{
  "name": "OciVaultSecret",
  "kind": "OciVaultSecret",
  "cloudProvider": "oci",
  "apiVersion": "oci.openmcf.org/v1",
  "description": "OciVaultSecret is the Kubernetes Resource Model (KRM) envelope for\n deploying a secret into an OCI KMS Vault.",
  "protoPackage": "org.openmcf.provider.oci.ocivaultsecret.v1",
  "protoFiles": {
    "api": "org/openmcf/provider/oci/ocivaultsecret/v1/api.proto",
    "spec": "org/openmcf/provider/oci/ocivaultsecret/v1/spec.proto"
  },
  "spec": {
    "name": "OciVaultSecretSpec",
    "fields": [
      {
        "name": "CompartmentId",
        "jsonName": "compartmentId",
        "protoField": "compartment_id",
        "type": {
          "kind": "string"
        },
        "description": "OCID of the compartment where the secret will be created.",
        "required": true,
        "validation": {
          "required": true
        },
        "referenceKind": "OciCompartment",
        "referenceFieldPath": "status.outputs.compartmentId"
      },
      {
        "name": "SecretName",
        "jsonName": "secretName",
        "protoField": "secret_name",
        "type": {
          "kind": "string"
        },
        "description": "User-friendly name for the secret. Must be unique within the vault.\n Immutable after creation.",
        "required": false,
        "validation": {
          "minLength": 1
        }
      },
      {
        "name": "VaultId",
        "jsonName": "vaultId",
        "protoField": "vault_id",
        "type": {
          "kind": "string"
        },
        "description": "OCID of the vault that will contain this secret.\n Immutable after creation.",
        "required": true,
        "validation": {
          "required": true
        },
        "referenceKind": "OciKmsVault",
        "referenceFieldPath": "status.outputs.vaultId"
      },
      {
        "name": "KeyId",
        "jsonName": "keyId",
        "protoField": "key_id",
        "type": {
          "kind": "string"
        },
        "description": "OCID of the master encryption key used to encrypt this secret.\n Must be a symmetric key within the specified vault.\n Immutable after creation.",
        "required": true,
        "validation": {
          "required": true
        },
        "referenceKind": "OciKmsKey",
        "referenceFieldPath": "status.outputs.keyId"
      },
      {
        "name": "Description",
        "jsonName": "description",
        "protoField": "description",
        "type": {
          "kind": "string"
        },
        "description": "Brief description of the secret.",
        "required": false
      },
      {
        "name": "SecretContent",
        "jsonName": "secretContent",
        "protoField": "secret_content",
        "type": {
          "kind": "message",
          "messageType": "SecretContent"
        },
        "description": "Explicit secret content (base64-encoded). Mutually exclusive with\n auto-generation (enable_auto_generation + secret_generation_context).\n Updating this field creates a new secret version.",
        "required": false
      },
      {
        "name": "EnableAutoGeneration",
        "jsonName": "enableAutoGeneration",
        "protoField": "enable_auto_generation",
        "type": {
          "kind": "bool"
        },
        "description": "Enable automatic secret content generation. When true,\n secret_generation_context must be provided and secret_content\n must not be set.",
        "required": false
      },
      {
        "name": "SecretGenerationContext",
        "jsonName": "secretGenerationContext",
        "protoField": "secret_generation_context",
        "type": {
          "kind": "message",
          "messageType": "SecretGenerationContext"
        },
        "description": "Configuration for automatic secret content generation.\n Required when enable_auto_generation is true; must not be set otherwise.",
        "required": false
      },
      {
        "name": "SecretRules",
        "jsonName": "secretRules",
        "protoField": "secret_rules",
        "type": {
          "kind": "array",
          "elementType": {
            "kind": "message",
            "messageType": "SecretRule"
          }
        },
        "description": "Lifecycle rules controlling secret expiry and content reuse.",
        "required": false
      },
      {
        "name": "RotationConfig",
        "jsonName": "rotationConfig",
        "protoField": "rotation_config",
        "type": {
          "kind": "message",
          "messageType": "RotationConfig"
        },
        "description": "Configuration for scheduled secret rotation against a target system.",
        "required": false
      },
      {
        "name": "SecretMetadata",
        "jsonName": "secretMetadata",
        "protoField": "secret_metadata",
        "type": {
          "kind": "map",
          "keyType": {
            "kind": "string"
          },
          "valueType": {
            "kind": "string"
          }
        },
        "description": "Additional metadata key-value pairs for administrative context\n (e.g., rotation notes, target system hints). Named secret_metadata\n to distinguish from OpenMCF's CloudResourceMetadata.",
        "required": false
      }
    ]
  },
  "nestedTypes": [
    {
      "name": "RotationConfig",
      "description": "RotationConfig configures scheduled rotation of secret content\n against a target system (Autonomous Database or OCI Functions).",
      "protoType": "org.openmcf.provider.oci.ocivaultsecret.v1.OciVaultSecretSpec.RotationConfig",
      "fields": [
        {
          "name": "IsScheduledRotationEnabled",
          "jsonName": "isScheduledRotationEnabled",
          "protoField": "is_scheduled_rotation_enabled",
          "type": {
            "kind": "bool"
          },
          "description": "Enable scheduled automatic rotation.",
          "required": false
        },
        {
          "name": "RotationInterval",
          "jsonName": "rotationInterval",
          "protoField": "rotation_interval",
          "type": {
            "kind": "string"
          },
          "description": "Rotation interval in ISO 8601 duration format (e.g., \"P30D\").\n Range: 1-360 days. Required when is_scheduled_rotation_enabled\n is true.",
          "required": false
        },
        {
          "name": "TargetSystemDetails",
          "jsonName": "targetSystemDetails",
          "protoField": "target_system_details",
          "type": {
            "kind": "message",
            "messageType": "TargetSystemDetails"
          },
          "description": "Target system that will be updated during rotation.",
          "required": true,
          "validation": {
            "required": true
          }
        }
      ]
    },
    {
      "name": "SecretContent",
      "description": "SecretContent holds explicit secret data provided by the user.\n content_type is hardcoded to BASE64 in IaC modules (only valid\n value today) and not exposed in the spec.",
      "protoType": "org.openmcf.provider.oci.ocivaultsecret.v1.OciVaultSecretSpec.SecretContent",
      "fields": [
        {
          "name": "Content",
          "jsonName": "content",
          "protoField": "content",
          "type": {
            "kind": "string"
          },
          "description": "Base64-encoded secret data.",
          "required": false
        },
        {
          "name": "Name",
          "jsonName": "name",
          "protoField": "name",
          "type": {
            "kind": "string"
          },
          "description": "Optional version name. Must be unique across versions of this secret.",
          "required": false
        },
        {
          "name": "Stage",
          "jsonName": "stage",
          "protoField": "stage",
          "type": {
            "kind": "string"
          },
          "description": "Rotation state of this content version.\n Valid values: \"CURRENT\" (default when omitted), \"PENDING\".",
          "required": false,
          "validation": {
            "enum": [
              "",
              "CURRENT",
              "PENDING"
            ]
          }
        }
      ]
    },
    {
      "name": "SecretGenerationContext",
      "description": "SecretGenerationContext configures OCI's automatic secret content\n generation. Used when enable_auto_generation is true.",
      "protoType": "org.openmcf.provider.oci.ocivaultsecret.v1.OciVaultSecretSpec.SecretGenerationContext",
      "fields": [
        {
          "name": "GenerationType",
          "jsonName": "generationType",
          "protoField": "generation_type",
          "type": {
            "kind": "enum",
            "enumType": "org.openmcf.provider.oci.ocivaultsecret.v1.GenerationType",
            "enumValues": [
              "bytes",
              "passphrase",
              "ssh_key"
            ]
          },
          "description": "Type of secret content to generate.",
          "required": false
        },
        {
          "name": "GenerationTemplate",
          "jsonName": "generationTemplate",
          "protoField": "generation_template",
          "type": {
            "kind": "string"
          },
          "description": "Name of the generation template. Template names are provider-defined\n and vary by generation_type.",
          "required": false,
          "validation": {
            "minLength": 1
          }
        },
        {
          "name": "PassphraseLength",
          "jsonName": "passphraseLength",
          "protoField": "passphrase_length",
          "type": {
            "kind": "int32"
          },
          "description": "Length of the passphrase to generate. Required when generation_type\n is passphrase.",
          "required": false
        },
        {
          "name": "SecretTemplate",
          "jsonName": "secretTemplate",
          "protoField": "secret_template",
          "type": {
            "kind": "string"
          },
          "description": "Optional template structure for storing the generated secret.\n Supports predefined placeholders for the generated values.",
          "required": false
        }
      ]
    },
    {
      "name": "SecretRule",
      "description": "SecretRule defines a lifecycle policy for secret versions.\n Uses a flat discriminated model: rule_type selects which fields apply.",
      "protoType": "org.openmcf.provider.oci.ocivaultsecret.v1.OciVaultSecretSpec.SecretRule",
      "fields": [
        {
          "name": "RuleType",
          "jsonName": "ruleType",
          "protoField": "rule_type",
          "type": {
            "kind": "enum",
            "enumType": "org.openmcf.provider.oci.ocivaultsecret.v1.RuleType",
            "enumValues": [
              "secret_expiry_rule",
              "secret_reuse_rule"
            ]
          },
          "description": "Discriminator selecting the rule type.",
          "required": false
        },
        {
          "name": "IsSecretContentRetrievalBlockedOnExpiry",
          "jsonName": "isSecretContentRetrievalBlockedOnExpiry",
          "protoField": "is_secret_content_retrieval_blocked_on_expiry",
          "type": {
            "kind": "bool"
          },
          "description": "Block retrieval of secret content after the version expires.\n Applies when rule_type is secret_expiry_rule.",
          "required": false
        },
        {
          "name": "SecretVersionExpiryInterval",
          "jsonName": "secretVersionExpiryInterval",
          "protoField": "secret_version_expiry_interval",
          "type": {
            "kind": "string"
          },
          "description": "Duration after which each secret version expires, in ISO 8601\n format (e.g., \"P30D\" for 30 days). Range: 1-90 days.\n Applies when rule_type is secret_expiry_rule.",
          "required": false
        },
        {
          "name": "TimeOfAbsoluteExpiry",
          "jsonName": "timeOfAbsoluteExpiry",
          "protoField": "time_of_absolute_expiry",
          "type": {
            "kind": "string"
          },
          "description": "Absolute expiry timestamp in RFC 3339 format. Range: 1-365 days\n from creation. Applies when rule_type is secret_expiry_rule.",
          "required": false
        },
        {
          "name": "IsEnforcedOnDeletedSecretVersions",
          "jsonName": "isEnforcedOnDeletedSecretVersions",
          "protoField": "is_enforced_on_deleted_secret_versions",
          "type": {
            "kind": "bool"
          },
          "description": "Enforce the reuse rule even on deleted secret versions.\n Applies when rule_type is secret_reuse_rule.",
          "required": false
        }
      ]
    },
    {
      "name": "TargetSystemDetails",
      "description": "TargetSystemDetails identifies the system whose credentials\n are rotated. Uses a discriminated model: target_system_type\n selects which ID field is required.",
      "protoType": "org.openmcf.provider.oci.ocivaultsecret.v1.OciVaultSecretSpec.RotationConfig.TargetSystemDetails",
      "fields": [
        {
          "name": "TargetSystemType",
          "jsonName": "targetSystemType",
          "protoField": "target_system_type",
          "type": {
            "kind": "enum",
            "enumType": "org.openmcf.provider.oci.ocivaultsecret.v1.TargetSystemType",
            "enumValues": [
              "adb",
              "function"
            ]
          },
          "description": "Type of target system.",
          "required": false
        },
        {
          "name": "AdbId",
          "jsonName": "adbId",
          "protoField": "adb_id",
          "type": {
            "kind": "string"
          },
          "description": "OCID of the Autonomous Database whose credentials are rotated.\n Required when target_system_type is adb.",
          "required": false,
          "referenceKind": "OciAutonomousDatabase",
          "referenceFieldPath": "status.outputs.autonomousDatabaseId"
        },
        {
          "name": "FunctionId",
          "jsonName": "functionId",
          "protoField": "function_id",
          "type": {
            "kind": "string"
          },
          "description": "OCID of the OCI Functions function invoked during rotation.\n Required when target_system_type is function.",
          "required": false
        }
      ]
    }
  ]
}
