{
  "name": "CloudflareWorker",
  "kind": "CloudflareWorker",
  "cloudProvider": "cloudflare",
  "apiVersion": "cloudflare.openmcf.org/v1",
  "description": "cloudflare-worker",
  "protoPackage": "org.openmcf.provider.cloudflare.cloudflareworker.v1",
  "protoFiles": {
    "api": "org/openmcf/provider/cloudflare/cloudflareworker/v1/api.proto",
    "spec": "org/openmcf/provider/cloudflare/cloudflareworker/v1/spec.proto"
  },
  "spec": {
    "name": "CloudflareWorkerSpec",
    "fields": [
      {
        "name": "AccountId",
        "jsonName": "accountId",
        "protoField": "account_id",
        "type": {
          "kind": "string"
        },
        "description": "The Cloudflare account ID in which to create the worker.",
        "required": true,
        "validation": {
          "required": true,
          "pattern": "^[0-9a-fA-F]{32}$"
        }
      },
      {
        "name": "WorkerName",
        "jsonName": "workerName",
        "protoField": "worker_name",
        "type": {
          "kind": "string"
        },
        "description": "The name of the Cloudflare Worker.\n This is the worker name that will be visible in the Cloudflare dashboard.",
        "required": true,
        "validation": {
          "required": true,
          "minLength": 1,
          "maxLength": 63
        }
      },
      {
        "name": "ScriptBundle",
        "jsonName": "scriptBundle",
        "protoField": "script_bundle",
        "type": {
          "kind": "message",
          "messageType": "CloudflareWorkerScriptBundle"
        },
        "description": "Worker script bundle configuration.\n Specifies the R2 bucket and path where the pre-built Worker script bundle is stored.",
        "required": true,
        "validation": {
          "required": true
        }
      },
      {
        "name": "KvBindings",
        "jsonName": "kvBindings",
        "protoField": "kv_bindings",
        "type": {
          "kind": "array",
          "elementType": {
            "kind": "string"
          }
        },
        "description": "(Optional) One or more KV namespaces to bind to this Worker (referenced by CloudflareKVNamespace.namespace_id).",
        "required": false,
        "referenceKind": "CloudflareKvNamespace",
        "referenceFieldPath": "status.outputs.namespace_id"
      },
      {
        "name": "Dns",
        "jsonName": "dns",
        "protoField": "dns",
        "type": {
          "kind": "message",
          "messageType": "CloudflareWorkerDns"
        },
        "description": "(Optional) DNS configuration for attaching the Worker to a custom domain.",
        "required": false
      },
      {
        "name": "CompatibilityDate",
        "jsonName": "compatibilityDate",
        "protoField": "compatibility_date",
        "type": {
          "kind": "string"
        },
        "description": "(Optional) Compatibility date for the Worker script (YYYY-MM-DD). If unset, defaults to today's date.",
        "required": false,
        "validation": {
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        }
      },
      {
        "name": "UsageModel",
        "jsonName": "usageModel",
        "protoField": "usage_model",
        "type": {
          "kind": "enum",
          "enumType": "org.openmcf.provider.cloudflare.cloudflareworker.v1.CloudflareWorkerUsageModel",
          "enumValues": [
            "UNBOUND"
          ]
        },
        "description": "(Optional) Billing/usage model for the Worker. Defaults to BUNDLED if unspecified.",
        "required": false
      },
      {
        "name": "Env",
        "jsonName": "env",
        "protoField": "env",
        "type": {
          "kind": "message",
          "messageType": "CloudflareWorkerEnv"
        },
        "description": "Environment configuration supporting variables and secrets.\n Variables become plain-text bindings in the Worker.\n Secrets are uploaded via Cloudflare Workers Secrets API (encrypted at rest).",
        "required": false
      }
    ]
  },
  "nestedTypes": [
    {
      "name": "CloudflareWorkerDns",
      "description": "CloudflareWorkerDns defines DNS configuration for attaching a Worker to a custom domain.",
      "protoType": "org.openmcf.provider.cloudflare.cloudflareworker.v1.CloudflareWorkerDns",
      "fields": [
        {
          "name": "Enabled",
          "jsonName": "enabled",
          "protoField": "enabled",
          "type": {
            "kind": "bool"
          },
          "description": "Enable or disable DNS/route configuration. Set to false to deploy worker without a route.",
          "required": false
        },
        {
          "name": "ZoneId",
          "jsonName": "zoneId",
          "protoField": "zone_id",
          "type": {
            "kind": "string"
          },
          "description": "The Cloudflare Zone ID where the Worker route will be created.",
          "required": false,
          "validation": {
            "minLength": 1
          }
        },
        {
          "name": "Hostname",
          "jsonName": "hostname",
          "protoField": "hostname",
          "type": {
            "kind": "string"
          },
          "description": "The fully qualified domain name where the Worker will be accessible (e.g., \"git-webhooks.planton.live\").\n A DNS record will be created automatically for this hostname with proxy (orange cloud) enabled.",
          "required": false,
          "validation": {
            "minLength": 1
          }
        },
        {
          "name": "RoutePattern",
          "jsonName": "routePattern",
          "protoField": "route_pattern",
          "type": {
            "kind": "string"
          },
          "description": "(Optional) URL pattern to match incoming requests. If not specified, defaults to \"hostname/*\".\n Examples: \"git-webhooks.planton.live/*\", \"api.example.com/webhooks/*\"",
          "required": false
        }
      ]
    },
    {
      "name": "CloudflareWorkerEnv",
      "description": "CloudflareWorkerEnv defines environment variables and secrets for a CloudflareWorker.",
      "protoType": "org.openmcf.provider.cloudflare.cloudflareworker.v1.CloudflareWorkerEnv",
      "fields": [
        {
          "name": "Variables",
          "jsonName": "variables",
          "protoField": "variables",
          "type": {
            "kind": "map",
            "keyType": {
              "kind": "string"
            },
            "valueType": {
              "kind": "string"
            }
          },
          "description": "Non-sensitive configuration (becomes plain-text bindings in the Worker).\n Supports plain values or $variables-group/... references.\n Example: LOG_LEVEL: \"info\"\n Example: NAMESPACE: \"$variables-group/temporal/namespace\"",
          "required": false
        },
        {
          "name": "Secrets",
          "jsonName": "secrets",
          "protoField": "secrets",
          "type": {
            "kind": "map",
            "keyType": {
              "kind": "string"
            },
            "valueType": {
              "kind": "string"
            }
          },
          "description": "Sensitive configuration (uploaded via Cloudflare Secrets API, encrypted at rest).\n Supports plain values or $secrets-group/... references.\n Example: API_KEY: \"$secrets-group/external-apis/stripe-key\"\n Note: Secrets are uploaded separately from the worker version and are never logged.",
          "required": false
        }
      ]
    },
    {
      "name": "CloudflareWorkerScriptBundle",
      "description": "CloudflareWorkerScriptBundle defines the R2 object reference for the pre-built Worker script bundle.",
      "protoType": "org.openmcf.provider.cloudflare.cloudflareworker.v1.CloudflareWorkerScriptBundle",
      "fields": [
        {
          "name": "Bucket",
          "jsonName": "bucket",
          "protoField": "bucket",
          "type": {
            "kind": "string"
          },
          "description": "The R2 bucket name where the script bundle is stored.",
          "required": true,
          "validation": {
            "required": true
          }
        },
        {
          "name": "Path",
          "jsonName": "path",
          "protoField": "path",
          "type": {
            "kind": "string"
          },
          "description": "The path to the script bundle within the R2 bucket.",
          "required": true,
          "validation": {
            "required": true
          }
        }
      ]
    }
  ]
}
