// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T22:24:53+05:30

package oci

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OciFunctionsApplication is the top-level resource representing an OCI
//
//	Functions Application -- the organizational container for serverless
//	functions in Oracle Cloud Infrastructure.
type OciFunctionsApplicationSpecInput struct {
	// OCID of the compartment where the application will be created.
	CompartmentId string `json:"compartment_id" jsonschema:"required,OCID of the compartment where the application will be created."`
	// OCIDs of the subnets in which to run functions. At least one subnet
	//  is required. Functions execute in these subnets and can reach resources
	//  accessible from them. Immutable after creation.
	SubnetIds []string `json:"subnet_ids,omitempty" jsonschema:"OCIDs of the subnets in which to run functions. At least one subnet is required. Functions execute in these subnets and can reach resources accessible from them. Immutable after creation."`
	// Display name for the application. Must be unique within the compartment.
	//  When omitted, the metadata name is used. Immutable after creation.
	DisplayName string `json:"display_name,omitempty" jsonschema:"Display name for the application. Must be unique within the compartment. When omitted; the metadata name is used. Immutable after creation."`
	// Processor architecture for running functions. When omitted, OCI
	//  defaults to GENERIC_X86. Immutable after creation.
	//    - generic_x86:     Intel/AMD x86-64
	//    - generic_arm:     Arm-based (Ampere A1)
	//    - generic_x86_arm: multi-architecture (runs on either)
	Shape string `json:"shape,omitempty" jsonschema:"enum=generic_x86|generic_arm|generic_x86_arm,Processor architecture for running functions. When omitted; OCI defaults to GENERIC_X86. Immutable after creation. - generic_x86: Intel/AMD x86-64 - generic_arm: Arm-based (Ampere A1) - generic_x86_ar..."`
	// Application configuration passed as environment variables to all
	//  functions in this application. Keys must be ASCII strings consisting
	//  of letters, digits, and underscores; must not begin with a digit.
	//  Maximum total size for all keys and values is 4 KB.
	Config map[string]string `json:"config,omitempty" jsonschema:"Application configuration passed as environment variables to all functions in this application. Keys must be ASCII strings consisting of letters; digits; and underscores; must not begin with a digit. ..."`
	// OCIDs of network security groups applied to the application.
	NetworkSecurityGroupIds []string `json:"network_security_group_ids,omitempty" jsonschema:"OCIDs of network security groups applied to the application."`
	// Syslog URL to send all function logs. Supports tcp, udp, and tcp+tls
	//  schemes (e.g., "tcp://logserver.example.com:514"). Must be reachable
	//  from the configured subnets. Ignored when OCI Logging service is enabled.
	SyslogUrl string `json:"syslog_url,omitempty" jsonschema:"Syslog URL to send all function logs. Supports tcp; udp; and tcp+tls schemes (e.g.; 'tcp://logserver.example.com:514'). Must be reachable from the configured subnets. Ignored when OCI Logging service ..."`
	// Image signature verification policy. When enabled, only container
	//  images signed by the specified KMS keys can be used for functions.
	ImagePolicyConfig *ImagePolicyConfigInput `json:"image_policy_config,omitempty" jsonschema:"Image signature verification policy. When enabled; only container images signed by the specified KMS keys can be used for functions."`
	// Distributed tracing configuration for integration with OCI
	//  Application Performance Monitoring (APM).
	TraceConfig *TraceConfigInput `json:"trace_config,omitempty" jsonschema:"Distributed tracing configuration for integration with OCI Application Performance Monitoring (APM)."`
}

func (s *OciFunctionsApplicationSpecInput) validate() error {
	if s.CompartmentId == "" {
		return fmt.Errorf("compartment_id is required")
	}
	if len(s.SubnetIds) < 1 {
		return fmt.Errorf("subnet_ids requires at least 1 items, got %d", len(s.SubnetIds))
	}
	switch s.Shape {
	case "", "generic_x86", "generic_arm", "generic_x86_arm":
	default:
		return fmt.Errorf("invalid shape: %q", s.Shape)
	}
	if s.ImagePolicyConfig != nil {
		if err := s.ImagePolicyConfig.validate(); err != nil {
			return fmt.Errorf("image_policy_config: %w", err)
		}
	}
	if s.TraceConfig != nil {
		if err := s.TraceConfig.validate(); err != nil {
			return fmt.Errorf("trace_config: %w", err)
		}
	}
	return nil
}

func (s *OciFunctionsApplicationSpecInput) applyDefaults() {
	if s.ImagePolicyConfig != nil {
		s.ImagePolicyConfig.applyDefaults()
	}
	if s.TraceConfig != nil {
		s.TraceConfig.applyDefaults()
	}
}

func (s *OciFunctionsApplicationSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["compartment_id"] = s.CompartmentId
	if len(s.SubnetIds) > 0 {
		m["subnet_ids"] = s.SubnetIds
	}
	if s.DisplayName != "" {
		m["display_name"] = s.DisplayName
	}
	if s.Shape != "" {
		m["shape"] = s.Shape
	}
	if len(s.Config) > 0 {
		m["config"] = s.Config
	}
	if len(s.NetworkSecurityGroupIds) > 0 {
		m["network_security_group_ids"] = s.NetworkSecurityGroupIds
	}
	if s.SyslogUrl != "" {
		m["syslog_url"] = s.SyslogUrl
	}
	if s.ImagePolicyConfig != nil {
		m["image_policy_config"] = s.ImagePolicyConfig.toMap()
	}
	if s.TraceConfig != nil {
		m["trace_config"] = s.TraceConfig.toMap()
	}
	return m
}

// TraceConfig configures distributed tracing via OCI Application
//
//	Performance Monitoring (APM).
type TraceConfigInput struct {
	// Whether tracing is enabled for this application.
	IsEnabled bool `json:"is_enabled,omitempty" jsonschema:"Whether tracing is enabled for this application."`
	// OCID of the APM domain (collector) where trace events are sent.
	//  Only meaningful when is_enabled is true.
	DomainId string `json:"domain_id,omitempty" jsonschema:"OCID of the APM domain (collector) where trace events are sent. Only meaningful when is_enabled is true."`
}

func (s *TraceConfigInput) validate() error {
	return nil
}

func (s *TraceConfigInput) applyDefaults() {
}

func (s *TraceConfigInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.IsEnabled {
		m["is_enabled"] = s.IsEnabled
	}
	if s.DomainId != "" {
		m["domain_id"] = s.DomainId
	}
	return m
}

// ParseOciFunctionsApplication validates and normalizes a OciFunctionsApplication cloud_object.
func ParseOciFunctionsApplication(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "oci.openmcf.org/v1", "OciFunctionsApplication"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OciFunctionsApplicationSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
