// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T22:24:53+05:30

package alicloud

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// alicloud-ram-policy
type AliCloudRamPolicySpecInput struct {
	// Alibaba Cloud region for provider endpoint configuration.
	//  RAM is a global service, but the provider requires a region for API routing.
	//  Examples: "cn-hangzhou", "cn-shanghai", "us-west-1", "ap-southeast-1".
	Region string `json:"region" jsonschema:"required,Alibaba Cloud region for provider endpoint configuration. RAM is a global service; but the provider requires a region for API routing. Examples: 'cn-hangzhou'; 'cn-shanghai'; 'us-west-1'; 'ap-southeas..."`
	// RAM policy name. Must be unique within the Alibaba Cloud account.
	//  1-128 characters: English letters, digits, and hyphens (-).
	PolicyName string `json:"policy_name" jsonschema:"required,RAM policy name. Must be unique within the Alibaba Cloud account. 1-128 characters: English letters; digits; and hyphens (-)."`
	// Human-readable description of what this policy allows or denies.
	//  Maximum 1024 characters.
	Description string `json:"description,omitempty" jsonschema:"Human-readable description of what this policy allows or denies. Maximum 1024 characters."`
	// JSON IAM policy document defining the permissions.
	//  Maximum 6144 bytes. Must be valid JSON conforming to the Alibaba Cloud
	//  RAM policy structure with Version, Statement, Effect, Action, and Resource.
	//
	//  Example granting read-only access to a specific OSS bucket:
	//    {"Version":"1","Statement":[{"Effec...
	PolicyDocument string `json:"policy_document" jsonschema:"required,JSON IAM policy document defining the permissions. Maximum 6144 bytes. Must be valid JSON conforming to the Alibaba Cloud RAM policy structure with Version; Statement; Effect; Action; and Resource. Ex..."`
	// Strategy for handling policy versions when the 5-version limit is reached.
	//  "None" (default): update fails if the limit is reached; you must manually
	//    delete old versions.
	//  "DeleteOldestNonDefaultVersionWhenLimitExceeded": automatically deletes
	//    the oldest non-default version to make room.
	RotateStrategy string `json:"rotate_strategy,omitempty" jsonschema:"Strategy for handling policy versions when the 5-version limit is reached. 'None' (default): update fails if the limit is reached; you must manually delete old versions. 'DeleteOldestNonDefaultVersion..."`
	// Tags applied to the RAM policy for organizational and cost-tracking purposes.
	Tags map[string]string `json:"tags,omitempty" jsonschema:"Tags applied to the RAM policy for organizational and cost-tracking purposes."`
	// Force-delete the policy even if it is still attached to roles, users, or groups.
	//  When true, the policy is detached from all entities and all non-default versions
	//  are deleted before the policy itself is removed.
	//  When false (default), deletion fails if the policy is still attached.
	//  Default: false
	Force bool `json:"force,omitempty" jsonschema:"Force-delete the policy even if it is still attached to roles; users; or groups. When true; the policy is detached from all entities and all non-default versions are deleted before the policy itself i..."`
}

func (s *AliCloudRamPolicySpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	if s.PolicyName == "" {
		return fmt.Errorf("policy_name is required")
	}
	if s.PolicyDocument == "" {
		return fmt.Errorf("policy_document is required")
	}
	return nil
}

func (s *AliCloudRamPolicySpecInput) applyDefaults() {
}

func (s *AliCloudRamPolicySpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	m["policy_name"] = s.PolicyName
	if s.Description != "" {
		m["description"] = s.Description
	}
	m["policy_document"] = s.PolicyDocument
	if s.RotateStrategy != "" {
		m["rotate_strategy"] = s.RotateStrategy
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if s.Force {
		m["force"] = s.Force
	}
	return m
}

// ParseAliCloudRamPolicy validates and normalizes a AliCloudRamPolicy cloud_object.
func ParseAliCloudRamPolicy(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "ali-cloud.openmcf.org/v1", "AliCloudRamPolicy"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AliCloudRamPolicySpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
