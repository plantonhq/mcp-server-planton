// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T22:24:53+05:30

package alicloud

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// alicloud-kms-key
type AliCloudKmsKeySpecInput struct {
	// Alibaba Cloud region where the KMS key will be created.
	//  The key can only be used by resources in the same region.
	//  Examples: "cn-hangzhou", "cn-shanghai", "us-west-1", "ap-southeast-1".
	Region string `json:"region" jsonschema:"required,Alibaba Cloud region where the KMS key will be created. The key can only be used by resources in the same region. Examples: 'cn-hangzhou'; 'cn-shanghai'; 'us-west-1'; 'ap-southeast-1'."`
	// Human-readable description of the key's intended use.
	Description string `json:"description,omitempty" jsonschema:"Human-readable description of the key's intended use."`
	// Cryptographic algorithm for the key material.
	//
	//  Symmetric keys (ENCRYPT/DECRYPT):
	//    "Aliyun_AES_256" -- AES-256 (default, recommended for most use cases)
	//    "Aliyun_AES_128" -- AES-128 (Dedicated KMS only)
	//    "Aliyun_AES_192" -- AES-192 (Dedicated KMS only)
	//    "Aliyun_SM4"     -- Chinese national s...
	KeySpec string `json:"key_spec,omitempty" jsonschema:"Cryptographic algorithm for the key material. Symmetric keys (ENCRYPT/DECRYPT): 'Aliyun_AES_256' -- AES-256 (default; recommended for most use cases) 'Aliyun_AES_128' -- AES-128 (Dedicated KMS only) '..."`
	// Intended cryptographic operation for the key.
	//
	//  "ENCRYPT/DECRYPT" -- symmetric encryption/decryption (use with AES/SM4 key specs).
	//  "SIGN/VERIFY"     -- asymmetric signing/verification (use with RSA/EC key specs).
	//
	//  This field is immutable after creation (ForceNew in the provider).
	//  Default: "ENCRYP...
	KeyUsage string `json:"key_usage,omitempty" jsonschema:"Intended cryptographic operation for the key. 'ENCRYPT/DECRYPT' -- symmetric encryption/decryption (use with AES/SM4 key specs). 'SIGN/VERIFY' -- asymmetric signing/verification (use with RSA/EC key s..."`
	// Protection level for the key material.
	//
	//  "SOFTWARE" -- key material is protected by software-based cryptographic
	//    modules. Suitable for most workloads.
	//  "HSM" -- key material is stored and used exclusively within a Hardware
	//    Security Module. Required for regulatory compliance in some industries....
	ProtectionLevel string `json:"protection_level,omitempty" jsonschema:"Protection level for the key material. 'SOFTWARE' -- key material is protected by software-based cryptographic modules. Suitable for most workloads. 'HSM' -- key material is stored and used exclusivel..."`
	// Enable automatic key rotation.
	//
	//  When enabled, Alibaba Cloud periodically generates new key material for
	//  the CMK according to rotation_interval. Previous key versions remain
	//  available for decryption, but new encrypt operations use the latest version.
	//
	//  Automatic rotation is only supported for symm...
	AutomaticRotation bool `json:"automatic_rotation,omitempty" jsonschema:"Enable automatic key rotation. When enabled; Alibaba Cloud periodically generates new key material for the CMK according to rotation_interval. Previous key versions remain available for decryption; bu..."`
	// Period between automatic rotations.
	//
	//  Accepted formats: "Nd" for days (e.g., "365d"), "Ns" for seconds
	//  (e.g., "604800s"), "Nh" for hours (e.g., "8760h").
	//
	//  Required when automatic_rotation is true. Ignored when false.
	//  Common production value: "365d" (annual rotation).
	RotationInterval string `json:"rotation_interval,omitempty" jsonschema:"Period between automatic rotations. Accepted formats: 'Nd' for days (e.g.; '365d'); 'Ns' for seconds (e.g.; '604800s'); 'Nh' for hours (e.g.; '8760h'). Required when automatic_rotation is true. Ignore..."`
	// Number of days to wait before permanently deleting the key after a
	//  deletion request. During this window the key enters PendingDeletion
	//  state and can be recovered by cancelling the deletion.
	//
	//  Range: 7-366 days.
	//  Default: 30
	PendingWindowInDays int32 `json:"pending_window_in_days,omitempty" jsonschema:"Number of days to wait before permanently deleting the key after a deletion request. During this window the key enters PendingDeletion state and can be recovered by cancelling the deletion. Range: 7-3..."`
	// Enable deletion protection to prevent accidental key deletion.
	//
	//  When enabled, any attempt to delete the key will be rejected until
	//  deletion protection is explicitly disabled. Strongly recommended for
	//  production encryption keys -- losing a KMS key means permanent,
	//  irrecoverable data loss for any ...
	DeletionProtection bool `json:"deletion_protection,omitempty" jsonschema:"Enable deletion protection to prevent accidental key deletion. When enabled; any attempt to delete the key will be rejected until deletion protection is explicitly disabled. Strongly recommended for p..."`
	// Reason for enabling deletion protection. Provides an audit trail for
	//  why the key is protected. Only meaningful when deletion_protection
	//  is true.
	DeletionProtectionDescription string `json:"deletion_protection_description,omitempty" jsonschema:"Reason for enabling deletion protection. Provides an audit trail for why the key is protected. Only meaningful when deletion_protection is true."`
	// Tags to apply to the KMS key.
	Tags map[string]string `json:"tags,omitempty" jsonschema:"Tags to apply to the KMS key."`
}

func (s *AliCloudKmsKeySpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	return nil
}

func (s *AliCloudKmsKeySpecInput) applyDefaults() {
	if s.KeySpec == "" {
		s.KeySpec = "Aliyun_AES_256"
	}
	if s.KeyUsage == "" {
		s.KeyUsage = "ENCRYPT/DECRYPT"
	}
	if s.ProtectionLevel == "" {
		s.ProtectionLevel = "SOFTWARE"
	}
	if s.PendingWindowInDays == 0 {
		s.PendingWindowInDays = 30
	}
}

func (s *AliCloudKmsKeySpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.KeySpec != "" {
		m["key_spec"] = s.KeySpec
	}
	if s.KeyUsage != "" {
		m["key_usage"] = s.KeyUsage
	}
	if s.ProtectionLevel != "" {
		m["protection_level"] = s.ProtectionLevel
	}
	if s.AutomaticRotation {
		m["automatic_rotation"] = s.AutomaticRotation
	}
	if s.RotationInterval != "" {
		m["rotation_interval"] = s.RotationInterval
	}
	if s.PendingWindowInDays != 0 {
		m["pending_window_in_days"] = s.PendingWindowInDays
	}
	if s.DeletionProtection {
		m["deletion_protection"] = s.DeletionProtection
	}
	if s.DeletionProtectionDescription != "" {
		m["deletion_protection_description"] = s.DeletionProtectionDescription
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	return m
}

// ParseAliCloudKmsKey validates and normalizes a AliCloudKmsKey cloud_object.
func ParseAliCloudKmsKey(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "ali-cloud.openmcf.org/v1", "AliCloudKmsKey"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AliCloudKmsKeySpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
