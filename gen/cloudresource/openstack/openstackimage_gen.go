// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package openstack

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OpenStackImage is a Kubernetes Resource Model (KRM) style resource
//
//	for managing OpenStack Glance images.
//
//	A Glance image is a virtual disk template used to boot compute instances
//	or initialize bootable Cinder volumes.
//
//	Common use cases:
//	  - Upload custom VM images from URLs for developer environments
//	  - Register organization-standard golden images with visibility controls
//	  - Create bootable volume templates from cloud images
type OpenStackImageSpecInput struct {
	// container_format describes the container or envelope format of the image.
	//  Required. ForceNew: cannot be changed after creation.
	//
	//  Common values:
	//    "bare"   - no container (most common for cloud images)
	//    "ovf"    - Open Virtualization Format
	//    "docker" - Docker container image
	ContainerFormat string `json:"container_format,omitempty" jsonschema:"container_format describes the container or envelope format of the image. Required. ForceNew: cannot be changed after creation. Common values: 'bare' - no container (most common for cloud images) 'ovf..."`
	// disk_format describes the format of the disk image data.
	//  Required. ForceNew: cannot be changed after creation.
	//
	//  Common values:
	//    "qcow2" - QEMU Copy On Write 2 (most common for KVM/libvirt)
	//    "raw"   - unstructured disk image
	//    "vmdk"  - VMware disk format
	//    "iso"   - optical disc image
	DiskFormat string `json:"disk_format,omitempty" jsonschema:"disk_format describes the format of the disk image data. Required. ForceNew: cannot be changed after creation. Common values: 'qcow2' - QEMU Copy On Write 2 (most common for KVM/libvirt) 'raw' - unstr..."`
	// image_source_url is the HTTP or HTTPS URL from which Glance downloads the
	//  image data. This is the primary mechanism for uploading images in
	//  pipeline-based IaC workflows.
	//  ForceNew: the source cannot be changed after creation.
	//
	//  Example: "https://cloud-images.ubuntu.com/jammy/current/jammy-server-c...
	ImageSourceUrl string `json:"image_source_url,omitempty" jsonschema:"image_source_url is the HTTP or HTTPS URL from which Glance downloads the image data. This is the primary mechanism for uploading images in pipeline-based IaC workflows. ForceNew: the source cannot be..."`
	// min_disk_gb is the minimum disk size in GB required to boot this image.
	//  Set this to prevent users from booting the image on a flavor with
	//  insufficient disk. Zero means no minimum.
	MinDiskGb int32 `json:"min_disk_gb,omitempty" jsonschema:"min_disk_gb is the minimum disk size in GB required to boot this image. Set this to prevent users from booting the image on a flavor with insufficient disk. Zero means no minimum."`
	// min_ram_mb is the minimum RAM in MB required to boot this image.
	//  Set this to prevent users from booting the image on a flavor with
	//  insufficient memory. Zero means no minimum.
	MinRamMb int32 `json:"min_ram_mb,omitempty" jsonschema:"min_ram_mb is the minimum RAM in MB required to boot this image. Set this to prevent users from booting the image on a flavor with insufficient memory. Zero means no minimum."`
	// protected prevents the image from being deleted.
	//  Set to true for production images that should not be accidentally removed.
	//  Default: false
	Protected bool `json:"protected,omitempty" jsonschema:"protected prevents the image from being deleted. Set to true for production images that should not be accidentally removed. Default: false"`
	// hidden hides the image from default listing queries.
	//  Hidden images are still accessible by UUID but do not appear in
	//  `openstack image list` output.
	//  Default: false
	Hidden bool `json:"hidden,omitempty" jsonschema:"hidden hides the image from default listing queries. Hidden images are still accessible by UUID but do not appear in 'openstack image list' output. Default: false"`
	// tags is a set of tags to associate with the image.
	//  Tags are simple strings used for filtering images in Glance.
	//  Example: ["ubuntu", "22.04", "cloud-init"]
	Tags []string `json:"tags,omitempty" jsonschema:"tags is a set of tags to associate with the image. Tags are simple strings used for filtering images in Glance. Example: ['ubuntu'; '22.04'; 'cloud-init']"`
	// visibility controls who can see and use this image.
	//  Default: "private"
	//
	//  Values:
	//    "private"   - only the image owner (project) can see it
	//    "shared"    - owner can share with specific projects via member API
	//    "community" - visible to all projects but not in default listings
	//    "public"    - vi...
	Visibility string `json:"visibility,omitempty" jsonschema:"visibility controls who can see and use this image. Default: 'private' Values: 'private' - only the image owner (project) can see it 'shared' - owner can share with specific projects via member API 'c..."`
	// region overrides the region from the provider config for this image.
	//  If omitted, the region from the OpenStack provider config is used.
	//  Example: "RegionOne"
	Region string `json:"region,omitempty" jsonschema:"region overrides the region from the provider config for this image. If omitted; the region from the OpenStack provider config is used. Example: 'RegionOne'"`
}

func (s *OpenStackImageSpecInput) validate() error {
	return nil
}

func (s *OpenStackImageSpecInput) applyDefaults() {
	if s.Visibility == "" {
		s.Visibility = "private"
	}
}

func (s *OpenStackImageSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.ContainerFormat != "" {
		m["container_format"] = s.ContainerFormat
	}
	if s.DiskFormat != "" {
		m["disk_format"] = s.DiskFormat
	}
	if s.ImageSourceUrl != "" {
		m["image_source_url"] = s.ImageSourceUrl
	}
	if s.MinDiskGb != 0 {
		m["min_disk_gb"] = s.MinDiskGb
	}
	if s.MinRamMb != 0 {
		m["min_ram_mb"] = s.MinRamMb
	}
	if s.Protected {
		m["protected"] = s.Protected
	}
	if s.Hidden {
		m["hidden"] = s.Hidden
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if s.Visibility != "" {
		m["visibility"] = s.Visibility
	}
	if s.Region != "" {
		m["region"] = s.Region
	}
	return m
}

// ParseOpenStackImage validates and normalizes a OpenStackImage cloud_object.
func ParseOpenStackImage(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "openstack.openmcf.org/v1", "OpenStackImage"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OpenStackImageSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
