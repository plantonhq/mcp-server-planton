// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package openstack

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OpenStackNetwork is a Kubernetes Resource Model (KRM) style resource for managing
//
//	Neutron networks in OpenStack.
//
//	Networks are the foundational networking primitive in OpenStack, providing isolated
//	Layer 2 broadcast domains. All other networking resources (subnets, ports, routers,
//	security groups) attach to or reference a network.
type OpenStackNetworkSpecInput struct {
	// description is a human-readable description of the network.
	//  This is stored on the OpenStack resource and visible in Horizon and API responses.
	Description string `json:"description,omitempty" jsonschema:"description is a human-readable description of the network. This is stored on the OpenStack resource and visible in Horizon and API responses."`
	// admin_state_up controls the administrative state of the network.
	//  When false, the network is administratively down and will not forward traffic.
	//  Default: true
	AdminStateUp bool `json:"admin_state_up,omitempty" jsonschema:"admin_state_up controls the administrative state of the network. When false; the network is administratively down and will not forward traffic. Default: true"`
	// shared indicates whether this network is shared across all tenants/projects.
	//  Creating shared networks typically requires admin privileges.
	//  Most tenant users should leave this as false (the default).
	Shared bool `json:"shared,omitempty" jsonschema:"shared indicates whether this network is shared across all tenants/projects. Creating shared networks typically requires admin privileges. Most tenant users should leave this as false (the default)."`
	// external indicates whether this is an external (provider) network.
	//  External networks are used for floating IP allocation and router gateways.
	//  Creating external networks typically requires admin privileges.
	External bool `json:"external,omitempty" jsonschema:"external indicates whether this is an external (provider) network. External networks are used for floating IP allocation and router gateways. Creating external networks typically requires admin privil..."`
	// mtu is the Maximum Transmission Unit value for the network, in bytes.
	//  Common values: 1500 (standard Ethernet), 1450 (VXLAN overlay), 9000 (jumbo frames).
	//  If omitted or set to 0, OpenStack uses the default MTU for the network type.
	Mtu int32 `json:"mtu,omitempty" jsonschema:"mtu is the Maximum Transmission Unit value for the network; in bytes. Common values: 1500 (standard Ethernet); 1450 (VXLAN overlay); 9000 (jumbo frames). If omitted or set to 0; OpenStack uses the def..."`
	// dns_domain is the DNS domain associated with the network.
	//  When set, ports on this network can have DNS names auto-assigned.
	//  Must end with a dot (.) if specified (e.g., "my-network.example.com.").
	//  Requires the dns-integration extension in Neutron.
	DnsDomain string `json:"dns_domain,omitempty" jsonschema:"dns_domain is the DNS domain associated with the network. When set; ports on this network can have DNS names auto-assigned. Must end with a dot (.) if specified (e.g.; 'my-network.example.com.'). Requ..."`
	// port_security_enabled controls whether port security is enforced on ports
	//  created on this network. When enabled, only traffic matching the port's
	//  security groups and allowed address pairs is permitted.
	//  If omitted, the OpenStack deployment's default is used (typically true).
	PortSecurityEnabled bool `json:"port_security_enabled,omitempty" jsonschema:"port_security_enabled controls whether port security is enforced on ports created on this network. When enabled; only traffic matching the port's security groups and allowed address pairs is permitted..."`
	// tags are string tags to associate with the network in OpenStack.
	//  Tags are stored on the OpenStack resource and can be used for filtering
	//  and organization in the OpenStack API and Horizon dashboard.
	Tags []string `json:"tags,omitempty" jsonschema:"tags are string tags to associate with the network in OpenStack. Tags are stored on the OpenStack resource and can be used for filtering and organization in the OpenStack API and Horizon dashboard."`
	// region overrides the region from the provider config for this network.
	//  If omitted, the region from the OpenStack provider config is used.
	//  Example: "RegionOne"
	Region string `json:"region,omitempty" jsonschema:"region overrides the region from the provider config for this network. If omitted; the region from the OpenStack provider config is used. Example: 'RegionOne'"`
}

func (s *OpenStackNetworkSpecInput) validate() error {
	return nil
}

func (s *OpenStackNetworkSpecInput) applyDefaults() {
	// default: AdminStateUp = true (applied at zero-value)
}

func (s *OpenStackNetworkSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.AdminStateUp {
		m["admin_state_up"] = s.AdminStateUp
	}
	if s.Shared {
		m["shared"] = s.Shared
	}
	if s.External {
		m["external"] = s.External
	}
	if s.Mtu != 0 {
		m["mtu"] = s.Mtu
	}
	if s.DnsDomain != "" {
		m["dns_domain"] = s.DnsDomain
	}
	if s.PortSecurityEnabled {
		m["port_security_enabled"] = s.PortSecurityEnabled
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if s.Region != "" {
		m["region"] = s.Region
	}
	return m
}

// ParseOpenStackNetwork validates and normalizes a OpenStackNetwork cloud_object.
func ParseOpenStackNetwork(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "openstack.openmcf.org/v1", "OpenStackNetwork"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OpenStackNetworkSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
