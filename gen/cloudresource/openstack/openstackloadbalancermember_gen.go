// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package openstack

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OpenStackLoadBalancerMember is a Kubernetes Resource Model (KRM) style resource
//
//	for managing Octavia pool members in OpenStack.
//
//	A member represents a backend server in a load balancer pool. It defines the
//	IP address and port where the backend listens, along with an optional weight
//	for weighted load distribution. Members can be on the same subnet as the VIP
//	or on a different subnet (cross-subnet routing via Octavia).
type OpenStackLoadBalancerMemberSpecInput struct {
	// (Required) The pool to add this member to.
	//  ForceNew: changing this requires recreating the member.
	//
	//  FK: OpenStackLoadBalancerPool.status.outputs.pool_id
	PoolId string `json:"pool_id" jsonschema:"required,(Required) The pool to add this member to. ForceNew: changing this requires recreating the member. FK: OpenStackLoadBalancerPool.status.outputs.pool_id"`
	// (Required) The IP address of the backend server.
	//  This is the actual IP that receives forwarded traffic from the load balancer.
	//  ForceNew: changing this requires recreating the member.
	//
	//  This is a plain string (not StringValueOrRef) because member backends can be
	//  any IP -- VMs, containers, bare met...
	Address string `json:"address" jsonschema:"required,(Required) The IP address of the backend server. This is the actual IP that receives forwarded traffic from the load balancer. ForceNew: changing this requires recreating the member. This is a plain s..."`
	// (Required) The port on the backend server that accepts traffic.
	//  ForceNew: changing this requires recreating the member.
	//  Must be between 1 and 65535.
	ProtocolPort int32 `json:"protocol_port" jsonschema:"required,(Required) The port on the backend server that accepts traffic. ForceNew: changing this requires recreating the member. Must be between 1 and 65535."`
	// (Optional) The subnet where the member resides.
	//  Used by Octavia for L3 routing when the member is on a different subnet
	//  than the VIP. ForceNew: changing this requires recreating the member.
	//
	//  FK: OpenStackSubnet.status.outputs.subnet_id
	SubnetId string `json:"subnet_id,omitempty" jsonschema:"(Optional) The subnet where the member resides. Used by Octavia for L3 routing when the member is on a different subnet than the VIP. ForceNew: changing this requires recreating the member. FK: OpenSt..."`
	// (Optional) Weight of this member for weighted load balancing.
	//  A member with weight 0 receives no traffic (useful for draining).
	//  Valid range: 0-256. Default: 1 (set by Octavia when unspecified).
	//
	//  Uses optional int32 because proto3 int32 defaults to 0, which means
	//  "disabled member" in Octavia. opt...
	Weight int32 `json:"weight,omitempty" jsonschema:"(Optional) Weight of this member for weighted load balancing. A member with weight 0 receives no traffic (useful for draining). Valid range: 0-256. Default: 1 (set by Octavia when unspecified). Uses o..."`
	// (Optional) Administrative state of the member.
	//  When false, the member is removed from the pool's rotation. Default: true.
	AdminStateUp bool `json:"admin_state_up,omitempty" jsonschema:"(Optional) Administrative state of the member. When false; the member is removed from the pool's rotation. Default: true."`
	// (Optional) Tags applied to the member in OpenStack.
	//  Must be unique within this resource.
	Tags []string `json:"tags,omitempty" jsonschema:"(Optional) Tags applied to the member in OpenStack. Must be unique within this resource."`
	// (Optional) Override the region from the provider configuration.
	Region string `json:"region,omitempty" jsonschema:"(Optional) Override the region from the provider configuration."`
}

func (s *OpenStackLoadBalancerMemberSpecInput) validate() error {
	if s.PoolId == "" {
		return fmt.Errorf("pool_id is required")
	}
	if s.Address == "" {
		return fmt.Errorf("address is required")
	}
	return nil
}

func (s *OpenStackLoadBalancerMemberSpecInput) applyDefaults() {
	// default: AdminStateUp = true (applied at zero-value)
}

func (s *OpenStackLoadBalancerMemberSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["pool_id"] = s.PoolId
	m["address"] = s.Address
	m["protocol_port"] = s.ProtocolPort
	if s.SubnetId != "" {
		m["subnet_id"] = s.SubnetId
	}
	if s.Weight != 0 {
		m["weight"] = s.Weight
	}
	if s.AdminStateUp {
		m["admin_state_up"] = s.AdminStateUp
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if s.Region != "" {
		m["region"] = s.Region
	}
	return m
}

// ParseOpenStackLoadBalancerMember validates and normalizes a OpenStackLoadBalancerMember cloud_object.
func ParseOpenStackLoadBalancerMember(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "openstack.openmcf.org/v1", "OpenStackLoadBalancerMember"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OpenStackLoadBalancerMemberSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
