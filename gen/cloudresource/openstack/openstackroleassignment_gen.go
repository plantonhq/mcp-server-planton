// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T21:50:49+05:30

package openstack

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/gen/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OpenStackRoleAssignment is a Kubernetes Resource Model (KRM) style resource
//
//	for managing OpenStack Identity role assignments.
//
//	A role assignment binds a role to a principal (user or group) on a scope
//	(project or domain). This is the fundamental authorization mechanism in
//	OpenStack.
//
//	Role assignments do not have a natural "name" in the OpenStack API --
//	metadata.name provides KRM identity only.
//
//	Note: This is an admin-level operation requiring appropriate permissions.
type OpenStackRoleAssignmentSpecInput struct {
	// role_id is the UUID of the role to assign.
	//  Required. ForceNew: changing the role recreates the assignment.
	//  Roles are admin-managed Keystone objects (e.g., "admin", "member", "reader").
	//  Use `openstack role list` to find available role UUIDs.
	RoleId string `json:"role_id,omitempty" jsonschema:"role_id is the UUID of the role to assign. Required. ForceNew: changing the role recreates the assignment. Roles are admin-managed Keystone objects (e.g.; 'admin'; 'member'; 'reader'). Use 'openstack ..."`
	// project_id is the project to assign the role on.
	//  Mutually exclusive with domain_id (exactly one must be set).
	//  ForceNew: changing the scope recreates the assignment.
	//  Can reference an OpenStackProject resource's output or be a literal UUID.
	ProjectId string `json:"project_id,omitempty" jsonschema:"project_id is the project to assign the role on. Mutually exclusive with domain_id (exactly one must be set). ForceNew: changing the scope recreates the assignment. Can reference an OpenStackProject r..."`
	// domain_id is the domain to assign the role on.
	//  Mutually exclusive with project_id (exactly one must be set).
	//  ForceNew: changing the scope recreates the assignment.
	//  Domains are admin-managed Keystone objects -- this is a plain UUID string.
	DomainId string `json:"domain_id,omitempty" jsonschema:"domain_id is the domain to assign the role on. Mutually exclusive with project_id (exactly one must be set). ForceNew: changing the scope recreates the assignment. Domains are admin-managed Keystone o..."`
	// user_id is the UUID of the user to assign the role to.
	//  Mutually exclusive with group_id (exactly one must be set).
	//  ForceNew: changing the principal recreates the assignment.
	//  Users are admin-managed Keystone objects -- this is a plain UUID string.
	UserId string `json:"user_id,omitempty" jsonschema:"user_id is the UUID of the user to assign the role to. Mutually exclusive with group_id (exactly one must be set). ForceNew: changing the principal recreates the assignment. Users are admin-managed Ke..."`
	// group_id is the UUID of the group to assign the role to.
	//  Mutually exclusive with user_id (exactly one must be set).
	//  ForceNew: changing the principal recreates the assignment.
	//  Groups are admin-managed Keystone objects -- this is a plain UUID string.
	GroupId string `json:"group_id,omitempty" jsonschema:"group_id is the UUID of the group to assign the role to. Mutually exclusive with user_id (exactly one must be set). ForceNew: changing the principal recreates the assignment. Groups are admin-managed ..."`
	// region overrides the region from the provider config.
	//  If omitted, the region from the OpenStack provider config is used.
	//  Example: "RegionOne"
	Region string `json:"region,omitempty" jsonschema:"region overrides the region from the provider config. If omitted; the region from the OpenStack provider config is used. Example: 'RegionOne'"`
}

func (s *OpenStackRoleAssignmentSpecInput) validate() error {
	return nil
}

func (s *OpenStackRoleAssignmentSpecInput) applyDefaults() {
}

func (s *OpenStackRoleAssignmentSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.RoleId != "" {
		m["role_id"] = s.RoleId
	}
	if s.ProjectId != "" {
		m["project_id"] = s.ProjectId
	}
	if s.DomainId != "" {
		m["domain_id"] = s.DomainId
	}
	if s.UserId != "" {
		m["user_id"] = s.UserId
	}
	if s.GroupId != "" {
		m["group_id"] = s.GroupId
	}
	if s.Region != "" {
		m["region"] = s.Region
	}
	return m
}

// ParseOpenStackRoleAssignment validates and normalizes a OpenStackRoleAssignment cloud_object.
func ParseOpenStackRoleAssignment(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "openstack.openmcf.org/v1", "OpenStackRoleAssignment"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OpenStackRoleAssignmentSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
