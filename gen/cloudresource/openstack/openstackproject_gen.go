// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package openstack

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OpenStackProject is a Kubernetes Resource Model (KRM) style resource
//
//	for managing OpenStack Identity (Keystone) projects.
//
//	A project is the fundamental organizational unit in OpenStack. All cloud
//	resources belong to a project, which provides resource isolation, quota
//	boundaries, and access control scoping.
//
//	Common use cases:
//	  - Provision tenant projects for development teams
//	  - Create isolated project hierarchies for multi-tenant environments
//	  - Automate project onboarding in landing zone InfraCharts
//
//	Note: Creating projects is an admin-level operation. The OpenStack credentials
//	used with this component must have the "admin" role or equivalent permissions.
type OpenStackProjectSpecInput struct {
	// description is a human-readable description of the project.
	//  Visible in the OpenStack API, Horizon dashboard, and CLI output.
	Description string `json:"description,omitempty" jsonschema:"description is a human-readable description of the project. Visible in the OpenStack API; Horizon dashboard; and CLI output."`
	// domain_id is the Keystone domain to which this project belongs.
	//  ForceNew: changing the domain requires recreating the project.
	//  If omitted, OpenStack assigns the project to the default domain.
	//  Most single-domain deployments can leave this empty.
	//  Example: "default", or a domain UUID like "abcdef12...
	DomainId string `json:"domain_id,omitempty" jsonschema:"domain_id is the Keystone domain to which this project belongs. ForceNew: changing the domain requires recreating the project. If omitted; OpenStack assigns the project to the default domain. Most sin..."`
	// enabled controls whether the project is active.
	//  When disabled (false), all users in the project lose access to its
	//  resources, but the resources are NOT deleted.
	//  Default: true
	Enabled bool `json:"enabled,omitempty" jsonschema:"enabled controls whether the project is active. When disabled (false); all users in the project lose access to its resources; but the resources are NOT deleted. Default: true"`
	// parent_id is the UUID of the parent project in the project hierarchy.
	//  ForceNew: changing the parent requires recreating the project.
	//  If omitted, the project is created as a top-level project in its domain.
	//  Project hierarchies are used for nested quota management and organizational
	//  structuring in...
	ParentId string `json:"parent_id,omitempty" jsonschema:"parent_id is the UUID of the parent project in the project hierarchy. ForceNew: changing the parent requires recreating the project. If omitted; the project is created as a top-level project in its do..."`
	// tags is a set of tags to associate with the project.
	//  Tags are simple strings used for filtering and organizational purposes.
	//  They are visible in the OpenStack API and can be queried via tag-based filters.
	Tags []string `json:"tags,omitempty" jsonschema:"tags is a set of tags to associate with the project. Tags are simple strings used for filtering and organizational purposes. They are visible in the OpenStack API and can be queried via tag-based filt..."`
	// region overrides the region from the provider config for this project.
	//  If omitted, the region from the OpenStack provider config is used.
	//  Note: Keystone is typically a global service (not per-region), so this
	//  field is rarely needed. It controls which Keystone endpoint is used.
	//  Example: "RegionOn...
	Region string `json:"region,omitempty" jsonschema:"region overrides the region from the provider config for this project. If omitted; the region from the OpenStack provider config is used. Note: Keystone is typically a global service (not per-region);..."`
}

func (s *OpenStackProjectSpecInput) validate() error {
	return nil
}

func (s *OpenStackProjectSpecInput) applyDefaults() {
	// default: Enabled = true (applied at zero-value)
}

func (s *OpenStackProjectSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.DomainId != "" {
		m["domain_id"] = s.DomainId
	}
	if s.Enabled {
		m["enabled"] = s.Enabled
	}
	if s.ParentId != "" {
		m["parent_id"] = s.ParentId
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if s.Region != "" {
		m["region"] = s.Region
	}
	return m
}

// ParseOpenStackProject validates and normalizes a OpenStackProject cloud_object.
func ParseOpenStackProject(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "openstack.openmcf.org/v1", "OpenStackProject"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OpenStackProjectSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
