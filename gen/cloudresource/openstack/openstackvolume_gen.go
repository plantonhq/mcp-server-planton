// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package openstack

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OpenStackVolume is a Kubernetes Resource Model (KRM) style resource for an
//
//	OpenStack Cinder block storage volume.
//
//	Volumes provide persistent block storage that can be attached to compute
//	instances. They survive instance termination and can be detached and
//	reattached to different instances, making them essential for databases,
//	application data, and any workload that requires durable storage.
//
//	A volume can be created blank, cloned from an existing volume, restored from
//	a snapshot, or initialized from a Glance image (for bootable volumes).
//
//	In InfraCharts, volumes typically appear alongside instances. Use
//	OpenStackVolumeAttach to bind a volume to an instance as a visible DAG node.
type OpenStackVolumeSpecInput struct {
	// description is a human-readable description of the volume.
	//  This is stored on the OpenStack resource and visible in Horizon and API responses.
	Description string `json:"description,omitempty" jsonschema:"description is a human-readable description of the volume. This is stored on the OpenStack resource and visible in Horizon and API responses."`
	// size is the volume size in gigabytes (GB).
	//  Required for blank volumes and image-based volumes.
	//  For snapshot-based or clone-based volumes, if omitted or set to 0, the size
	//  of the source is used. If provided, it must be >= the source size.
	//  Must be greater than 0 for blank volumes.
	Size int32 `json:"size,omitempty" jsonschema:"size is the volume size in gigabytes (GB). Required for blank volumes and image-based volumes. For snapshot-based or clone-based volumes; if omitted or set to 0; the size of the source is used. If pro..."`
	// volume_type is the Cinder volume type (backend storage class).
	//  Examples: "SSD", "HDD", "__DEFAULT__", "ceph-ssd", "lvm".
	//  If omitted, the Cinder default volume type for the project is used.
	//  Changing this on an existing volume triggers a retype operation.
	VolumeType string `json:"volume_type,omitempty" jsonschema:"volume_type is the Cinder volume type (backend storage class). Examples: 'SSD'; 'HDD'; '__DEFAULT__'; 'ceph-ssd'; 'lvm'. If omitted; the Cinder default volume type for the project is used. Changing th..."`
	// availability_zone is the availability zone where the volume is created.
	//  ForceNew: changing the AZ requires recreating the volume.
	//  If omitted, Cinder selects the default AZ.
	//  Must match the instance's AZ for attachment to work (in most deployments).
	AvailabilityZone string `json:"availability_zone,omitempty" jsonschema:"availability_zone is the availability zone where the volume is created. ForceNew: changing the AZ requires recreating the volume. If omitted; Cinder selects the default AZ. Must match the instance's A..."`
	// snapshot_id is the UUID of a Cinder volume snapshot to restore from.
	//  ForceNew: the source cannot be changed after creation.
	//  Mutually exclusive with source_vol_id and image_id.
	SnapshotId string `json:"snapshot_id,omitempty" jsonschema:"snapshot_id is the UUID of a Cinder volume snapshot to restore from. ForceNew: the source cannot be changed after creation. Mutually exclusive with source_vol_id and image_id."`
	// source_vol_id is the UUID of an existing Cinder volume to clone.
	//  ForceNew: the source cannot be changed after creation.
	//  Mutually exclusive with snapshot_id and image_id.
	SourceVolId string `json:"source_vol_id,omitempty" jsonschema:"source_vol_id is the UUID of an existing Cinder volume to clone. ForceNew: the source cannot be changed after creation. Mutually exclusive with snapshot_id and image_id."`
	// image_id is the ID of a Glance image to initialize the volume from.
	//  This creates a bootable volume that can be used as a root disk.
	//  ForceNew: the source cannot be changed after creation.
	//  Mutually exclusive with snapshot_id and source_vol_id.
	//  Can reference an OpenStackImage resource's output or b...
	ImageId string `json:"image_id,omitempty" jsonschema:"image_id is the ID of a Glance image to initialize the volume from. This creates a bootable volume that can be used as a root disk. ForceNew: the source cannot be changed after creation. Mutually excl..."`
	// metadata is a map of key-value pairs stored on the volume.
	//  Metadata is visible in the OpenStack API and Horizon dashboard.
	//  Can be used for tagging, billing, or organizational purposes.
	Metadata map[string]string `json:"metadata,omitempty" jsonschema:"metadata is a map of key-value pairs stored on the volume. Metadata is visible in the OpenStack API and Horizon dashboard. Can be used for tagging; billing; or organizational purposes."`
	// region overrides the region from the provider config for this volume.
	//  If omitted, the region from the OpenStack provider config is used.
	//  ForceNew: changing the region requires recreating the volume.
	//  Example: "RegionOne"
	Region string `json:"region,omitempty" jsonschema:"region overrides the region from the provider config for this volume. If omitted; the region from the OpenStack provider config is used. ForceNew: changing the region requires recreating the volume. E..."`
}

func (s *OpenStackVolumeSpecInput) validate() error {
	return nil
}

func (s *OpenStackVolumeSpecInput) applyDefaults() {
}

func (s *OpenStackVolumeSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.Size != 0 {
		m["size"] = s.Size
	}
	if s.VolumeType != "" {
		m["volume_type"] = s.VolumeType
	}
	if s.AvailabilityZone != "" {
		m["availability_zone"] = s.AvailabilityZone
	}
	if s.SnapshotId != "" {
		m["snapshot_id"] = s.SnapshotId
	}
	if s.SourceVolId != "" {
		m["source_vol_id"] = s.SourceVolId
	}
	if s.ImageId != "" {
		m["image_id"] = s.ImageId
	}
	if len(s.Metadata) > 0 {
		m["metadata"] = s.Metadata
	}
	if s.Region != "" {
		m["region"] = s.Region
	}
	return m
}

// ParseOpenStackVolume validates and normalizes a OpenStackVolume cloud_object.
func ParseOpenStackVolume(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "openstack.openmcf.org/v1", "OpenStackVolume"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OpenStackVolumeSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
