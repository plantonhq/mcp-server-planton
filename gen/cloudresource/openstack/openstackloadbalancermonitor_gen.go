// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package openstack

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OpenStackLoadBalancerMonitor is a Kubernetes Resource Model (KRM) style resource
//
//	for managing Octavia health monitors in OpenStack.
//
//	A health monitor periodically probes pool members to determine their health status.
//	Unhealthy members are automatically removed from the pool's traffic rotation until
//	they recover. Monitors support HTTP, HTTPS, PING, TCP, TLS-HELLO, and UDP-CONNECT
//	check types.
type OpenStackLoadBalancerMonitorSpecInput struct {
	// (Required) The pool to monitor.
	//  ForceNew: changing this requires recreating the monitor.
	//
	//  FK: OpenStackLoadBalancerPool.status.outputs.pool_id
	PoolId string `json:"pool_id" jsonschema:"required,(Required) The pool to monitor. ForceNew: changing this requires recreating the monitor. FK: OpenStackLoadBalancerPool.status.outputs.pool_id"`
	// (Required) The type of health check to perform.
	//  ForceNew: changing this requires recreating the monitor.
	//
	//  - HTTP: Send HTTP requests and check response codes
	//  - HTTPS: Send HTTPS requests and check response codes
	//  - PING: ICMP ping the member
	//  - TCP: Attempt a TCP connection
	//  - TLS-HELLO: Perform ...
	Type string `json:"type" jsonschema:"required,(Required) The type of health check to perform. ForceNew: changing this requires recreating the monitor. - HTTP: Send HTTP requests and check response codes - HTTPS: Send HTTPS requests and check resp..."`
	// (Required) The interval in seconds between health checks.
	//  A check is sent every `delay` seconds to each member.
	Delay int32 `json:"delay" jsonschema:"required,(Required) The interval in seconds between health checks. A check is sent every 'delay' seconds to each member."`
	// (Required) The maximum time in seconds to wait for a health check response.
	//  If a member does not respond within this time, the check is considered failed.
	Timeout int32 `json:"timeout" jsonschema:"required,(Required) The maximum time in seconds to wait for a health check response. If a member does not respond within this time; the check is considered failed."`
	// (Required) The number of consecutive successful health checks required before
	//  a member is considered healthy (brought back into rotation).
	//  Must be between 1 and 10.
	MaxRetries int32 `json:"max_retries" jsonschema:"required,(Required) The number of consecutive successful health checks required before a member is considered healthy (brought back into rotation). Must be between 1 and 10."`
	// (Optional) The number of consecutive failed health checks required before
	//  a member is considered unhealthy (removed from rotation).
	//  Must be between 1 and 10. Default: Octavia uses the same value as max_retries.
	MaxRetriesDown int32 `json:"max_retries_down,omitempty" jsonschema:"(Optional) The number of consecutive failed health checks required before a member is considered unhealthy (removed from rotation). Must be between 1 and 10. Default: Octavia uses the same value as ma..."`
	// (Optional) The URL path to request for HTTP/HTTPS health checks.
	//  Typically "/" or "/healthz". Only applicable when type is HTTP or HTTPS.
	UrlPath string `json:"url_path,omitempty" jsonschema:"(Optional) The URL path to request for HTTP/HTTPS health checks. Typically '/' or '/healthz'. Only applicable when type is HTTP or HTTPS."`
	// (Optional) The HTTP method to use for HTTP/HTTPS health checks.
	//  Only applicable when type is HTTP or HTTPS.
	HttpMethod string `json:"http_method,omitempty" jsonschema:"(Optional) The HTTP method to use for HTTP/HTTPS health checks. Only applicable when type is HTTP or HTTPS."`
	// (Optional) Expected HTTP response codes for a healthy member.
	//  Supports single codes ("200"), ranges ("200-299"), and comma-separated lists ("200,202").
	//  Only applicable when type is HTTP or HTTPS.
	ExpectedCodes string `json:"expected_codes,omitempty" jsonschema:"(Optional) Expected HTTP response codes for a healthy member. Supports single codes ('200'); ranges ('200-299'); and comma-separated lists ('200;202'). Only applicable when type is HTTP or HTTPS."`
	// (Optional) Administrative state of the monitor.
	//  When false, the monitor stops checking members. Default: true.
	AdminStateUp bool `json:"admin_state_up,omitempty" jsonschema:"(Optional) Administrative state of the monitor. When false; the monitor stops checking members. Default: true."`
	// (Optional) Override the region from the provider configuration.
	Region string `json:"region,omitempty" jsonschema:"(Optional) Override the region from the provider configuration."`
}

func (s *OpenStackLoadBalancerMonitorSpecInput) validate() error {
	if s.PoolId == "" {
		return fmt.Errorf("pool_id is required")
	}
	if s.Type == "" {
		return fmt.Errorf("type is required")
	}
	return nil
}

func (s *OpenStackLoadBalancerMonitorSpecInput) applyDefaults() {
	// default: AdminStateUp = true (applied at zero-value)
}

func (s *OpenStackLoadBalancerMonitorSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["pool_id"] = s.PoolId
	m["type"] = s.Type
	m["delay"] = s.Delay
	m["timeout"] = s.Timeout
	m["max_retries"] = s.MaxRetries
	if s.MaxRetriesDown != 0 {
		m["max_retries_down"] = s.MaxRetriesDown
	}
	if s.UrlPath != "" {
		m["url_path"] = s.UrlPath
	}
	if s.HttpMethod != "" {
		m["http_method"] = s.HttpMethod
	}
	if s.ExpectedCodes != "" {
		m["expected_codes"] = s.ExpectedCodes
	}
	if s.AdminStateUp {
		m["admin_state_up"] = s.AdminStateUp
	}
	if s.Region != "" {
		m["region"] = s.Region
	}
	return m
}

// ParseOpenStackLoadBalancerMonitor validates and normalizes a OpenStackLoadBalancerMonitor cloud_object.
func ParseOpenStackLoadBalancerMonitor(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "openstack.openmcf.org/v1", "OpenStackLoadBalancerMonitor"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OpenStackLoadBalancerMonitorSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
