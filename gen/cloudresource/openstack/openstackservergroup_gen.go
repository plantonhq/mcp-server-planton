// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package openstack

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OpenStackServerGroup is a Kubernetes Resource Model (KRM) style resource
//
//	for managing OpenStack Compute server groups.
//
//	A server group is a placement constraint for compute instances. By assigning
//	instances to a server group with an affinity or anti-affinity policy, you
//	control whether instances are co-located on the same hypervisor or spread
//	across different hypervisors.
//
//	Common use cases:
//	  - Anti-affinity for HA: spread database replicas across different hosts
//	  - Affinity for performance: co-locate coupled services on the same host
//	  - Soft policies for best-effort placement without hard scheduling failures
type OpenStackServerGroupSpecInput struct {
	// policy is the placement policy for instances in this server group.
	//
	//  Valid values:
	//    "affinity"           - all members on the same hypervisor (hard constraint)
	//    "anti-affinity"      - all members on different hypervisors (hard constraint)
	//    "soft-affinity"      - prefer same hypervisor, no fail...
	Policy string `json:"policy,omitempty" jsonschema:"policy is the placement policy for instances in this server group. Valid values: 'affinity' - all members on the same hypervisor (hard constraint) 'anti-affinity' - all members on different hypervisor..."`
	// region overrides the region from the provider config for this server group.
	//  If omitted, the region from the OpenStack provider config is used.
	//  Example: "RegionOne"
	Region string `json:"region,omitempty" jsonschema:"region overrides the region from the provider config for this server group. If omitted; the region from the OpenStack provider config is used. Example: 'RegionOne'"`
}

func (s *OpenStackServerGroupSpecInput) validate() error {
	return nil
}

func (s *OpenStackServerGroupSpecInput) applyDefaults() {
}

func (s *OpenStackServerGroupSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Policy != "" {
		m["policy"] = s.Policy
	}
	if s.Region != "" {
		m["region"] = s.Region
	}
	return m
}

// ParseOpenStackServerGroup validates and normalizes a OpenStackServerGroup cloud_object.
func ParseOpenStackServerGroup(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "openstack.openmcf.org/v1", "OpenStackServerGroup"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OpenStackServerGroupSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
