// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package aws

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AwsKmsKey represents a customer-managed AWS KMS encryption key.
//
//	KMS keys provide cryptographic operations for data encryption, signing, and verification
//	with fine-grained access control and automatic key rotation capabilities.
type AwsKmsKeySpecInput struct {
	// The AWS region where the resource will be created.
	//  Example: "us-west-2", "eu-west-1"
	Region string `json:"region,omitempty" jsonschema:"The AWS region where the resource will be created. Example: 'us-west-2'; 'eu-west-1'"`
	// key_spec specifies the type of KMS key to create.
	//  If not provided, defaults to symmetric_default.
	KeySpec string `json:"key_spec,omitempty" jsonschema:"enum=rsa_2048|rsa_4096|ecc_nist_p256,key_spec specifies the type of KMS key to create. If not provided; defaults to symmetric_default."`
	// description is an optional description for the KMS key.
	//  Maximum length is 250 characters.
	Description string `json:"description,omitempty" jsonschema:"description is an optional description for the KMS key. Maximum length is 250 characters."`
	// disable_key_rotation, if true, will disable the key's automatic annual rotation.
	//  If false (default), rotation is enabled.
	DisableKeyRotation bool `json:"disable_key_rotation,omitempty" jsonschema:"disable_key_rotation; if true; will disable the key's automatic annual rotation. If false (default); rotation is enabled."`
	// deletion_window_days is the waiting period (in days) before deletion of the KMS key.
	//  Allowed range is 7–30 days (inclusive). Default is 30 days.
	DeletionWindowDays int32 `json:"deletion_window_days,omitempty" jsonschema:"deletion_window_days is the waiting period (in days) before deletion of the KMS key. Allowed range is 7–30 days (inclusive). Default is 30 days."`
	// alias_name is an optional alias to assign to the KMS key.
	//  It must begin with "alias/" and contain 1–250 allowed characters (letters, numbers, underscore, or hyphen).
	AliasName string `json:"alias_name,omitempty" jsonschema:"alias_name is an optional alias to assign to the KMS key. It must begin with 'alias/' and contain 1–250 allowed characters (letters; numbers; underscore; or hyphen)."`
}

func (s *AwsKmsKeySpecInput) validate() error {
	switch s.KeySpec {
	case "", "rsa_2048", "rsa_4096", "ecc_nist_p256":
	default:
		return fmt.Errorf("invalid key_spec: %q", s.KeySpec)
	}
	return nil
}

func (s *AwsKmsKeySpecInput) applyDefaults() {
}

func (s *AwsKmsKeySpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	if s.KeySpec != "" {
		m["key_spec"] = s.KeySpec
	}
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.DisableKeyRotation {
		m["disable_key_rotation"] = s.DisableKeyRotation
	}
	if s.DeletionWindowDays != 0 {
		m["deletion_window_days"] = s.DeletionWindowDays
	}
	if s.AliasName != "" {
		m["alias_name"] = s.AliasName
	}
	return m
}

// ParseAwsKmsKey validates and normalizes a AwsKmsKey cloud_object.
func ParseAwsKmsKey(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "aws.openmcf.org/v1", "AwsKmsKey"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AwsKmsKeySpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
