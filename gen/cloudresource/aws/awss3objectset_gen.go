// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package aws

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// aws-s3-object-set
type AwsS3ObjectSetSpecInput struct {
	// The AWS region where the resource will be created.
	//  Example: "us-west-2", "eu-west-1"
	Region string `json:"region,omitempty" jsonschema:"The AWS region where the resource will be created. Example: 'us-west-2'; 'eu-west-1'"`
	// The target S3 bucket where objects will be uploaded.
	//  Can be a literal bucket name or a reference to an AwsS3Bucket component.
	//  When referencing an AwsS3Bucket, the bucket_id is resolved from status.outputs.bucket_id.
	Bucket string `json:"bucket" jsonschema:"required,The target S3 bucket where objects will be uploaded. Can be a literal bucket name or a reference to an AwsS3Bucket component. When referencing an AwsS3Bucket; the bucket_id is resolved from status.out..."`
	// The list of S3 objects to upload to the target bucket.
	//  At least one object must be specified.
	Objects []*AwsS3ObjectInput `json:"objects,omitempty" jsonschema:"The list of S3 objects to upload to the target bucket. At least one object must be specified."`
	// Tags applied to all objects in the set.
	//  Individual object tags are merged with these, with object-level tags taking precedence.
	Tags map[string]string `json:"tags,omitempty" jsonschema:"Tags applied to all objects in the set. Individual object tags are merged with these; with object-level tags taking precedence."`
}

func (s *AwsS3ObjectSetSpecInput) validate() error {
	if s.Bucket == "" {
		return fmt.Errorf("bucket is required")
	}
	if len(s.Objects) < 1 {
		return fmt.Errorf("objects requires at least 1 items, got %d", len(s.Objects))
	}
	for i, v := range s.Objects {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("objects[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *AwsS3ObjectSetSpecInput) applyDefaults() {
}

func (s *AwsS3ObjectSetSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	m["bucket"] = s.Bucket
	if len(s.Objects) > 0 {
		items := make([]any, len(s.Objects))
		for i, v := range s.Objects {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["objects"] = items
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	return m
}

// AwsS3Object defines a single S3 object to be uploaded.
type AwsS3ObjectInput struct {
	// The S3 object key (path within the bucket).
	//  Examples: "config/app.json", "assets/logo.png", "data/seed.csv"
	Key string `json:"key,omitempty" jsonschema:"The S3 object key (path within the bucket). Examples: 'config/app.json'; 'assets/logo.png'; 'data/seed.csv'"`
	// Inline UTF-8 text content for the object.
	//  Suitable for configuration files, JSON, YAML, HTML, and other text formats.
	Content string `json:"content,omitempty" jsonschema:"Inline UTF-8 text content for the object. Suitable for configuration files; JSON; YAML; HTML; and other text formats."`
	// Base64-encoded binary content for the object.
	//  Suitable for images, compiled assets, or any binary data.
	ContentBase64 string `json:"content_base64,omitempty" jsonschema:"Base64-encoded binary content for the object. Suitable for images; compiled assets; or any binary data."`
	// The MIME content type of the object (e.g., "application/json", "text/html", "image/png").
	//  Default: application/octet-stream
	ContentType string `json:"content_type,omitempty" jsonschema:"The MIME content type of the object (e.g.; 'application/json'; 'text/html'; 'image/png'). Default: application/octet-stream"`
	// The caching behavior for the object.
	//  Example: "max-age=86400" for 24-hour caching, "no-cache" for no caching.
	CacheControl string `json:"cache_control,omitempty" jsonschema:"The caching behavior for the object. Example: 'max-age=86400' for 24-hour caching; 'no-cache' for no caching."`
	// How the content is encoded (e.g., "gzip", "br").
	//  Set this if the content has been pre-compressed.
	ContentEncoding string `json:"content_encoding,omitempty" jsonschema:"How the content is encoded (e.g.; 'gzip'; 'br'). Set this if the content has been pre-compressed."`
	// Tags specific to this object. Merged with set-level tags (object tags take precedence).
	Tags map[string]string `json:"tags,omitempty" jsonschema:"Tags specific to this object. Merged with set-level tags (object tags take precedence)."`
	// The canned ACL for this object (e.g., "private", "public-read").
	//  If not specified, inherits the bucket's default ACL.
	Acl string `json:"acl,omitempty" jsonschema:"The canned ACL for this object (e.g.; 'private'; 'public-read'). If not specified; inherits the bucket's default ACL."`
}

func (s *AwsS3ObjectInput) validate() error {
	return nil
}

func (s *AwsS3ObjectInput) applyDefaults() {
	if s.ContentType == "" {
		s.ContentType = "application/octet-stream"
	}
}

func (s *AwsS3ObjectInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Key != "" {
		m["key"] = s.Key
	}
	if s.Content != "" {
		m["content"] = s.Content
	}
	if s.ContentBase64 != "" {
		m["content_base64"] = s.ContentBase64
	}
	if s.ContentType != "" {
		m["content_type"] = s.ContentType
	}
	if s.CacheControl != "" {
		m["cache_control"] = s.CacheControl
	}
	if s.ContentEncoding != "" {
		m["content_encoding"] = s.ContentEncoding
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if s.Acl != "" {
		m["acl"] = s.Acl
	}
	return m
}

// ParseAwsS3ObjectSet validates and normalizes a AwsS3ObjectSet cloud_object.
func ParseAwsS3ObjectSet(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "aws.openmcf.org/v1", "AwsS3ObjectSet"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AwsS3ObjectSetSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
