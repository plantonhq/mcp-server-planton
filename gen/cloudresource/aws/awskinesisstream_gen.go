// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package aws

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AwsKinesisStream is the Kubernetes-style resource envelope for an Amazon
//
//	Kinesis Data Stream.
type AwsKinesisStreamSpecInput struct {
	// The AWS region where the resource will be created.
	//  Example: "us-west-2", "eu-west-1"
	Region string `json:"region,omitempty" jsonschema:"The AWS region where the resource will be created. Example: 'us-west-2'; 'eu-west-1'"`
	// Capacity mode for the stream. This is a fundamental design choice that
	//  determines pricing model, scaling behavior, and operational overhead.
	//
	//  Valid values:
	//  - "PROVISIONED": You manage shard count explicitly. Each shard provides
	//    1 MB/s ingestion and 2 MB/s consumption. Cost-effective for steady...
	StreamMode string `json:"stream_mode,omitempty" jsonschema:"Capacity mode for the stream. This is a fundamental design choice that determines pricing model; scaling behavior; and operational overhead. Valid values: - 'PROVISIONED': You manage shard count expli..."`
	// Number of open shards in the stream. Each shard provides 1 MB/s write
	//  (1,000 records/s) and 2 MB/s read capacity.
	//
	//  Required when stream_mode is "PROVISIONED" (must be >= 1).
	//  Must be 0 (or omitted) when stream_mode is "ON_DEMAND" because AWS
	//  manages shard count automatically.
	//
	//  Can be updated aft...
	ShardCount int32 `json:"shard_count,omitempty" jsonschema:"Number of open shards in the stream. Each shard provides 1 MB/s write (1;000 records/s) and 2 MB/s read capacity. Required when stream_mode is 'PROVISIONED' (must be >= 1). Must be 0 (or omitted) when..."`
	// Duration in hours that data records remain accessible after being added to
	//  the stream. After the retention period expires, records are no longer
	//  accessible via GetRecords.
	//
	//  Range: 24–8760 (1 day to 365 days). AWS default: 24 hours.
	//  Leave at 0 to use the AWS default.
	//
	//  Increasing retention is u...
	RetentionPeriodHours int32 `json:"retention_period_hours,omitempty" jsonschema:"Duration in hours that data records remain accessible after being added to the stream. After the retention period expires; records are no longer accessible via GetRecords. Range: 24–8760 (1 day to 3..."`
	// Customer-managed KMS key for server-side encryption of data at rest. When
	//  set, the IaC modules automatically configure KMS encryption (encryption_type
	//  = "KMS"). When absent, encryption is disabled (encryption_type = "NONE").
	//
	//  Accepts a KMS key ID, key ARN, alias name (e.g., "alias/aws/kinesis"), ...
	KmsKeyId string `json:"kms_key_id,omitempty" jsonschema:"Customer-managed KMS key for server-side encryption of data at rest. When set; the IaC modules automatically configure KMS encryption (encryption_type = 'KMS'). When absent; encryption is disabled (en..."`
	// Maximum size of a single data record in KiB (kibibytes). Records exceeding
	//  this limit are rejected by the PutRecord/PutRecords API.
	//
	//  Range: 1024–10240 (1 MiB to 10 MiB). AWS default: 1024 (1 MiB).
	//  Leave at 0 to use the AWS default.
	//
	//  Larger record sizes are useful for aggregated events, rich JS...
	MaxRecordSizeInKib int32 `json:"max_record_size_in_kib,omitempty" jsonschema:"Maximum size of a single data record in KiB (kibibytes). Records exceeding this limit are rejected by the PutRecord/PutRecords API. Range: 1024–10240 (1 MiB to 10 MiB). AWS default: 1024 (1 MiB). Le..."`
	// Shard-level CloudWatch metrics to enable. By default, Kinesis only provides
	//  stream-level metrics. Enabling shard-level metrics allows monitoring of
	//  individual shard performance, which is critical for identifying hot shards
	//  and capacity bottlenecks in production.
	//
	//  Valid values (one or more):
	//  - "...
	ShardLevelMetrics []string `json:"shard_level_metrics,omitempty" jsonschema:"Shard-level CloudWatch metrics to enable. By default; Kinesis only provides stream-level metrics. Enabling shard-level metrics allows monitoring of individual shard performance; which is critical for ..."`
	// When true, all registered enhanced fan-out consumers are automatically
	//  deregistered before the stream is deleted, preventing deletion errors.
	//  When false (default), deleting a stream with active consumers will fail.
	//
	//  This is an operational setting that only affects stream deletion. It has
	//  no impa...
	EnforceConsumerDeletion bool `json:"enforce_consumer_deletion,omitempty" jsonschema:"When true; all registered enhanced fan-out consumers are automatically deregistered before the stream is deleted; preventing deletion errors. When false (default); deleting a stream with active consum..."`
}

func (s *AwsKinesisStreamSpecInput) validate() error {
	return nil
}

func (s *AwsKinesisStreamSpecInput) applyDefaults() {
}

func (s *AwsKinesisStreamSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	if s.StreamMode != "" {
		m["stream_mode"] = s.StreamMode
	}
	if s.ShardCount != 0 {
		m["shard_count"] = s.ShardCount
	}
	if s.RetentionPeriodHours != 0 {
		m["retention_period_hours"] = s.RetentionPeriodHours
	}
	if s.KmsKeyId != "" {
		m["kms_key_id"] = s.KmsKeyId
	}
	if s.MaxRecordSizeInKib != 0 {
		m["max_record_size_in_kib"] = s.MaxRecordSizeInKib
	}
	if len(s.ShardLevelMetrics) > 0 {
		m["shard_level_metrics"] = s.ShardLevelMetrics
	}
	if s.EnforceConsumerDeletion {
		m["enforce_consumer_deletion"] = s.EnforceConsumerDeletion
	}
	return m
}

// ParseAwsKinesisStream validates and normalizes a AwsKinesisStream cloud_object.
func ParseAwsKinesisStream(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "aws.openmcf.org/v1", "AwsKinesisStream"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AwsKinesisStreamSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
