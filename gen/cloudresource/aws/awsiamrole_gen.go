// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package aws

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AwsIamRole represents an AWS IAM Role resource.
//
//	IAM roles enable secure delegation of permissions to AWS services, applications, or users
//	through temporary credentials without embedding long-lived access keys.
type AwsIamRoleSpecInput struct {
	// The AWS region where the resource will be created.
	//  Example: "us-west-2", "eu-west-1"
	Region string `json:"region,omitempty" jsonschema:"The AWS region where the resource will be created. Example: 'us-west-2'; 'eu-west-1'"`
	// description is an optional description of the IAM role.
	Description string `json:"description,omitempty" jsonschema:"description is an optional description of the IAM role."`
	// path is the IAM path for the role. Defaults to "/" if omitted.
	Path string `json:"path,omitempty" jsonschema:"path is the IAM path for the role. Defaults to '/' if omitted."`
	// trust_policy_json is the JSON string describing the trust relationship for the role.
	//  Example: a trust policy allowing ECS tasks to assume this role.
	TrustPolicy any `json:"trust_policy" jsonschema:"required,trust_policy_json is the JSON string describing the trust relationship for the role. Example: a trust policy allowing ECS tasks to assume this role."`
	// managed_policy_arns is a list of ARNs for AWS-managed or customer-managed IAM policies
	//  you want to attach to this role.
	ManagedPolicyArns []string `json:"managed_policy_arns,omitempty" jsonschema:"managed_policy_arns is a list of ARNs for AWS-managed or customer-managed IAM policies you want to attach to this role."`
	// inline_policy_jsons is a map of inline policy names to a JSON policy doc.
	//  Key is policy name. Value is the raw JSON for that policy.
	InlinePolicies map[string]any `json:"inline_policies,omitempty" jsonschema:"inline_policy_jsons is a map of inline policy names to a JSON policy doc. Key is policy name. Value is the raw JSON for that policy."`
}

func (s *AwsIamRoleSpecInput) validate() error {
	return nil
}

func (s *AwsIamRoleSpecInput) applyDefaults() {
}

func (s *AwsIamRoleSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.Path != "" {
		m["path"] = s.Path
	}
	// unsupported type "object" for field TrustPolicy
	if len(s.ManagedPolicyArns) > 0 {
		m["managed_policy_arns"] = s.ManagedPolicyArns
	}
	if len(s.InlinePolicies) > 0 {
		m["inline_policies"] = s.InlinePolicies
	}
	return m
}

// ParseAwsIamRole validates and normalizes a AwsIamRole cloud_object.
func ParseAwsIamRole(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "aws.openmcf.org/v1", "AwsIamRole"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AwsIamRoleSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
