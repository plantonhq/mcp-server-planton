// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package aws

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AwsStepFunction is the Kubernetes-style resource envelope for an AWS Step
//
//	Functions state machine.
type AwsStepFunctionSpecInput struct {
	// The AWS region where the resource will be created.
	//  Example: "us-west-2", "eu-west-1"
	Region string `json:"region,omitempty" jsonschema:"The AWS region where the resource will be created. Example: 'us-west-2'; 'eu-west-1'"`
	// State machine type. Determines execution semantics and pricing model.
	//  - "STANDARD": Long-running, exactly-once, full execution history.
	//  - "EXPRESS": High-volume, short-duration, at-most-once.
	//  Cannot be changed after creation (forces replacement).
	//  When omitted the IaC module defaults to "STANDARD...
	Type string `json:"type,omitempty" jsonschema:"State machine type. Determines execution semantics and pricing model. - 'STANDARD': Long-running; exactly-once; full execution history. - 'EXPRESS': High-volume; short-duration; at-most-once. Cannot b..."`
	// State machine definition in Amazon States Language (ASL). Write the
	//  definition as native YAML; the IaC module serializes it to JSON for the
	//  AWS API. ASL key casing (StartAt, States, Type, Resource, etc.) is
	//  preserved through serialization.
	//
	//  Maximum size: 1,048,576 bytes (1 MB) after JSON seriali...
	Definition any `json:"definition" jsonschema:"required,State machine definition in Amazon States Language (ASL). Write the definition as native YAML; the IaC module serializes it to JSON for the AWS API. ASL key casing (StartAt; States; Type; Resource; et..."`
	// IAM execution role ARN. The role must have a trust policy for
	//  states.amazonaws.com and policies granting access to all services
	//  invoked by the workflow (Lambda:InvokeFunction, SQS:SendMessage, etc.).
	RoleArn string `json:"role_arn" jsonschema:"required,IAM execution role ARN. The role must have a trust policy for states.amazonaws.com and policies granting access to all services invoked by the workflow (Lambda:InvokeFunction; SQS:SendMessage; etc.)."`
	// Free-form description visible in the AWS Console. Useful for documenting
	//  the workflow's purpose and behavior.
	Description string `json:"description,omitempty" jsonschema:"Free-form description visible in the AWS Console. Useful for documenting the workflow's purpose and behavior."`
	// Logging configuration for execution history events. When omitted, logging
	//  is disabled (level OFF). Logging is supported for both STANDARD and EXPRESS
	//  state machines.
	Logging *AwsStepFunctionLoggingConfigInput `json:"logging,omitempty" jsonschema:"Logging configuration for execution history events. When omitted; logging is disabled (level OFF). Logging is supported for both STANDARD and EXPRESS state machines."`
	// Enable AWS X-Ray tracing for the state machine. When true, Step Functions
	//  sends trace data to X-Ray for visualizing request flows. Ensure the
	//  execution role has xray:PutTraceSegments and xray:PutTelemetryRecords
	//  permissions.
	TracingEnabled bool `json:"tracing_enabled,omitempty" jsonschema:"Enable AWS X-Ray tracing for the state machine. When true; Step Functions sends trace data to X-Ray for visualizing request flows. Ensure the execution role has xray:PutTraceSegments and xray:PutTelem..."`
	// Encryption configuration for data at rest. When omitted, AWS uses
	//  AWS-owned keys (default, no additional cost). Provide this block to
	//  use a customer-managed KMS key for encrypting state machine data,
	//  execution history, and input/output payloads.
	Encryption *AwsStepFunctionEncryptionConfigInput `json:"encryption,omitempty" jsonschema:"Encryption configuration for data at rest. When omitted; AWS uses AWS-owned keys (default; no additional cost). Provide this block to use a customer-managed KMS key for encrypting state machine data; ..."`
}

func (s *AwsStepFunctionSpecInput) validate() error {
	if s.RoleArn == "" {
		return fmt.Errorf("role_arn is required")
	}
	if s.Logging != nil {
		if err := s.Logging.validate(); err != nil {
			return fmt.Errorf("logging: %w", err)
		}
	}
	if s.Encryption != nil {
		if err := s.Encryption.validate(); err != nil {
			return fmt.Errorf("encryption: %w", err)
		}
	}
	return nil
}

func (s *AwsStepFunctionSpecInput) applyDefaults() {
	if s.Logging != nil {
		s.Logging.applyDefaults()
	}
	if s.Encryption != nil {
		s.Encryption.applyDefaults()
	}
}

func (s *AwsStepFunctionSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	if s.Type != "" {
		m["type"] = s.Type
	}
	// unsupported type "object" for field Definition
	m["role_arn"] = s.RoleArn
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.Logging != nil {
		m["logging"] = s.Logging.toMap()
	}
	if s.TracingEnabled {
		m["tracing_enabled"] = s.TracingEnabled
	}
	if s.Encryption != nil {
		m["encryption"] = s.Encryption.toMap()
	}
	return m
}

// AwsStepFunctionEncryptionConfig configures encryption for state machine data
//
//	using a customer-managed KMS key. When this block is provided with a
//	kms_key_id, the IaC module sets the encryption type to
//	CUSTOMER_MANAGED_KMS_KEY. When omitted, AWS-owned keys are used.
type AwsStepFunctionEncryptionConfigInput struct {
	// Customer-managed KMS key ARN for encrypting state machine data, execution
	//  history, and input/output payloads. The key must be a symmetric encryption
	//  key in the same region as the state machine. For cross-account access, use
	//  the full key ARN (not alias).
	KmsKeyId string `json:"kms_key_id" jsonschema:"required,Customer-managed KMS key ARN for encrypting state machine data; execution history; and input/output payloads. The key must be a symmetric encryption key in the same region as the state machine. For cr..."`
	// Duration in seconds for which Step Functions reuses a data encryption key
	//  before calling KMS GenerateDataKey again. Higher values reduce KMS API
	//  costs but increase the window for key reuse.
	//  Range: 60â€“900 seconds. AWS default: 300 (5 minutes).
	//  Leave at 0 to use the AWS default.
	KmsDataKeyReusePeriodSeconds int32 `json:"kms_data_key_reuse_period_seconds,omitempty" jsonschema:"Duration in seconds for which Step Functions reuses a data encryption key before calling KMS GenerateDataKey again. Higher values reduce KMS API costs but increase the window for key reuse. Range: 60\xe2..."`
}

func (s *AwsStepFunctionEncryptionConfigInput) validate() error {
	if s.KmsKeyId == "" {
		return fmt.Errorf("kms_key_id is required")
	}
	return nil
}

func (s *AwsStepFunctionEncryptionConfigInput) applyDefaults() {
}

func (s *AwsStepFunctionEncryptionConfigInput) toMap() map[string]any {
	m := make(map[string]any)
	m["kms_key_id"] = s.KmsKeyId
	if s.KmsDataKeyReusePeriodSeconds != 0 {
		m["kms_data_key_reuse_period_seconds"] = s.KmsDataKeyReusePeriodSeconds
	}
	return m
}

// AwsStepFunctionLoggingConfig configures execution history logging to
//
//	CloudWatch Logs. Logging helps with debugging, auditing, and monitoring
//	state machine executions.
type AwsStepFunctionLoggingConfigInput struct {
	// Logging level. Determines which execution history events are logged.
	//  - "ALL": Log all event types (recommended for development and debugging).
	//  - "ERROR": Log only error events (recommended for production).
	//  - "FATAL": Log only fatal errors.
	//  - "OFF": Disable logging.
	Level string `json:"level,omitempty" jsonschema:"Logging level. Determines which execution history events are logged. - 'ALL': Log all event types (recommended for development and debugging). - 'ERROR': Log only error events (recommended for product..."`
	// Whether to include execution input and output data in log entries. When
	//  true, the full JSON payloads passed between states are logged. Useful for
	//  debugging but may increase log volume and expose sensitive data.
	IncludeExecutionData bool `json:"include_execution_data,omitempty" jsonschema:"Whether to include execution input and output data in log entries. When true; the full JSON payloads passed between states are logged. Useful for debugging but may increase log volume and expose sensi..."`
	// CloudWatch Logs log group ARN for log delivery. Accepts a direct ARN or a
	//  reference to a CloudWatch Log Group resource.
	//
	//  Note: AWS requires the ARN to end with ":*". The IaC module automatically
	//  appends this suffix if not present, so you can reference a log group ARN
	//  directly without worrying ab...
	LogDestination string `json:"log_destination,omitempty" jsonschema:"CloudWatch Logs log group ARN for log delivery. Accepts a direct ARN or a reference to a CloudWatch Log Group resource. Note: AWS requires the ARN to end with ':*'. The IaC module automatically append..."`
}

func (s *AwsStepFunctionLoggingConfigInput) validate() error {
	return nil
}

func (s *AwsStepFunctionLoggingConfigInput) applyDefaults() {
}

func (s *AwsStepFunctionLoggingConfigInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Level != "" {
		m["level"] = s.Level
	}
	if s.IncludeExecutionData {
		m["include_execution_data"] = s.IncludeExecutionData
	}
	if s.LogDestination != "" {
		m["log_destination"] = s.LogDestination
	}
	return m
}

// ParseAwsStepFunction validates and normalizes a AwsStepFunction cloud_object.
func ParseAwsStepFunction(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "aws.openmcf.org/v1", "AwsStepFunction"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AwsStepFunctionSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
