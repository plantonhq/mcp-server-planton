// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package aws

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AwsCloudwatchAlarm represents a CloudWatch metric alarm — a monitoring
//
//	resource that watches a single metric or metric math expression and performs
//	actions when the value crosses a threshold for a sustained number of periods.
//
//	Alarms support two metric definition modes:
//	1. Simple metric mode — a single metric with statistic and dimensions.
//	2. Metric query mode — metric math expressions, anomaly detection, or
//	   multi-metric evaluations using up to 20 queries.
//
//	Actions are typically SNS topic notifications but can also target Auto
//	Scaling policies, EC2 automation, Lambda functions, and SSM OpsItems.
type AwsCloudwatchAlarmSpecInput struct {
	// The AWS region where the resource will be created.
	//  Example: "us-west-2", "eu-west-1"
	Region string `json:"region,omitempty" jsonschema:"The AWS region where the resource will be created. Example: 'us-west-2'; 'eu-west-1'"`
	// Arithmetic operation to compare the statistic against the threshold.
	//
	//  Standard comparison operators:
	//  - "GreaterThanOrEqualToThreshold"
	//  - "GreaterThanThreshold"
	//  - "LessThanThreshold"
	//  - "LessThanOrEqualToThreshold"
	//
	//  Anomaly detection operators (use with metric_queries and threshold_metric_id):
	//  ...
	ComparisonOperator string `json:"comparison_operator" jsonschema:"required,Arithmetic operation to compare the statistic against the threshold. Standard comparison operators: - 'GreaterThanOrEqualToThreshold' - 'GreaterThanThreshold' - 'LessThanThreshold' - 'LessThanOrEqualT..."`
	// Number of consecutive periods over which the metric is compared to the
	//  threshold. Must be at least 1.
	//
	//  Combined with `datapoints_to_alarm` this creates an M-of-N evaluation
	//  window. For example, evaluation_periods=5 with datapoints_to_alarm=3
	//  means "3 out of the last 5 periods must breach to trig...
	EvaluationPeriods int32 `json:"evaluation_periods,omitempty" jsonschema:"Number of consecutive periods over which the metric is compared to the threshold. Must be at least 1. Combined with 'datapoints_to_alarm' this creates an M-of-N evaluation window. For example; evaluat..."`
	// Number of data points within the evaluation window that must breach the
	//  threshold to trigger the alarm. Must be less than or equal to
	//  `evaluation_periods`. When omitted, defaults to `evaluation_periods`
	//  (every period must breach).
	//
	//  Use a value lower than `evaluation_periods` for M-of-N evaluatio...
	DatapointsToAlarm int32 `json:"datapoints_to_alarm,omitempty" jsonschema:"Number of data points within the evaluation window that must breach the threshold to trigger the alarm. Must be less than or equal to 'evaluation_periods'. When omitted; defaults to 'evaluation_period..."`
	// Static threshold value. The statistic (or metric math result) is compared
	//  against this value using `comparison_operator`.
	//
	//  Required for static threshold alarms. Must not be set for anomaly
	//  detection alarms (use `threshold_metric_id` instead).
	Threshold float64 `json:"threshold,omitempty" jsonschema:"Static threshold value. The statistic (or metric math result) is compared against this value using 'comparison_operator'. Required for static threshold alarms. Must not be set for anomaly detection al..."`
	// For anomaly detection alarms, set this to the ID of the
	//  ANOMALY_DETECTION_BAND function defined in `metric_queries`. The anomaly
	//  band serves as a dynamic threshold instead of a static `threshold` value.
	//
	//  Mutually exclusive with `threshold`.
	ThresholdMetricId string `json:"threshold_metric_id,omitempty" jsonschema:"For anomaly detection alarms; set this to the ID of the ANOMALY_DETECTION_BAND function defined in 'metric_queries'. The anomaly band serves as a dynamic threshold instead of a static 'threshold' valu..."`
	// How the alarm treats missing data points during evaluation.
	//
	//  Valid values:
	//  - "missing"      — (Default) Missing data is treated as missing; the alarm
	//                      state does not change. Can cause delayed transitions.
	//  - "notBreaching" — Missing data is within the threshold. Best for al...
	TreatMissingData string `json:"treat_missing_data,omitempty" jsonschema:"How the alarm treats missing data points during evaluation. Valid values: - 'missing' — (Default) Missing data is treated as missing; the alarm state does not change. Can cause delayed transitions. ..."`
	// Whether actions execute during alarm state transitions. Defaults to true
	//  in the IaC module when not set. Set to false to suppress actions during
	//  maintenance windows or alarm tuning.
	ActionsEnabled bool `json:"actions_enabled,omitempty" jsonschema:"Whether actions execute during alarm state transitions. Defaults to true in the IaC module when not set. Set to false to suppress actions during maintenance windows or alarm tuning."`
	// Name of the CloudWatch metric to alarm on (e.g., "CPUUtilization",
	//  "4xxErrorRate", "ApproximateNumberOfMessagesVisible").
	//
	//  When set, `namespace`, `period`, and one of `statistic` or
	//  `extended_statistic` must also be set.
	//
	//  Mutually exclusive with `metric_queries`.
	MetricName string `json:"metric_name,omitempty" jsonschema:"Name of the CloudWatch metric to alarm on (e.g.; 'CPUUtilization'; '4xxErrorRate'; 'ApproximateNumberOfMessagesVisible'). When set; 'namespace'; 'period'; and one of 'statistic' or 'extended_statistic..."`
	// Namespace of the metric (e.g., "AWS/EC2", "AWS/ECS", "AWS/SQS",
	//  "AWS/ApplicationELB"). Custom namespaces are also supported.
	//
	//  Required when `metric_name` is set. Must not start with a colon.
	Namespace string `json:"namespace,omitempty" jsonschema:"Namespace of the metric (e.g.; 'AWS/EC2'; 'AWS/ECS'; 'AWS/SQS'; 'AWS/ApplicationELB'). Custom namespaces are also supported. Required when 'metric_name' is set. Must not start with a colon."`
	// Period in seconds over which the statistic is applied. Defines the
	//  granularity of the alarm evaluation.
	//
	//  Valid values: 10, 20, 30, or any multiple of 60.
	//  High-resolution metrics support 10/20/30-second periods.
	//  Standard-resolution metrics require multiples of 60.
	//
	//  Required when `metric_name` is...
	Period int32 `json:"period,omitempty" jsonschema:"Period in seconds over which the statistic is applied. Defines the granularity of the alarm evaluation. Valid values: 10; 20; 30; or any multiple of 60. High-resolution metrics support 10/20/30-second..."`
	// Standard statistic to apply to the metric.
	//
	//  Valid values: "SampleCount", "Average", "Sum", "Minimum", "Maximum".
	//
	//  Mutually exclusive with `extended_statistic`. Exactly one must be set
	//  when using simple metric mode.
	Statistic string `json:"statistic,omitempty" jsonschema:"Standard statistic to apply to the metric. Valid values: 'SampleCount'; 'Average'; 'Sum'; 'Minimum'; 'Maximum'. Mutually exclusive with 'extended_statistic'. Exactly one must be set when using simple ..."`
	// Percentile or extended statistic to apply to the metric. Used for
	//  percentile-based alarms (e.g., p95 latency, p99 error rate).
	//
	//  Examples: "p95", "p99", "p99.9", "IQM", "TM(10%:90%)"
	//
	//  Mutually exclusive with `statistic`. Exactly one must be set when
	//  using simple metric mode.
	ExtendedStatistic string `json:"extended_statistic,omitempty" jsonschema:"Percentile or extended statistic to apply to the metric. Used for percentile-based alarms (e.g.; p95 latency; p99 error rate). Examples: 'p95'; 'p99'; 'p99.9'; 'IQM'; 'TM(10%:90%)' Mutually exclusive ..."`
	// Dimensions that identify the specific metric stream to alarm on.
	//  Dimensions narrow the metric to a specific resource or subset.
	//
	//  Example for EC2 CPU: {"InstanceId": "i-1234567890abcdef0"}
	//  Example for ECS service: {"ClusterName": "prod", "ServiceName": "api"}
	//
	//  Mutually exclusive with `metric_quer...
	Dimensions map[string]string `json:"dimensions,omitempty" jsonschema:"Dimensions that identify the specific metric stream to alarm on. Dimensions narrow the metric to a specific resource or subset. Example for EC2 CPU: {'InstanceId': 'i-1234567890abcdef0'} Example for E..."`
	// Unit for the metric. When specified, only data points with a matching unit
	//  are used for evaluation. Most alarms omit this and use the metric's
	//  published unit.
	Unit string `json:"unit,omitempty" jsonschema:"Unit for the metric. When specified; only data points with a matching unit are used for evaluation. Most alarms omit this and use the metric's published unit."`
	// Metric math expressions or multi-metric queries. Use this mode for:
	//  - Metric math (e.g., error rate = errors / total * 100)
	//  - Anomaly detection (ANOMALY_DETECTION_BAND function)
	//  - Cross-account metric monitoring
	//  - Multi-metric composite evaluations
	//
	//  Up to 20 queries are supported. Exactly one q...
	MetricQueries []*AwsCloudwatchAlarmMetricQueryInput `json:"metric_queries,omitempty" jsonschema:"Metric math expressions or multi-metric queries. Use this mode for: - Metric math (e.g.; error rate = errors / total * 100) - Anomaly detection (ANOMALY_DETECTION_BAND function) - Cross-account metric..."`
	// Actions to execute when the alarm transitions to ALARM state. Each action
	//  is an ARN — typically an SNS topic ARN, but can also be an Auto Scaling
	//  policy, EC2 automation action, Lambda function, or SSM OpsItem.
	//
	//  Maximum 5 actions.
	AlarmActions []string `json:"alarm_actions,omitempty" jsonschema:"Actions to execute when the alarm transitions to ALARM state. Each action is an ARN — typically an SNS topic ARN; but can also be an Auto Scaling policy; EC2 automation action; Lambda function; or S..."`
	// Actions to execute when the alarm transitions to OK state.
	//  Maximum 5 actions.
	OkActions []string `json:"ok_actions,omitempty" jsonschema:"Actions to execute when the alarm transitions to OK state. Maximum 5 actions."`
	// Actions to execute when the alarm transitions to INSUFFICIENT_DATA state.
	//  Maximum 5 actions.
	InsufficientDataActions []string `json:"insufficient_data_actions,omitempty" jsonschema:"Actions to execute when the alarm transitions to INSUFFICIENT_DATA state. Maximum 5 actions."`
	// Human-readable description of the alarm's purpose. Include details about
	//  what the alarm monitors, expected thresholds, and remediation steps.
	//  Maximum 1024 characters.
	AlarmDescription string `json:"alarm_description,omitempty" jsonschema:"Human-readable description of the alarm's purpose. Include details about what the alarm monitors; expected thresholds; and remediation steps. Maximum 1024 characters."`
	// Controls alarm behavior during periods with too few data points for
	//  statistically significant percentile calculations.
	//
	//  Valid values:
	//  - "evaluate" — Always evaluate the alarm regardless of sample count.
	//  - "ignore"   — Do not change alarm state during low-sample-count periods.
	//
	//  Only meaningf...
	EvaluateLowSampleCountPercentiles string `json:"evaluate_low_sample_count_percentiles,omitempty" jsonschema:"Controls alarm behavior during periods with too few data points for statistically significant percentile calculations. Valid values: - 'evaluate' — Always evaluate the alarm regardless of sample cou..."`
}

func (s *AwsCloudwatchAlarmSpecInput) validate() error {
	if s.ComparisonOperator == "" {
		return fmt.Errorf("comparison_operator is required")
	}
	for i, v := range s.MetricQueries {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("metric_queries[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *AwsCloudwatchAlarmSpecInput) applyDefaults() {
}

func (s *AwsCloudwatchAlarmSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	m["comparison_operator"] = s.ComparisonOperator
	if s.EvaluationPeriods != 0 {
		m["evaluation_periods"] = s.EvaluationPeriods
	}
	if s.DatapointsToAlarm != 0 {
		m["datapoints_to_alarm"] = s.DatapointsToAlarm
	}
	if s.Threshold != 0 {
		m["threshold"] = s.Threshold
	}
	if s.ThresholdMetricId != "" {
		m["threshold_metric_id"] = s.ThresholdMetricId
	}
	if s.TreatMissingData != "" {
		m["treat_missing_data"] = s.TreatMissingData
	}
	if s.ActionsEnabled {
		m["actions_enabled"] = s.ActionsEnabled
	}
	if s.MetricName != "" {
		m["metric_name"] = s.MetricName
	}
	if s.Namespace != "" {
		m["namespace"] = s.Namespace
	}
	if s.Period != 0 {
		m["period"] = s.Period
	}
	if s.Statistic != "" {
		m["statistic"] = s.Statistic
	}
	if s.ExtendedStatistic != "" {
		m["extended_statistic"] = s.ExtendedStatistic
	}
	if len(s.Dimensions) > 0 {
		m["dimensions"] = s.Dimensions
	}
	if s.Unit != "" {
		m["unit"] = s.Unit
	}
	if len(s.MetricQueries) > 0 {
		items := make([]any, len(s.MetricQueries))
		for i, v := range s.MetricQueries {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["metric_queries"] = items
	}
	if len(s.AlarmActions) > 0 {
		m["alarm_actions"] = s.AlarmActions
	}
	if len(s.OkActions) > 0 {
		m["ok_actions"] = s.OkActions
	}
	if len(s.InsufficientDataActions) > 0 {
		m["insufficient_data_actions"] = s.InsufficientDataActions
	}
	if s.AlarmDescription != "" {
		m["alarm_description"] = s.AlarmDescription
	}
	if s.EvaluateLowSampleCountPercentiles != "" {
		m["evaluate_low_sample_count_percentiles"] = s.EvaluateLowSampleCountPercentiles
	}
	return m
}

// AwsCloudwatchAlarmMetricQuery defines a single metric query within a metric
//
//	math alarm. Queries can reference raw metrics or define expressions that
//	combine other queries using metric math functions.
//
//	Exactly one of `expression` or `metric` must be set (not both, not neither).
//
//	The query `id` serves as a variable name in metric math expressions. For
//	example, two queries with id "m1" (raw 5xx errors) and "m2" (raw request
//	count) can be combined by a third query with expression "m1/m2*100" to
//	compute an error rate percentage.
type AwsCloudwatchAlarmMetricQueryInput struct {
	// Unique identifier for this query. Used as a variable name in metric math
	//  expressions. Must start with a lowercase letter; valid characters are
	//  lowercase letters, digits, and underscores.
	Id string `json:"id" jsonschema:"required,Unique identifier for this query. Used as a variable name in metric math expressions. Must start with a lowercase letter; valid characters are lowercase letters; digits; and underscores."`
	// Metric math expression or Metrics Insights query. References other
	//  queries by their `id` field.
	//
	//  Examples:
	//    "m1/m2*100"                           — error rate percentage
	//    "ANOMALY_DETECTION_BAND(m1, 2)"       — anomaly detection with 2 std devs
	//    "METRICS('AWS/EC2')"                   —...
	Expression string `json:"expression,omitempty" jsonschema:"Metric math expression or Metrics Insights query. References other queries by their 'id' field. Examples: 'm1/m2*100' — error rate percentage 'ANOMALY_DETECTION_BAND(m1; 2)' — anomaly detection wi..."`
	// Raw metric definition. Use when this query retrieves a metric from
	//  CloudWatch rather than computing a value from other queries.
	//
	//  Mutually exclusive with `expression`.
	Metric *AwsCloudwatchAlarmMetricQueryMetricInput `json:"metric,omitempty" jsonschema:"Raw metric definition. Use when this query retrieves a metric from CloudWatch rather than computing a value from other queries. Mutually exclusive with 'expression'."`
	// Human-readable label for this query. Displayed in the CloudWatch console
	//  and alarm history. Especially useful for expressions to describe what the
	//  computed value represents.
	Label string `json:"label,omitempty" jsonschema:"Human-readable label for this query. Displayed in the CloudWatch console and alarm history. Especially useful for expressions to describe what the computed value represents."`
	// Override period (in seconds) for this query. When omitted, uses the period
	//  from the `metric` definition (if present) or inherits the alarm's period.
	//
	//  Valid values: 1, 5, 10, 20, 30, or any multiple of 60.
	Period int32 `json:"period,omitempty" jsonschema:"Override period (in seconds) for this query. When omitted; uses the period from the 'metric' definition (if present) or inherits the alarm's period. Valid values: 1; 5; 10; 20; 30; or any multiple of ..."`
	// Whether this query's result is used as the alarm's evaluation signal.
	//  Exactly one query in the `metric_queries` list must set this to true.
	//  Queries with `return_data = false` are intermediate values used by
	//  expressions but not directly evaluated by the alarm.
	ReturnData bool `json:"return_data,omitempty" jsonschema:"Whether this query's result is used as the alarm's evaluation signal. Exactly one query in the 'metric_queries' list must set this to true. Queries with 'return_data = false' are intermediate values u..."`
	// AWS account ID where the metric is located. Use for cross-account alarms
	//  that monitor metrics from a different account.
	AccountId string `json:"account_id,omitempty" jsonschema:"AWS account ID where the metric is located. Use for cross-account alarms that monitor metrics from a different account."`
}

func (s *AwsCloudwatchAlarmMetricQueryInput) validate() error {
	if s.Id == "" {
		return fmt.Errorf("id is required")
	}
	if s.Metric != nil {
		if err := s.Metric.validate(); err != nil {
			return fmt.Errorf("metric: %w", err)
		}
	}
	return nil
}

func (s *AwsCloudwatchAlarmMetricQueryInput) applyDefaults() {
	if s.Metric != nil {
		s.Metric.applyDefaults()
	}
}

func (s *AwsCloudwatchAlarmMetricQueryInput) toMap() map[string]any {
	m := make(map[string]any)
	m["id"] = s.Id
	if s.Expression != "" {
		m["expression"] = s.Expression
	}
	if s.Metric != nil {
		m["metric"] = s.Metric.toMap()
	}
	if s.Label != "" {
		m["label"] = s.Label
	}
	if s.Period != 0 {
		m["period"] = s.Period
	}
	if s.ReturnData {
		m["return_data"] = s.ReturnData
	}
	if s.AccountId != "" {
		m["account_id"] = s.AccountId
	}
	return m
}

// AwsCloudwatchAlarmMetricQueryMetric defines a raw CloudWatch metric to
//
//	retrieve for use in a metric query. This is the data source for the query —
//	it specifies which metric, from which namespace, with what statistic and
//	period.
type AwsCloudwatchAlarmMetricQueryMetricInput struct {
	// Name of the CloudWatch metric (e.g., "CPUUtilization", "5XXError").
	MetricName string `json:"metric_name" jsonschema:"required,Name of the CloudWatch metric (e.g.; 'CPUUtilization'; '5XXError')."`
	// Namespace of the metric (e.g., "AWS/EC2", "AWS/ApplicationELB").
	Namespace string `json:"namespace" jsonschema:"required,Namespace of the metric (e.g.; 'AWS/EC2'; 'AWS/ApplicationELB')."`
	// Period in seconds for the metric data points. Determines the granularity
	//  of the data used in expressions.
	//
	//  Valid values: 1, 5, 10, 20, 30, or any multiple of 60.
	//  High-resolution metrics support sub-minute periods (1, 5, 10, 20, 30).
	Period int32 `json:"period,omitempty" jsonschema:"Period in seconds for the metric data points. Determines the granularity of the data used in expressions. Valid values: 1; 5; 10; 20; 30; or any multiple of 60. High-resolution metrics support sub-min..."`
	// Statistic to apply — either a standard statistic (SampleCount, Average,
	//  Sum, Minimum, Maximum) or a percentile/extended statistic (p95, p99.9,
	//  IQM, TM(10%:90%), etc.).
	Stat string `json:"stat" jsonschema:"required,Statistic to apply — either a standard statistic (SampleCount; Average; Sum; Minimum; Maximum) or a percentile/extended statistic (p95; p99.9; IQM; TM(10%:90%); etc.)."`
	// Dimensions that identify the specific metric stream.
	Dimensions map[string]string `json:"dimensions,omitempty" jsonschema:"Dimensions that identify the specific metric stream."`
	// Unit for the metric. Optional; filters data points to those matching
	//  the specified unit.
	Unit string `json:"unit,omitempty" jsonschema:"Unit for the metric. Optional; filters data points to those matching the specified unit."`
}

func (s *AwsCloudwatchAlarmMetricQueryMetricInput) validate() error {
	if s.MetricName == "" {
		return fmt.Errorf("metric_name is required")
	}
	if s.Namespace == "" {
		return fmt.Errorf("namespace is required")
	}
	if s.Stat == "" {
		return fmt.Errorf("stat is required")
	}
	return nil
}

func (s *AwsCloudwatchAlarmMetricQueryMetricInput) applyDefaults() {
}

func (s *AwsCloudwatchAlarmMetricQueryMetricInput) toMap() map[string]any {
	m := make(map[string]any)
	m["metric_name"] = s.MetricName
	m["namespace"] = s.Namespace
	if s.Period != 0 {
		m["period"] = s.Period
	}
	m["stat"] = s.Stat
	if len(s.Dimensions) > 0 {
		m["dimensions"] = s.Dimensions
	}
	if s.Unit != "" {
		m["unit"] = s.Unit
	}
	return m
}

// ParseAwsCloudwatchAlarm validates and normalizes a AwsCloudwatchAlarm cloud_object.
func ParseAwsCloudwatchAlarm(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "aws.openmcf.org/v1", "AwsCloudwatchAlarm"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AwsCloudwatchAlarmSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
