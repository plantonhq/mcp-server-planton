// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package aws

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AwsClientVpn represents an AWS Client VPN endpoint resource.
//
//	It encapsulates the configuration for a managed OpenVPN endpoint attached to a VPC.
type AwsClientVpnSpecInput struct {
	// The AWS region where the Client VPN endpoint will be created.
	//  Example: "us-west-2", "eu-west-1"
	Region string `json:"region,omitempty" jsonschema:"The AWS region where the Client VPN endpoint will be created. Example: 'us-west-2'; 'eu-west-1'"`
	// (Optional) A human-friendly description for the Client VPN endpoint. This is stored for clarity and is typically visible in the AWS Console as the description of the endpoint.
	Description string `json:"description,omitempty" jsonschema:"(Optional) A human-friendly description for the Client VPN endpoint. This is stored for clarity and is typically visible in the AWS Console as the description of the endpoint."`
	// The target AWS VPC in which to create the Client VPN endpoint. This should reference
	//  an existing AwsVpc resource. The Client VPN will be attached to this VPC's network.
	//  **Must** be a VPC in the same AWS region as the provided credentials.
	VpcId string `json:"vpc_id" jsonschema:"required,The target AWS VPC in which to create the Client VPN endpoint. This should reference an existing AwsVpc resource. The Client VPN will be attached to this VPC's network. **Must** be a VPC in the same A..."`
	// The list of subnet IDs in the above VPC to associate as target networks for the Client VPN.
	//  Each subnet association enables VPN clients to access resources in that subnet’s Availability Zone.
	//  At least one subnet ID is required (the first association will activate the endpoint). All subnets must ...
	Subnets []string `json:"subnets" jsonschema:"required,The list of subnet IDs in the above VPC to associate as target networks for the Client VPN. Each subnet association enables VPN clients to access resources in that subnet’s Availability Zone. At lea..."`
	// The IPv4 address range, in CIDR notation, from which to assign client IP addresses. For example, "10.0.0.0/22".
	//  This client CIDR block must not overlap with the VPC’s CIDR or any routes in the VPC.
	//  It defines the pool of IPs that VPN clients will receive. Note: The CIDR block size must be betwee...
	ClientCidrBlock string `json:"client_cidr_block" jsonschema:"required,The IPv4 address range; in CIDR notation; from which to assign client IP addresses. For example; '10.0.0.0/22'. This client CIDR block must not overlap with the VPC’s CIDR or any routes in the VPC. ..."`
	// The authentication method for clients connecting to this VPN endpoint.
	//  defaults to `certificate` (mutual TLS authentication using client certificates).
	AuthenticationType string `json:"authentication_type,omitempty" jsonschema:"enum=directory|cognito,The authentication method for clients connecting to this VPN endpoint. defaults to 'certificate' (mutual TLS authentication using client certificates)."`
	// The ARN of the ACM server certificate to use for the Client VPN endpoint. This TLS certificate is presented by the VPN server to clients upon connection.
	//  The certificate must be present in AWS Certificate Manager in the same region. This field is **required** for establishing the VPN (mutual TLS re...
	ServerCertificateArn string `json:"server_certificate_arn" jsonschema:"required,The ARN of the ACM server certificate to use for the Client VPN endpoint. This TLS certificate is presented by the VPN server to clients upon connection. The certificate must be present in AWS Certifi..."`
	// A list of IPv4 network CIDR ranges that VPN clients are authorized to access through this endpoint.
	//  Typically, these correspond to private subnet ranges within the VPC (e.g., "10.0.0.0/16") or other networks.
	//  For each CIDR here, an authorization rule will be created to allow clients to access that...
	CidrAuthorizationRules []string `json:"cidr_authorization_rules,omitempty" jsonschema:"A list of IPv4 network CIDR ranges that VPN clients are authorized to access through this endpoint. Typically; these correspond to private subnet ranges within the VPC (e.g.; '10.0.0.0/16') or other n..."`
	// Enables or disables split-tunnel routing for the VPN. When `false`, only traffic destined for the above authorized CIDRs (internal networks) will go through the VPN, while all other Internet traffic stays local to the client.
	//  When `true` (full-tunnel), all client traffic is routed through the VPN. ...
	DisableSplitTunnel bool `json:"disable_split_tunnel,omitempty" jsonschema:"Enables or disables split-tunnel routing for the VPN. When 'false'; only traffic destined for the above authorized CIDRs (internal networks) will go through the VPN; while all other Internet traffic s..."`
	// The port number on which the Client VPN endpoint will accept connections. The default (443) is commonly used for OpenVPN over TLS.
	//  Using port 443 allows VPN traffic to more easily traverse corporate firewalls.
	//  If a different port (e.g., 1194) is needed, it can be specified here.
	VpnPort int32 `json:"vpn_port,omitempty" jsonschema:"The port number on which the Client VPN endpoint will accept connections. The default (443) is commonly used for OpenVPN over TLS. Using port 443 allows VPN traffic to more easily traverse corporate f..."`
	// The transport protocol for VPN connections. Can be `tcp` or `udp`.
	TransportProtocol string `json:"transport_protocol,omitempty" jsonschema:"enum=udp|tcp,The transport protocol for VPN connections. Can be 'tcp' or 'udp'."`
	// The CloudWatch Logs group name for VPN connection logs. If specified, connection logging is enabled for this Client VPN endpoint.
	//  The VPN service will send connection events to the given log group (a log stream is created automatically if not provided).
	//  If left blank, connection logging is disable...
	LogGroupName string `json:"log_group_name,omitempty" jsonschema:"The CloudWatch Logs group name for VPN connection logs. If specified; connection logging is enabled for this Client VPN endpoint. The VPN service will send connection events to the given log group (a ..."`
	// (Optional) One or more security group IDs to apply to the Client VPN endpoint's network associations.
	//  These security groups control traffic between VPN clients and VPC resources.
	//  If not provided, the VPC’s default security group will be applied to the Client VPN endpoint.
	//  If provided, ensure th...
	SecurityGroups []string `json:"security_groups,omitempty" jsonschema:"(Optional) One or more security group IDs to apply to the Client VPN endpoint's network associations. These security groups control traffic between VPN clients and VPC resources. If not provided; the ..."`
	// (Optional) Custom DNS server IP addresses for VPN clients. Up to two IP addresses can be specified.
	//  If set, connected clients will use these DNS servers for name resolution while connected. If not set, clients default to the VPC’s DNS (AmazonProvidedDNS) for name resolution.
	DnsServers []string `json:"dns_servers,omitempty" jsonschema:"(Optional) Custom DNS server IP addresses for VPN clients. Up to two IP addresses can be specified. If set; connected clients will use these DNS servers for name resolution while connected. If not set..."`
}

func (s *AwsClientVpnSpecInput) validate() error {
	if s.VpcId == "" {
		return fmt.Errorf("vpc_id is required")
	}
	if len(s.Subnets) == 0 {
		return fmt.Errorf("subnets is required")
	}
	if len(s.Subnets) < 1 {
		return fmt.Errorf("subnets requires at least 1 items, got %d", len(s.Subnets))
	}
	if s.ClientCidrBlock == "" {
		return fmt.Errorf("client_cidr_block is required")
	}
	switch s.AuthenticationType {
	case "", "directory", "cognito":
	default:
		return fmt.Errorf("invalid authentication_type: %q", s.AuthenticationType)
	}
	if s.ServerCertificateArn == "" {
		return fmt.Errorf("server_certificate_arn is required")
	}
	switch s.TransportProtocol {
	case "", "udp", "tcp":
	default:
		return fmt.Errorf("invalid transport_protocol: %q", s.TransportProtocol)
	}
	return nil
}

func (s *AwsClientVpnSpecInput) applyDefaults() {
	if s.VpnPort == 0 {
		s.VpnPort = 443
	}
}

func (s *AwsClientVpnSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	if s.Description != "" {
		m["description"] = s.Description
	}
	m["vpc_id"] = s.VpcId
	m["subnets"] = s.Subnets
	m["client_cidr_block"] = s.ClientCidrBlock
	if s.AuthenticationType != "" {
		m["authentication_type"] = s.AuthenticationType
	}
	m["server_certificate_arn"] = s.ServerCertificateArn
	if len(s.CidrAuthorizationRules) > 0 {
		m["cidr_authorization_rules"] = s.CidrAuthorizationRules
	}
	if s.DisableSplitTunnel {
		m["disable_split_tunnel"] = s.DisableSplitTunnel
	}
	if s.VpnPort != 0 {
		m["vpn_port"] = s.VpnPort
	}
	if s.TransportProtocol != "" {
		m["transport_protocol"] = s.TransportProtocol
	}
	if s.LogGroupName != "" {
		m["log_group_name"] = s.LogGroupName
	}
	if len(s.SecurityGroups) > 0 {
		m["security_groups"] = s.SecurityGroups
	}
	if len(s.DnsServers) > 0 {
		m["dns_servers"] = s.DnsServers
	}
	return m
}

// ParseAwsClientVpn validates and normalizes a AwsClientVpn cloud_object.
func ParseAwsClientVpn(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "aws.openmcf.org/v1", "AwsClientVpn"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AwsClientVpnSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
