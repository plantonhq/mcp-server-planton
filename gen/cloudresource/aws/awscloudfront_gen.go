// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package aws

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AwsCloudFront is the top-level API resource envelope.
type AwsCloudFrontSpecInput struct {
	// The AWS region where the resource will be created.
	//  Example: "us-west-2", "eu-west-1"
	Region string `json:"region,omitempty" jsonschema:"The AWS region where the resource will be created. Example: 'us-west-2'; 'eu-west-1'"`
	// Whether the distribution is enabled.
	Enabled bool `json:"enabled,omitempty" jsonschema:"Whether the distribution is enabled."`
	// Aliases (CNAMEs) for the distribution, e.g., "cdn.example.com".
	Aliases []string `json:"aliases,omitempty" jsonschema:"Aliases (CNAMEs) for the distribution; e.g.; 'cdn.example.com'."`
	// ACM certificate ARN for custom domains. Must be in the us-east-1 region.
	//  Required when aliases are provided. Can reference an AwsCertManagerCert resource.
	CertificateArn string `json:"certificate_arn,omitempty" jsonschema:"ACM certificate ARN for custom domains. Must be in the us-east-1 region. Required when aliases are provided. Can reference an AwsCertManagerCert resource."`
	PriceClass     string `json:"price_class,omitempty" jsonschema:"enum=PRICE_CLASS_100|PRICE_CLASS_200|PRICE_CLASS_ALL"`
	// List of origins available to the distribution.
	//  Must contain at least one origin with exactly one marked as default.
	Origins []*OriginInput `json:"origins,omitempty" jsonschema:"List of origins available to the distribution. Must contain at least one origin with exactly one marked as default."`
	// Default root object, e.g., "index.html".
	DefaultRootObject string `json:"default_root_object,omitempty" jsonschema:"Default root object; e.g.; 'index.html'."`
}

func (s *AwsCloudFrontSpecInput) validate() error {
	switch s.PriceClass {
	case "", "PRICE_CLASS_100", "PRICE_CLASS_200", "PRICE_CLASS_ALL":
	default:
		return fmt.Errorf("invalid price_class: %q", s.PriceClass)
	}
	if len(s.Origins) < 1 {
		return fmt.Errorf("origins requires at least 1 items, got %d", len(s.Origins))
	}
	for i, v := range s.Origins {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("origins[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *AwsCloudFrontSpecInput) applyDefaults() {
}

func (s *AwsCloudFrontSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	if s.Enabled {
		m["enabled"] = s.Enabled
	}
	if len(s.Aliases) > 0 {
		m["aliases"] = s.Aliases
	}
	if s.CertificateArn != "" {
		m["certificate_arn"] = s.CertificateArn
	}
	if s.PriceClass != "" {
		m["price_class"] = s.PriceClass
	}
	if len(s.Origins) > 0 {
		items := make([]any, len(s.Origins))
		for i, v := range s.Origins {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["origins"] = items
	}
	if s.DefaultRootObject != "" {
		m["default_root_object"] = s.DefaultRootObject
	}
	return m
}

// Origin definition.
type OriginInput struct {
	// DNS name of the origin, e.g., "my-bucket.s3.amazonaws.com".
	DomainName string `json:"domain_name,omitempty" jsonschema:"DNS name of the origin; e.g.; 'my-bucket.s3.amazonaws.com'."`
	// Optional origin path that CloudFront appends to requests.
	OriginPath string `json:"origin_path,omitempty" jsonschema:"Optional origin path that CloudFront appends to requests."`
	// Whether this origin is used as the default origin for the distribution.
	//  Exactly one origin must be marked as default.
	IsDefault bool `json:"is_default,omitempty" jsonschema:"Whether this origin is used as the default origin for the distribution. Exactly one origin must be marked as default."`
}

func (s *OriginInput) validate() error {
	return nil
}

func (s *OriginInput) applyDefaults() {
}

func (s *OriginInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.DomainName != "" {
		m["domain_name"] = s.DomainName
	}
	if s.OriginPath != "" {
		m["origin_path"] = s.OriginPath
	}
	if s.IsDefault {
		m["is_default"] = s.IsDefault
	}
	return m
}

// ParseAwsCloudFront validates and normalizes a AwsCloudFront cloud_object.
func ParseAwsCloudFront(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "aws.openmcf.org/v1", "AwsCloudFront"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AwsCloudFrontSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
