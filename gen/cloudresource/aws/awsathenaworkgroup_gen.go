// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package aws

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AwsAthenaWorkgroup is the Kubernetes-style resource envelope for an Amazon
//
//	Athena workgroup.
type AwsAthenaWorkgroupSpecInput struct {
	// The AWS region where the Athena workgroup will be created.
	//  Example: "us-west-2", "eu-west-1"
	Region string `json:"region,omitempty" jsonschema:"The AWS region where the Athena workgroup will be created. Example: 'us-west-2'; 'eu-west-1'"`
	// Configuration for query result storage, encryption, and access control.
	//  When omitted, queries must specify their own result location or will use the
	//  AWS account-level Athena settings.
	ResultConfiguration *AwsAthenaWorkgroupResultConfigInput `json:"result_configuration,omitempty" jsonschema:"Configuration for query result storage; encryption; and access control. When omitted; queries must specify their own result location or will use the AWS account-level Athena settings."`
	// Maximum number of bytes a single query is allowed to scan. Queries that
	//  exceed this limit are cancelled automatically. This is the primary cost
	//  control mechanism for Athena workgroups.
	//
	//  Must be 0 (no limit, the default) or at least 10485760 (10 MB). AWS
	//  enforces this minimum to prevent trivially...
	BytesScannedCutoffPerQuery int64 `json:"bytes_scanned_cutoff_per_query,omitempty" jsonschema:"Maximum number of bytes a single query is allowed to scan. Queries that exceed this limit are cancelled automatically. This is the primary cost control mechanism for Athena workgroups. Must be 0 (no l..."`
	// When true (the default), workgroup settings override client-side settings
	//  for result location, encryption, and other configuration. Individual queries
	//  cannot override these values.
	//
	//  When false, queries can override workgroup settings. Useful for development
	//  workgroups where engineers need flexib...
	EnforceWorkgroupConfiguration bool `json:"enforce_workgroup_configuration,omitempty" jsonschema:"When true (the default); workgroup settings override client-side settings for result location; encryption; and other configuration. Individual queries cannot override these values. When false; queries..."`
	// When true, Athena publishes query execution metrics (data scanned, execution
	//  time, etc.) to CloudWatch. Useful for monitoring query performance and cost
	//  trends across the workgroup.
	PublishCloudwatchMetricsEnabled bool `json:"publish_cloudwatch_metrics_enabled,omitempty" jsonschema:"When true; Athena publishes query execution metrics (data scanned; execution time; etc.) to CloudWatch. Useful for monitoring query performance and cost trends across the workgroup."`
	// When true, the requester pays for data access charges when querying data in
	//  requester-pays S3 buckets. Default is false (the bucket owner pays).
	RequesterPaysEnabled bool `json:"requester_pays_enabled,omitempty" jsonschema:"When true; the requester pays for data access charges when querying data in requester-pays S3 buckets. Default is false (the bucket owner pays)."`
	// When true, enforces a minimum encryption level (at least SSE_S3) for all
	//  query results written by this workgroup. Queries that do not specify
	//  encryption will default to SSE_S3.
	//
	//  Useful as a compliance guardrail to ensure no query results are ever written
	//  unencrypted, even if result_configuration...
	EnableMinimumEncryptionConfiguration bool `json:"enable_minimum_encryption_configuration,omitempty" jsonschema:"When true; enforces a minimum encryption level (at least SSE_S3) for all query results written by this workgroup. Queries that do not specify encryption will default to SSE_S3. Useful as a compliance ..."`
	// The Athena engine version to use for queries in this workgroup. Leave empty
	//  or set to "AUTO" (the default) to use the latest available engine version.
	//
	//  Pinning to a specific version (e.g., "Athena engine version 3") is useful
	//  when you need to control query behavior across engine upgrades. The act...
	SelectedEngineVersion string `json:"selected_engine_version,omitempty" jsonschema:"The Athena engine version to use for queries in this workgroup. Leave empty or set to 'AUTO' (the default) to use the latest available engine version. Pinning to a specific version (e.g.; 'Athena engi..."`
	// When true, all named queries and prepared statements associated with the
	//  workgroup are deleted when the workgroup is destroyed. When false (the
	//  default), destroying a workgroup that contains named queries or prepared
	//  statements will fail.
	ForceDestroy bool `json:"force_destroy,omitempty" jsonschema:"When true; all named queries and prepared statements associated with the workgroup are deleted when the workgroup is destroyed. When false (the default); destroying a workgroup that contains named que..."`
	// IAM role ARN for Apache Spark workloads. Required only for workgroups that
	//  run PySpark notebooks or Spark SQL — standard Athena SQL workgroups do not
	//  need this field.
	//
	//  The role must have permissions to read from S3 data sources, write results,
	//  and access the AWS Glue Data Catalog.
	ExecutionRole string `json:"execution_role,omitempty" jsonschema:"IAM role ARN for Apache Spark workloads. Required only for workgroups that run PySpark notebooks or Spark SQL — standard Athena SQL workgroups do not need this field. The role must have permissions ..."`
}

func (s *AwsAthenaWorkgroupSpecInput) validate() error {
	if s.ResultConfiguration != nil {
		if err := s.ResultConfiguration.validate(); err != nil {
			return fmt.Errorf("result_configuration: %w", err)
		}
	}
	return nil
}

func (s *AwsAthenaWorkgroupSpecInput) applyDefaults() {
	if s.ResultConfiguration != nil {
		s.ResultConfiguration.applyDefaults()
	}
	// default: EnforceWorkgroupConfiguration = true (applied at zero-value)
	// default: PublishCloudwatchMetricsEnabled = true (applied at zero-value)
}

func (s *AwsAthenaWorkgroupSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	if s.ResultConfiguration != nil {
		m["result_configuration"] = s.ResultConfiguration.toMap()
	}
	if s.BytesScannedCutoffPerQuery != 0 {
		m["bytes_scanned_cutoff_per_query"] = s.BytesScannedCutoffPerQuery
	}
	if s.EnforceWorkgroupConfiguration {
		m["enforce_workgroup_configuration"] = s.EnforceWorkgroupConfiguration
	}
	if s.PublishCloudwatchMetricsEnabled {
		m["publish_cloudwatch_metrics_enabled"] = s.PublishCloudwatchMetricsEnabled
	}
	if s.RequesterPaysEnabled {
		m["requester_pays_enabled"] = s.RequesterPaysEnabled
	}
	if s.EnableMinimumEncryptionConfiguration {
		m["enable_minimum_encryption_configuration"] = s.EnableMinimumEncryptionConfiguration
	}
	if s.SelectedEngineVersion != "" {
		m["selected_engine_version"] = s.SelectedEngineVersion
	}
	if s.ForceDestroy {
		m["force_destroy"] = s.ForceDestroy
	}
	if s.ExecutionRole != "" {
		m["execution_role"] = s.ExecutionRole
	}
	return m
}

// AwsAthenaWorkgroupResultConfig defines where Athena stores query results and
//
//	how those results are encrypted.
type AwsAthenaWorkgroupResultConfigInput struct {
	// S3 URI where query results are stored, e.g., "s3://my-bucket/athena-results/".
	//  Include the trailing slash. When omitted, queries must specify their own
	//  result location.
	//
	//  This is a plain string (not StringValueOrRef) because it's an S3 URI with a
	//  user-defined path prefix, not a direct resource id...
	OutputLocation string `json:"output_location,omitempty" jsonschema:"S3 URI where query results are stored; e.g.; 's3://my-bucket/athena-results/'. Include the trailing slash. When omitted; queries must specify their own result location. This is a plain string (not Str..."`
	// Server-side encryption mode for query results written to S3.
	//
	//  Valid values:
	//  - "SSE_S3"   — Amazon S3-managed encryption keys (no additional cost).
	//  - "SSE_KMS"  — AWS KMS-managed key. Requires kms_key_arn. Provides key
	//                 rotation control and CloudTrail audit of key usage.
	//  - "CSE...
	EncryptionOption string `json:"encryption_option,omitempty" jsonschema:"Server-side encryption mode for query results written to S3. Valid values: - 'SSE_S3' — Amazon S3-managed encryption keys (no additional cost). - 'SSE_KMS' — AWS KMS-managed key. Requires kms_key_..."`
	// KMS key ARN for encrypting query results. Required when encryption_option is
	//  SSE_KMS or CSE_KMS. Must not be set for SSE_S3 or when encryption is
	//  disabled.
	KmsKeyArn string `json:"kms_key_arn,omitempty" jsonschema:"KMS key ARN for encrypting query results. Required when encryption_option is SSE_KMS or CSE_KMS. Must not be set for SSE_S3 or when encryption is disabled."`
	// AWS account ID that owns the S3 bucket used for query results. Set this when
	//  the output_location bucket belongs to a different AWS account than the one
	//  running the Athena workgroup. Ensures Athena applies the correct bucket
	//  ownership controls.
	ExpectedBucketOwner string `json:"expected_bucket_owner,omitempty" jsonschema:"AWS account ID that owns the S3 bucket used for query results. Set this when the output_location bucket belongs to a different AWS account than the one running the Athena workgroup. Ensures Athena app..."`
	// S3 ACL option applied to query result objects. The only valid value is
	//  "BUCKET_OWNER_FULL_CONTROL", which grants the bucket owner full control of
	//  result objects. Useful for cross-account scenarios where the query executor
	//  writes to a bucket owned by another account.
	//
	//  When omitted, S3 default ACL...
	S3AclOption string `json:"s3_acl_option,omitempty" jsonschema:"S3 ACL option applied to query result objects. The only valid value is 'BUCKET_OWNER_FULL_CONTROL'; which grants the bucket owner full control of result objects. Useful for cross-account scenarios whe..."`
}

func (s *AwsAthenaWorkgroupResultConfigInput) validate() error {
	return nil
}

func (s *AwsAthenaWorkgroupResultConfigInput) applyDefaults() {
}

func (s *AwsAthenaWorkgroupResultConfigInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.OutputLocation != "" {
		m["output_location"] = s.OutputLocation
	}
	if s.EncryptionOption != "" {
		m["encryption_option"] = s.EncryptionOption
	}
	if s.KmsKeyArn != "" {
		m["kms_key_arn"] = s.KmsKeyArn
	}
	if s.ExpectedBucketOwner != "" {
		m["expected_bucket_owner"] = s.ExpectedBucketOwner
	}
	if s.S3AclOption != "" {
		m["s3_acl_option"] = s.S3AclOption
	}
	return m
}

// ParseAwsAthenaWorkgroup validates and normalizes a AwsAthenaWorkgroup cloud_object.
func ParseAwsAthenaWorkgroup(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "aws.openmcf.org/v1", "AwsAthenaWorkgroup"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AwsAthenaWorkgroupSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
