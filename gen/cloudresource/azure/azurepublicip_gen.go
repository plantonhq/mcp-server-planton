// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package azure

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AzurePublicIp is the top-level API resource for an Azure Public IP Address.
//
//	Public IPs provide static, internet-routable IPv4 addresses that can be attached
//	to load balancers, application gateways, NAT gateways, and virtual machines.
type AzurePublicIpSpecInput struct {
	// The Azure region where the Public IP will be created.
	//  Examples: "eastus", "westus2", "westeurope", "southeastasia".
	//  The Public IP must be in the same region as the resource it will be attached to
	//  (load balancer, application gateway, NAT gateway, etc.).
	Region string `json:"region" jsonschema:"required,The Azure region where the Public IP will be created. Examples: 'eastus'; 'westus2'; 'westeurope'; 'southeastasia'. The Public IP must be in the same region as the resource it will be attached to (loa..."`
	// The Azure Resource Group where the Public IP will be created.
	//  Can be a literal string or a reference to an AzureResourceGroup output.
	ResourceGroup string `json:"resource_group" jsonschema:"required,The Azure Resource Group where the Public IP will be created. Can be a literal string or a reference to an AzureResourceGroup output."`
	// The name of the Public IP resource.
	//  Must be unique within the resource group.
	//  Allowed characters: alphanumeric, underscores, hyphens, and periods.
	//  Must start with alphanumeric. Length: 1 to 80 characters.
	Name string `json:"name" jsonschema:"required,The name of the Public IP resource. Must be unique within the resource group. Allowed characters: alphanumeric; underscores; hyphens; and periods. Must start with alphanumeric. Length: 1 to 80 charact..."`
	// An optional DNS label that creates a domain name mapping for this Public IP.
	//  When set, Azure creates an A record at: {label}.{region}.cloudapp.azure.com
	//  pointing to this IP address. This provides a stable DNS name even if the IP
	//  changes (though with Standard SKU + static allocation, IPs are persi...
	DomainNameLabel string `json:"domain_name_label,omitempty" jsonschema:"An optional DNS label that creates a domain name mapping for this Public IP. When set; Azure creates an A record at: {label}.{region}.cloudapp.azure.com pointing to this IP address. This provides a st..."`
	// Availability zones for the Public IP.
	//  Standard SKU public IPs can be zone-redundant (multiple zones) or zonal (single zone).
	//  Valid values: "1", "2", "3" (availability zone numbers).
	//  Examples:
	//  - ["1", "2", "3"] for zone-redundant (recommended for production)
	//  - ["1"] for zonal (pinned to zone 1)
	// ...
	Zones []string `json:"zones,omitempty" jsonschema:"Availability zones for the Public IP. Standard SKU public IPs can be zone-redundant (multiple zones) or zonal (single zone). Valid values: '1'; '2'; '3' (availability zone numbers). Examples: - ['1'; ..."`
	// The idle timeout in minutes for the Public IP.
	//  Controls how long Azure keeps idle TCP/UDP connections open before recycling them.
	//  Higher values are better for long-lived connections (WebSocket, gRPC streaming,
	//  database connections). Lower values free resources faster for short-lived traffic.
	//  Ran...
	IdleTimeoutInMinutes int32 `json:"idle_timeout_in_minutes,omitempty" jsonschema:"The idle timeout in minutes for the Public IP. Controls how long Azure keeps idle TCP/UDP connections open before recycling them. Higher values are better for long-lived connections (WebSocket; gRPC s..."`
}

func (s *AzurePublicIpSpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	if s.ResourceGroup == "" {
		return fmt.Errorf("resource_group is required")
	}
	if s.Name == "" {
		return fmt.Errorf("name is required")
	}
	return nil
}

func (s *AzurePublicIpSpecInput) applyDefaults() {
	if s.IdleTimeoutInMinutes == 0 {
		s.IdleTimeoutInMinutes = 4
	}
}

func (s *AzurePublicIpSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	m["resource_group"] = s.ResourceGroup
	m["name"] = s.Name
	if s.DomainNameLabel != "" {
		m["domain_name_label"] = s.DomainNameLabel
	}
	if len(s.Zones) > 0 {
		m["zones"] = s.Zones
	}
	if s.IdleTimeoutInMinutes != 0 {
		m["idle_timeout_in_minutes"] = s.IdleTimeoutInMinutes
	}
	return m
}

// ParseAzurePublicIp validates and normalizes a AzurePublicIp cloud_object.
func ParseAzurePublicIp(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "azure.openmcf.org/v1", "AzurePublicIp"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AzurePublicIpSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
