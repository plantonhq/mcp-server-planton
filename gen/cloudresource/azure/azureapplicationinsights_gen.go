// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package azure

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AzureApplicationInsights is the top-level resource definition for an Azure
//
//	Application Insights instance. It follows the KRM (Kubernetes Resource Model)
//	pattern with apiVersion, kind, metadata, spec, and status.
type AzureApplicationInsightsSpecInput struct {
	// The Azure region where Application Insights will be deployed.
	//  Examples: "eastus", "westus2", "westeurope", "southeastasia".
	//  Should match the region of the application(s) being monitored to minimize
	//  telemetry ingestion latency and data residency concerns.
	Region string `json:"region" jsonschema:"required,The Azure region where Application Insights will be deployed. Examples: 'eastus'; 'westus2'; 'westeurope'; 'southeastasia'. Should match the region of the application(s) being monitored to minimize te..."`
	// The Azure Resource Group where Application Insights will be created.
	//  Can be a literal string or a reference to an AzureResourceGroup output.
	ResourceGroup string `json:"resource_group" jsonschema:"required,The Azure Resource Group where Application Insights will be created. Can be a literal string or a reference to an AzureResourceGroup output."`
	// The name of the Application Insights resource.
	//  Must be unique within the resource group.
	//  Length: 1 to 260 characters.
	Name string `json:"name" jsonschema:"required,The name of the Application Insights resource. Must be unique within the resource group. Length: 1 to 260 characters."`
	// The type of application being monitored.
	//  Uses exact Azure API values -- no conversion needed in IaC modules.
	//  - "web": Web applications (ASP.NET, Spring Boot, Django, Express, etc.)
	//  - "java": Java applications (standalone, not web)
	//  - "Node.JS": Node.js applications
	//  - "other": All other applicati...
	ApplicationType string `json:"application_type,omitempty" jsonschema:"The type of application being monitored. Uses exact Azure API values -- no conversion needed in IaC modules. - 'web': Web applications (ASP.NET; Spring Boot; Django; Express; etc.) - 'java': Java appl..."`
	// The Log Analytics Workspace to store Application Insights data.
	//  Required -- workspace-based Application Insights is the only supported mode.
	//  Classic (non-workspace) Application Insights is deprecated by Microsoft.
	//  Can be a literal workspace resource ID or a reference to an
	//  AzureLogAnalyticsWorks...
	WorkspaceId string `json:"workspace_id" jsonschema:"required,The Log Analytics Workspace to store Application Insights data. Required -- workspace-based Application Insights is the only supported mode. Classic (non-workspace) Application Insights is deprecated ..."`
	// The number of days to retain telemetry data.
	//  Azure only allows specific values: 30, 60, 90, 120, 180, 270, 365, 550, 730.
	//  Free tier includes 90 days. Beyond that, retention is billed per GB per month.
	//  Default: 90
	RetentionInDays int32 `json:"retention_in_days,omitempty" jsonschema:"The number of days to retain telemetry data. Azure only allows specific values: 30; 60; 90; 120; 180; 270; 365; 550; 730. Free tier includes 90 days. Beyond that; retention is billed per GB per month...."`
	// The daily telemetry data cap in GB.
	//  When the cap is reached, telemetry ingestion stops until the next UTC day.
	//  Set to control costs in development or staging environments.
	//  Default: 100 (Azure's default)
	DailyDataCapInGb float64 `json:"daily_data_cap_in_gb,omitempty" jsonschema:"The daily telemetry data cap in GB. When the cap is reached; telemetry ingestion stops until the next UTC day. Set to control costs in development or staging environments. Default: 100 (Azure's defaul..."`
	// The percentage of telemetry data to sample (0-100).
	//  Reducing sampling percentage lowers data volume and cost while still providing
	//  statistically representative telemetry. Common production values are 25-50%.
	//  Set to 100 for full fidelity (all telemetry collected).
	//  Default: 100
	SamplingPercentage float64 `json:"sampling_percentage,omitempty" jsonschema:"The percentage of telemetry data to sample (0-100). Reducing sampling percentage lowers data volume and cost while still providing statistically representative telemetry. Common production values are ..."`
}

func (s *AzureApplicationInsightsSpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	if s.ResourceGroup == "" {
		return fmt.Errorf("resource_group is required")
	}
	if s.Name == "" {
		return fmt.Errorf("name is required")
	}
	if s.WorkspaceId == "" {
		return fmt.Errorf("workspace_id is required")
	}
	return nil
}

func (s *AzureApplicationInsightsSpecInput) applyDefaults() {
	if s.ApplicationType == "" {
		s.ApplicationType = "web"
	}
	if s.RetentionInDays == 0 {
		s.RetentionInDays = 90
	}
}

func (s *AzureApplicationInsightsSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	m["resource_group"] = s.ResourceGroup
	m["name"] = s.Name
	if s.ApplicationType != "" {
		m["application_type"] = s.ApplicationType
	}
	m["workspace_id"] = s.WorkspaceId
	if s.RetentionInDays != 0 {
		m["retention_in_days"] = s.RetentionInDays
	}
	if s.DailyDataCapInGb != 0 {
		m["daily_data_cap_in_gb"] = s.DailyDataCapInGb
	}
	if s.SamplingPercentage != 0 {
		m["sampling_percentage"] = s.SamplingPercentage
	}
	return m
}

// ParseAzureApplicationInsights validates and normalizes a AzureApplicationInsights cloud_object.
func ParseAzureApplicationInsights(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "azure.openmcf.org/v1", "AzureApplicationInsights"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AzureApplicationInsightsSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
