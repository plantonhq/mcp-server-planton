// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package azure

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// AzureSubnet is the top-level API resource for an Azure Subnet.
//
//	Subnets partition a Virtual Network's address space into segments for different
//	workloads, tiers, or service delegations. This is the most widely referenced
//	networking resource in the Azure resource collection.
type AzureSubnetSpecInput struct {
	// The Azure Resource Group where the parent VNet exists.
	//  Must be the same resource group as the VNet.
	//  Can be a literal string or a reference to an AzureResourceGroup output.
	ResourceGroup string `json:"resource_group" jsonschema:"required,The Azure Resource Group where the parent VNet exists. Must be the same resource group as the VNet. Can be a literal string or a reference to an AzureResourceGroup output."`
	// The Azure Resource Manager ID of the parent Virtual Network.
	//  The subnet will be created inside this VNet and must use an address prefix
	//  that falls within the VNet's address space.
	//  Format: /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.Network/virtualNetworks/{name}
	VnetId string `json:"vnet_id" jsonschema:"required,The Azure Resource Manager ID of the parent Virtual Network. The subnet will be created inside this VNet and must use an address prefix that falls within the VNet's address space. Format: /subscriptio..."`
	// The name of the subnet.
	//  Must be unique within the VNet.
	//  Allowed characters: alphanumeric, underscores, hyphens, and periods.
	//  Must start with alphanumeric. Length: 1 to 80 characters.
	Name string `json:"name" jsonschema:"required,The name of the subnet. Must be unique within the VNet. Allowed characters: alphanumeric; underscores; hyphens; and periods. Must start with alphanumeric. Length: 1 to 80 characters."`
	// The IPv4 CIDR block for the subnet (e.g., "10.0.1.0/24").
	//  Must be a subset of the parent VNet's address space and must not overlap
	//  with other subnets in the same VNet.
	//  Typical sizing: /24 for general workloads (254 usable IPs), /27 for Application
	//  Gateway (min 32 IPs), /28 for small delegated su...
	AddressPrefix string `json:"address_prefix" jsonschema:"required,The IPv4 CIDR block for the subnet (e.g.; '10.0.1.0/24'). Must be a subset of the parent VNet's address space and must not overlap with other subnets in the same VNet. Typical sizing: /24 for general ..."`
	// Azure service endpoints to enable on this subnet.
	//  Service endpoints create an optimized route over the Azure backbone network
	//  to the specified Azure services, bypassing the public internet.
	//
	//  Common values:
	//  - "Microsoft.Storage" -- secure access to Azure Storage Accounts
	//  - "Microsoft.Sql" -- sec...
	ServiceEndpoints []string `json:"service_endpoints,omitempty" jsonschema:"Azure service endpoints to enable on this subnet. Service endpoints create an optimized route over the Azure backbone network to the specified Azure services; bypassing the public internet. Common val..."`
	// Optional service delegation for this subnet.
	//  Delegation grants an Azure service permission to create service-specific
	//  network rules and inject resources into the subnet. A subnet can have at
	//  most one delegation.
	//
	//  Common delegations:
	//  - PostgreSQL Flexible Server: "Microsoft.DBforPostgreSQL/flexi...
	Delegation *AzureSubnetDelegationInput `json:"delegation,omitempty" jsonschema:"Optional service delegation for this subnet. Delegation grants an Azure service permission to create service-specific network rules and inject resources into the subnet. A subnet can have at most one ..."`
	// Controls whether network policies (NSG rules, route tables) are applied to
	//  private endpoints in this subnet.
	//
	//  Valid values:
	//  - "Disabled" -- network policies are NOT applied to private endpoints (Azure default)
	//  - "Enabled" -- both NSG and route table policies apply to private endpoints
	//  - "Networ...
	PrivateEndpointNetworkPolicies string `json:"private_endpoint_network_policies,omitempty" jsonschema:"Controls whether network policies (NSG rules; route tables) are applied to private endpoints in this subnet. Valid values: - 'Disabled' -- network policies are NOT applied to private endpoints (Azure ..."`
	// Controls whether network policies are applied to Private Link Service
	//  resources in this subnet.
	//
	//  When true (default), standard network policies (NSGs, UDRs) apply to Private
	//  Link Services. Set to false only when creating a Private Link Service that
	//  needs to bypass network policies.
	//
	//  Default: tr...
	PrivateLinkServiceNetworkPoliciesEnabled bool `json:"private_link_service_network_policies_enabled,omitempty" jsonschema:"Controls whether network policies are applied to Private Link Service resources in this subnet. When true (default); standard network policies (NSGs; UDRs) apply to Private Link Services. Set to false..."`
}

func (s *AzureSubnetSpecInput) validate() error {
	if s.ResourceGroup == "" {
		return fmt.Errorf("resource_group is required")
	}
	if s.VnetId == "" {
		return fmt.Errorf("vnet_id is required")
	}
	if s.Name == "" {
		return fmt.Errorf("name is required")
	}
	if s.AddressPrefix == "" {
		return fmt.Errorf("address_prefix is required")
	}
	if s.Delegation != nil {
		if err := s.Delegation.validate(); err != nil {
			return fmt.Errorf("delegation: %w", err)
		}
	}
	return nil
}

func (s *AzureSubnetSpecInput) applyDefaults() {
	if s.Delegation != nil {
		s.Delegation.applyDefaults()
	}
	if s.PrivateEndpointNetworkPolicies == "" {
		s.PrivateEndpointNetworkPolicies = "Disabled"
	}
	// default: PrivateLinkServiceNetworkPoliciesEnabled = true (applied at zero-value)
}

func (s *AzureSubnetSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["resource_group"] = s.ResourceGroup
	m["vnet_id"] = s.VnetId
	m["name"] = s.Name
	m["address_prefix"] = s.AddressPrefix
	if len(s.ServiceEndpoints) > 0 {
		m["service_endpoints"] = s.ServiceEndpoints
	}
	if s.Delegation != nil {
		m["delegation"] = s.Delegation.toMap()
	}
	if s.PrivateEndpointNetworkPolicies != "" {
		m["private_endpoint_network_policies"] = s.PrivateEndpointNetworkPolicies
	}
	if s.PrivateLinkServiceNetworkPoliciesEnabled {
		m["private_link_service_network_policies_enabled"] = s.PrivateLinkServiceNetworkPoliciesEnabled
	}
	return m
}

// AzureSubnetDelegation defines a service delegation for the subnet.
//
//	Delegation grants an Azure PaaS service permission to inject service-specific
//	resources and network rules into the subnet.
type AzureSubnetDelegationInput struct {
	// A user-chosen label for this delegation.
	//  This is a logical name used in the Terraform/Pulumi configuration, not an
	//  Azure resource name. Use a descriptive name like "postgresql" or "container-apps".
	Name string `json:"name" jsonschema:"required,A user-chosen label for this delegation. This is a logical name used in the Terraform/Pulumi configuration; not an Azure resource name. Use a descriptive name like 'postgresql' or 'container-apps'."`
	// The Azure service to delegate to.
	//  This must be an exact match for one of Azure's supported delegation service names.
	//
	//  Common values:
	//  - "Microsoft.DBforPostgreSQL/flexibleServers"
	//  - "Microsoft.DBforMySQL/flexibleServers"
	//  - "Microsoft.App/environments"
	//  - "Microsoft.Web/serverFarms"
	//  - "Microsoft...
	ServiceName string `json:"service_name" jsonschema:"required,The Azure service to delegate to. This must be an exact match for one of Azure's supported delegation service names. Common values: - 'Microsoft.DBforPostgreSQL/flexibleServers' - 'Microsoft.DBforMySQ..."`
	// Optional list of actions that the delegated service is permitted to perform.
	//  If omitted, Azure uses the default actions for the service.
	//
	//  Common action: "Microsoft.Network/virtualNetworks/subnets/action"
	//  Most delegations only need this single action, and Azure infers it if omitted.
	Actions []string `json:"actions,omitempty" jsonschema:"Optional list of actions that the delegated service is permitted to perform. If omitted; Azure uses the default actions for the service. Common action: 'Microsoft.Network/virtualNetworks/subnets/actio..."`
}

func (s *AzureSubnetDelegationInput) validate() error {
	if s.Name == "" {
		return fmt.Errorf("name is required")
	}
	if s.ServiceName == "" {
		return fmt.Errorf("service_name is required")
	}
	return nil
}

func (s *AzureSubnetDelegationInput) applyDefaults() {
}

func (s *AzureSubnetDelegationInput) toMap() map[string]any {
	m := make(map[string]any)
	m["name"] = s.Name
	m["service_name"] = s.ServiceName
	if len(s.Actions) > 0 {
		m["actions"] = s.Actions
	}
	return m
}

// ParseAzureSubnet validates and normalizes a AzureSubnet cloud_object.
func ParseAzureSubnet(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "azure.openmcf.org/v1", "AzureSubnet"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AzureSubnetSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
