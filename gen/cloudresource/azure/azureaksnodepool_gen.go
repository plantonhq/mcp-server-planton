// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package azure

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// azure-aks-node-pool
type AzureAksNodePoolSpecInput struct {
	// Reference to the parent AKS cluster by name.
	//  Must refer to an existing AzureAksCluster resource in the same environment.
	ClusterName string `json:"cluster_name" jsonschema:"required,Reference to the parent AKS cluster by name. Must refer to an existing AzureAksCluster resource in the same environment."`
	// VM size (SKU) for the nodes in this pool (e.g., "Standard_D4s_v3").
	//  Determines the CPU/memory of each node. No default; user must specify.
	VmSize string `json:"vm_size" jsonschema:"required,VM size (SKU) for the nodes in this pool (e.g.; 'Standard_D4s_v3'). Determines the CPU/memory of each node. No default; user must specify."`
	// Number of nodes to create in this pool initially (if autoscaling is off, this is the fixed node count).
	//  Must be at least 1.
	InitialNodeCount int32 `json:"initial_node_count" jsonschema:"required,Number of nodes to create in this pool initially (if autoscaling is off; this is the fixed node count). Must be at least 1."`
	// Autoscaling configuration for this node pool. If set, cluster autoscaler is enabled for this pool.
	//  If not provided, the node pool will have a fixed size (no autoscaling).
	Autoscaling *AzureAksNodePoolAutoscalingInput `json:"autoscaling,omitempty" jsonschema:"Autoscaling configuration for this node pool. If set; cluster autoscaler is enabled for this pool. If not provided; the node pool will have a fixed size (no autoscaling)."`
	// Zones to spread this node pool across for high availability (e.g., ["1", "2", "3"] for three zones).
	//  If unspecified, nodes are not pinned to specific zones (using region defaults). If specified, at least 2 zones should be provided for HA.
	AvailabilityZones []string `json:"availability_zones,omitempty" jsonschema:"Zones to spread this node pool across for high availability (e.g.; ['1'; '2'; '3'] for three zones). If unspecified; nodes are not pinned to specific zones (using region defaults). If specified; at le..."`
	// Operating system type for nodes. Defaults to Linux. Use "WINDOWS" for a Windows node pool (requires a cluster with Windows support).
	OsType string `json:"os_type,omitempty" jsonschema:"enum=LINUX|WINDOWS,Operating system type for nodes. Defaults to Linux. Use 'WINDOWS' for a Windows node pool (requires a cluster with Windows support)."`
	// Node pool mode determines the pool's purpose.
	//  SYSTEM pools host critical cluster components (CoreDNS, metrics-server). Must be Linux. Cannot scale to zero.
	//  USER pools run application workloads. Can be Linux or Windows. Can scale to zero.
	//  Defaults to USER since most additional pools are for applic...
	Mode string `json:"mode,omitempty" jsonschema:"enum=SYSTEM|USER,Node pool mode determines the pool's purpose. SYSTEM pools host critical cluster components (CoreDNS; metrics-server). Must be Linux. Cannot scale to zero. USER pools run application workloads. Can be..."`
	// Use Spot (preemptible) VMs for this node pool to reduce cost. Defaults to false (regular on-demand VMs).
	//  NOTE: Spot cannot be used for System mode pools.
	SpotEnabled bool `json:"spot_enabled,omitempty" jsonschema:"Use Spot (preemptible) VMs for this node pool to reduce cost. Defaults to false (regular on-demand VMs). NOTE: Spot cannot be used for System mode pools."`
	// The Azure Resource Group where the node pool's parent cluster resides.
	//  Can be a literal string or a reference to an AzureResourceGroup output.
	ResourceGroup string `json:"resource_group" jsonschema:"required,The Azure Resource Group where the node pool's parent cluster resides. Can be a literal string or a reference to an AzureResourceGroup output."`
}

func (s *AzureAksNodePoolSpecInput) validate() error {
	if s.ClusterName == "" {
		return fmt.Errorf("cluster_name is required")
	}
	if s.VmSize == "" {
		return fmt.Errorf("vm_size is required")
	}
	if s.Autoscaling != nil {
		if err := s.Autoscaling.validate(); err != nil {
			return fmt.Errorf("autoscaling: %w", err)
		}
	}
	if len(s.AvailabilityZones) < 2 {
		return fmt.Errorf("availability_zones requires at least 2 items, got %d", len(s.AvailabilityZones))
	}
	switch s.OsType {
	case "", "LINUX", "WINDOWS":
	default:
		return fmt.Errorf("invalid os_type: %q", s.OsType)
	}
	switch s.Mode {
	case "", "SYSTEM", "USER":
	default:
		return fmt.Errorf("invalid mode: %q", s.Mode)
	}
	if s.ResourceGroup == "" {
		return fmt.Errorf("resource_group is required")
	}
	return nil
}

func (s *AzureAksNodePoolSpecInput) applyDefaults() {
	if s.Autoscaling != nil {
		s.Autoscaling.applyDefaults()
	}
	if s.OsType == "" {
		s.OsType = "AZURE_AKS_NODE_POOL_OS_TYPE_LINUX"
	}
	if s.Mode == "" {
		s.Mode = "AZURE_AKS_NODE_POOL_MODE_USER"
	}
}

func (s *AzureAksNodePoolSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["cluster_name"] = s.ClusterName
	m["vm_size"] = s.VmSize
	m["initial_node_count"] = s.InitialNodeCount
	if s.Autoscaling != nil {
		m["autoscaling"] = s.Autoscaling.toMap()
	}
	if len(s.AvailabilityZones) > 0 {
		m["availability_zones"] = s.AvailabilityZones
	}
	if s.OsType != "" {
		m["os_type"] = s.OsType
	}
	if s.Mode != "" {
		m["mode"] = s.Mode
	}
	if s.SpotEnabled {
		m["spot_enabled"] = s.SpotEnabled
	}
	m["resource_group"] = s.ResourceGroup
	return m
}

// Autoscaling settings for an AKS node pool. Effective only if autoscaling is enabled.
type AzureAksNodePoolAutoscalingInput struct {
	// Minimum number of nodes for this pool when autoscaler is active. Can be 0 for user node pools to allow scale-to-zero.
	//  For system pools, minimum should be at least 1 (system pools cannot scale to zero).
	MinNodes uint32 `json:"min_nodes,omitempty" jsonschema:"Minimum number of nodes for this pool when autoscaler is active. Can be 0 for user node pools to allow scale-to-zero. For system pools; minimum should be at least 1 (system pools cannot scale to zero)..."`
	// Maximum number of nodes for this pool when autoscaler is active. Must be greater than or equal to min_nodes.
	MaxNodes uint32 `json:"max_nodes,omitempty" jsonschema:"Maximum number of nodes for this pool when autoscaler is active. Must be greater than or equal to min_nodes."`
}

func (s *AzureAksNodePoolAutoscalingInput) validate() error {
	return nil
}

func (s *AzureAksNodePoolAutoscalingInput) applyDefaults() {
}

func (s *AzureAksNodePoolAutoscalingInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.MinNodes != 0 {
		m["min_nodes"] = s.MinNodes
	}
	if s.MaxNodes != 0 {
		m["max_nodes"] = s.MaxNodes
	}
	return m
}

// ParseAzureAksNodePool validates and normalizes a AzureAksNodePool cloud_object.
func ParseAzureAksNodePool(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "azure.openmcf.org/v1", "AzureAksNodePool"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AzureAksNodePoolSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
