// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package scaleway

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// scaleway-block-volume
type ScalewayBlockVolumeSpecInput struct {
	// The Scaleway Availability Zone where the volume will be created.
	//
	//  The volume can only be attached to Instances in the same zone.
	//  Choose a zone that matches your target Instance's zone.
	//
	//  Examples: "fr-par-1", "nl-ams-1", "pl-waw-2"
	//
	//  Cannot be changed after creation (would require recreating the
	//  ...
	Zone string `json:"zone" jsonschema:"required,The Scaleway Availability Zone where the volume will be created. The volume can only be attached to Instances in the same zone. Choose a zone that matches your target Instance's zone. Examples: 'fr-pa..."`
	// Volume size in gigabytes.
	//
	//  Range: 5 GB (minimum) to 10240 GB (10 TB maximum).
	//
	//  Can be increased in-place after creation (hot resize). Cannot be
	//  shrunk -- the Scaleway provider rejects plans that decrease size.
	//
	//  After increasing via IaC, you must also grow the partition and
	//  filesystem inside the...
	SizeGb uint32 `json:"size_gb" jsonschema:"required,Volume size in gigabytes. Range: 5 GB (minimum) to 10240 GB (10 TB maximum). Can be increased in-place after creation (hot resize). Cannot be shrunk -- the Scaleway provider rejects plans that decreas..."`
	// The performance tier determines the volume's IOPS capability.
	//
	//  Scaleway offers two Block Storage tiers built on modern NVMe disks:
	//    - sbs_5k:  5,000 IOPS (combined read + write). Standard tier.
	//    - sbs_15k: 15,000 IOPS (combined read + write). High-performance
	//               tier for databases an...
	PerformanceTier string `json:"performance_tier" jsonschema:"required,enum=sbs_5k|sbs_15k,The performance tier determines the volume's IOPS capability. Scaleway offers two Block Storage tiers built on modern NVMe disks: - sbs_5k: 5;000 IOPS (combined read + write). Standard tier. - sbs_15k..."`
	// Optional ID of a Block Storage snapshot to create this volume from.
	//
	//  When set, the volume is cloned from the snapshot. The snapshot must
	//  be in the same zone as the target volume. The volume size (`size_gb`)
	//  must be >= the snapshot's source volume size.
	//
	//  If omitted, a blank volume is created.
	//
	//  F...
	SnapshotId string `json:"snapshot_id,omitempty" jsonschema:"Optional ID of a Block Storage snapshot to create this volume from. When set; the volume is cloned from the snapshot. The snapshot must be in the same zone as the target volume. The volume size ('size..."`
}

func (s *ScalewayBlockVolumeSpecInput) validate() error {
	if s.Zone == "" {
		return fmt.Errorf("zone is required")
	}
	if s.PerformanceTier == "" {
		return fmt.Errorf("performance_tier is required")
	}
	switch s.PerformanceTier {
	case "sbs_5k", "sbs_15k":
	default:
		return fmt.Errorf("invalid performance_tier: %q", s.PerformanceTier)
	}
	return nil
}

func (s *ScalewayBlockVolumeSpecInput) applyDefaults() {
}

func (s *ScalewayBlockVolumeSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["zone"] = s.Zone
	m["size_gb"] = s.SizeGb
	m["performance_tier"] = s.PerformanceTier
	if s.SnapshotId != "" {
		m["snapshot_id"] = s.SnapshotId
	}
	return m
}

// ParseScalewayBlockVolume validates and normalizes a ScalewayBlockVolume cloud_object.
func ParseScalewayBlockVolume(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "scaleway.openmcf.org/v1", "ScalewayBlockVolume"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec ScalewayBlockVolumeSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
