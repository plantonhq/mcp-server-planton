// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T21:50:49+05:30

package scaleway

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/gen/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// scaleway-object-bucket
type ScalewayObjectBucketSpecInput struct {
	// The Scaleway region where the bucket will be created.
	//
	//  Available regions: "fr-par", "nl-ams", "pl-waw"
	//
	//  Cannot be changed after creation (would require recreating the bucket
	//  and migrating all objects).
	//
	//  Choose the region closest to your application for lowest latency.
	//  Consider data residency re...
	Region string `json:"region" jsonschema:"required,The Scaleway region where the bucket will be created. Available regions: 'fr-par'; 'nl-ams'; 'pl-waw' Cannot be changed after creation (would require recreating the bucket and migrating all objects). ..."`
	// Whether to enable S3-compatible object versioning.
	//
	//  When enabled, every PUT operation creates a new version of the
	//  object. Previous versions are retained and can be retrieved by
	//  version ID. DELETE operations insert a delete marker instead of
	//  removing the object.
	//
	//  IMPORTANT: Once enabled, versio...
	VersioningEnabled bool `json:"versioning_enabled,omitempty" jsonschema:"Whether to enable S3-compatible object versioning. When enabled; every PUT operation creates a new version of the object. Previous versions are retained and can be retrieved by version ID. DELETE oper..."`
	// Whether to enable S3 Object Lock on this bucket.
	//
	//  Object Lock enables WORM (Write Once Read Many) protection. When
	//  enabled, objects can be locked to prevent deletion or modification
	//  for a specified retention period.
	//
	//  IMPORTANT: Object Lock requires versioning to be enabled. This
	//  constraint is e...
	ObjectLockEnabled bool `json:"object_lock_enabled,omitempty" jsonschema:"Whether to enable S3 Object Lock on this bucket. Object Lock enables WORM (Write Once Read Many) protection. When enabled; objects can be locked to prevent deletion or modification for a specified ret..."`
	// Lifecycle rules for automated object management.
	//
	//  Lifecycle rules define actions that Scaleway Object Storage applies
	//  to groups of objects based on prefix, tags, or age. Common uses:
	//
	//    - **Expire old objects**: Delete logs, temp files after N days
	//    - **Transition to cold storage**: Move infreq...
	LifecycleRules []*ScalewayObjectBucketLifecycleRuleInput `json:"lifecycle_rules,omitempty" jsonschema:"Lifecycle rules for automated object management. Lifecycle rules define actions that Scaleway Object Storage applies to groups of objects based on prefix; tags; or age. Common uses: - **Expire old obj..."`
	// Cross-Origin Resource Sharing (CORS) rules for the bucket.
	//
	//  CORS rules control which web origins can make cross-origin requests
	//  to the bucket. This is essential when:
	//    - A web application uploads files directly to the bucket
	//    - Browser-based JavaScript reads objects from the bucket
	//    - A fron...
	CorsRules []*ScalewayObjectBucketCorsRuleInput `json:"cors_rules,omitempty" jsonschema:"Cross-Origin Resource Sharing (CORS) rules for the bucket. CORS rules control which web origins can make cross-origin requests to the bucket. This is essential when: - A web application uploads files ..."`
	// Whether to force-destroy the bucket even if it contains objects.
	//
	//  When true, all objects (including locked objects and all versions)
	//  are deleted before the bucket is destroyed.
	//
	//  WARNING: This is irreversible. All data in the bucket will be
	//  permanently lost.
	//
	//  Recommended settings:
	//    - false for...
	ForceDestroy bool `json:"force_destroy,omitempty" jsonschema:"Whether to force-destroy the bucket even if it contains objects. When true; all objects (including locked objects and all versions) are deleted before the bucket is destroyed. WARNING: This is irrever..."`
}

func (s *ScalewayObjectBucketSpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	for i, v := range s.LifecycleRules {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("lifecycle_rules[%d]: %w", i, err)
			}
		}
	}
	for i, v := range s.CorsRules {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("cors_rules[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayObjectBucketSpecInput) applyDefaults() {
}

func (s *ScalewayObjectBucketSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	if s.VersioningEnabled {
		m["versioning_enabled"] = s.VersioningEnabled
	}
	if s.ObjectLockEnabled {
		m["object_lock_enabled"] = s.ObjectLockEnabled
	}
	if len(s.LifecycleRules) > 0 {
		items := make([]any, len(s.LifecycleRules))
		for i, v := range s.LifecycleRules {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["lifecycle_rules"] = items
	}
	if len(s.CorsRules) > 0 {
		items := make([]any, len(s.CorsRules))
		for i, v := range s.CorsRules {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["cors_rules"] = items
	}
	if s.ForceDestroy {
		m["force_destroy"] = s.ForceDestroy
	}
	return m
}

// ScalewayObjectBucketCorsRule defines a Cross-Origin Resource Sharing
//
//	rule for the bucket.
//
//	CORS rules control which web origins can interact with the bucket's
//	S3 endpoint. Browsers enforce CORS by sending a preflight OPTIONS
//	request before the actual cross-origin request.
type ScalewayObjectBucketCorsRuleInput struct {
	// HTTP methods allowed for cross-origin requests.
	//
	//  Common values: "GET", "PUT", "POST", "DELETE", "HEAD"
	//
	//  For read-only access (e.g., serving images): ["GET", "HEAD"]
	//  For upload access: ["GET", "PUT", "POST", "DELETE", "HEAD"]
	AllowedMethods []string `json:"allowed_methods,omitempty" jsonschema:"HTTP methods allowed for cross-origin requests. Common values: 'GET'; 'PUT'; 'POST'; 'DELETE'; 'HEAD' For read-only access (e.g.; serving images): ['GET'; 'HEAD'] For upload access: ['GET'; 'PUT'; 'PO..."`
	// Origins allowed to make cross-origin requests.
	//
	//  Format: scheme + domain (e.g., "https://example.com").
	//  Use "*" to allow all origins (not recommended for production).
	//
	//  Examples:
	//    - "https://app.example.com" -- Allow specific origin
	//    - "https://*.example.com"   -- Allow subdomains
	//    - "*"     ...
	AllowedOrigins []string `json:"allowed_origins,omitempty" jsonschema:"Origins allowed to make cross-origin requests. Format: scheme + domain (e.g.; 'https://example.com'). Use '*' to allow all origins (not recommended for production). Examples: - 'https://app.example.co..."`
	// Headers that browsers are allowed to include in cross-origin
	//  requests.
	//
	//  Common values: "Content-Type", "Authorization", "x-amz-*"
	//  Use "*" to allow all headers.
	//
	//  Optional. If empty, only simple headers are allowed.
	AllowedHeaders []string `json:"allowed_headers,omitempty" jsonschema:"Headers that browsers are allowed to include in cross-origin requests. Common values: 'Content-Type'; 'Authorization'; 'x-amz-*' Use '*' to allow all headers. Optional. If empty; only simple headers a..."`
	// Headers that browsers are allowed to read from the response.
	//
	//  By default, browsers can only read "simple" response headers.
	//  List headers here that your application needs to access.
	//
	//  Common values: "ETag", "x-amz-request-id"
	//
	//  Optional.
	ExposeHeaders []string `json:"expose_headers,omitempty" jsonschema:"Headers that browsers are allowed to read from the response. By default; browsers can only read 'simple' response headers. List headers here that your application needs to access. Common values: 'ETag..."`
	// Maximum time (in seconds) that the browser should cache the
	//  preflight response.
	//
	//  Higher values reduce the number of preflight OPTIONS requests
	//  at the cost of slower propagation of CORS policy changes.
	//
	//  Common value: 3600 (1 hour).
	//  0 = browser uses its own default (usually 5 seconds).
	MaxAgeSeconds int32 `json:"max_age_seconds,omitempty" jsonschema:"Maximum time (in seconds) that the browser should cache the preflight response. Higher values reduce the number of preflight OPTIONS requests at the cost of slower propagation of CORS policy changes. ..."`
}

func (s *ScalewayObjectBucketCorsRuleInput) validate() error {
	if len(s.AllowedMethods) < 1 {
		return fmt.Errorf("allowed_methods requires at least 1 items, got %d", len(s.AllowedMethods))
	}
	if len(s.AllowedOrigins) < 1 {
		return fmt.Errorf("allowed_origins requires at least 1 items, got %d", len(s.AllowedOrigins))
	}
	return nil
}

func (s *ScalewayObjectBucketCorsRuleInput) applyDefaults() {
}

func (s *ScalewayObjectBucketCorsRuleInput) toMap() map[string]any {
	m := make(map[string]any)
	if len(s.AllowedMethods) > 0 {
		m["allowed_methods"] = s.AllowedMethods
	}
	if len(s.AllowedOrigins) > 0 {
		m["allowed_origins"] = s.AllowedOrigins
	}
	if len(s.AllowedHeaders) > 0 {
		m["allowed_headers"] = s.AllowedHeaders
	}
	if len(s.ExposeHeaders) > 0 {
		m["expose_headers"] = s.ExposeHeaders
	}
	if s.MaxAgeSeconds != 0 {
		m["max_age_seconds"] = s.MaxAgeSeconds
	}
	return m
}

// ScalewayObjectBucketLifecycleRule defines a single lifecycle automation
//
//	rule for objects in the bucket.
//
//	Each rule identifies a group of objects by prefix and/or tags, and
//	defines one or more actions: expiration, storage class transition,
//	noncurrent version expiration, or multipart upload abort.
//
//	Rules are evaluated by Scaleway daily and take effect within 24 hours
//	of creation or modification.
type ScalewayObjectBucketLifecycleRuleInput struct {
	// Unique identifier for this rule.
	//
	//  Used for identification in Terraform state and in Scaleway's
	//  lifecycle management API. Must be unique within the bucket.
	Id string `json:"id,omitempty" jsonschema:"Unique identifier for this rule. Used for identification in Terraform state and in Scaleway's lifecycle management API. Must be unique within the bucket."`
	// Whether this rule is currently active.
	//
	//  Disabled rules are retained in configuration but not evaluated.
	//  Useful for temporarily suspending a rule without deleting it.
	Enabled bool `json:"enabled,omitempty" jsonschema:"Whether this rule is currently active. Disabled rules are retained in configuration but not evaluated. Useful for temporarily suspending a rule without deleting it."`
	// Object key prefix filter.
	//
	//  When set, the rule applies only to objects whose key starts with
	//  this prefix. For example, "logs/" applies to all objects in the
	//  logs directory.
	//
	//  Empty string or omitted = rule applies to all objects in the
	//  bucket (subject to tag filter if present).
	Prefix string `json:"prefix,omitempty" jsonschema:"Object key prefix filter. When set; the rule applies only to objects whose key starts with this prefix. For example; 'logs/' applies to all objects in the logs directory. Empty string or omitted = rul..."`
	// Tag-based filter for objects.
	//
	//  When set, the rule applies only to objects that have ALL of these
	//  tags. Combined with prefix for more specific targeting.
	//
	//  Example: {"environment": "staging"} applies only to objects tagged
	//  with environment=staging.
	Tags map[string]string `json:"tags,omitempty" jsonschema:"Tag-based filter for objects. When set; the rule applies only to objects that have ALL of these tags. Combined with prefix for more specific targeting. Example: {'environment': 'staging'} applies only..."`
	// Number of days after object creation to expire (delete) the object.
	//
	//  When an object reaches this age, it is automatically deleted.
	//  For versioned buckets, a delete marker is inserted.
	//
	//  0 = no expiration (default).
	ExpirationDays int32 `json:"expiration_days,omitempty" jsonschema:"Number of days after object creation to expire (delete) the object. When an object reaches this age; it is automatically deleted. For versioned buckets; a delete marker is inserted. 0 = no expiration ..."`
	// Storage class transitions.
	//
	//  Move objects to cheaper storage classes after a specified number
	//  of days. Multiple transitions can be defined to create a tiered
	//  storage lifecycle (e.g., Standard -> ONEZONE_IA -> GLACIER).
	//
	//  Available storage classes:
	//    - "GLACIER" -- Cold storage for archival data (...
	Transitions []*ScalewayObjectBucketLifecycleTransitionInput `json:"transitions,omitempty" jsonschema:"Storage class transitions. Move objects to cheaper storage classes after a specified number of days. Multiple transitions can be defined to create a tiered storage lifecycle (e.g.; Standard -> ONEZONE..."`
	// Number of days to abort incomplete multipart uploads.
	//
	//  Multipart uploads that are not completed within this period are
	//  automatically aborted and their parts are deleted.
	//
	//  Recommended: 7 days. Incomplete multipart uploads accumulate
	//  storage costs silently.
	//
	//  0 = incomplete uploads are never abort...
	AbortIncompleteMultipartUploadDays int32 `json:"abort_incomplete_multipart_upload_days,omitempty" jsonschema:"Number of days to abort incomplete multipart uploads. Multipart uploads that are not completed within this period are automatically aborted and their parts are deleted. Recommended: 7 days. Incomplete..."`
}

func (s *ScalewayObjectBucketLifecycleRuleInput) validate() error {
	for i, v := range s.Transitions {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("transitions[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayObjectBucketLifecycleRuleInput) applyDefaults() {
}

func (s *ScalewayObjectBucketLifecycleRuleInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Id != "" {
		m["id"] = s.Id
	}
	if s.Enabled {
		m["enabled"] = s.Enabled
	}
	if s.Prefix != "" {
		m["prefix"] = s.Prefix
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if s.ExpirationDays != 0 {
		m["expiration_days"] = s.ExpirationDays
	}
	if len(s.Transitions) > 0 {
		items := make([]any, len(s.Transitions))
		for i, v := range s.Transitions {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["transitions"] = items
	}
	if s.AbortIncompleteMultipartUploadDays != 0 {
		m["abort_incomplete_multipart_upload_days"] = s.AbortIncompleteMultipartUploadDays
	}
	return m
}

// ScalewayObjectBucketLifecycleTransition defines a storage class
//
//	transition within a lifecycle rule.
//
//	Objects matching the parent rule's filter are moved to the specified
//	storage class after the given number of days.
type ScalewayObjectBucketLifecycleTransitionInput struct {
	// Number of days after object creation to transition.
	//
	//  Must be a positive integer. When defining multiple transitions in
	//  a rule, each transition's days must be greater than the previous.
	Days int32 `json:"days,omitempty" jsonschema:"Number of days after object creation to transition. Must be a positive integer. When defining multiple transitions in a rule; each transition's days must be greater than the previous."`
	// Target storage class.
	//
	//  Supported values:
	//    - "GLACIER" -- Cold storage for archival (cheapest, slow retrieval)
	//    - "ONEZONE_IA" -- Infrequent Access (cheaper, single-zone redundancy)
	StorageClass string `json:"storage_class" jsonschema:"required,Target storage class. Supported values: - 'GLACIER' -- Cold storage for archival (cheapest; slow retrieval) - 'ONEZONE_IA' -- Infrequent Access (cheaper; single-zone redundancy)"`
}

func (s *ScalewayObjectBucketLifecycleTransitionInput) validate() error {
	if s.StorageClass == "" {
		return fmt.Errorf("storage_class is required")
	}
	return nil
}

func (s *ScalewayObjectBucketLifecycleTransitionInput) applyDefaults() {
}

func (s *ScalewayObjectBucketLifecycleTransitionInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Days != 0 {
		m["days"] = s.Days
	}
	m["storage_class"] = s.StorageClass
	return m
}

// ParseScalewayObjectBucket validates and normalizes a ScalewayObjectBucket cloud_object.
func ParseScalewayObjectBucket(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "scaleway.openmcf.org/v1", "ScalewayObjectBucket"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec ScalewayObjectBucketSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
