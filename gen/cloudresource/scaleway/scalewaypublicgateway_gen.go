// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package scaleway

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// scaleway-public-gateway
type ScalewayPublicGatewaySpecInput struct {
	// The Private Network to attach this gateway to.
	//
	//  The gateway provides NAT, SSH bastion, and port forwarding for resources
	//  in this network. Can be a literal Private Network UUID or a reference to
	//  a ScalewayPrivateNetwork resource's output.
	//
	//  In infra charts, this is typically wired via valueFrom:
	//
	// ...
	PrivateNetworkId string `json:"private_network_id" jsonschema:"required,The Private Network to attach this gateway to. The gateway provides NAT; SSH bastion; and port forwarding for resources in this network. Can be a literal Private Network UUID or a reference to a Scale..."`
	// The Scaleway zone where the gateway will be created.
	//  Examples: "fr-par-1", "nl-ams-1", "pl-waw-1"
	//
	//  Public Gateways are zonal resources (unlike VPCs and Private Networks
	//  which are regional). The zone must be within the same region as the
	//  target Private Network. For example, if the Private Network...
	Zone string `json:"zone" jsonschema:"required,The Scaleway zone where the gateway will be created. Examples: 'fr-par-1'; 'nl-ams-1'; 'pl-waw-1' Public Gateways are zonal resources (unlike VPCs and Private Networks which are regional). The zone mu..."`
	// Gateway type determines bandwidth and performance tier.
	//
	//  Available types:
	//    - "VPC-GW-S"  -- Standard gateway. Sufficient for most workloads.
	//    - "VPC-GW-XL" -- High-bandwidth gateway (up to 10 Gbps). Available
	//                      only in Paris region zones (fr-par-1, fr-par-2, etc.).
	//
	//  Choose "...
	Type string `json:"type" jsonschema:"required,Gateway type determines bandwidth and performance tier. Available types: - 'VPC-GW-S' -- Standard gateway. Sufficient for most workloads. - 'VPC-GW-XL' -- High-bandwidth gateway (up to 10 Gbps). Avail..."`
	// Whether to enable NAT masquerade on the Private Network attachment.
	//
	//  When enabled, resources in the attached Private Network can reach the
	//  internet through the gateway's public IP. This is the primary use case
	//  for a Public Gateway and is almost always enabled.
	//
	//  Disable only if using the gateway ...
	EnableMasquerade bool `json:"enable_masquerade,omitempty" jsonschema:"Whether to enable NAT masquerade on the Private Network attachment. When enabled; resources in the attached Private Network can reach the internet through the gateway's public IP. This is the primary ..."`
	// SSH bastion configuration.
	//
	//  When enabled, the gateway acts as a jump host for SSH connections to
	//  resources in the Private Network. Users SSH to the gateway's public IP,
	//  and the gateway proxies the connection to the target private IP.
	//
	//  Optional. If omitted, the SSH bastion is disabled.
	Bastion *ScalewayPublicGatewayBastionInput `json:"bastion,omitempty" jsonschema:"SSH bastion configuration. When enabled; the gateway acts as a jump host for SSH connections to resources in the Private Network. Users SSH to the gateway's public IP; and the gateway proxies the conn..."`
	// Whether to enable outbound SMTP through the gateway.
	//
	//  By default, outbound SMTP (port 25) is blocked to prevent spam abuse.
	//  Enable only if resources in the Private Network need to send email
	//  directly (e.g., an email relay or notification service).
	//
	//  Default: false
	EnableSmtp bool `json:"enable_smtp,omitempty" jsonschema:"Whether to enable outbound SMTP through the gateway. By default; outbound SMTP (port 25) is blocked to prevent spam abuse. Enable only if resources in the Private Network need to send email directly (..."`
	// Reverse DNS hostname for the gateway's public IP.
	//  Example: "gateway.example.com"
	//
	//  A matching DNS A record pointing to the public IP must already exist
	//  before setting this field. Useful for email servers (SPF/DKIM compliance),
	//  compliance requirements, and professional appearance in network logs.
	// ...
	ReverseDns string `json:"reverse_dns,omitempty" jsonschema:"Reverse DNS hostname for the gateway's public IP. Example: 'gateway.example.com' A matching DNS A record pointing to the public IP must already exist before setting this field. Useful for email server..."`
	// Port forwarding (PAT) rules.
	//
	//  Each rule maps a public port on the gateway's IP to a private IP and
	//  port inside the attached Private Network. This enables inbound access
	//  to specific services without giving them public IPs.
	//
	//  Example: Forward public port 8080 to a web server at 10.0.1.5:80.
	//
	//  Optio...
	PatRules []*ScalewayPublicGatewayPatRuleInput `json:"pat_rules,omitempty" jsonschema:"Port forwarding (PAT) rules. Each rule maps a public port on the gateway's IP to a private IP and port inside the attached Private Network. This enables inbound access to specific services without giv..."`
}

func (s *ScalewayPublicGatewaySpecInput) validate() error {
	if s.PrivateNetworkId == "" {
		return fmt.Errorf("private_network_id is required")
	}
	if s.Zone == "" {
		return fmt.Errorf("zone is required")
	}
	if s.Type == "" {
		return fmt.Errorf("type is required")
	}
	if s.Bastion != nil {
		if err := s.Bastion.validate(); err != nil {
			return fmt.Errorf("bastion: %w", err)
		}
	}
	for i, v := range s.PatRules {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("pat_rules[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayPublicGatewaySpecInput) applyDefaults() {
	if s.Bastion != nil {
		s.Bastion.applyDefaults()
	}
}

func (s *ScalewayPublicGatewaySpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["private_network_id"] = s.PrivateNetworkId
	m["zone"] = s.Zone
	m["type"] = s.Type
	if s.EnableMasquerade {
		m["enable_masquerade"] = s.EnableMasquerade
	}
	if s.Bastion != nil {
		m["bastion"] = s.Bastion.toMap()
	}
	if s.EnableSmtp {
		m["enable_smtp"] = s.EnableSmtp
	}
	if s.ReverseDns != "" {
		m["reverse_dns"] = s.ReverseDns
	}
	if len(s.PatRules) > 0 {
		items := make([]any, len(s.PatRules))
		for i, v := range s.PatRules {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["pat_rules"] = items
	}
	return m
}

// ScalewayPublicGatewayBastion configures the SSH bastion feature.
//
//	The bastion provides a secure, auditable entry point for SSH connections
//	to resources in the Private Network. Instead of assigning public IPs to
//	individual instances, users SSH to the gateway and the gateway proxies
//	the connection.
type ScalewayPublicGatewayBastionInput struct {
	// Whether to enable SSH bastion.
	//
	//  When true, the gateway listens for SSH connections and proxies them
	//  to resources in the attached Private Network.
	Enabled bool `json:"enabled,omitempty" jsonschema:"Whether to enable SSH bastion. When true; the gateway listens for SSH connections and proxies them to resources in the attached Private Network."`
	// Port for the SSH bastion to listen on.
	//
	//  Default: 22. Change only if port 22 is blocked by corporate firewalls
	//  or if you need a non-standard port for security-through-obscurity.
	Port int32 `json:"port,omitempty" jsonschema:"Port for the SSH bastion to listen on. Default: 22. Change only if port 22 is blocked by corporate firewalls or if you need a non-standard port for security-through-obscurity."`
	// CIDR ranges allowed to connect to the bastion.
	//  Examples: ["203.0.113.0/24", "198.51.100.10/32"]
	//
	//  Restricts SSH bastion access to specific source IP ranges. If empty,
	//  all IP ranges are allowed -- not recommended for production.
	//
	//  Best practice: Restrict to your office IP range, VPN exit IPs, or
	//  C...
	AllowedIpRanges []string `json:"allowed_ip_ranges,omitempty" jsonschema:"CIDR ranges allowed to connect to the bastion. Examples: ['203.0.113.0/24'; '198.51.100.10/32'] Restricts SSH bastion access to specific source IP ranges. If empty; all IP ranges are allowed -- not re..."`
}

func (s *ScalewayPublicGatewayBastionInput) validate() error {
	return nil
}

func (s *ScalewayPublicGatewayBastionInput) applyDefaults() {
}

func (s *ScalewayPublicGatewayBastionInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Enabled {
		m["enabled"] = s.Enabled
	}
	if s.Port != 0 {
		m["port"] = s.Port
	}
	if len(s.AllowedIpRanges) > 0 {
		m["allowed_ip_ranges"] = s.AllowedIpRanges
	}
	return m
}

// ScalewayPublicGatewayPatRule defines a port forwarding rule.
//
//	PAT (Port Address Translation) maps a public port on the gateway's IP
//	to a private IP and port inside the attached Private Network. This
//	enables inbound traffic to reach specific services without assigning
//	public IPs to individual resources.
type ScalewayPublicGatewayPatRuleInput struct {
	// Private IP address to forward traffic to.
	//
	//  Must be an IP address within the attached Private Network's subnet.
	//  Example: "10.0.1.5"
	PrivateIp string `json:"private_ip" jsonschema:"required,Private IP address to forward traffic to. Must be an IP address within the attached Private Network's subnet. Example: '10.0.1.5'"`
	// Private port to forward traffic to.
	//  Example: 80 (for a web server), 5432 (for PostgreSQL)
	PrivatePort int32 `json:"private_port" jsonschema:"required,Private port to forward traffic to. Example: 80 (for a web server); 5432 (for PostgreSQL)"`
	// Public port to listen on the gateway's public IP.
	//
	//  External traffic hitting this port on the gateway's public IP will
	//  be forwarded to private_ip:private_port.
	//  Example: 8080
	PublicPort int32 `json:"public_port" jsonschema:"required,Public port to listen on the gateway's public IP. External traffic hitting this port on the gateway's public IP will be forwarded to private_ip:private_port. Example: 8080"`
	// Protocol for the rule: "tcp", "udp", or "both".
	//
	//  Default: "both" (forwards both TCP and UDP traffic).
	//  Use "tcp" for web servers, SSH, databases. Use "udp" for DNS, game
	//  servers, media streaming. Use "both" when unsure.
	Protocol string `json:"protocol,omitempty" jsonschema:"Protocol for the rule: 'tcp'; 'udp'; or 'both'. Default: 'both' (forwards both TCP and UDP traffic). Use 'tcp' for web servers; SSH; databases. Use 'udp' for DNS; game servers; media streaming. Use 'b..."`
}

func (s *ScalewayPublicGatewayPatRuleInput) validate() error {
	if s.PrivateIp == "" {
		return fmt.Errorf("private_ip is required")
	}
	return nil
}

func (s *ScalewayPublicGatewayPatRuleInput) applyDefaults() {
}

func (s *ScalewayPublicGatewayPatRuleInput) toMap() map[string]any {
	m := make(map[string]any)
	m["private_ip"] = s.PrivateIp
	m["private_port"] = s.PrivatePort
	m["public_port"] = s.PublicPort
	if s.Protocol != "" {
		m["protocol"] = s.Protocol
	}
	return m
}

// ParseScalewayPublicGateway validates and normalizes a ScalewayPublicGateway cloud_object.
func ParseScalewayPublicGateway(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "scaleway.openmcf.org/v1", "ScalewayPublicGateway"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec ScalewayPublicGatewaySpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
