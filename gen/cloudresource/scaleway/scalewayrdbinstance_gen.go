// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package scaleway

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// scaleway-rdb-instance
type ScalewayRdbInstanceSpecInput struct {
	// The Scaleway region where the instance will be created.
	//  Examples: "fr-par", "nl-ams", "pl-waw"
	//
	//  Determines which availability zones are used for HA replicas.
	//
	//  This field is required and cannot be changed after creation.
	Region string `json:"region" jsonschema:"required,The Scaleway region where the instance will be created. Examples: 'fr-par'; 'nl-ams'; 'pl-waw' Determines which availability zones are used for HA replicas. This field is required and cannot be change..."`
	// Database engine and major version.
	//
	//  Format: "{Engine}-{MajorVersion}" (case-sensitive).
	//  Examples:
	//    - "PostgreSQL-16" -- PostgreSQL version 16
	//    - "PostgreSQL-15" -- PostgreSQL version 15
	//    - "MySQL-8"       -- MySQL version 8
	//
	//  The engine determines which SQL dialect, extensions, and features
	// ...
	Engine string `json:"engine" jsonschema:"required,Database engine and major version. Format: '{Engine}-{MajorVersion}' (case-sensitive). Examples: - 'PostgreSQL-16' -- PostgreSQL version 16 - 'PostgreSQL-15' -- PostgreSQL version 15 - 'MySQL-8' -- My..."`
	// Node type determining CPU, RAM, and baseline performance.
	//
	//  Development types:
	//    - "DB-DEV-S"  -- 2 vCPU, 2 GB RAM. Cheapest, for development only.
	//    - "DB-DEV-M"  -- 4 vCPU, 4 GB RAM.
	//
	//  General-purpose types:
	//    - "db-gp-xs"  -- 4 vCPU, 16 GB RAM. Entry production.
	//    - "db-gp-s"   -- 8 vCPU, 32 ...
	NodeType string `json:"node_type" jsonschema:"required,Node type determining CPU; RAM; and baseline performance. Development types: - 'DB-DEV-S' -- 2 vCPU; 2 GB RAM. Cheapest; for development only. - 'DB-DEV-M' -- 4 vCPU; 4 GB RAM. General-purpose types: ..."`
	// The Private Network to attach the instance to.
	//
	//  When set, the instance receives a private endpoint reachable only
	//  from resources on the same Private Network. This is the recommended
	//  topology for production: applications connect via private IPs,
	//  and the public endpoint can be locked down with ACL...
	PrivateNetworkId string `json:"private_network_id,omitempty" jsonschema:"The Private Network to attach the instance to. When set; the instance receives a private endpoint reachable only from resources on the same Private Network. This is the recommended topology for produc..."`
	// Whether to deploy a multi-node HA cluster with automatic failover.
	//
	//  When true, Scaleway provisions a standby replica that automatically
	//  takes over if the primary fails. Provides zero-downtime failover
	//  but doubles the cost.
	//
	//  Recommended for production workloads. For dev/test, leave false.
	//
	//  Defau...
	IsHaCluster bool `json:"is_ha_cluster,omitempty" jsonschema:"Whether to deploy a multi-node HA cluster with automatic failover. When true; Scaleway provisions a standby replica that automatically takes over if the primary fails. Provides zero-downtime failover ..."`
	// Volume type for database storage.
	//
	//  Options:
	//    - "lssd" (default) -- Local SSD. Lowest latency, highest IOPS.
	//      Limited by the node type's local disk capacity.
	//    - "bssd" -- Block SSD (5K IOPS). Scalable beyond local disk.
	//      Good balance of performance and flexibility.
	//    - "sbs_15k" -- Bloc...
	VolumeType string `json:"volume_type,omitempty" jsonschema:"Volume type for database storage. Options: - 'lssd' (default) -- Local SSD. Lowest latency; highest IOPS. Limited by the node type's local disk capacity. - 'bssd' -- Block SSD (5K IOPS). Scalable beyo..."`
	// Volume size in GB.
	//
	//  If 0 or omitted, uses the default size for the node type. The size
	//  determines how much data the database can store.
	//
	//  Can only be increased after creation, never decreased. Plan ahead
	//  for data growth.
	VolumeSizeInGb uint32 `json:"volume_size_in_gb,omitempty" jsonschema:"Volume size in GB. If 0 or omitted; uses the default size for the node type. The size determines how much data the database can store. Can only be increased after creation; never decreased. Plan ahead..."`
	// Whether to disable automated backups.
	//
	//  Default: false (backups enabled). Set to true for dev/test
	//  instances where backup cost is unnecessary.
	//
	//  When backups are enabled, Scaleway takes automated snapshots at
	//  the configured frequency and retains them for the configured period.
	DisableBackup bool `json:"disable_backup,omitempty" jsonschema:"Whether to disable automated backups. Default: false (backups enabled). Set to true for dev/test instances where backup cost is unnecessary. When backups are enabled; Scaleway takes automated snapshot..."`
	// Hours between automated backups.
	//
	//  Range: 1 to 24. If 0 or omitted, uses Scaleway's default (24 hours).
	//  Lower values provide finer recovery point objectives (RPO) but
	//  increase storage cost.
	BackupScheduleFrequencyHours uint32 `json:"backup_schedule_frequency_hours,omitempty" jsonschema:"Hours between automated backups. Range: 1 to 24. If 0 or omitted; uses Scaleway's default (24 hours). Lower values provide finer recovery point objectives (RPO) but increase storage cost."`
	// Days to retain automated backups.
	//
	//  Range: 1 to 365. If 0 or omitted, uses Scaleway's default (7 days).
	//  Longer retention provides more recovery options but increases
	//  storage cost.
	BackupScheduleRetentionDays uint32 `json:"backup_schedule_retention_days,omitempty" jsonschema:"Days to retain automated backups. Range: 1 to 365. If 0 or omitted; uses Scaleway's default (7 days). Longer retention provides more recovery options but increases storage cost."`
	// Whether to enable encryption at rest for the database storage.
	//
	//  When true, all data written to disk is encrypted. Provides
	//  defense-in-depth for compliance-sensitive workloads. Minimal
	//  performance impact on modern hardware.
	EncryptionAtRest bool `json:"encryption_at_rest,omitempty" jsonschema:"Whether to enable encryption at rest for the database storage. When true; all data written to disk is encrypted. Provides defense-in-depth for compliance-sensitive workloads. Minimal performance impac..."`
	// Network access control rules.
	//
	//  Each rule allows a CIDR range to connect to the database's public
	//  endpoint. Rules replace the instance's entire ACL (Scaleway's ACL
	//  is a single resource per instance that replaces all rules atomically).
	//
	//  If empty, no ACL resource is created and Scaleway's default a...
	AclRules []*ScalewayRdbAclRuleInput `json:"acl_rules,omitempty" jsonschema:"Network access control rules. Each rule allows a CIDR range to connect to the database's public endpoint. Rules replace the instance's entire ACL (Scaleway's ACL is a single resource per instance that..."`
	// Username for the initial admin user created with the instance.
	//
	//  This user has full administrative privileges on the database engine
	//  (superuser-like). It is created as part of the instance provisioning
	//  and cannot be removed through this resource.
	//
	//  Must be different from any user in the `users` li...
	AdminUser string `json:"admin_user" jsonschema:"required,Username for the initial admin user created with the instance. This user has full administrative privileges on the database engine (superuser-like). It is created as part of the instance provisioning ..."`
	// Password for the initial admin user.
	//
	//  Must meet minimum complexity requirements. For production, use a
	//  strong, randomly generated password and manage it through your
	//  organization's secrets workflow.
	AdminPassword string `json:"admin_password" jsonschema:"required,Password for the initial admin user. Must meet minimum complexity requirements. For production; use a strong; randomly generated password and manage it through your organization's secrets workflow."`
	// Logical databases to create on the instance.
	//
	//  Each entry creates a `scaleway_rdb_database` resource. Databases
	//  are where application data is stored. Users connect to a specific
	//  database and are granted privileges on it.
	//
	//  Optional. If empty, only the engine's default database exists
	//  (e.g., "post...
	Databases []*ScalewayRdbDatabaseInput `json:"databases,omitempty" jsonschema:"Logical databases to create on the instance. Each entry creates a 'scaleway_rdb_database' resource. Databases are where application data is stored. Users connect to a specific database and are granted..."`
	// Additional database users to create on the instance.
	//
	//  Each entry creates a `scaleway_rdb_user` resource. Each user's
	//  privileges (if specified) create `scaleway_rdb_privilege` resources
	//  linking the user to specific databases with specific permission
	//  levels.
	//
	//  The admin user (specified above) alwa...
	Users []*ScalewayRdbUserInput `json:"users,omitempty" jsonschema:"Additional database users to create on the instance. Each entry creates a 'scaleway_rdb_user' resource. Each user's privileges (if specified) create 'scaleway_rdb_privilege' resources linking the user..."`
	// Engine-specific runtime settings.
	//
	//  Key-value pairs passed to the database engine's configuration.
	//  Applied on both creation and updates. Keys are engine-specific.
	//
	//  PostgreSQL examples:
	//    - "work_mem" = "64MB"
	//    - "max_connections" = "200"
	//    - "effective_cache_size" = "4GB"
	//
	//  MySQL examples:
	//    ...
	Settings map[string]string `json:"settings,omitempty" jsonschema:"Engine-specific runtime settings. Key-value pairs passed to the database engine's configuration. Applied on both creation and updates. Keys are engine-specific. PostgreSQL examples: - 'work_mem' = '64..."`
	// Engine-specific init settings applied only during instance creation.
	//
	//  These settings cannot be changed after the instance is created.
	//  Use for configuration that must be set at init time.
	//
	//  MySQL example:
	//    - "lower_case_table_names" = "1"
	//
	//  Optional. Most users don't need init settings.
	InitSettings map[string]string `json:"init_settings,omitempty" jsonschema:"Engine-specific init settings applied only during instance creation. These settings cannot be changed after the instance is created. Use for configuration that must be set at init time. MySQL example:..."`
}

func (s *ScalewayRdbInstanceSpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	if s.Engine == "" {
		return fmt.Errorf("engine is required")
	}
	if s.NodeType == "" {
		return fmt.Errorf("node_type is required")
	}
	for i, v := range s.AclRules {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("acl_rules[%d]: %w", i, err)
			}
		}
	}
	if s.AdminUser == "" {
		return fmt.Errorf("admin_user is required")
	}
	if s.AdminPassword == "" {
		return fmt.Errorf("admin_password is required")
	}
	for i, v := range s.Databases {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("databases[%d]: %w", i, err)
			}
		}
	}
	for i, v := range s.Users {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("users[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayRdbInstanceSpecInput) applyDefaults() {
}

func (s *ScalewayRdbInstanceSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	m["engine"] = s.Engine
	m["node_type"] = s.NodeType
	if s.PrivateNetworkId != "" {
		m["private_network_id"] = s.PrivateNetworkId
	}
	if s.IsHaCluster {
		m["is_ha_cluster"] = s.IsHaCluster
	}
	if s.VolumeType != "" {
		m["volume_type"] = s.VolumeType
	}
	if s.VolumeSizeInGb != 0 {
		m["volume_size_in_gb"] = s.VolumeSizeInGb
	}
	if s.DisableBackup {
		m["disable_backup"] = s.DisableBackup
	}
	if s.BackupScheduleFrequencyHours != 0 {
		m["backup_schedule_frequency_hours"] = s.BackupScheduleFrequencyHours
	}
	if s.BackupScheduleRetentionDays != 0 {
		m["backup_schedule_retention_days"] = s.BackupScheduleRetentionDays
	}
	if s.EncryptionAtRest {
		m["encryption_at_rest"] = s.EncryptionAtRest
	}
	if len(s.AclRules) > 0 {
		items := make([]any, len(s.AclRules))
		for i, v := range s.AclRules {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["acl_rules"] = items
	}
	m["admin_user"] = s.AdminUser
	m["admin_password"] = s.AdminPassword
	if len(s.Databases) > 0 {
		items := make([]any, len(s.Databases))
		for i, v := range s.Databases {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["databases"] = items
	}
	if len(s.Users) > 0 {
		items := make([]any, len(s.Users))
		for i, v := range s.Users {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["users"] = items
	}
	if len(s.Settings) > 0 {
		m["settings"] = s.Settings
	}
	if len(s.InitSettings) > 0 {
		m["init_settings"] = s.InitSettings
	}
	return m
}

// ScalewayRdbAclRule defines a network access control rule for the
//
//	RDB instance's public endpoint.
//
//	Each rule allows connections from a specific CIDR range. The complete
//	set of rules defines who can reach the database over the public internet.
type ScalewayRdbAclRuleInput struct {
	// CIDR range to allow.
	//
	//  Examples:
	//    - "10.0.0.0/24" -- Allow a /24 subnet
	//    - "1.2.3.4/32"  -- Allow a single IP
	//    - "0.0.0.0/0"   -- Allow all IPs (NOT recommended for production)
	Ip string `json:"ip" jsonschema:"required,CIDR range to allow. Examples: - '10.0.0.0/24' -- Allow a /24 subnet - '1.2.3.4/32' -- Allow a single IP - '0.0.0.0/0' -- Allow all IPs (NOT recommended for production)"`
	// Human-readable description for this rule.
	//
	//  Helps operators understand the purpose of each ACL entry.
	//  Examples: "Office IP", "VPN egress", "CI/CD pipeline"
	Description string `json:"description,omitempty" jsonschema:"Human-readable description for this rule. Helps operators understand the purpose of each ACL entry. Examples: 'Office IP'; 'VPN egress'; 'CI/CD pipeline'"`
}

func (s *ScalewayRdbAclRuleInput) validate() error {
	if s.Ip == "" {
		return fmt.Errorf("ip is required")
	}
	return nil
}

func (s *ScalewayRdbAclRuleInput) applyDefaults() {
}

func (s *ScalewayRdbAclRuleInput) toMap() map[string]any {
	m := make(map[string]any)
	m["ip"] = s.Ip
	if s.Description != "" {
		m["description"] = s.Description
	}
	return m
}

// ScalewayRdbDatabase defines a logical database to create on the
//
//	RDB instance.
//
//	Each database is a separate namespace for tables, indexes, and data.
//	Applications typically connect to a specific database and are granted
//	privileges on it via the user's privileges field.
type ScalewayRdbDatabaseInput struct {
	// Database name.
	//
	//  Must be 1-63 characters, consisting of alphanumeric characters,
	//  underscores, or dashes. Must start with a letter.
	//
	//  Reserved names are rejected by Scaleway: postgres, mysql, sys,
	//  information_schema, performance_schema, rdb, template0, template1.
	Name string `json:"name" jsonschema:"required,Database name. Must be 1-63 characters; consisting of alphanumeric characters; underscores; or dashes. Must start with a letter. Reserved names are rejected by Scaleway: postgres; mysql; sys; informat..."`
}

func (s *ScalewayRdbDatabaseInput) validate() error {
	if s.Name == "" {
		return fmt.Errorf("name is required")
	}
	return nil
}

func (s *ScalewayRdbDatabaseInput) applyDefaults() {
}

func (s *ScalewayRdbDatabaseInput) toMap() map[string]any {
	m := make(map[string]any)
	m["name"] = s.Name
	return m
}

// ScalewayRdbUser defines an additional database user.
//
//	Users are authentication principals that connect to the database.
//	Each user has a name and password and can optionally be granted
//	specific permissions on specific databases via the privileges field.
//
//	The initial admin user (defined in the spec's admin_user field) is
//	separate and always has full access. Users defined here are typically
//	application-level accounts with restricted permissions.
type ScalewayRdbUserInput struct {
	// Username.
	//
	//  Must be unique within the instance and different from the admin_user
	//  specified in the spec. 1-63 characters.
	Name string `json:"name" jsonschema:"required,Username. Must be unique within the instance and different from the admin_user specified in the spec. 1-63 characters."`
	// Password for this user.
	//
	//  Must meet minimum complexity requirements. For production, use a
	//  strong, randomly generated password.
	Password string `json:"password" jsonschema:"required,Password for this user. Must meet minimum complexity requirements. For production; use a strong; randomly generated password."`
	// Whether this user has admin privileges on the database engine.
	//
	//  Admin users have superuser-like access to all databases. Use
	//  sparingly -- most application users should be non-admin with
	//  specific per-database privileges.
	//
	//  Default: false.
	IsAdmin bool `json:"is_admin,omitempty" jsonschema:"Whether this user has admin privileges on the database engine. Admin users have superuser-like access to all databases. Use sparingly -- most application users should be non-admin with specific per-da..."`
	// Per-database permission grants for this user.
	//
	//  Each entry creates a `scaleway_rdb_privilege` resource linking
	//  this user to a specific database with a specific permission level.
	//
	//  If empty, the user exists but has no database access until
	//  privileges are granted (via this field or manually).
	//
	//  The ...
	Privileges []*ScalewayRdbUserPrivilegeInput `json:"privileges,omitempty" jsonschema:"Per-database permission grants for this user. Each entry creates a 'scaleway_rdb_privilege' resource linking this user to a specific database with a specific permission level. If empty; the user exist..."`
}

func (s *ScalewayRdbUserInput) validate() error {
	if s.Name == "" {
		return fmt.Errorf("name is required")
	}
	if s.Password == "" {
		return fmt.Errorf("password is required")
	}
	for i, v := range s.Privileges {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("privileges[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayRdbUserInput) applyDefaults() {
}

func (s *ScalewayRdbUserInput) toMap() map[string]any {
	m := make(map[string]any)
	m["name"] = s.Name
	m["password"] = s.Password
	if s.IsAdmin {
		m["is_admin"] = s.IsAdmin
	}
	if len(s.Privileges) > 0 {
		items := make([]any, len(s.Privileges))
		for i, v := range s.Privileges {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["privileges"] = items
	}
	return m
}

// ScalewayRdbUserPrivilege grants a user a specific permission level
//
//	on a specific database.
//
//	This maps directly to a `scaleway_rdb_privilege` Terraform resource
//	(or `databases.Privilege` in Pulumi).
type ScalewayRdbUserPrivilegeInput struct {
	// Name of the database to grant access to.
	//
	//  Must be the name of a database that exists on the instance -- either
	//  one defined in the `databases` list or an engine-default database.
	//  The Scaleway API validates existence at apply time.
	DatabaseName string `json:"database_name" jsonschema:"required,Name of the database to grant access to. Must be the name of a database that exists on the instance -- either one defined in the 'databases' list or an engine-default database. The Scaleway API valida..."`
	// Permission level for this user on this database.
	//
	//  Options:
	//    - "readonly"  -- SELECT only. For read-only application accounts
	//                     or reporting services.
	//    - "readwrite" -- SELECT, INSERT, UPDATE, DELETE. For typical
	//                     application accounts.
	//    - "all"       -- Ful...
	Permission string `json:"permission" jsonschema:"required,Permission level for this user on this database. Options: - 'readonly' -- SELECT only. For read-only application accounts or reporting services. - 'readwrite' -- SELECT; INSERT; UPDATE; DELETE. For ty..."`
}

func (s *ScalewayRdbUserPrivilegeInput) validate() error {
	if s.DatabaseName == "" {
		return fmt.Errorf("database_name is required")
	}
	if s.Permission == "" {
		return fmt.Errorf("permission is required")
	}
	return nil
}

func (s *ScalewayRdbUserPrivilegeInput) applyDefaults() {
}

func (s *ScalewayRdbUserPrivilegeInput) toMap() map[string]any {
	m := make(map[string]any)
	m["database_name"] = s.DatabaseName
	m["permission"] = s.Permission
	return m
}

// ParseScalewayRdbInstance validates and normalizes a ScalewayRdbInstance cloud_object.
func ParseScalewayRdbInstance(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "scaleway.openmcf.org/v1", "ScalewayRdbInstance"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec ScalewayRdbInstanceSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
