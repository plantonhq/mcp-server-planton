// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package scaleway

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// ScalewayServerlessFunction is a Kubernetes Resource Model (KRM) style
//
//	resource for deploying and managing serverless functions on Scaleway.
//
//	This is a **composite** resource that bundles a function namespace,
//	the function itself, and optional cron triggers into a single
//	declarable unit. Under the hood it creates:
//	  - scaleway_function_namespace (1x) -- grouping container
//	  - scaleway_function (1x) -- the serverless function
//	  - scaleway_function_cron (0..Nx) -- optional scheduled triggers
//
//	**Deployment model:** This resource defines the function
//	*infrastructure* (runtime, memory, scaling, networking, env vars).
//	Code can be deployed alongside via `zip_file`/`zip_hash` fields,
//	or separately via the Scaleway CLI (`scw function deploy`) or CI/CD
//	pipeline.
//
//	**Composition pattern:** This is a mid-tier resource (DAG Layer 2).
//	Upstream: `private_network_id` optionally references
//	ScalewayPrivateNetwork for VPC connectivity.
//	Downstream: `domain_name` output can be referenced by
//	ScalewayDnsRecord for custom domain routing.
type ScalewayServerlessFunctionSpecInput struct {
	// region where the function namespace and function are deployed.
	//
	//  Scaleway serverless functions are regional resources.
	//  Valid regions: "fr-par", "nl-ams", "pl-waw".
	Region string `json:"region,omitempty" jsonschema:"region where the function namespace and function are deployed. Scaleway serverless functions are regional resources. Valid regions: 'fr-par'; 'nl-ams'; 'pl-waw'."`
	// runtime specifies the language runtime for the function.
	//
	//  This is a plain string (not an enum) because Scaleway adds new
	//  runtimes frequently. Using a string avoids proto staleness.
	//
	//  Known runtimes (as of 2026):
	//    Node.js: "node20", "node22"
	//    Python:  "python39", "python310", "python311", "pyth...
	Runtime string `json:"runtime,omitempty" jsonschema:"runtime specifies the language runtime for the function. This is a plain string (not an enum) because Scaleway adds new runtimes frequently. Using a string avoids proto staleness. Known runtimes (as o..."`
	// handler is the function entrypoint, runtime-dependent.
	//
	//  Examples:
	//    Python: "handler.handle"
	//    Node.js: "handler.handler"
	//    Go: "Handle"
	//
	//  Refer to Scaleway documentation for handler conventions per runtime.
	Handler string `json:"handler,omitempty" jsonschema:"handler is the function entrypoint; runtime-dependent. Examples: Python: 'handler.handle' Node.js: 'handler.handler' Go: 'Handle' Refer to Scaleway documentation for handler conventions per runtime."`
	// privacy controls how the function is authenticated.
	Privacy string `json:"privacy" jsonschema:"required,enum=privacy_public|privacy_private,privacy controls how the function is authenticated."`
	// description of the function. Optional, human-readable.
	Description string `json:"description,omitempty" jsonschema:"description of the function. Optional; human-readable."`
	// memory_limit_mb is the memory allocated to each function instance
	//  in megabytes.
	//
	//  Higher memory also increases CPU allocation proportionally.
	//  Common values: 128, 256, 512, 1024, 2048.
	//  Defaults to 256 MB if not specified.
	MemoryLimitMb uint32 `json:"memory_limit_mb,omitempty" jsonschema:"memory_limit_mb is the memory allocated to each function instance in megabytes. Higher memory also increases CPU allocation proportionally. Common values: 128; 256; 512; 1024; 2048. Defaults to 256 MB..."`
	// min_scale is the minimum number of always-running function instances.
	//
	//  Set to 0 (default) for scale-to-zero behavior -- the function
	//  spins down when idle and incurs no compute charges.
	//  Set to 1+ for always-warm instances (eliminates cold starts but
	//  incurs continuous billing).
	MinScale uint32 `json:"min_scale,omitempty" jsonschema:"min_scale is the minimum number of always-running function instances. Set to 0 (default) for scale-to-zero behavior -- the function spins down when idle and incurs no compute charges. Set to 1+ for al..."`
	// max_scale is the maximum number of concurrent function instances.
	//
	//  The function auto-scales based on incoming workload but never
	//  exceeds this limit. Defaults to 20 if not specified.
	MaxScale uint32 `json:"max_scale,omitempty" jsonschema:"max_scale is the maximum number of concurrent function instances. The function auto-scales based on incoming workload but never exceeds this limit. Defaults to 20 if not specified."`
	// timeout_seconds is the maximum execution time for a single
	//  function invocation in seconds.
	//
	//  If the function exceeds this duration, Scaleway terminates it.
	//  Defaults to 300 seconds (5 minutes) if not specified.
	TimeoutSeconds uint32 `json:"timeout_seconds,omitempty" jsonschema:"timeout_seconds is the maximum execution time for a single function invocation in seconds. If the function exceeds this duration; Scaleway terminates it. Defaults to 300 seconds (5 minutes) if not spe..."`
	// http_option controls HTTP/HTTPS behavior for the function endpoint.
	//
	//  Defaults to "enabled" (both HTTP and HTTPS allowed) if not specified.
	HttpOption string `json:"http_option,omitempty" jsonschema:"enum=enabled|redirected,http_option controls HTTP/HTTPS behavior for the function endpoint. Defaults to 'enabled' (both HTTP and HTTPS allowed) if not specified."`
	// env groups environment variables and secrets for the function.
	//
	//  Variables are non-secret and visible in logs/dashboards.
	//  Secrets are encrypted at rest and masked in the Scaleway console.
	//
	//  Modeled as repeated name-value messages (Kubernetes-style) rather
	//  than maps to preserve sort order and enabl...
	Env *ScalewayServerlessFunctionEnvInput `json:"env,omitempty" jsonschema:"env groups environment variables and secrets for the function. Variables are non-secret and visible in logs/dashboards. Secrets are encrypted at rest and masked in the Scaleway console. Modeled as rep..."`
	// private_network_id optionally connects the function to a Scaleway
	//  Private Network for VPC-internal communication.
	//
	//  When connected, the function can reach resources on the Private
	//  Network (databases, Redis clusters, other services) without
	//  traversing the public internet.
	//
	//  Leave unset for functio...
	PrivateNetworkId string `json:"private_network_id,omitempty" jsonschema:"private_network_id optionally connects the function to a Scaleway Private Network for VPC-internal communication. When connected; the function can reach resources on the Private Network (databases; Re..."`
	// sandbox selects the execution environment for the function.
	//
	//  Available sandboxes depend on the Scaleway platform version.
	//  Common values: "v1" (standard), "v2" (enhanced security).
	//  Leave empty to use the platform default.
	Sandbox string `json:"sandbox,omitempty" jsonschema:"sandbox selects the execution environment for the function. Available sandboxes depend on the Scaleway platform version. Common values: 'v1' (standard); 'v2' (enhanced security). Leave empty to use th..."`
	// zip_file is the local path to a zip archive containing the
	//  function source code.
	//
	//  When provided, the IaC module uploads this archive and triggers
	//  deployment. Use together with `zip_hash` for change detection.
	//
	//  Leave empty when deploying code separately via the Scaleway CLI
	//  or CI/CD pipeline.
	ZipFile string `json:"zip_file,omitempty" jsonschema:"zip_file is the local path to a zip archive containing the function source code. When provided; the IaC module uploads this archive and triggers deployment. Use together with 'zip_hash' for change det..."`
	// zip_hash is a hash of the zip archive for change detection.
	//
	//  When the hash changes, the IaC module re-uploads and redeploys
	//  the function. Can be any string (e.g., SHA256 of the zip file).
	//
	//  Only meaningful when `zip_file` is also set.
	ZipHash string `json:"zip_hash,omitempty" jsonschema:"zip_hash is a hash of the zip archive for change detection. When the hash changes; the IaC module re-uploads and redeploys the function. Can be any string (e.g.; SHA256 of the zip file). Only meaningf..."`
	// cron_triggers defines optional scheduled triggers for the function.
	//
	//  Each trigger creates a `scaleway_function_cron` resource that
	//  invokes the function on the specified schedule with the given
	//  JSON arguments.
	//
	//  Common patterns:
	//    Hourly cleanup:    schedule = "0 * * * *"
	//    Nightly backup:    sc...
	CronTriggers []*ScalewayServerlessFunctionCronTriggerInput `json:"cron_triggers,omitempty" jsonschema:"cron_triggers defines optional scheduled triggers for the function. Each trigger creates a 'scaleway_function_cron' resource that invokes the function on the specified schedule with the given JSON arg..."`
}

func (s *ScalewayServerlessFunctionSpecInput) validate() error {
	if s.Privacy == "" {
		return fmt.Errorf("privacy is required")
	}
	switch s.Privacy {
	case "privacy_public", "privacy_private":
	default:
		return fmt.Errorf("invalid privacy: %q", s.Privacy)
	}
	switch s.HttpOption {
	case "", "enabled", "redirected":
	default:
		return fmt.Errorf("invalid http_option: %q", s.HttpOption)
	}
	if s.Env != nil {
		if err := s.Env.validate(); err != nil {
			return fmt.Errorf("env: %w", err)
		}
	}
	for i, v := range s.CronTriggers {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("cron_triggers[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayServerlessFunctionSpecInput) applyDefaults() {
	if s.Env != nil {
		s.Env.applyDefaults()
	}
}

func (s *ScalewayServerlessFunctionSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	if s.Runtime != "" {
		m["runtime"] = s.Runtime
	}
	if s.Handler != "" {
		m["handler"] = s.Handler
	}
	m["privacy"] = s.Privacy
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.MemoryLimitMb != 0 {
		m["memory_limit_mb"] = s.MemoryLimitMb
	}
	if s.MinScale != 0 {
		m["min_scale"] = s.MinScale
	}
	if s.MaxScale != 0 {
		m["max_scale"] = s.MaxScale
	}
	if s.TimeoutSeconds != 0 {
		m["timeout_seconds"] = s.TimeoutSeconds
	}
	if s.HttpOption != "" {
		m["http_option"] = s.HttpOption
	}
	if s.Env != nil {
		m["env"] = s.Env.toMap()
	}
	if s.PrivateNetworkId != "" {
		m["private_network_id"] = s.PrivateNetworkId
	}
	if s.Sandbox != "" {
		m["sandbox"] = s.Sandbox
	}
	if s.ZipFile != "" {
		m["zip_file"] = s.ZipFile
	}
	if s.ZipHash != "" {
		m["zip_hash"] = s.ZipHash
	}
	if len(s.CronTriggers) > 0 {
		items := make([]any, len(s.CronTriggers))
		for i, v := range s.CronTriggers {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["cron_triggers"] = items
	}
	return m
}

// ScalewayServerlessFunctionCronTrigger defines a scheduled trigger
//
//	that invokes the function on a CRON schedule.
//
//	Each trigger creates a separate `scaleway_function_cron` Terraform
//	resource linked to the function.
type ScalewayServerlessFunctionCronTriggerInput struct {
	// name is an optional human-readable identifier for the trigger.
	//
	//  If not provided, Scaleway auto-generates a name. Providing a name
	//  makes triggers easier to identify in the console and logs.
	Name string `json:"name,omitempty" jsonschema:"name is an optional human-readable identifier for the trigger. If not provided; Scaleway auto-generates a name. Providing a name makes triggers easier to identify in the console and logs."`
	// schedule is a UNIX CRON expression defining when the function
	//  is invoked.
	//
	//  Examples:
	//    "0 * * * *"    -- every hour at minute 0
	//    "0 2 * * *"    -- daily at 2:00 AM
	//    "* /5 * * * *"  -- every 5 minutes
	//    "0 0 * * 0"    -- weekly on Sunday at midnight
	//
	//  See https://www.scaleway.com/en/docs/serv...
	Schedule string `json:"schedule,omitempty" jsonschema:"schedule is a UNIX CRON expression defining when the function is invoked. Examples: '0 * * * *' -- every hour at minute 0 '0 2 * * *' -- daily at 2:00 AM '*/5 * * * *' -- every 5 minutes '0 0 * * 0' -..."`
	// args is a JSON string passed to the function's event object on
	//  each scheduled invocation.
	//
	//  Must be valid JSON. Use "{}" for no arguments.
	//
	//  Example: '{"cleanup_type": "stale_sessions", "batch_size": 100}'
	Args string `json:"args,omitempty" jsonschema:"args is a JSON string passed to the function's event object on each scheduled invocation. Must be valid JSON. Use '{}' for no arguments. Example: '{'cleanup_type': 'stale_sessions'; 'batch_size': 100}..."`
}

func (s *ScalewayServerlessFunctionCronTriggerInput) validate() error {
	return nil
}

func (s *ScalewayServerlessFunctionCronTriggerInput) applyDefaults() {
}

func (s *ScalewayServerlessFunctionCronTriggerInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Name != "" {
		m["name"] = s.Name
	}
	if s.Schedule != "" {
		m["schedule"] = s.Schedule
	}
	if s.Args != "" {
		m["args"] = s.Args
	}
	return m
}

// ScalewayServerlessFunctionEnv groups environment variables and secrets
//
//	for the function.
//
//	This is a component-local message (NOT shared across components).
//	Each component defines its own Env message to enable independent
//	evolution and avoid cross-component coupling.
type ScalewayServerlessFunctionEnvInput struct {
	// variables are non-secret environment variables.
	//
	//  These are visible in the Scaleway console and may appear in
	//  function logs. Do not put sensitive values here -- use `secrets`.
	Variables []*ScalewayServerlessFunctionEnvVarInput `json:"variables,omitempty" jsonschema:"variables are non-secret environment variables. These are visible in the Scaleway console and may appear in function logs. Do not put sensitive values here -- use 'secrets'."`
	// secrets are encrypted environment variables.
	//
	//  Scaleway stores these encrypted at rest and masks them in the
	//  console. Use for database URLs, API keys, tokens, and other
	//  sensitive configuration.
	Secrets []*ScalewayServerlessFunctionEnvVarInput `json:"secrets,omitempty" jsonschema:"secrets are encrypted environment variables. Scaleway stores these encrypted at rest and masks them in the console. Use for database URLs; API keys; tokens; and other sensitive configuration."`
}

func (s *ScalewayServerlessFunctionEnvInput) validate() error {
	for i, v := range s.Variables {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("variables[%d]: %w", i, err)
			}
		}
	}
	for i, v := range s.Secrets {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("secrets[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayServerlessFunctionEnvInput) applyDefaults() {
}

func (s *ScalewayServerlessFunctionEnvInput) toMap() map[string]any {
	m := make(map[string]any)
	if len(s.Variables) > 0 {
		items := make([]any, len(s.Variables))
		for i, v := range s.Variables {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["variables"] = items
	}
	if len(s.Secrets) > 0 {
		items := make([]any, len(s.Secrets))
		for i, v := range s.Secrets {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["secrets"] = items
	}
	return m
}

// ScalewayServerlessFunctionEnvVar is a single environment variable
//
//	name-value pair.
//
//	Modeled as a message (not a map entry) to preserve ordering and
//	enable future extension with `valueFrom` for referencing external
//	secret stores.
type ScalewayServerlessFunctionEnvVarInput struct {
	// name is the environment variable name (e.g., "DATABASE_URL").
	Name string `json:"name,omitempty" jsonschema:"name is the environment variable name (e.g.; 'DATABASE_URL')."`
	// value is the environment variable value.
	Value string `json:"value,omitempty" jsonschema:"value is the environment variable value."`
}

func (s *ScalewayServerlessFunctionEnvVarInput) validate() error {
	return nil
}

func (s *ScalewayServerlessFunctionEnvVarInput) applyDefaults() {
}

func (s *ScalewayServerlessFunctionEnvVarInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Name != "" {
		m["name"] = s.Name
	}
	if s.Value != "" {
		m["value"] = s.Value
	}
	return m
}

// ParseScalewayServerlessFunction validates and normalizes a ScalewayServerlessFunction cloud_object.
func ParseScalewayServerlessFunction(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "scaleway.openmcf.org/v1", "ScalewayServerlessFunction"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec ScalewayServerlessFunctionSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
