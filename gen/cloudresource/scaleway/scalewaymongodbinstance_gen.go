// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T21:50:49+05:30

package scaleway

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/gen/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// scaleway-mongodb-instance
type ScalewayMongodbInstanceSpecInput struct {
	// The Scaleway region where the instance will be created.
	//
	//  Currently, Managed MongoDB is only available in "fr-par" (Paris).
	//  Additional regions may become available in the future.
	//
	//  This field is required and cannot be changed after creation.
	Region string `json:"region" jsonschema:"required,The Scaleway region where the instance will be created. Currently; Managed MongoDB is only available in 'fr-par' (Paris). Additional regions may become available in the future. This field is required ..."`
	// MongoDB engine version.
	//
	//  Format: semantic version string (e.g., "7.0.12").
	//
	//  The Scaleway provider normalizes this to major.minor internally.
	//  Check Scaleway documentation for currently supported versions.
	//
	//  Cannot be changed after creation.
	Version string `json:"version" jsonschema:"required,MongoDB engine version. Format: semantic version string (e.g.; '7.0.12'). The Scaleway provider normalizes this to major.minor internally. Check Scaleway documentation for currently supported versions..."`
	// Node type determining CPU, RAM, and baseline performance.
	//
	//  Shared vCPU (cost-optimized):
	//    - "MGDB-PLAY2-NANO"  -- 2 vCPU, 4 GB RAM. Development/testing.
	//    - "MGDB-PRO2-XXS"    -- 2 vCPU, 8 GB RAM. Light production.
	//    - "MGDB-PRO2-XS"     -- 4 vCPU, 16 GB RAM.
	//    - "MGDB-PRO2-S"      -- 8 vCPU, ...
	NodeType string `json:"node_type" jsonschema:"required,Node type determining CPU; RAM; and baseline performance. Shared vCPU (cost-optimized): - 'MGDB-PLAY2-NANO' -- 2 vCPU; 4 GB RAM. Development/testing. - 'MGDB-PRO2-XXS' -- 2 vCPU; 8 GB RAM. Light produ..."`
	// Number of nodes in the instance.
	//
	//  Valid values:
	//    - 1: Standalone mode (single node, no redundancy).
	//    - 3: Replica set (1 primary + 2 secondaries, automatic failover).
	//
	//  There is no 2-node mode. MongoDB requires an odd number of voting
	//  members for replica set elections.
	//
	//  IMPORTANT: Changing fr...
	NodeNumber uint32 `json:"node_number" jsonschema:"required,Number of nodes in the instance. Valid values: - 1: Standalone mode (single node; no redundancy). - 3: Replica set (1 primary + 2 secondaries; automatic failover). There is no 2-node mode. MongoDB req..."`
	// The Private Network to attach the instance to.
	//
	//  When set, the instance receives a private endpoint reachable only
	//  from resources on the same Private Network. This is the recommended
	//  topology for production.
	//
	//  When a Private Network is attached and `enable_public_network` is
	//  false (the default), ...
	PrivateNetworkId string `json:"private_network_id,omitempty" jsonschema:"The Private Network to attach the instance to. When set; the instance receives a private endpoint reachable only from resources on the same Private Network. This is the recommended topology for produc..."`
	// Whether to also create a public network endpoint when a Private
	//  Network is attached.
	//
	//  This field only takes effect when `private_network_id` is set.
	//  When `private_network_id` is not set, a public endpoint is always
	//  created (Scaleway's default behavior).
	//
	//  Use cases for enabling both endpoints:
	//  ...
	EnablePublicNetwork bool `json:"enable_public_network,omitempty" jsonschema:"Whether to also create a public network endpoint when a Private Network is attached. This field only takes effect when 'private_network_id' is set. When 'private_network_id' is not set; a public endpo..."`
	// Volume type for database storage.
	//
	//  Options:
	//    - "sbs_5k"  (default) -- Block Storage SSD with 5K IOPS.
	//    - "sbs_15k"           -- Block Storage SSD with 15K IOPS.
	//      Higher throughput for I/O-intensive workloads.
	//
	//  Unlike RDB (which supports local SSD), MongoDB uses only block
	//  storage volumes....
	VolumeType string `json:"volume_type,omitempty" jsonschema:"Volume type for database storage. Options: - 'sbs_5k' (default) -- Block Storage SSD with 5K IOPS. - 'sbs_15k' -- Block Storage SSD with 15K IOPS. Higher throughput for I/O-intensive workloads. Unlike..."`
	// Volume size in GB.
	//
	//  Must be a multiple of 5. Minimum 5 GB.
	//
	//  If 0 or omitted, uses the default size (5 GB). The size determines
	//  how much data the database can store.
	//
	//  Can only be increased after creation, never decreased.
	VolumeSizeInGb uint32 `json:"volume_size_in_gb,omitempty" jsonschema:"Volume size in GB. Must be a multiple of 5. Minimum 5 GB. If 0 or omitted; uses the default size (5 GB). The size determines how much data the database can store. Can only be increased after creation;..."`
	// Whether to enable automatic snapshot scheduling.
	//
	//  When enabled, Scaleway takes periodic snapshots of the database at
	//  the configured frequency and retains them for the configured period.
	//
	//  Default: false (no automatic snapshots).
	EnableSnapshotSchedule bool `json:"enable_snapshot_schedule,omitempty" jsonschema:"Whether to enable automatic snapshot scheduling. When enabled; Scaleway takes periodic snapshots of the database at the configured frequency and retains them for the configured period. Default: false ..."`
	// Hours between automatic snapshots.
	//
	//  Only used when `enable_snapshot_schedule` is true.
	//  If 0 or omitted when snapshots are enabled, uses Scaleway's default.
	SnapshotScheduleFrequencyHours uint32 `json:"snapshot_schedule_frequency_hours,omitempty" jsonschema:"Hours between automatic snapshots. Only used when 'enable_snapshot_schedule' is true. If 0 or omitted when snapshots are enabled; uses Scaleway's default."`
	// Days to retain automatic snapshots.
	//
	//  Only used when `enable_snapshot_schedule` is true.
	//  If 0 or omitted when snapshots are enabled, uses Scaleway's default.
	SnapshotScheduleRetentionDays uint32 `json:"snapshot_schedule_retention_days,omitempty" jsonschema:"Days to retain automatic snapshots. Only used when 'enable_snapshot_schedule' is true. If 0 or omitted when snapshots are enabled; uses Scaleway's default."`
	// Username for the initial admin user created with the instance.
	//
	//  This user is created as part of instance provisioning and has full
	//  administrative privileges. It cannot be removed through this resource.
	//
	//  Must be different from any user in the `users` list.
	AdminUser string `json:"admin_user" jsonschema:"required,Username for the initial admin user created with the instance. This user is created as part of instance provisioning and has full administrative privileges. It cannot be removed through this resource...."`
	// Password for the initial admin user.
	//
	//  Must meet minimum complexity requirements. For production, use a
	//  strong, randomly generated password and manage it through your
	//  organization's secrets workflow.
	AdminPassword string `json:"admin_password" jsonschema:"required,Password for the initial admin user. Must meet minimum complexity requirements. For production; use a strong; randomly generated password and manage it through your organization's secrets workflow."`
	// Additional database users to create on the instance.
	//
	//  Each entry creates a `scaleway_mongodb_user` Terraform resource.
	//  Each user's roles define what databases they can access and at what
	//  permission level.
	//
	//  The admin user (specified above) always exists with full access.
	//  Users listed here are ty...
	Users []*ScalewayMongodbUserInput `json:"users,omitempty" jsonschema:"Additional database users to create on the instance. Each entry creates a 'scaleway_mongodb_user' Terraform resource. Each user's roles define what databases they can access and at what permission lev..."`
	// MongoDB-specific configuration settings.
	//
	//  Key-value pairs passed to the MongoDB engine configuration.
	//  Applied on both creation and updates. Keys are engine-specific.
	//
	//  Optional. If empty, Scaleway uses MongoDB defaults optimized for
	//  the node type.
	Settings map[string]string `json:"settings,omitempty" jsonschema:"MongoDB-specific configuration settings. Key-value pairs passed to the MongoDB engine configuration. Applied on both creation and updates. Keys are engine-specific. Optional. If empty; Scaleway uses M..."`
}

func (s *ScalewayMongodbInstanceSpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	if s.Version == "" {
		return fmt.Errorf("version is required")
	}
	if s.NodeType == "" {
		return fmt.Errorf("node_type is required")
	}
	if s.AdminUser == "" {
		return fmt.Errorf("admin_user is required")
	}
	if s.AdminPassword == "" {
		return fmt.Errorf("admin_password is required")
	}
	for i, v := range s.Users {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("users[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayMongodbInstanceSpecInput) applyDefaults() {
}

func (s *ScalewayMongodbInstanceSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	m["version"] = s.Version
	m["node_type"] = s.NodeType
	m["node_number"] = s.NodeNumber
	if s.PrivateNetworkId != "" {
		m["private_network_id"] = s.PrivateNetworkId
	}
	if s.EnablePublicNetwork {
		m["enable_public_network"] = s.EnablePublicNetwork
	}
	if s.VolumeType != "" {
		m["volume_type"] = s.VolumeType
	}
	if s.VolumeSizeInGb != 0 {
		m["volume_size_in_gb"] = s.VolumeSizeInGb
	}
	if s.EnableSnapshotSchedule {
		m["enable_snapshot_schedule"] = s.EnableSnapshotSchedule
	}
	if s.SnapshotScheduleFrequencyHours != 0 {
		m["snapshot_schedule_frequency_hours"] = s.SnapshotScheduleFrequencyHours
	}
	if s.SnapshotScheduleRetentionDays != 0 {
		m["snapshot_schedule_retention_days"] = s.SnapshotScheduleRetentionDays
	}
	m["admin_user"] = s.AdminUser
	m["admin_password"] = s.AdminPassword
	if len(s.Users) > 0 {
		items := make([]any, len(s.Users))
		for i, v := range s.Users {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["users"] = items
	}
	if len(s.Settings) > 0 {
		m["settings"] = s.Settings
	}
	return m
}

// ScalewayMongodbUser defines an additional database user.
//
//	Users are authentication principals that connect to the MongoDB instance.
//	Each user has a name, password, and a set of role assignments that define
//	their access level on specific databases or all databases.
//
//	The initial admin user (defined in the spec's admin_user field) is
//	separate and always has full access. Users defined here are typically
//	application-level accounts with restricted roles.
type ScalewayMongodbUserInput struct {
	// Username.
	//
	//  Must be unique within the instance and different from the admin_user
	//  specified in the spec. 1-63 characters.
	Name string `json:"name" jsonschema:"required,Username. Must be unique within the instance and different from the admin_user specified in the spec. 1-63 characters."`
	// Password for this user.
	//
	//  Must meet minimum complexity requirements. For production, use a
	//  strong, randomly generated password.
	Password string `json:"password" jsonschema:"required,Password for this user. Must meet minimum complexity requirements. For production; use a strong; randomly generated password."`
	// Role assignments for this user.
	//
	//  Each role grants a specific permission level scoped to a database
	//  name or all databases. Multiple roles can be assigned to one user.
	//
	//  If empty, the user exists but has no database access until roles
	//  are assigned (via this field or manually).
	Roles []*ScalewayMongodbUserRoleInput `json:"roles,omitempty" jsonschema:"Role assignments for this user. Each role grants a specific permission level scoped to a database name or all databases. Multiple roles can be assigned to one user. If empty; the user exists but has n..."`
}

func (s *ScalewayMongodbUserInput) validate() error {
	if s.Name == "" {
		return fmt.Errorf("name is required")
	}
	if s.Password == "" {
		return fmt.Errorf("password is required")
	}
	for i, v := range s.Roles {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("roles[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayMongodbUserInput) applyDefaults() {
}

func (s *ScalewayMongodbUserInput) toMap() map[string]any {
	m := make(map[string]any)
	m["name"] = s.Name
	m["password"] = s.Password
	if len(s.Roles) > 0 {
		items := make([]any, len(s.Roles))
		for i, v := range s.Roles {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["roles"] = items
	}
	return m
}

// ScalewayMongodbUserRole defines a role assignment for a MongoDB user.
//
//	Each role combines a permission level (read, read_write, db_admin) with
//	a scope (specific database or all databases). The scope is determined by
//	setting exactly one of `database_name` or `any_database`.
//
//	This maps directly to the `roles` block on the `scaleway_mongodb_user`
//	Terraform resource.
type ScalewayMongodbUserRoleInput struct {
	// The role to assign.
	//
	//  Available roles:
	//    - "read"       -- Read-only access (find, count, aggregate).
	//    - "read_write" -- Read and write access (insert, update, delete).
	//    - "db_admin"   -- Database administration (index management,
	//                      collection management, schema validation).
	// ...
	Role string `json:"role" jsonschema:"required,The role to assign. Available roles: - 'read' -- Read-only access (find; count; aggregate). - 'read_write' -- Read and write access (insert; update; delete). - 'db_admin' -- Database administration (i..."`
	// The specific database to scope this role to.
	//
	//  When set, the role applies only to this database. The database does
	//  not need to exist at provisioning time -- MongoDB creates databases
	//  implicitly when data is first written.
	//
	//  Mutually exclusive with `any_database`. Exactly one must be set.
	DatabaseName string `json:"database_name,omitempty" jsonschema:"The specific database to scope this role to. When set; the role applies only to this database. The database does not need to exist at provisioning time -- MongoDB creates databases implicitly when dat..."`
	// Whether to apply this role to ALL databases on the instance.
	//
	//  When true, the role grants access to every current and future
	//  database on the instance. Useful for admin or monitoring accounts.
	//
	//  Mutually exclusive with `database_name`. Exactly one must be set.
	AnyDatabase bool `json:"any_database,omitempty" jsonschema:"Whether to apply this role to ALL databases on the instance. When true; the role grants access to every current and future database on the instance. Useful for admin or monitoring accounts. Mutually e..."`
}

func (s *ScalewayMongodbUserRoleInput) validate() error {
	if s.Role == "" {
		return fmt.Errorf("role is required")
	}
	return nil
}

func (s *ScalewayMongodbUserRoleInput) applyDefaults() {
}

func (s *ScalewayMongodbUserRoleInput) toMap() map[string]any {
	m := make(map[string]any)
	m["role"] = s.Role
	if s.DatabaseName != "" {
		m["database_name"] = s.DatabaseName
	}
	if s.AnyDatabase {
		m["any_database"] = s.AnyDatabase
	}
	return m
}

// ParseScalewayMongodbInstance validates and normalizes a ScalewayMongodbInstance cloud_object.
func ParseScalewayMongodbInstance(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "scaleway.openmcf.org/v1", "ScalewayMongodbInstance"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec ScalewayMongodbInstanceSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
