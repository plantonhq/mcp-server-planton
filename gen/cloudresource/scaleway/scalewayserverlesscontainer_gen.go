// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package scaleway

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// ScalewayServerlessContainer is a Kubernetes Resource Model (KRM) style
//
//	resource for deploying and managing serverless containers on Scaleway.
//
//	This is a **composite** resource that bundles a container namespace,
//	the container itself, and optional cron triggers into a single
//	declarable unit. Under the hood it creates:
//	  - scaleway_container_namespace (1x) -- grouping container
//	  - scaleway_container (1x) -- the serverless container
//	  - scaleway_container_cron (0..Nx) -- optional scheduled triggers
//
//	**Deployment model:** This resource deploys pre-built container images
//	from any OCI-compatible registry (Scaleway Container Registry, Docker
//	Hub, GHCR, etc.). Unlike ScalewayServerlessFunction which deploys
//	source code with a runtime, this resource deploys ready-to-run
//	container images.
//
//	**Composition pattern:** This is a mid-tier resource (DAG Layer 2).
//	Upstream: `image.registry_endpoint` optionally references
//	ScalewayContainerRegistry for registry DAG edges.
//	`private_network_id` optionally references ScalewayPrivateNetwork
//	for VPC connectivity.
//	Downstream: `domain_name` output can be referenced by
//	ScalewayDnsRecord for custom domain routing.
type ScalewayServerlessContainerSpecInput struct {
	// region where the container namespace and container are deployed.
	//
	//  Scaleway serverless containers are regional resources.
	//  Valid regions: "fr-par", "nl-ams", "pl-waw".
	Region string `json:"region,omitempty" jsonschema:"region where the container namespace and container are deployed. Scaleway serverless containers are regional resources. Valid regions: 'fr-par'; 'nl-ams'; 'pl-waw'."`
	// image specifies the container image to deploy.
	//
	//  The image is defined as a structured message with three fields:
	//  registry endpoint, image name, and tag. The IaC module composes
	//  these into the full image URL: "{registry_endpoint}/{name}:{tag}".
	//
	//  The `registry_endpoint` field supports `StringValueO...
	Image *ScalewayServerlessContainerImageInput `json:"image" jsonschema:"required,image specifies the container image to deploy. The image is defined as a structured message with three fields: registry endpoint; image name; and tag. The IaC module composes these into the full image..."`
	// registry_sha256 is a deployment trigger string.
	//
	//  When this value changes, the IaC module triggers a redeployment
	//  of the container. This can be any string -- typically the SHA256
	//  digest of the container image, but it could be a CI build number,
	//  git commit SHA, or any value that changes when redep...
	RegistrySha256 string `json:"registry_sha256,omitempty" jsonschema:"registry_sha256 is a deployment trigger string. When this value changes; the IaC module triggers a redeployment of the container. This can be any string -- typically the SHA256 digest of the container..."`
	// port is the listening port exposed by the container.
	//
	//  The container must listen on this port for incoming HTTP requests.
	//  Scaleway routes traffic to this port. Most containers use 8080
	//  (the default) but any valid port is accepted.
	Port uint32 `json:"port,omitempty" jsonschema:"port is the listening port exposed by the container. The container must listen on this port for incoming HTTP requests. Scaleway routes traffic to this port. Most containers use 8080 (the default) but..."`
	// privacy controls how the container endpoint is authenticated.
	Privacy string `json:"privacy" jsonschema:"required,enum=privacy_public|privacy_private,privacy controls how the container endpoint is authenticated."`
	// description of the container. Optional, human-readable.
	Description string `json:"description,omitempty" jsonschema:"description of the container. Optional; human-readable."`
	// memory_limit_mb is the memory allocated to each container instance
	//  in megabytes.
	//
	//  Determines the memory ceiling for the container. Common values:
	//  128, 256, 512, 1024, 2048, 4096. Defaults to 256 MB.
	MemoryLimitMb uint32 `json:"memory_limit_mb,omitempty" jsonschema:"memory_limit_mb is the memory allocated to each container instance in megabytes. Determines the memory ceiling for the container. Common values: 128; 256; 512; 1024; 2048; 4096. Defaults to 256 MB."`
	// cpu_limit is the vCPU allocated to each container instance in
	//  milliCPU units (1000 = 1 vCPU).
	//
	//  When set to 0 or omitted, Scaleway auto-allocates CPU proportional
	//  to the memory limit. Set explicitly for workloads with specific
	//  CPU requirements. Common values: 70, 140, 280, 560, 1120.
	CpuLimit uint32 `json:"cpu_limit,omitempty" jsonschema:"cpu_limit is the vCPU allocated to each container instance in milliCPU units (1000 = 1 vCPU). When set to 0 or omitted; Scaleway auto-allocates CPU proportional to the memory limit. Set explicitly for..."`
	// min_scale is the minimum number of always-running container instances.
	//
	//  Set to 0 (default) for scale-to-zero behavior -- the container
	//  stops when idle and incurs no compute charges.
	//  Set to 1+ for always-warm instances (eliminates cold starts but
	//  incurs continuous billing).
	MinScale uint32 `json:"min_scale,omitempty" jsonschema:"min_scale is the minimum number of always-running container instances. Set to 0 (default) for scale-to-zero behavior -- the container stops when idle and incurs no compute charges. Set to 1+ for alway..."`
	// max_scale is the maximum number of concurrent container instances.
	//
	//  The container auto-scales based on incoming workload but never
	//  exceeds this limit. Defaults to 20 if not specified.
	MaxScale uint32 `json:"max_scale,omitempty" jsonschema:"max_scale is the maximum number of concurrent container instances. The container auto-scales based on incoming workload but never exceeds this limit. Defaults to 20 if not specified."`
	// timeout_seconds is the maximum time in seconds a single request
	//  can spend being processed before Scaleway terminates it.
	//
	//  Defaults to 300 seconds (5 minutes) if not specified.
	TimeoutSeconds uint32 `json:"timeout_seconds,omitempty" jsonschema:"timeout_seconds is the maximum time in seconds a single request can spend being processed before Scaleway terminates it. Defaults to 300 seconds (5 minutes) if not specified."`
	// http_option controls HTTP/HTTPS behavior for the container endpoint.
	//
	//  Defaults to "enabled" (both HTTP and HTTPS allowed) if not specified.
	HttpOption string `json:"http_option,omitempty" jsonschema:"enum=enabled|redirected,http_option controls HTTP/HTTPS behavior for the container endpoint. Defaults to 'enabled' (both HTTP and HTTPS allowed) if not specified."`
	// protocol selects the communication protocol between the Scaleway
	//  gateway and the container.
	//
	//  Defaults to HTTP/1.1 if not specified. Use h2c for gRPC services
	//  or HTTP/2 backends.
	Protocol string `json:"protocol,omitempty" jsonschema:"enum=http1|h2c,protocol selects the communication protocol between the Scaleway gateway and the container. Defaults to HTTP/1.1 if not specified. Use h2c for gRPC services or HTTP/2 backends."`
	// commands overrides the default CMD from the container image.
	//
	//  This is equivalent to Docker's CMD instruction. When set, it
	//  replaces the image's default command entirely.
	//
	//  Example: ["node", "server.js"]
	Commands []string `json:"commands,omitempty" jsonschema:"commands overrides the default CMD from the container image. This is equivalent to Docker's CMD instruction. When set; it replaces the image's default command entirely. Example: ['node'; 'server.js']"`
	// args overrides the default ENTRYPOINT arguments from the container
	//  image.
	//
	//  These are passed as arguments to the command specified in the
	//  `commands` field (or the image's default ENTRYPOINT).
	//
	//  Example: ["--port", "8080", "--workers", "4"]
	Args []string `json:"args,omitempty" jsonschema:"args overrides the default ENTRYPOINT arguments from the container image. These are passed as arguments to the command specified in the 'commands' field (or the image's default ENTRYPOINT). Example: [..."`
	// env groups environment variables and secrets for the container.
	//
	//  Variables are non-secret and visible in logs/dashboards.
	//  Secrets are encrypted at rest and masked in the Scaleway console.
	//
	//  Modeled as repeated name-value messages (Kubernetes-style) rather
	//  than maps to preserve sort order and enab...
	Env *ScalewayServerlessContainerEnvInput `json:"env,omitempty" jsonschema:"env groups environment variables and secrets for the container. Variables are non-secret and visible in logs/dashboards. Secrets are encrypted at rest and masked in the Scaleway console. Modeled as re..."`
	// private_network_id optionally connects the container to a Scaleway
	//  Private Network for VPC-internal communication.
	//
	//  When connected, the container can reach resources on the Private
	//  Network (databases, Redis clusters, other services) without
	//  traversing the public internet.
	//
	//  Leave unset for conta...
	PrivateNetworkId string `json:"private_network_id,omitempty" jsonschema:"private_network_id optionally connects the container to a Scaleway Private Network for VPC-internal communication. When connected; the container can reach resources on the Private Network (databases; ..."`
	// sandbox selects the execution environment for the container.
	//
	//  Available sandboxes depend on the Scaleway platform version.
	//  Common values: "v1" (standard), "v2" (enhanced security).
	//  Leave empty to use the platform default.
	Sandbox string `json:"sandbox,omitempty" jsonschema:"sandbox selects the execution environment for the container. Available sandboxes depend on the Scaleway platform version. Common values: 'v1' (standard); 'v2' (enhanced security). Leave empty to use t..."`
	// health_check configures HTTP health checking for the container.
	//
	//  When configured, Scaleway periodically sends HTTP requests to the
	//  specified path and considers the container unhealthy after the
	//  configured number of consecutive failures.
	//
	//  Leave unset to rely on Scaleway's default liveness detecti...
	HealthCheck *ScalewayServerlessContainerHealthCheckInput `json:"health_check,omitempty" jsonschema:"health_check configures HTTP health checking for the container. When configured; Scaleway periodically sends HTTP requests to the specified path and considers the container unhealthy after the configu..."`
	// scaling_option configures autoscaling thresholds for the container.
	//
	//  These thresholds control when Scaleway adds or removes container
	//  instances. Only one threshold should typically be set -- Scaleway
	//  uses the first threshold that is breached.
	//
	//  Leave unset to use Scaleway's default scaling behavi...
	ScalingOption *ScalewayServerlessContainerScalingOptionInput `json:"scaling_option,omitempty" jsonschema:"scaling_option configures autoscaling thresholds for the container. These thresholds control when Scaleway adds or removes container instances. Only one threshold should typically be set -- Scaleway u..."`
	// local_storage_limit_mb is the local (ephemeral) storage available
	//  to each container instance in megabytes.
	//
	//  This storage is lost when the container instance is stopped or
	//  replaced. Use for temporary files, caches, or build artifacts.
	//  Leave at 0 or unset to use the platform default.
	LocalStorageLimitMb uint32 `json:"local_storage_limit_mb,omitempty" jsonschema:"local_storage_limit_mb is the local (ephemeral) storage available to each container instance in megabytes. This storage is lost when the container instance is stopped or replaced. Use for temporary fi..."`
	// deploy controls whether the container is deployed (started) after
	//  creation or update.
	//
	//  When true (default), the IaC module triggers deployment immediately
	//  after provisioning. Set to false to create the container
	//  infrastructure without starting it -- useful for pre-provisioning
	//  before a release.
	Deploy bool `json:"deploy,omitempty" jsonschema:"deploy controls whether the container is deployed (started) after creation or update. When true (default); the IaC module triggers deployment immediately after provisioning. Set to false to create the..."`
	// cron_triggers defines optional scheduled triggers for the container.
	//
	//  Each trigger creates a `scaleway_container_cron` resource that
	//  invokes the container on the specified schedule with the given
	//  JSON arguments.
	//
	//  Common patterns:
	//    Hourly cleanup:    schedule = "0 * * * *"
	//    Nightly backup:   ...
	CronTriggers []*ScalewayServerlessContainerCronTriggerInput `json:"cron_triggers,omitempty" jsonschema:"cron_triggers defines optional scheduled triggers for the container. Each trigger creates a 'scaleway_container_cron' resource that invokes the container on the specified schedule with the given JSON ..."`
}

func (s *ScalewayServerlessContainerSpecInput) validate() error {
	if s.Image == nil {
		return fmt.Errorf("image is required")
	}
	if s.Image != nil {
		if err := s.Image.validate(); err != nil {
			return fmt.Errorf("image: %w", err)
		}
	}
	if s.Privacy == "" {
		return fmt.Errorf("privacy is required")
	}
	switch s.Privacy {
	case "privacy_public", "privacy_private":
	default:
		return fmt.Errorf("invalid privacy: %q", s.Privacy)
	}
	switch s.HttpOption {
	case "", "enabled", "redirected":
	default:
		return fmt.Errorf("invalid http_option: %q", s.HttpOption)
	}
	switch s.Protocol {
	case "", "http1", "h2c":
	default:
		return fmt.Errorf("invalid protocol: %q", s.Protocol)
	}
	if s.Env != nil {
		if err := s.Env.validate(); err != nil {
			return fmt.Errorf("env: %w", err)
		}
	}
	if s.HealthCheck != nil {
		if err := s.HealthCheck.validate(); err != nil {
			return fmt.Errorf("health_check: %w", err)
		}
	}
	if s.ScalingOption != nil {
		if err := s.ScalingOption.validate(); err != nil {
			return fmt.Errorf("scaling_option: %w", err)
		}
	}
	for i, v := range s.CronTriggers {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("cron_triggers[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayServerlessContainerSpecInput) applyDefaults() {
	if s.Image != nil {
		s.Image.applyDefaults()
	}
	if s.Env != nil {
		s.Env.applyDefaults()
	}
	if s.HealthCheck != nil {
		s.HealthCheck.applyDefaults()
	}
	if s.ScalingOption != nil {
		s.ScalingOption.applyDefaults()
	}
}

func (s *ScalewayServerlessContainerSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Region != "" {
		m["region"] = s.Region
	}
	if s.Image != nil {
		m["image"] = s.Image.toMap()
	}
	if s.RegistrySha256 != "" {
		m["registry_sha256"] = s.RegistrySha256
	}
	if s.Port != 0 {
		m["port"] = s.Port
	}
	m["privacy"] = s.Privacy
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.MemoryLimitMb != 0 {
		m["memory_limit_mb"] = s.MemoryLimitMb
	}
	if s.CpuLimit != 0 {
		m["cpu_limit"] = s.CpuLimit
	}
	if s.MinScale != 0 {
		m["min_scale"] = s.MinScale
	}
	if s.MaxScale != 0 {
		m["max_scale"] = s.MaxScale
	}
	if s.TimeoutSeconds != 0 {
		m["timeout_seconds"] = s.TimeoutSeconds
	}
	if s.HttpOption != "" {
		m["http_option"] = s.HttpOption
	}
	if s.Protocol != "" {
		m["protocol"] = s.Protocol
	}
	if len(s.Commands) > 0 {
		m["commands"] = s.Commands
	}
	if len(s.Args) > 0 {
		m["args"] = s.Args
	}
	if s.Env != nil {
		m["env"] = s.Env.toMap()
	}
	if s.PrivateNetworkId != "" {
		m["private_network_id"] = s.PrivateNetworkId
	}
	if s.Sandbox != "" {
		m["sandbox"] = s.Sandbox
	}
	if s.HealthCheck != nil {
		m["health_check"] = s.HealthCheck.toMap()
	}
	if s.ScalingOption != nil {
		m["scaling_option"] = s.ScalingOption.toMap()
	}
	if s.LocalStorageLimitMb != 0 {
		m["local_storage_limit_mb"] = s.LocalStorageLimitMb
	}
	if s.Deploy {
		m["deploy"] = s.Deploy
	}
	if len(s.CronTriggers) > 0 {
		items := make([]any, len(s.CronTriggers))
		for i, v := range s.CronTriggers {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["cron_triggers"] = items
	}
	return m
}

// ScalewayServerlessContainerCronTrigger defines a scheduled trigger
//
//	that invokes the container on a CRON schedule.
//
//	Each trigger creates a separate `scaleway_container_cron` Terraform
//	resource linked to the container.
type ScalewayServerlessContainerCronTriggerInput struct {
	// name is an optional human-readable identifier for the trigger.
	//
	//  If not provided, Scaleway auto-generates a name. Providing a name
	//  makes triggers easier to identify in the console and logs.
	Name string `json:"name,omitempty" jsonschema:"name is an optional human-readable identifier for the trigger. If not provided; Scaleway auto-generates a name. Providing a name makes triggers easier to identify in the console and logs."`
	// schedule is a UNIX CRON expression defining when the container
	//  is invoked.
	//
	//  Examples:
	//    "0 * * * *"    -- every hour at minute 0
	//    "0 2 * * *"    -- daily at 2:00 AM
	//    "* /5 * * * *"  -- every 5 minutes
	//    "0 0 * * 0"    -- weekly on Sunday at midnight
	Schedule string `json:"schedule,omitempty" jsonschema:"schedule is a UNIX CRON expression defining when the container is invoked. Examples: '0 * * * *' -- every hour at minute 0 '0 2 * * *' -- daily at 2:00 AM '*/5 * * * *' -- every 5 minutes '0 0 * * 0' ..."`
	// args is a JSON string passed to the container's event object on
	//  each scheduled invocation.
	//
	//  Must be valid JSON. Use "{}" for no arguments.
	//
	//  Example: '{"task": "cleanup", "batch_size": 100}'
	Args string `json:"args,omitempty" jsonschema:"args is a JSON string passed to the container's event object on each scheduled invocation. Must be valid JSON. Use '{}' for no arguments. Example: '{'task': 'cleanup'; 'batch_size': 100}'"`
}

func (s *ScalewayServerlessContainerCronTriggerInput) validate() error {
	return nil
}

func (s *ScalewayServerlessContainerCronTriggerInput) applyDefaults() {
}

func (s *ScalewayServerlessContainerCronTriggerInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Name != "" {
		m["name"] = s.Name
	}
	if s.Schedule != "" {
		m["schedule"] = s.Schedule
	}
	if s.Args != "" {
		m["args"] = s.Args
	}
	return m
}

// ScalewayServerlessContainerEnv groups environment variables and
//
//	secrets for the container.
//
//	This is a component-local message (NOT shared with
//	ScalewayServerlessFunction). Each serverless component defines its
//	own Env message to enable independent evolution.
type ScalewayServerlessContainerEnvInput struct {
	// variables are non-secret environment variables.
	//
	//  These are visible in the Scaleway console and may appear in
	//  container logs. Do not put sensitive values here -- use `secrets`.
	Variables []*ScalewayServerlessContainerEnvVarInput `json:"variables,omitempty" jsonschema:"variables are non-secret environment variables. These are visible in the Scaleway console and may appear in container logs. Do not put sensitive values here -- use 'secrets'."`
	// secrets are encrypted environment variables.
	//
	//  Scaleway stores these encrypted at rest and masks them in the
	//  console. Use for database URLs, API keys, tokens, and other
	//  sensitive configuration.
	Secrets []*ScalewayServerlessContainerEnvVarInput `json:"secrets,omitempty" jsonschema:"secrets are encrypted environment variables. Scaleway stores these encrypted at rest and masks them in the console. Use for database URLs; API keys; tokens; and other sensitive configuration."`
}

func (s *ScalewayServerlessContainerEnvInput) validate() error {
	for i, v := range s.Variables {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("variables[%d]: %w", i, err)
			}
		}
	}
	for i, v := range s.Secrets {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("secrets[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *ScalewayServerlessContainerEnvInput) applyDefaults() {
}

func (s *ScalewayServerlessContainerEnvInput) toMap() map[string]any {
	m := make(map[string]any)
	if len(s.Variables) > 0 {
		items := make([]any, len(s.Variables))
		for i, v := range s.Variables {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["variables"] = items
	}
	if len(s.Secrets) > 0 {
		items := make([]any, len(s.Secrets))
		for i, v := range s.Secrets {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["secrets"] = items
	}
	return m
}

// ScalewayServerlessContainerEnvVar is a single environment variable
//
//	name-value pair.
//
//	Modeled as a message (not a map entry) to preserve ordering and
//	enable future extension with `valueFrom` for referencing external
//	secret stores.
type ScalewayServerlessContainerEnvVarInput struct {
	// name is the environment variable name (e.g., "DATABASE_URL").
	Name string `json:"name,omitempty" jsonschema:"name is the environment variable name (e.g.; 'DATABASE_URL')."`
	// value is the environment variable value.
	Value string `json:"value,omitempty" jsonschema:"value is the environment variable value."`
}

func (s *ScalewayServerlessContainerEnvVarInput) validate() error {
	return nil
}

func (s *ScalewayServerlessContainerEnvVarInput) applyDefaults() {
}

func (s *ScalewayServerlessContainerEnvVarInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Name != "" {
		m["name"] = s.Name
	}
	if s.Value != "" {
		m["value"] = s.Value
	}
	return m
}

// ScalewayServerlessContainerHealthCheck configures HTTP health
//
//	checking for the container.
//
//	Scaleway periodically sends an HTTP GET request to the specified
//	path on the container's listening port. If the container returns a
//	non-2xx response more than `failure_threshold` times consecutively,
//	Scaleway marks the instance as unhealthy and replaces it.
type ScalewayServerlessContainerHealthCheckInput struct {
	// path is the HTTP path to probe for health checks.
	//
	//  The health check sends an HTTP GET to this path on the
	//  container's configured port. The container should return
	//  a 2xx status code when healthy.
	//
	//  Common values: "/health", "/healthz", "/ready", "/".
	Path string `json:"path,omitempty" jsonschema:"path is the HTTP path to probe for health checks. The health check sends an HTTP GET to this path on the container's configured port. The container should return a 2xx status code when healthy. Common..."`
	// failure_threshold is the number of consecutive health check
	//  failures before the container instance is considered unhealthy.
	//
	//  A higher threshold tolerates transient failures but takes longer
	//  to detect actual problems. Typical values: 2-5.
	FailureThreshold uint32 `json:"failure_threshold,omitempty" jsonschema:"failure_threshold is the number of consecutive health check failures before the container instance is considered unhealthy. A higher threshold tolerates transient failures but takes longer to detect a..."`
	// interval_seconds is the period between health check probes
	//  in seconds.
	//
	//  Shorter intervals detect failures faster but generate more
	//  probe traffic. Typical values: 10-60.
	IntervalSeconds uint32 `json:"interval_seconds,omitempty" jsonschema:"interval_seconds is the period between health check probes in seconds. Shorter intervals detect failures faster but generate more probe traffic. Typical values: 10-60."`
}

func (s *ScalewayServerlessContainerHealthCheckInput) validate() error {
	return nil
}

func (s *ScalewayServerlessContainerHealthCheckInput) applyDefaults() {
}

func (s *ScalewayServerlessContainerHealthCheckInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Path != "" {
		m["path"] = s.Path
	}
	if s.FailureThreshold != 0 {
		m["failure_threshold"] = s.FailureThreshold
	}
	if s.IntervalSeconds != 0 {
		m["interval_seconds"] = s.IntervalSeconds
	}
	return m
}

// ScalewayServerlessContainerImage specifies the container image to
//
//	deploy, split into registry endpoint, image name, and tag.
//
//	The IaC module composes these into the full registry image URL:
//	  "{registry_endpoint}/{name}:{tag}"
//
//	The `registry_endpoint` field uses `StringValueOrRef` to enable
//	infra-chart DAG edges from ScalewayContainerRegistry to this
//	container. For non-Scaleway registries (Docker Hub, GHCR, ECR),
//	provide a plain `value`.
//
//	Examples:
//	  Scaleway:   endpoint = valueFrom(ScalewayContainerRegistry), name = "my-app", tag = "v1.0"
//	  Docker Hub: endpoint = "docker.io/library", name = "nginx", tag = "1.25"
//	  GHCR:       endpoint = "ghcr.io/my-org", name = "my-service", tag = "latest"
type ScalewayServerlessContainerImageInput struct {
	// registry_endpoint is the base URL of the container registry.
	//
	//  For Scaleway Container Registry, use `valueFrom` to reference
	//  the endpoint output of a ScalewayContainerRegistry resource.
	//  For external registries, provide the URL as a plain `value`.
	//
	//  Format examples:
	//    "rg.fr-par.scw.cloud/my-names...
	RegistryEndpoint string `json:"registry_endpoint" jsonschema:"required,registry_endpoint is the base URL of the container registry. For Scaleway Container Registry; use 'valueFrom' to reference the endpoint output of a ScalewayContainerRegistry resource. For external reg..."`
	// name is the image name within the registry.
	//
	//  This is the repository path relative to the registry endpoint.
	//  Examples: "my-app", "backend/api", "nginx".
	Name string `json:"name,omitempty" jsonschema:"name is the image name within the registry. This is the repository path relative to the registry endpoint. Examples: 'my-app'; 'backend/api'; 'nginx'."`
	// tag is the image tag to deploy.
	//
	//  Examples: "latest", "v1.2.3", "sha-abc1234", "production".
	//  Use immutable tags (semantic versions, git SHAs) in production
	//  for reproducible deployments.
	Tag string `json:"tag,omitempty" jsonschema:"tag is the image tag to deploy. Examples: 'latest'; 'v1.2.3'; 'sha-abc1234'; 'production'. Use immutable tags (semantic versions; git SHAs) in production for reproducible deployments."`
}

func (s *ScalewayServerlessContainerImageInput) validate() error {
	if s.RegistryEndpoint == "" {
		return fmt.Errorf("registry_endpoint is required")
	}
	return nil
}

func (s *ScalewayServerlessContainerImageInput) applyDefaults() {
}

func (s *ScalewayServerlessContainerImageInput) toMap() map[string]any {
	m := make(map[string]any)
	m["registry_endpoint"] = s.RegistryEndpoint
	if s.Name != "" {
		m["name"] = s.Name
	}
	if s.Tag != "" {
		m["tag"] = s.Tag
	}
	return m
}

// ScalewayServerlessContainerScalingOption configures autoscaling
//
//	thresholds that determine when Scaleway adds or removes container
//	instances.
//
//	Set one or more thresholds. Scaleway scales up when any threshold
//	is breached and scales down when all thresholds are below target.
//
//	These replace the deprecated `max_concurrency` field.
type ScalewayServerlessContainerScalingOptionInput struct {
	// concurrent_requests_threshold is the target number of concurrent
	//  requests per container instance before scaling up.
	//
	//  When the average concurrent requests across instances exceeds
	//  this value, Scaleway adds instances (up to max_scale).
	//  Set to 0 or omit to disable request-based scaling.
	//
	//  Typical v...
	ConcurrentRequestsThreshold uint32 `json:"concurrent_requests_threshold,omitempty" jsonschema:"concurrent_requests_threshold is the target number of concurrent requests per container instance before scaling up. When the average concurrent requests across instances exceeds this value; Scaleway a..."`
	// cpu_usage_threshold is the target CPU usage percentage per
	//  container instance before scaling up.
	//
	//  When average CPU usage exceeds this percentage, Scaleway adds
	//  instances. Set to 0 or omit to disable CPU-based scaling.
	//
	//  Typical values: 50-80.
	CpuUsageThreshold uint32 `json:"cpu_usage_threshold,omitempty" jsonschema:"cpu_usage_threshold is the target CPU usage percentage per container instance before scaling up. When average CPU usage exceeds this percentage; Scaleway adds instances. Set to 0 or omit to disable CP..."`
	// memory_usage_threshold is the target memory usage percentage per
	//  container instance before scaling up.
	//
	//  When average memory usage exceeds this percentage, Scaleway adds
	//  instances. Set to 0 or omit to disable memory-based scaling.
	//
	//  Typical values: 60-90.
	MemoryUsageThreshold uint32 `json:"memory_usage_threshold,omitempty" jsonschema:"memory_usage_threshold is the target memory usage percentage per container instance before scaling up. When average memory usage exceeds this percentage; Scaleway adds instances. Set to 0 or omit to d..."`
}

func (s *ScalewayServerlessContainerScalingOptionInput) validate() error {
	return nil
}

func (s *ScalewayServerlessContainerScalingOptionInput) applyDefaults() {
}

func (s *ScalewayServerlessContainerScalingOptionInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.ConcurrentRequestsThreshold != 0 {
		m["concurrent_requests_threshold"] = s.ConcurrentRequestsThreshold
	}
	if s.CpuUsageThreshold != 0 {
		m["cpu_usage_threshold"] = s.CpuUsageThreshold
	}
	if s.MemoryUsageThreshold != 0 {
		m["memory_usage_threshold"] = s.MemoryUsageThreshold
	}
	return m
}

// ParseScalewayServerlessContainer validates and normalizes a ScalewayServerlessContainer cloud_object.
func ParseScalewayServerlessContainer(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "scaleway.openmcf.org/v1", "ScalewayServerlessContainer"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec ScalewayServerlessContainerSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
