// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package civo

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// civo-compute-instance
type CivoComputeInstanceSpecInput struct {
	// instance hostname (letters, numbers, dashes, dots; <=63 chars, no trailing dash/dot)
	InstanceName string `json:"instance_name" jsonschema:"required,instance hostname (letters; numbers; dashes; dots; <=63 chars; no trailing dash/dot)"`
	// region code for the instance location
	Region string `json:"region" jsonschema:"required,enum=lon1|lon2|fra1|nyc1|phx1|mum1,region code for the instance location"`
	// instance size (flavor) slug, e.g. "g3.small"
	Size string `json:"size" jsonschema:"required,instance size (flavor) slug; e.g. 'g3.small'"`
	// base OS image slug for the instance (e.g. "ubuntu-focal")
	Image string `json:"image" jsonschema:"required,base OS image slug for the instance (e.g. 'ubuntu-focal')"`
	// target network for the instance (must exist in the same region)
	Network string `json:"network" jsonschema:"required,target network for the instance (must exist in the same region)"`
	// SSH public key(s) to enable passwordless login (optional; if empty, a password will be set)
	SshKeyIds []string `json:"ssh_key_ids,omitempty" jsonschema:"SSH public key(s) to enable passwordless login (optional; if empty; a password will be set)"`
	// firewall(s) to attach to the instance (must belong to the same network)
	FirewallIds []string `json:"firewall_ids,omitempty" jsonschema:"firewall(s) to attach to the instance (must belong to the same network)"`
	// existing storage volumes to attach to this instance (must reside in same region)
	VolumeIds []string `json:"volume_ids,omitempty" jsonschema:"existing storage volumes to attach to this instance (must reside in same region)"`
	// reserved IP to assign to this instance (optional static public IP address)
	ReservedIpId string `json:"reserved_ip_id,omitempty" jsonschema:"reserved IP to assign to this instance (optional static public IP address)"`
	// tags for the instance (for organization, optional)
	Tags []string `json:"tags,omitempty" jsonschema:"tags for the instance (for organization; optional)"`
	// cloud-init user data script to run on instance boot (<=32 KiB, optional)
	UserData string `json:"user_data,omitempty" jsonschema:"cloud-init user data script to run on instance boot (<=32 KiB; optional)"`
}

func (s *CivoComputeInstanceSpecInput) validate() error {
	if s.InstanceName == "" {
		return fmt.Errorf("instance_name is required")
	}
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	switch s.Region {
	case "lon1", "lon2", "fra1", "nyc1", "phx1", "mum1":
	default:
		return fmt.Errorf("invalid region: %q", s.Region)
	}
	if s.Size == "" {
		return fmt.Errorf("size is required")
	}
	if s.Image == "" {
		return fmt.Errorf("image is required")
	}
	if s.Network == "" {
		return fmt.Errorf("network is required")
	}
	return nil
}

func (s *CivoComputeInstanceSpecInput) applyDefaults() {
}

func (s *CivoComputeInstanceSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["instance_name"] = s.InstanceName
	m["region"] = s.Region
	m["size"] = s.Size
	m["image"] = s.Image
	m["network"] = s.Network
	if len(s.SshKeyIds) > 0 {
		m["ssh_key_ids"] = s.SshKeyIds
	}
	if len(s.FirewallIds) > 0 {
		m["firewall_ids"] = s.FirewallIds
	}
	if len(s.VolumeIds) > 0 {
		m["volume_ids"] = s.VolumeIds
	}
	if s.ReservedIpId != "" {
		m["reserved_ip_id"] = s.ReservedIpId
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if s.UserData != "" {
		m["user_data"] = s.UserData
	}
	return m
}

// ParseCivoComputeInstance validates and normalizes a CivoComputeInstance cloud_object.
func ParseCivoComputeInstance(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "civo.openmcf.org/v1", "CivoComputeInstance"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec CivoComputeInstanceSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
