// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package kubernetes

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// KubernetesGatewayApiCrds installs the Kubernetes Gateway API Custom Resource
//
//	Definitions (CRDs) on a target Kubernetes cluster. The Gateway API provides
//	a next-generation, role-oriented, expressive API for managing ingress and
//	service mesh traffic.
type KubernetesGatewayApiCrdsSpecInput struct {
	// Target Kubernetes Cluster where the Gateway API CRDs will be installed.
	TargetCluster *KubernetesClusterSelectorInput `json:"target_cluster,omitempty" jsonschema:"Target Kubernetes Cluster where the Gateway API CRDs will be installed."`
	// Gateway API version to install (e.g., "v1.2.1", "v1.3.0").
	//  Defaults to v1.2.1 if not specified.
	//  Must start with 'v' followed by a valid semver version.
	Version string `json:"version,omitempty" jsonschema:"Gateway API version to install (e.g.; 'v1.2.1'; 'v1.3.0'). Defaults to v1.2.1 if not specified. Must start with 'v' followed by a valid semver version."`
	// Installation channel for Gateway API CRDs.
	//  Defaults to standard channel if not specified.
	InstallChannel *InstallChannelInput `json:"install_channel,omitempty" jsonschema:"Installation channel for Gateway API CRDs. Defaults to standard channel if not specified."`
}

func (s *KubernetesGatewayApiCrdsSpecInput) validate() error {
	if s.TargetCluster != nil {
		if err := s.TargetCluster.validate(); err != nil {
			return fmt.Errorf("target_cluster: %w", err)
		}
	}
	if s.InstallChannel != nil {
		if err := s.InstallChannel.validate(); err != nil {
			return fmt.Errorf("install_channel: %w", err)
		}
	}
	return nil
}

func (s *KubernetesGatewayApiCrdsSpecInput) applyDefaults() {
	if s.TargetCluster != nil {
		s.TargetCluster.applyDefaults()
	}
	if s.Version == "" {
		s.Version = "v1.2.1"
	}
	if s.InstallChannel != nil {
		s.InstallChannel.applyDefaults()
	}
}

func (s *KubernetesGatewayApiCrdsSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.TargetCluster != nil {
		m["target_cluster"] = s.TargetCluster.toMap()
	}
	if s.Version != "" {
		m["version"] = s.Version
	}
	if s.InstallChannel != nil {
		m["install_channel"] = s.InstallChannel.toMap()
	}
	return m
}

// Installation channel determines which set of CRDs to install.
//
//	The standard channel includes stable Gateway API resources.
//	The experimental channel includes additional experimental resources.
type InstallChannelInput struct {
	Channel string `json:"channel,omitempty" jsonschema:"enum=standard|experimental"`
}

func (s *InstallChannelInput) validate() error {
	switch s.Channel {
	case "", "standard", "experimental":
	default:
		return fmt.Errorf("invalid channel: %q", s.Channel)
	}
	return nil
}

func (s *InstallChannelInput) applyDefaults() {
}

func (s *InstallChannelInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Channel != "" {
		m["channel"] = s.Channel
	}
	return m
}

// ParseKubernetesGatewayApiCrds validates and normalizes a KubernetesGatewayApiCrds cloud_object.
func ParseKubernetesGatewayApiCrds(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "kubernetes.openmcf.org/v1", "KubernetesGatewayApiCrds"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec KubernetesGatewayApiCrdsSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
