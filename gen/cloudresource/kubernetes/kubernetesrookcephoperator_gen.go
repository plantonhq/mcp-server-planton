// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package kubernetes

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// KubernetesRookCephOperator is the top-level resource representing a Rook Ceph Operator deployment on Kubernetes.
//
//	Rook enables Ceph distributed storage to be deployed and managed on Kubernetes clusters,
//	providing file, block, and object storage services.
type KubernetesRookCephOperatorSpecInput struct {
	// Target Kubernetes Cluster where the Rook Ceph Operator will be deployed.
	TargetCluster *KubernetesClusterSelectorInput `json:"target_cluster,omitempty" jsonschema:"Target Kubernetes Cluster where the Rook Ceph Operator will be deployed."`
	// Kubernetes Namespace where the operator will be installed.
	//  Default: rook-ceph
	Namespace string `json:"namespace" jsonschema:"required,Kubernetes Namespace where the operator will be installed. Default: rook-ceph"`
	// Flag to indicate if the namespace should be created.
	CreateNamespace bool `json:"create_namespace,omitempty" jsonschema:"Flag to indicate if the namespace should be created."`
	// The version of the Rook Ceph Operator Helm chart to deploy.
	//  https://github.com/rook/rook/releases
	//  Default: v1.16.6
	OperatorVersion string `json:"operator_version,omitempty" jsonschema:"The version of the Rook Ceph Operator Helm chart to deploy. https://github.com/rook/rook/releases Default: v1.16.6"`
	// Whether the Helm chart should create and update CRDs.
	//  WARNING: Only set to false during first deployment if managing CRDs independently.
	//  Default: true
	CrdsEnabled bool `json:"crds_enabled,omitempty" jsonschema:"Whether the Helm chart should create and update CRDs. WARNING: Only set to false during first deployment if managing CRDs independently. Default: true"`
	// The container specifications for the Rook Ceph Operator deployment.
	Container *KubernetesRookCephOperatorSpecContainerInput `json:"container" jsonschema:"required,The container specifications for the Rook Ceph Operator deployment."`
	// CSI driver configuration for the Rook Ceph Operator.
	Csi *KubernetesRookCephOperatorCsiSpecInput `json:"csi,omitempty" jsonschema:"CSI driver configuration for the Rook Ceph Operator."`
}

func (s *KubernetesRookCephOperatorSpecInput) validate() error {
	if s.TargetCluster != nil {
		if err := s.TargetCluster.validate(); err != nil {
			return fmt.Errorf("target_cluster: %w", err)
		}
	}
	if s.Namespace == "" {
		return fmt.Errorf("namespace is required")
	}
	if s.Container == nil {
		return fmt.Errorf("container is required")
	}
	if s.Container != nil {
		if err := s.Container.validate(); err != nil {
			return fmt.Errorf("container: %w", err)
		}
	}
	if s.Csi != nil {
		if err := s.Csi.validate(); err != nil {
			return fmt.Errorf("csi: %w", err)
		}
	}
	return nil
}

func (s *KubernetesRookCephOperatorSpecInput) applyDefaults() {
	if s.TargetCluster != nil {
		s.TargetCluster.applyDefaults()
	}
	if s.OperatorVersion == "" {
		s.OperatorVersion = "v1.16.6"
	}
	// default: CrdsEnabled = true (applied at zero-value)
	if s.Container != nil {
		s.Container.applyDefaults()
	}
	if s.Csi != nil {
		s.Csi.applyDefaults()
	}
}

func (s *KubernetesRookCephOperatorSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.TargetCluster != nil {
		m["target_cluster"] = s.TargetCluster.toMap()
	}
	m["namespace"] = s.Namespace
	if s.CreateNamespace {
		m["create_namespace"] = s.CreateNamespace
	}
	if s.OperatorVersion != "" {
		m["operator_version"] = s.OperatorVersion
	}
	if s.CrdsEnabled {
		m["crds_enabled"] = s.CrdsEnabled
	}
	if s.Container != nil {
		m["container"] = s.Container.toMap()
	}
	if s.Csi != nil {
		m["csi"] = s.Csi.toMap()
	}
	return m
}

// **KubernetesRookCephOperatorCsiSpec** configures the Ceph CSI drivers managed by the Rook operator.
//
//	CSI drivers enable Kubernetes to use Ceph for persistent volume claims.
type KubernetesRookCephOperatorCsiSpecInput struct {
	// Enable the Ceph CSI RBD (block storage) driver.
	//  Default: true
	EnableRbdDriver bool `json:"enable_rbd_driver,omitempty" jsonschema:"Enable the Ceph CSI RBD (block storage) driver. Default: true"`
	// Enable the Ceph CSI CephFS (file storage) driver.
	//  Default: true
	EnableCephfsDriver bool `json:"enable_cephfs_driver,omitempty" jsonschema:"Enable the Ceph CSI CephFS (file storage) driver. Default: true"`
	// Disable the CSI driver entirely.
	//  Set to true if you want to use an external CSI driver.
	//  Default: false
	DisableCsiDriver bool `json:"disable_csi_driver,omitempty" jsonschema:"Disable the CSI driver entirely. Set to true if you want to use an external CSI driver. Default: false"`
	// Enable host networking for CSI CephFS and RBD nodeplugins.
	//  May be necessary in some network configurations where the SDN does not
	//  provide access to an external cluster or there is significant drop in read/write performance.
	//  Default: true
	EnableCsiHostNetwork bool `json:"enable_csi_host_network,omitempty" jsonschema:"Enable host networking for CSI CephFS and RBD nodeplugins. May be necessary in some network configurations where the SDN does not provide access to an external cluster or there is significant drop in ..."`
	// Number of replicas for CSI provisioner deployment.
	//  Default: 2
	ProvisionerReplicas int32 `json:"provisioner_replicas,omitempty" jsonschema:"Number of replicas for CSI provisioner deployment. Default: 2"`
	// Enable CSI Addons for additional CSI functionality.
	//  Default: false
	EnableCsiAddons bool `json:"enable_csi_addons,omitempty" jsonschema:"Enable CSI Addons for additional CSI functionality. Default: false"`
	// Enable NFS CSI driver for NFS storage support.
	//  Default: false
	EnableNfsDriver bool `json:"enable_nfs_driver,omitempty" jsonschema:"Enable NFS CSI driver for NFS storage support. Default: false"`
}

func (s *KubernetesRookCephOperatorCsiSpecInput) validate() error {
	return nil
}

func (s *KubernetesRookCephOperatorCsiSpecInput) applyDefaults() {
	// default: EnableRbdDriver = true (applied at zero-value)
	// default: EnableCephfsDriver = true (applied at zero-value)
	// default: EnableCsiHostNetwork = true (applied at zero-value)
	if s.ProvisionerReplicas == 0 {
		s.ProvisionerReplicas = 2
	}
}

func (s *KubernetesRookCephOperatorCsiSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.EnableRbdDriver {
		m["enable_rbd_driver"] = s.EnableRbdDriver
	}
	if s.EnableCephfsDriver {
		m["enable_cephfs_driver"] = s.EnableCephfsDriver
	}
	if s.DisableCsiDriver {
		m["disable_csi_driver"] = s.DisableCsiDriver
	}
	if s.EnableCsiHostNetwork {
		m["enable_csi_host_network"] = s.EnableCsiHostNetwork
	}
	if s.ProvisionerReplicas != 0 {
		m["provisioner_replicas"] = s.ProvisionerReplicas
	}
	if s.EnableCsiAddons {
		m["enable_csi_addons"] = s.EnableCsiAddons
	}
	if s.EnableNfsDriver {
		m["enable_nfs_driver"] = s.EnableNfsDriver
	}
	return m
}

// **KubernetesRookCephOperatorSpecContainer** specifies the container configuration for the Rook Ceph Operator.
//
//	It includes resource allocations for CPU and memory to ensure the operator runs efficiently.
type KubernetesRookCephOperatorSpecContainerInput struct {
	// The CPU and memory resources allocated to the Rook Ceph Operator container.
	Resources *ContainerResourcesInput `json:"resources,omitempty" jsonschema:"The CPU and memory resources allocated to the Rook Ceph Operator container."`
}

func (s *KubernetesRookCephOperatorSpecContainerInput) validate() error {
	if s.Resources != nil {
		if err := s.Resources.validate(); err != nil {
			return fmt.Errorf("resources: %w", err)
		}
	}
	return nil
}

func (s *KubernetesRookCephOperatorSpecContainerInput) applyDefaults() {
	if s.Resources != nil {
		s.Resources.applyDefaults()
	}
}

func (s *KubernetesRookCephOperatorSpecContainerInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Resources != nil {
		m["resources"] = s.Resources.toMap()
	}
	return m
}

// ParseKubernetesRookCephOperator validates and normalizes a KubernetesRookCephOperator cloud_object.
func ParseKubernetesRookCephOperator(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "kubernetes.openmcf.org/v1", "KubernetesRookCephOperator"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec KubernetesRookCephOperatorSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
