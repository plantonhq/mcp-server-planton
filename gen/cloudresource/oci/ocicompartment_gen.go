// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T21:50:49+05:30

package oci

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/gen/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OciCompartment is the top-level resource representing an Oracle Cloud
//
//	Infrastructure compartment for hierarchical resource isolation.
type OciCompartmentSpecInput struct {
	// OCID of the parent compartment where this compartment will be created.
	//  For top-level compartments, this should be the tenancy OCID.
	//  For nested compartments, this is the OCID of the parent compartment.
	CompartmentId string `json:"compartment_id" jsonschema:"required,OCID of the parent compartment where this compartment will be created. For top-level compartments; this should be the tenancy OCID. For nested compartments; this is the OCID of the parent compartment."`
	// Name assigned to the compartment. Must be unique across all compartments
	//  within the parent. This is the identifier shown in the OCI Console and
	//  used in IAM policy statements.
	//  Falls back to metadata.name if not provided.
	Name string `json:"name,omitempty" jsonschema:"Name assigned to the compartment. Must be unique across all compartments within the parent. This is the identifier shown in the OCI Console and used in IAM policy statements. Falls back to metadata.na..."`
	// Description of the compartment's purpose.
	//  Required by the OCI API. Use this to document what resources or teams
	//  the compartment is intended for.
	Description string `json:"description,omitempty" jsonschema:"Description of the compartment's purpose. Required by the OCI API. Use this to document what resources or teams the compartment is intended for."`
	// When true, the compartment will be deleted on resource destruction.
	//  When false (the default), the compartment is retained even after the
	//  IaC resource is destroyed -- this is OCI's safety mechanism to prevent
	//  accidental deletion of compartments containing active resources.
	//  Set to true only for ep...
	EnableDelete bool `json:"enable_delete,omitempty" jsonschema:"When true; the compartment will be deleted on resource destruction. When false (the default); the compartment is retained even after the IaC resource is destroyed -- this is OCI's safety mechanism to ..."`
}

func (s *OciCompartmentSpecInput) validate() error {
	if s.CompartmentId == "" {
		return fmt.Errorf("compartment_id is required")
	}
	return nil
}

func (s *OciCompartmentSpecInput) applyDefaults() {
}

func (s *OciCompartmentSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["compartment_id"] = s.CompartmentId
	if s.Name != "" {
		m["name"] = s.Name
	}
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.EnableDelete {
		m["enable_delete"] = s.EnableDelete
	}
	return m
}

// ParseOciCompartment validates and normalizes a OciCompartment cloud_object.
func ParseOciCompartment(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "oci.openmcf.org/v1", "OciCompartment"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OciCompartmentSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
