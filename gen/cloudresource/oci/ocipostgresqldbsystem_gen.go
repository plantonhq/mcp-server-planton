// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package oci

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OciPostgresqlDbSystem is the top-level resource representing an Oracle Cloud
//
//	Infrastructure PostgreSQL Database System -- a fully managed PostgreSQL
//	service with configurable compute, storage, and backup policies.
type OciPostgresqlDbSystemSpecInput struct {
	// OCID of the compartment where the PostgreSQL DB System will be created.
	CompartmentId string `json:"compartment_id" jsonschema:"required,OCID of the compartment where the PostgreSQL DB System will be created."`
	// Human-readable name shown in the OCI Console.
	//  Falls back to metadata.name if not provided.
	DisplayName string `json:"display_name,omitempty" jsonschema:"Human-readable name shown in the OCI Console. Falls back to metadata.name if not provided."`
	// PostgreSQL major version (e.g. "14", "15", "16").
	//  Only the major version is stored; minor versions are managed by OCI.
	//  Changing this forces recreation.
	DbVersion string `json:"db_version,omitempty" jsonschema:"PostgreSQL major version (e.g. '14'; '15'; '16'). Only the major version is stored; minor versions are managed by OCI. Changing this forces recreation."`
	// Compute shape for the DB System instances. The provider automatically
	//  prefixes "PostgreSQL." if not present. For flexible shapes, set
	//  instance_ocpu_count and instance_memory_size_in_gbs separately.
	//  Example: "VM.Standard.E4.Flex".
	Shape string `json:"shape,omitempty" jsonschema:"Compute shape for the DB System instances. The provider automatically prefixes 'PostgreSQL.' if not present. For flexible shapes; set instance_ocpu_count and instance_memory_size_in_gbs separately. Ex..."`
	// Number of OCPUs allocated to each database instance. Used with
	//  flexible shapes (e.g. VM.Standard.E4.Flex). Updatable.
	InstanceOcpuCount int32 `json:"instance_ocpu_count,omitempty" jsonschema:"Number of OCPUs allocated to each database instance. Used with flexible shapes (e.g. VM.Standard.E4.Flex). Updatable."`
	// Amount of memory in gigabytes allocated to each database instance.
	//  Used with flexible shapes. Updatable.
	InstanceMemorySizeInGbs int32 `json:"instance_memory_size_in_gbs,omitempty" jsonschema:"Amount of memory in gigabytes allocated to each database instance. Used with flexible shapes. Updatable."`
	// Number of database instances (nodes). 1 creates a standalone system;
	//  2 or more creates read replicas for read scaling and availability.
	InstanceCount int32 `json:"instance_count,omitempty" jsonschema:"Number of database instances (nodes). 1 creates a standalone system; 2 or more creates read replicas for read scaling and availability."`
	// Network configuration for the DB System. Required.
	NetworkDetails *NetworkDetailsInput `json:"network_details" jsonschema:"required,Network configuration for the DB System. Required."`
	// Storage configuration for the DB System. Required.
	StorageDetails *StorageDetailsInput `json:"storage_details" jsonschema:"required,Storage configuration for the DB System. Required."`
	// Initial database credentials. When omitted, the provider applies
	//  defaults. The entire credentials block is immutable after creation
	//  (changing it forces recreation).
	Credentials *CredentialsInput `json:"credentials,omitempty" jsonschema:"Initial database credentials. When omitted; the provider applies defaults. The entire credentials block is immutable after creation (changing it forces recreation)."`
	// Management policy controlling backup schedule and maintenance window.
	ManagementPolicy *ManagementPolicyInput `json:"management_policy,omitempty" jsonschema:"Management policy controlling backup schedule and maintenance window."`
	// OCID of a PostgreSQL configuration to apply. Configurations define
	//  server parameter settings (shared_buffers, max_connections, etc.).
	//  When omitted, the default configuration for the shape is used.
	ConfigId string `json:"config_id,omitempty" jsonschema:"OCID of a PostgreSQL configuration to apply. Configurations define server parameter settings (shared_buffers; max_connections; etc.). When omitted; the default configuration for the shape is used."`
	// User-provided description of the DB System.
	Description string `json:"description,omitempty" jsonschema:"User-provided description of the DB System."`
	// Per-instance configuration details. When specified, the list size
	//  must match instance_count. Allows pinning display names, descriptions,
	//  and private IP addresses per instance. Changing this forces recreation.
	InstancesDetails []*InstanceDetailsInput `json:"instances_details,omitempty" jsonschema:"Per-instance configuration details. When specified; the list size must match instance_count. Allows pinning display names; descriptions; and private IP addresses per instance. Changing this forces rec..."`
}

func (s *OciPostgresqlDbSystemSpecInput) validate() error {
	if s.CompartmentId == "" {
		return fmt.Errorf("compartment_id is required")
	}
	if s.NetworkDetails == nil {
		return fmt.Errorf("network_details is required")
	}
	if s.NetworkDetails != nil {
		if err := s.NetworkDetails.validate(); err != nil {
			return fmt.Errorf("network_details: %w", err)
		}
	}
	if s.StorageDetails == nil {
		return fmt.Errorf("storage_details is required")
	}
	if s.StorageDetails != nil {
		if err := s.StorageDetails.validate(); err != nil {
			return fmt.Errorf("storage_details: %w", err)
		}
	}
	if s.Credentials != nil {
		if err := s.Credentials.validate(); err != nil {
			return fmt.Errorf("credentials: %w", err)
		}
	}
	if s.ManagementPolicy != nil {
		if err := s.ManagementPolicy.validate(); err != nil {
			return fmt.Errorf("management_policy: %w", err)
		}
	}
	for i, v := range s.InstancesDetails {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("instances_details[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *OciPostgresqlDbSystemSpecInput) applyDefaults() {
	if s.NetworkDetails != nil {
		s.NetworkDetails.applyDefaults()
	}
	if s.StorageDetails != nil {
		s.StorageDetails.applyDefaults()
	}
	if s.Credentials != nil {
		s.Credentials.applyDefaults()
	}
	if s.ManagementPolicy != nil {
		s.ManagementPolicy.applyDefaults()
	}
}

func (s *OciPostgresqlDbSystemSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["compartment_id"] = s.CompartmentId
	if s.DisplayName != "" {
		m["display_name"] = s.DisplayName
	}
	if s.DbVersion != "" {
		m["db_version"] = s.DbVersion
	}
	if s.Shape != "" {
		m["shape"] = s.Shape
	}
	if s.InstanceOcpuCount != 0 {
		m["instance_ocpu_count"] = s.InstanceOcpuCount
	}
	if s.InstanceMemorySizeInGbs != 0 {
		m["instance_memory_size_in_gbs"] = s.InstanceMemorySizeInGbs
	}
	if s.InstanceCount != 0 {
		m["instance_count"] = s.InstanceCount
	}
	if s.NetworkDetails != nil {
		m["network_details"] = s.NetworkDetails.toMap()
	}
	if s.StorageDetails != nil {
		m["storage_details"] = s.StorageDetails.toMap()
	}
	if s.Credentials != nil {
		m["credentials"] = s.Credentials.toMap()
	}
	if s.ManagementPolicy != nil {
		m["management_policy"] = s.ManagementPolicy.toMap()
	}
	if s.ConfigId != "" {
		m["config_id"] = s.ConfigId
	}
	if s.Description != "" {
		m["description"] = s.Description
	}
	if len(s.InstancesDetails) > 0 {
		items := make([]any, len(s.InstancesDetails))
		for i, v := range s.InstancesDetails {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["instances_details"] = items
	}
	return m
}

// Credentials configures the initial database administrator account.
//
//	The entire block is immutable after creation.
type CredentialsInput struct {
	// Administrator username. Changing this forces recreation.
	Username string `json:"username,omitempty" jsonschema:"Administrator username. Changing this forces recreation."`
	// Password configuration using either a plain-text password or
	//  an OCI Vault secret reference.
	PasswordDetails *PasswordDetailsInput `json:"password_details" jsonschema:"required,Password configuration using either a plain-text password or an OCI Vault secret reference."`
}

func (s *CredentialsInput) validate() error {
	if s.PasswordDetails == nil {
		return fmt.Errorf("password_details is required")
	}
	if s.PasswordDetails != nil {
		if err := s.PasswordDetails.validate(); err != nil {
			return fmt.Errorf("password_details: %w", err)
		}
	}
	return nil
}

func (s *CredentialsInput) applyDefaults() {
	if s.PasswordDetails != nil {
		s.PasswordDetails.applyDefaults()
	}
}

func (s *CredentialsInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Username != "" {
		m["username"] = s.Username
	}
	if s.PasswordDetails != nil {
		m["password_details"] = s.PasswordDetails.toMap()
	}
	return m
}

// InstanceDetails configures per-instance properties. When provided,
//
//	the list size should match instance_count. All fields in this message
//	are immutable after creation.
type InstanceDetailsInput struct {
	// Display name for this database instance node.
	DisplayName string `json:"display_name,omitempty" jsonschema:"Display name for this database instance node."`
	// Description of this database instance node.
	Description string `json:"description,omitempty" jsonschema:"Description of this database instance node."`
	// Specific private IP address for this instance within the subnet.
	//  When omitted, OCI auto-assigns an available IP.
	PrivateIp string `json:"private_ip,omitempty" jsonschema:"Specific private IP address for this instance within the subnet. When omitted; OCI auto-assigns an available IP."`
}

func (s *InstanceDetailsInput) validate() error {
	return nil
}

func (s *InstanceDetailsInput) applyDefaults() {
}

func (s *InstanceDetailsInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.DisplayName != "" {
		m["display_name"] = s.DisplayName
	}
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.PrivateIp != "" {
		m["private_ip"] = s.PrivateIp
	}
	return m
}

// ManagementPolicy configures backup scheduling and maintenance windows.
type ManagementPolicyInput struct {
	// Backup policy for the DB System.
	BackupPolicy *BackupPolicyInput `json:"backup_policy,omitempty" jsonschema:"Backup policy for the DB System."`
	// Start of the maintenance window in UTC. Format:
	//  "{day-of-week} {time-of-day}" (e.g. "tue 02:00:00").
	MaintenanceWindowStart string `json:"maintenance_window_start,omitempty" jsonschema:"Start of the maintenance window in UTC. Format: '{day-of-week} {time-of-day}' (e.g. 'tue 02:00:00')."`
}

func (s *ManagementPolicyInput) validate() error {
	if s.BackupPolicy != nil {
		if err := s.BackupPolicy.validate(); err != nil {
			return fmt.Errorf("backup_policy: %w", err)
		}
	}
	return nil
}

func (s *ManagementPolicyInput) applyDefaults() {
	if s.BackupPolicy != nil {
		s.BackupPolicy.applyDefaults()
	}
}

func (s *ManagementPolicyInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.BackupPolicy != nil {
		m["backup_policy"] = s.BackupPolicy.toMap()
	}
	if s.MaintenanceWindowStart != "" {
		m["maintenance_window_start"] = s.MaintenanceWindowStart
	}
	return m
}

// PasswordDetails configures the database administrator password.
//
//	Uses a discriminator pattern: set password_type to select between
//	plain-text and Vault secret approaches.
type PasswordDetailsInput struct {
	// Password type discriminator.
	PasswordType string `json:"password_type,omitempty" jsonschema:"enum=plain_text|vault_secret,Password type discriminator."`
	// Database password in plain text. Required when password_type
	//  is plain_text. Not returned by the API after creation.
	Password string `json:"password,omitempty" jsonschema:"Database password in plain text. Required when password_type is plain_text. Not returned by the API after creation."`
	// OCID of the OCI Vault secret containing the password.
	//  Required when password_type is vault_secret.
	SecretId string `json:"secret_id,omitempty" jsonschema:"OCID of the OCI Vault secret containing the password. Required when password_type is vault_secret."`
	// Version of the Vault secret to use. When omitted, the latest
	//  version is used.
	SecretVersion string `json:"secret_version,omitempty" jsonschema:"Version of the Vault secret to use. When omitted; the latest version is used."`
}

func (s *PasswordDetailsInput) validate() error {
	switch s.PasswordType {
	case "", "plain_text", "vault_secret":
	default:
		return fmt.Errorf("invalid password_type: %q", s.PasswordType)
	}
	return nil
}

func (s *PasswordDetailsInput) applyDefaults() {
}

func (s *PasswordDetailsInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.PasswordType != "" {
		m["password_type"] = s.PasswordType
	}
	if s.Password != "" {
		m["password"] = s.Password
	}
	if s.SecretId != "" {
		m["secret_id"] = s.SecretId
	}
	if s.SecretVersion != "" {
		m["secret_version"] = s.SecretVersion
	}
	return m
}

// StorageDetails configures the storage backend for the DB System.
//
//	The storage system_type is hardcoded to OCI_OPTIMIZED_STORAGE in IaC
//	modules (the only valid value today).
type StorageDetailsInput struct {
	// When true, data is replicated across multiple availability domains
	//  for regional durability. When false, data resides in a single AD
	//  and availability_domain must be specified. Changing this forces
	//  recreation.
	IsRegionallyDurable bool `json:"is_regionally_durable,omitempty" jsonschema:"When true; data is replicated across multiple availability domains for regional durability. When false; data resides in a single AD and availability_domain must be specified. Changing this forces recr..."`
	// Availability domain for AD-local storage. Required when
	//  is_regionally_durable is false. Ignored when is_regionally_durable
	//  is true. Example: "Uocm:PHX-AD-1". Changing this forces recreation.
	AvailabilityDomain string `json:"availability_domain,omitempty" jsonschema:"Availability domain for AD-local storage. Required when is_regionally_durable is false. Ignored when is_regionally_durable is true. Example: 'Uocm:PHX-AD-1'. Changing this forces recreation."`
	// Guaranteed input/output storage requests per second (IOPS).
	//  Determines the performance tier. See OCI documentation for
	//  supported values per shape. Updatable.
	Iops int64 `json:"iops,omitempty" jsonschema:"Guaranteed input/output storage requests per second (IOPS). Determines the performance tier. See OCI documentation for supported values per shape. Updatable."`
}

func (s *StorageDetailsInput) validate() error {
	return nil
}

func (s *StorageDetailsInput) applyDefaults() {
}

func (s *StorageDetailsInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.IsRegionallyDurable {
		m["is_regionally_durable"] = s.IsRegionallyDurable
	}
	if s.AvailabilityDomain != "" {
		m["availability_domain"] = s.AvailabilityDomain
	}
	if s.Iops != 0 {
		m["iops"] = s.Iops
	}
	return m
}

// ParseOciPostgresqlDbSystem validates and normalizes a OciPostgresqlDbSystem cloud_object.
func ParseOciPostgresqlDbSystem(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "oci.openmcf.org/v1", "OciPostgresqlDbSystem"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OciPostgresqlDbSystemSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
