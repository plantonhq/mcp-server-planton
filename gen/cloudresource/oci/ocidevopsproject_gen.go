// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package oci

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OciDevopsProject is the top-level resource representing an OCI
//
//	DevOps Project -- the organizational container for CI/CD pipelines,
//	code repositories, artifacts, and triggers.
type OciDevopsProjectSpecInput struct {
	// OCID of the compartment where the project will be created.
	CompartmentId string `json:"compartment_id" jsonschema:"required,OCID of the compartment where the project will be created."`
	// OCID of the ONS (Oracle Notification Service) topic that receives
	//  DevOps pipeline events such as build completions, deployment
	//  successes, and failures. Required by the OCI API.
	//
	//  Flattened from the provider's notification_config.topic_id block.
	NotificationTopicId string `json:"notification_topic_id" jsonschema:"required,OCID of the ONS (Oracle Notification Service) topic that receives DevOps pipeline events such as build completions; deployment successes; and failures. Required by the OCI API. Flattened from the prov..."`
	// Human-readable description of the project's purpose.
	Description string `json:"description,omitempty" jsonschema:"Human-readable description of the project's purpose."`
}

func (s *OciDevopsProjectSpecInput) validate() error {
	if s.CompartmentId == "" {
		return fmt.Errorf("compartment_id is required")
	}
	if s.NotificationTopicId == "" {
		return fmt.Errorf("notification_topic_id is required")
	}
	return nil
}

func (s *OciDevopsProjectSpecInput) applyDefaults() {
}

func (s *OciDevopsProjectSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["compartment_id"] = s.CompartmentId
	m["notification_topic_id"] = s.NotificationTopicId
	if s.Description != "" {
		m["description"] = s.Description
	}
	return m
}

// ParseOciDevopsProject validates and normalizes a OciDevopsProject cloud_object.
func ParseOciDevopsProject(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "oci.openmcf.org/v1", "OciDevopsProject"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OciDevopsProjectSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
