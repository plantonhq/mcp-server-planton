// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package oci

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OciQueue is the top-level resource representing an OCI Queue -- a
//
//	fully managed, serverless message queue for asynchronous
//	communication between decoupled services.
type OciQueueSpecInput struct {
	// OCID of the compartment where the queue will be created.
	CompartmentId string `json:"compartment_id" jsonschema:"required,OCID of the compartment where the queue will be created."`
	// OCID of the custom encryption key for encrypting message content.
	//  When omitted, Oracle-managed encryption is used.
	CustomEncryptionKeyId string `json:"custom_encryption_key_id,omitempty" jsonschema:"OCID of the custom encryption key for encrypting message content. When omitted; Oracle-managed encryption is used."`
	// Number of delivery attempts before a message is moved to the dead
	//  letter queue. A value of 0 disables the DLQ. When omitted, OCI
	//  applies its default.
	DeadLetterQueueDeliveryCount int32 `json:"dead_letter_queue_delivery_count,omitempty" jsonschema:"Number of delivery attempts before a message is moved to the dead letter queue. A value of 0 disables the DLQ. When omitted; OCI applies its default."`
	// Retention period for messages in seconds. ForceNew -- changing this
	//  value forces queue recreation. When omitted, OCI applies its
	//  default (604800 seconds / 7 days).
	RetentionInSeconds int32 `json:"retention_in_seconds,omitempty" jsonschema:"Retention period for messages in seconds. ForceNew -- changing this value forces queue recreation. When omitted; OCI applies its default (604800 seconds / 7 days)."`
	// Default polling timeout for GetMessages calls, in seconds.
	//  When omitted, OCI applies its default.
	TimeoutInSeconds int32 `json:"timeout_in_seconds,omitempty" jsonschema:"Default polling timeout for GetMessages calls; in seconds. When omitted; OCI applies its default."`
	// Default visibility timeout for consumed messages, in seconds.
	//  A consumed message is invisible to other consumers for this
	//  duration. When omitted, OCI applies its default.
	VisibilityInSeconds int32 `json:"visibility_in_seconds,omitempty" jsonschema:"Default visibility timeout for consumed messages; in seconds. A consumed message is invisible to other consumers for this duration. When omitted; OCI applies its default."`
	// Percentage of allocated queue resources that can be consumed by a
	//  single channel. Both Terraform and Pulumi providers type this as
	//  integer; consult OCI documentation for the valid range and scale.
	//  When omitted, OCI applies its default (no per-channel limit).
	ChannelConsumptionLimit int32 `json:"channel_consumption_limit,omitempty" jsonschema:"Percentage of allocated queue resources that can be consumed by a single channel. Both Terraform and Pulumi providers type this as integer; consult OCI documentation for the valid range and scale. Whe..."`
	// Enable large message support (up to 512 KB per message).
	//  When omitted or false, standard message size limits apply.
	//  Maps to the LARGE_MESSAGES capability in the OCI API.
	IsLargeMessagesEnabled bool `json:"is_large_messages_enabled,omitempty" jsonschema:"Enable large message support (up to 512 KB per message). When omitted or false; standard message size limits apply. Maps to the LARGE_MESSAGES capability in the OCI API."`
	// Consumer group configuration. When provided, the CONSUMER_GROUPS
	//  capability is enabled for this queue, allowing partitioned
	//  consumption patterns.
	ConsumerGroupConfig *ConsumerGroupConfigInput `json:"consumer_group_config,omitempty" jsonschema:"Consumer group configuration. When provided; the CONSUMER_GROUPS capability is enabled for this queue; allowing partitioned consumption patterns."`
}

func (s *OciQueueSpecInput) validate() error {
	if s.CompartmentId == "" {
		return fmt.Errorf("compartment_id is required")
	}
	if s.ConsumerGroupConfig != nil {
		if err := s.ConsumerGroupConfig.validate(); err != nil {
			return fmt.Errorf("consumer_group_config: %w", err)
		}
	}
	return nil
}

func (s *OciQueueSpecInput) applyDefaults() {
	if s.ConsumerGroupConfig != nil {
		s.ConsumerGroupConfig.applyDefaults()
	}
}

func (s *OciQueueSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["compartment_id"] = s.CompartmentId
	if s.CustomEncryptionKeyId != "" {
		m["custom_encryption_key_id"] = s.CustomEncryptionKeyId
	}
	if s.DeadLetterQueueDeliveryCount != 0 {
		m["dead_letter_queue_delivery_count"] = s.DeadLetterQueueDeliveryCount
	}
	if s.RetentionInSeconds != 0 {
		m["retention_in_seconds"] = s.RetentionInSeconds
	}
	if s.TimeoutInSeconds != 0 {
		m["timeout_in_seconds"] = s.TimeoutInSeconds
	}
	if s.VisibilityInSeconds != 0 {
		m["visibility_in_seconds"] = s.VisibilityInSeconds
	}
	if s.ChannelConsumptionLimit != 0 {
		m["channel_consumption_limit"] = s.ChannelConsumptionLimit
	}
	if s.IsLargeMessagesEnabled {
		m["is_large_messages_enabled"] = s.IsLargeMessagesEnabled
	}
	if s.ConsumerGroupConfig != nil {
		m["consumer_group_config"] = s.ConsumerGroupConfig.toMap()
	}
	return m
}

// ConsumerGroupConfig controls the primary consumer group created
//
//	when the CONSUMER_GROUPS capability is added to the queue.
type ConsumerGroupConfigInput struct {
	// Whether to automatically enable the primary consumer group
	//  after adding the capability.
	IsPrimaryEnabled bool `json:"is_primary_enabled,omitempty" jsonschema:"Whether to automatically enable the primary consumer group after adding the capability."`
	// Dead letter queue delivery count for the primary consumer group.
	//  Overrides the queue-level dead_letter_queue_delivery_count.
	//  A value of 0 disables the DLQ for this consumer group.
	PrimaryDeadLetterQueueDeliveryCount int32 `json:"primary_dead_letter_queue_delivery_count,omitempty" jsonschema:"Dead letter queue delivery count for the primary consumer group. Overrides the queue-level dead_letter_queue_delivery_count. A value of 0 disables the DLQ for this consumer group."`
	// Display name for the primary consumer group.
	//  When omitted, OCI defaults to "Primary Consumer Group".
	PrimaryDisplayName string `json:"primary_display_name,omitempty" jsonschema:"Display name for the primary consumer group. When omitted; OCI defaults to 'Primary Consumer Group'."`
}

func (s *ConsumerGroupConfigInput) validate() error {
	return nil
}

func (s *ConsumerGroupConfigInput) applyDefaults() {
}

func (s *ConsumerGroupConfigInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.IsPrimaryEnabled {
		m["is_primary_enabled"] = s.IsPrimaryEnabled
	}
	if s.PrimaryDeadLetterQueueDeliveryCount != 0 {
		m["primary_dead_letter_queue_delivery_count"] = s.PrimaryDeadLetterQueueDeliveryCount
	}
	if s.PrimaryDisplayName != "" {
		m["primary_display_name"] = s.PrimaryDisplayName
	}
	return m
}

// ParseOciQueue validates and normalizes a OciQueue cloud_object.
func ParseOciQueue(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "oci.openmcf.org/v1", "OciQueue"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OciQueueSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
