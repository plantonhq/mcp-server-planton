// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package oci

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// OciBastion is the top-level resource representing an OCI Bastion
//
//	that provides secure, time-limited access to private subnet resources.
type OciBastionSpecInput struct {
	// OCID of the compartment where the bastion will be created.
	CompartmentId string `json:"compartment_id" jsonschema:"required,OCID of the compartment where the bastion will be created."`
	// OCID of the subnet that the bastion connects to. The bastion
	//  creates a private endpoint in this subnet. Immutable after creation.
	TargetSubnetId string `json:"target_subnet_id" jsonschema:"required,OCID of the subnet that the bastion connects to. The bastion creates a private endpoint in this subnet. Immutable after creation."`
	// Display name for the bastion. When omitted, the metadata name is used.
	//  Immutable after creation.
	DisplayName string `json:"display_name,omitempty" jsonschema:"Display name for the bastion. When omitted; the metadata name is used. Immutable after creation."`
	// CIDR ranges allowed to connect to sessions hosted by this bastion.
	//  Example: ["10.0.0.0/16", "192.168.1.0/24"]. Updatable after creation.
	ClientCidrBlockAllowList []string `json:"client_cidr_block_allow_list,omitempty" jsonschema:"CIDR ranges allowed to connect to sessions hosted by this bastion. Example: ['10.0.0.0/16'; '192.168.1.0/24']. Updatable after creation."`
	// Maximum TTL in seconds for any session on this bastion.
	//  When omitted, the OCI default applies (10800 = 3 hours).
	//  Updatable after creation.
	MaxSessionTtlInSeconds int32 `json:"max_session_ttl_in_seconds,omitempty" jsonschema:"Maximum TTL in seconds for any session on this bastion. When omitted; the OCI default applies (10800 = 3 hours). Updatable after creation."`
	// Enable FQDN and SOCKS5 proxy support on the bastion.
	//  When true, sessions can use DNS names to reach targets.
	//  Immutable after creation. When omitted, defaults to disabled.
	IsDnsProxyEnabled bool `json:"is_dns_proxy_enabled,omitempty" jsonschema:"Enable FQDN and SOCKS5 proxy support on the bastion. When true; sessions can use DNS names to reach targets. Immutable after creation. When omitted; defaults to disabled."`
}

func (s *OciBastionSpecInput) validate() error {
	if s.CompartmentId == "" {
		return fmt.Errorf("compartment_id is required")
	}
	if s.TargetSubnetId == "" {
		return fmt.Errorf("target_subnet_id is required")
	}
	return nil
}

func (s *OciBastionSpecInput) applyDefaults() {
}

func (s *OciBastionSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["compartment_id"] = s.CompartmentId
	m["target_subnet_id"] = s.TargetSubnetId
	if s.DisplayName != "" {
		m["display_name"] = s.DisplayName
	}
	if len(s.ClientCidrBlockAllowList) > 0 {
		m["client_cidr_block_allow_list"] = s.ClientCidrBlockAllowList
	}
	if s.MaxSessionTtlInSeconds != 0 {
		m["max_session_ttl_in_seconds"] = s.MaxSessionTtlInSeconds
	}
	if s.IsDnsProxyEnabled {
		m["is_dns_proxy_enabled"] = s.IsDnsProxyEnabled
	}
	return m
}

// ParseOciBastion validates and normalizes a OciBastion cloud_object.
func ParseOciBastion(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "oci.openmcf.org/v1", "OciBastion"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec OciBastionSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
