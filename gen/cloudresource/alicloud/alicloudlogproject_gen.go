// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package alicloud

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// alicloud-log-project
type AliCloudLogProjectSpecInput struct {
	// Alibaba Cloud region where the SLS project will be created.
	//  Examples: "cn-hangzhou", "cn-shanghai", "us-west-1", "ap-southeast-1".
	Region string `json:"region" jsonschema:"required,Alibaba Cloud region where the SLS project will be created. Examples: 'cn-hangzhou'; 'cn-shanghai'; 'us-west-1'; 'ap-southeast-1'."`
	// SLS project name. Must be globally unique within Alibaba Cloud.
	//  3-63 characters, lowercase letters, digits, and hyphens only.
	//  Must start and end with a letter or digit.
	ProjectName string `json:"project_name" jsonschema:"required,SLS project name. Must be globally unique within Alibaba Cloud. 3-63 characters; lowercase letters; digits; and hyphens only. Must start and end with a letter or digit."`
	// Human-readable description of the project.
	Description string `json:"description,omitempty" jsonschema:"Human-readable description of the project."`
	// Alibaba Cloud resource group ID for organizational grouping (per DD05).
	//  If omitted, the project is placed in the account's default resource group.
	ResourceGroupId string `json:"resource_group_id,omitempty" jsonschema:"Alibaba Cloud resource group ID for organizational grouping (per DD05). If omitted; the project is placed in the account's default resource group."`
	// Tags to apply to the SLS project.
	Tags map[string]string `json:"tags,omitempty" jsonschema:"Tags to apply to the SLS project."`
	// Log stores to create within this project.
	//  Each log store is an independent unit of log collection and storage.
	LogStores []*AliCloudLogStoreInput `json:"log_stores,omitempty" jsonschema:"Log stores to create within this project. Each log store is an independent unit of log collection and storage."`
}

func (s *AliCloudLogProjectSpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	if s.ProjectName == "" {
		return fmt.Errorf("project_name is required")
	}
	for i, v := range s.LogStores {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("log_stores[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *AliCloudLogProjectSpecInput) applyDefaults() {
}

func (s *AliCloudLogProjectSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	m["project_name"] = s.ProjectName
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.ResourceGroupId != "" {
		m["resource_group_id"] = s.ResourceGroupId
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if len(s.LogStores) > 0 {
		items := make([]any, len(s.LogStores))
		for i, v := range s.LogStores {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["log_stores"] = items
	}
	return m
}

// AliCloudLogStore defines a log store within an SLS project.
//
//	A log store is the basic unit for collecting, storing, and querying log data.
type AliCloudLogStoreInput struct {
	// Log store name. Must be unique within the project.
	//  3-63 characters, lowercase letters, digits, hyphens, and underscores.
	Name string `json:"name" jsonschema:"required,Log store name. Must be unique within the project. 3-63 characters; lowercase letters; digits; hyphens; and underscores."`
	// Data retention period in days. Range: 1-3650.
	//  Set to 3650 for permanent retention.
	//  Default: 30
	RetentionDays int32 `json:"retention_days,omitempty" jsonschema:"Data retention period in days. Range: 1-3650. Set to 3650 for permanent retention. Default: 30"`
	// Number of shards for the log store. More shards = higher write throughput.
	//  Default: 2
	ShardCount int32 `json:"shard_count,omitempty" jsonschema:"Number of shards for the log store. More shards = higher write throughput. Default: 2"`
	// Enable automatic shard splitting when write throughput exceeds shard capacity.
	//  Default: true
	AutoSplit bool `json:"auto_split,omitempty" jsonschema:"Enable automatic shard splitting when write throughput exceeds shard capacity. Default: true"`
	// Maximum number of shards after auto-splitting. Only effective when auto_split is true.
	//  Default: 64
	MaxSplitShardCount int32 `json:"max_split_shard_count,omitempty" jsonschema:"Maximum number of shards after auto-splitting. Only effective when auto_split is true. Default: 64"`
	// Create a full-text search index for this log store.
	//  When true, a default full-text index is created with case-insensitive matching
	//  and standard tokenization, making logs immediately searchable.
	//  Default: true
	EnableIndex bool `json:"enable_index,omitempty" jsonschema:"Create a full-text search index for this log store. When true; a default full-text index is created with case-insensitive matching and standard tokenization; making logs immediately searchable. Defaul..."`
	// Automatically append log receive time and client IP as metadata fields.
	//  Default: true
	AppendMeta bool `json:"append_meta,omitempty" jsonschema:"Automatically append log receive time and client IP as metadata fields. Default: true"`
}

func (s *AliCloudLogStoreInput) validate() error {
	if s.Name == "" {
		return fmt.Errorf("name is required")
	}
	return nil
}

func (s *AliCloudLogStoreInput) applyDefaults() {
	if s.RetentionDays == 0 {
		s.RetentionDays = 30
	}
	if s.ShardCount == 0 {
		s.ShardCount = 2
	}
	// default: AutoSplit = true (applied at zero-value)
	if s.MaxSplitShardCount == 0 {
		s.MaxSplitShardCount = 64
	}
	// default: EnableIndex = true (applied at zero-value)
	// default: AppendMeta = true (applied at zero-value)
}

func (s *AliCloudLogStoreInput) toMap() map[string]any {
	m := make(map[string]any)
	m["name"] = s.Name
	if s.RetentionDays != 0 {
		m["retention_days"] = s.RetentionDays
	}
	if s.ShardCount != 0 {
		m["shard_count"] = s.ShardCount
	}
	if s.AutoSplit {
		m["auto_split"] = s.AutoSplit
	}
	if s.MaxSplitShardCount != 0 {
		m["max_split_shard_count"] = s.MaxSplitShardCount
	}
	if s.EnableIndex {
		m["enable_index"] = s.EnableIndex
	}
	if s.AppendMeta {
		m["append_meta"] = s.AppendMeta
	}
	return m
}

// ParseAliCloudLogProject validates and normalizes a AliCloudLogProject cloud_object.
func ParseAliCloudLogProject(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "ali-cloud.openmcf.org/v1", "AliCloudLogProject"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AliCloudLogProjectSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
