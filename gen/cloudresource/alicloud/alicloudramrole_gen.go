// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package alicloud

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// alicloud-ram-role
type AliCloudRamRoleSpecInput struct {
	// Alibaba Cloud region for provider endpoint configuration.
	//  RAM is a global service, but the provider requires a region for API routing.
	//  Examples: "cn-hangzhou", "cn-shanghai", "us-west-1", "ap-southeast-1".
	Region string `json:"region" jsonschema:"required,Alibaba Cloud region for provider endpoint configuration. RAM is a global service; but the provider requires a region for API routing. Examples: 'cn-hangzhou'; 'cn-shanghai'; 'us-west-1'; 'ap-southeas..."`
	// RAM role name. Must be unique within the Alibaba Cloud account.
	//  1-64 characters: letters, digits, periods (.), hyphens (-), and underscores (_).
	RoleName string `json:"role_name" jsonschema:"required,RAM role name. Must be unique within the Alibaba Cloud account. 1-64 characters: letters; digits; periods (.); hyphens (-); and underscores (_)."`
	// Human-readable description of the role's purpose.
	Description string `json:"description,omitempty" jsonschema:"Human-readable description of the role's purpose."`
	// JSON trust policy document defining which principals can assume this role.
	//  This controls who can call sts:AssumeRole to obtain temporary credentials.
	//
	//  Example for allowing ECS service to assume the role:
	//    {"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow",
	//     "Principal":{"Service":["ecs...
	AssumeRolePolicyDocument string `json:"assume_role_policy_document" jsonschema:"required,JSON trust policy document defining which principals can assume this role. This controls who can call sts:AssumeRole to obtain temporary credentials. Example for allowing ECS service to assume the rol..."`
	// Maximum session duration in seconds when assuming this role via STS.
	//  Longer durations are useful for CI/CD pipelines and batch workloads.
	//  Range: 3600-43200 (1 hour to 12 hours).
	//  Default: 3600
	MaxSessionDuration int32 `json:"max_session_duration,omitempty" jsonschema:"Maximum session duration in seconds when assuming this role via STS. Longer durations are useful for CI/CD pipelines and batch workloads. Range: 3600-43200 (1 hour to 12 hours). Default: 3600"`
	// Tags applied to the RAM role for organizational and cost-tracking purposes.
	Tags map[string]string `json:"tags,omitempty" jsonschema:"Tags applied to the RAM role for organizational and cost-tracking purposes."`
	// Force-detach all attached policies before deleting the role.
	//  When false (default), deletion fails if policies are still attached.
	//  Default: false
	Force bool `json:"force,omitempty" jsonschema:"Force-detach all attached policies before deleting the role. When false (default); deletion fails if policies are still attached. Default: false"`
	// Policies to attach to this role. Each attachment grants the role a set
	//  of permissions defined by either a system-managed or custom policy.
	PolicyAttachments []*AliCloudRamRolePolicyAttachmentInput `json:"policy_attachments,omitempty" jsonschema:"Policies to attach to this role. Each attachment grants the role a set of permissions defined by either a system-managed or custom policy."`
}

func (s *AliCloudRamRoleSpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	if s.RoleName == "" {
		return fmt.Errorf("role_name is required")
	}
	if s.AssumeRolePolicyDocument == "" {
		return fmt.Errorf("assume_role_policy_document is required")
	}
	for i, v := range s.PolicyAttachments {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("policy_attachments[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *AliCloudRamRoleSpecInput) applyDefaults() {
	if s.MaxSessionDuration == 0 {
		s.MaxSessionDuration = 3600
	}
}

func (s *AliCloudRamRoleSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	m["role_name"] = s.RoleName
	if s.Description != "" {
		m["description"] = s.Description
	}
	m["assume_role_policy_document"] = s.AssumeRolePolicyDocument
	if s.MaxSessionDuration != 0 {
		m["max_session_duration"] = s.MaxSessionDuration
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if s.Force {
		m["force"] = s.Force
	}
	if len(s.PolicyAttachments) > 0 {
		items := make([]any, len(s.PolicyAttachments))
		for i, v := range s.PolicyAttachments {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["policy_attachments"] = items
	}
	return m
}

// AliCloudRamRolePolicyAttachment defines a policy to attach to the RAM role.
type AliCloudRamRolePolicyAttachmentInput struct {
	// Name of the policy to attach.
	//  System policies: "AliyunECSFullAccess", "AliyunOSSReadOnlyAccess", etc.
	//  Custom policies: the name you gave when creating the policy.
	PolicyName string `json:"policy_name" jsonschema:"required,Name of the policy to attach. System policies: 'AliyunECSFullAccess'; 'AliyunOSSReadOnlyAccess'; etc. Custom policies: the name you gave when creating the policy."`
	// Policy type: "System" for Alibaba Cloud managed policies,
	//  "Custom" for user-created policies.
	//  Default: "System"
	PolicyType string `json:"policy_type,omitempty" jsonschema:"Policy type: 'System' for Alibaba Cloud managed policies; 'Custom' for user-created policies. Default: 'System'"`
}

func (s *AliCloudRamRolePolicyAttachmentInput) validate() error {
	if s.PolicyName == "" {
		return fmt.Errorf("policy_name is required")
	}
	return nil
}

func (s *AliCloudRamRolePolicyAttachmentInput) applyDefaults() {
	if s.PolicyType == "" {
		s.PolicyType = "System"
	}
}

func (s *AliCloudRamRolePolicyAttachmentInput) toMap() map[string]any {
	m := make(map[string]any)
	m["policy_name"] = s.PolicyName
	if s.PolicyType != "" {
		m["policy_type"] = s.PolicyType
	}
	return m
}

// ParseAliCloudRamRole validates and normalizes a AliCloudRamRole cloud_object.
func ParseAliCloudRamRole(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "ali-cloud.openmcf.org/v1", "AliCloudRamRole"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AliCloudRamRoleSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
