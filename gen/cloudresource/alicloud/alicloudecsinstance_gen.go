// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package alicloud

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// alicloud-ecs-instance
type AliCloudEcsInstanceSpecInput struct {
	// Alibaba Cloud region where the ECS instance will be created.
	//  Examples: "cn-hangzhou", "cn-shanghai", "us-west-1", "ap-southeast-1".
	Region string `json:"region" jsonschema:"required,Alibaba Cloud region where the ECS instance will be created. Examples: 'cn-hangzhou'; 'cn-shanghai'; 'us-west-1'; 'ap-southeast-1'."`
	// VSwitch ID that determines the VPC, availability zone, and subnet CIDR
	//  for the instance's primary network interface.
	VswitchId string `json:"vswitch_id" jsonschema:"required,VSwitch ID that determines the VPC; availability zone; and subnet CIDR for the instance's primary network interface."`
	// Security group IDs to associate with the instance. At least one is
	//  required. An instance can belong to up to 5 security groups.
	SecurityGroupIds []string `json:"security_group_ids,omitempty" jsonschema:"Security group IDs to associate with the instance. At least one is required. An instance can belong to up to 5 security groups."`
	// ECS instance type that determines CPU and memory allocation.
	//  Must start with "ecs." prefix.
	//  Examples: "ecs.g7.large" (2 vCPU, 8 GiB), "ecs.c7.xlarge" (4 vCPU, 8 GiB).
	InstanceType string `json:"instance_type" jsonschema:"required,ECS instance type that determines CPU and memory allocation. Must start with 'ecs.' prefix. Examples: 'ecs.g7.large' (2 vCPU; 8 GiB); 'ecs.c7.xlarge' (4 vCPU; 8 GiB)."`
	// Operating system image ID. Determines the OS, architecture, and
	//  pre-installed software on the instance.
	//  Example: "ubuntu_22_04_x64_20G_alibase_20230515.vhd"
	ImageId string `json:"image_id" jsonschema:"required,Operating system image ID. Determines the OS; architecture; and pre-installed software on the instance. Example: 'ubuntu_22_04_x64_20G_alibase_20230515.vhd'"`
	// Instance display name. 2-128 characters.
	//  If omitted, defaults to the metadata.name.
	InstanceName string `json:"instance_name,omitempty" jsonschema:"Instance display name. 2-128 characters. If omitted; defaults to the metadata.name."`
	// OS-level hostname. If omitted, Alibaba Cloud generates one.
	HostName string `json:"host_name,omitempty" jsonschema:"OS-level hostname. If omitted; Alibaba Cloud generates one."`
	// Instance description. 2-256 characters.
	Description string `json:"description,omitempty" jsonschema:"Instance description. 2-256 characters."`
	// System disk configuration. Every ECS instance has exactly one system
	//  disk that holds the OS. If omitted, defaults are applied (cloud_essd, 40 GB).
	SystemDisk *AliCloudEcsSystemDiskInput `json:"system_disk,omitempty" jsonschema:"System disk configuration. Every ECS instance has exactly one system disk that holds the OS. If omitted; defaults are applied (cloud_essd; 40 GB)."`
	// Additional data disks to create and attach to the instance. Up to 16
	//  data disks are supported. Disks are created inline with the instance
	//  and their lifecycle is tied to it by default.
	DataDisks []*AliCloudEcsDataDiskInput `json:"data_disks,omitempty" jsonschema:"Additional data disks to create and attach to the instance. Up to 16 data disks are supported. Disks are created inline with the instance and their lifecycle is tied to it by default."`
	// SSH key pair name for passwordless authentication. Mutually exclusive
	//  authentication option with password.
	KeyName string `json:"key_name,omitempty" jsonschema:"SSH key pair name for passwordless authentication. Mutually exclusive authentication option with password."`
	// Instance login password. 8-30 characters, must contain at least three
	//  of: uppercase, lowercase, digits, special characters.
	//  Mutually exclusive authentication option with key_name.
	Password string `json:"password,omitempty" jsonschema:"Instance login password. 8-30 characters; must contain at least three of: uppercase; lowercase; digits; special characters. Mutually exclusive authentication option with key_name."`
	// Maximum outbound internet bandwidth in Mbps. A value > 0 causes Alibaba
	//  Cloud to allocate a public IP address to the instance.
	//  Default: 0 (no public IP).
	InternetMaxBandwidthOut int32 `json:"internet_max_bandwidth_out,omitempty" jsonschema:"Maximum outbound internet bandwidth in Mbps. A value > 0 causes Alibaba Cloud to allocate a public IP address to the instance. Default: 0 (no public IP)."`
	// Billing method for internet traffic. Only meaningful when
	//  internet_max_bandwidth_out > 0.
	InternetChargeType string `json:"internet_charge_type,omitempty" jsonschema:"Billing method for internet traffic. Only meaningful when internet_max_bandwidth_out > 0."`
	// Billing method for the instance itself.
	//  Default: "PostPaid" (pay-as-you-go).
	InstanceChargeType string `json:"instance_charge_type,omitempty" jsonschema:"Billing method for the instance itself. Default: 'PostPaid' (pay-as-you-go)."`
	// Subscription period. Only applicable when instance_charge_type is "PrePaid".
	//  Valid values: 1-9, 12, 24, 36, 48, 60.
	Period int32 `json:"period,omitempty" jsonschema:"Subscription period. Only applicable when instance_charge_type is 'PrePaid'. Valid values: 1-9; 12; 24; 36; 48; 60."`
	// Subscription period unit. Only applicable when instance_charge_type is "PrePaid".
	PeriodUnit string `json:"period_unit,omitempty" jsonschema:"Subscription period unit. Only applicable when instance_charge_type is 'PrePaid'."`
	// Spot instance bidding strategy. Spot instances can reduce costs up to 90%
	//  but may be reclaimed by Alibaba Cloud when capacity is needed.
	SpotStrategy string `json:"spot_strategy,omitempty" jsonschema:"Spot instance bidding strategy. Spot instances can reduce costs up to 90% but may be reclaimed by Alibaba Cloud when capacity is needed."`
	// Maximum hourly price for a spot instance. Only applicable when
	//  spot_strategy is "SpotWithPriceLimit".
	SpotPriceLimit float64 `json:"spot_price_limit,omitempty" jsonschema:"Maximum hourly price for a spot instance. Only applicable when spot_strategy is 'SpotWithPriceLimit'."`
	// Cloud-init user data script. Typically base64-encoded. Executed once
	//  at first boot for automated instance provisioning.
	UserData string `json:"user_data,omitempty" jsonschema:"Cloud-init user data script. Typically base64-encoded. Executed once at first boot for automated instance provisioning."`
	// RAM role name to attach as the instance profile. Enables the instance
	//  to call Alibaba Cloud APIs without embedded credentials.
	RoleName string `json:"role_name,omitempty" jsonschema:"RAM role name to attach as the instance profile. Enables the instance to call Alibaba Cloud APIs without embedded credentials."`
	// Prevent accidental instance deletion via console or API.
	DeletionProtection bool `json:"deletion_protection,omitempty" jsonschema:"Prevent accidental instance deletion via console or API."`
	// Cloud security center agent mode. "Active" enables the China-region
	//  security agent; "Deactive" disables it.
	SecurityEnhancementStrategy string `json:"security_enhancement_strategy,omitempty" jsonschema:"Cloud security center agent mode. 'Active' enables the China-region security agent; 'Deactive' disables it."`
	// Alibaba Cloud resource group ID for organizational grouping (per DD05).
	//  If omitted, the instance is placed in the account's default resource group.
	ResourceGroupId string `json:"resource_group_id,omitempty" jsonschema:"Alibaba Cloud resource group ID for organizational grouping (per DD05). If omitted; the instance is placed in the account's default resource group."`
	// Tags to apply to the ECS instance and its disks.
	Tags map[string]string `json:"tags,omitempty" jsonschema:"Tags to apply to the ECS instance and its disks."`
}

func (s *AliCloudEcsInstanceSpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	if s.VswitchId == "" {
		return fmt.Errorf("vswitch_id is required")
	}
	if len(s.SecurityGroupIds) < 1 {
		return fmt.Errorf("security_group_ids requires at least 1 items, got %d", len(s.SecurityGroupIds))
	}
	if s.InstanceType == "" {
		return fmt.Errorf("instance_type is required")
	}
	if s.ImageId == "" {
		return fmt.Errorf("image_id is required")
	}
	if s.SystemDisk != nil {
		if err := s.SystemDisk.validate(); err != nil {
			return fmt.Errorf("system_disk: %w", err)
		}
	}
	for i, v := range s.DataDisks {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("data_disks[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *AliCloudEcsInstanceSpecInput) applyDefaults() {
	if s.SystemDisk != nil {
		s.SystemDisk.applyDefaults()
	}
	if s.InternetMaxBandwidthOut == 0 {
		s.InternetMaxBandwidthOut = 0
	}
	if s.InstanceChargeType == "" {
		s.InstanceChargeType = "PostPaid"
	}
}

func (s *AliCloudEcsInstanceSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	m["vswitch_id"] = s.VswitchId
	if len(s.SecurityGroupIds) > 0 {
		m["security_group_ids"] = s.SecurityGroupIds
	}
	m["instance_type"] = s.InstanceType
	m["image_id"] = s.ImageId
	if s.InstanceName != "" {
		m["instance_name"] = s.InstanceName
	}
	if s.HostName != "" {
		m["host_name"] = s.HostName
	}
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.SystemDisk != nil {
		m["system_disk"] = s.SystemDisk.toMap()
	}
	if len(s.DataDisks) > 0 {
		items := make([]any, len(s.DataDisks))
		for i, v := range s.DataDisks {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["data_disks"] = items
	}
	if s.KeyName != "" {
		m["key_name"] = s.KeyName
	}
	if s.Password != "" {
		m["password"] = s.Password
	}
	if s.InternetMaxBandwidthOut != 0 {
		m["internet_max_bandwidth_out"] = s.InternetMaxBandwidthOut
	}
	if s.InternetChargeType != "" {
		m["internet_charge_type"] = s.InternetChargeType
	}
	if s.InstanceChargeType != "" {
		m["instance_charge_type"] = s.InstanceChargeType
	}
	if s.Period != 0 {
		m["period"] = s.Period
	}
	if s.PeriodUnit != "" {
		m["period_unit"] = s.PeriodUnit
	}
	if s.SpotStrategy != "" {
		m["spot_strategy"] = s.SpotStrategy
	}
	if s.SpotPriceLimit != 0 {
		m["spot_price_limit"] = s.SpotPriceLimit
	}
	if s.UserData != "" {
		m["user_data"] = s.UserData
	}
	if s.RoleName != "" {
		m["role_name"] = s.RoleName
	}
	if s.DeletionProtection {
		m["deletion_protection"] = s.DeletionProtection
	}
	if s.SecurityEnhancementStrategy != "" {
		m["security_enhancement_strategy"] = s.SecurityEnhancementStrategy
	}
	if s.ResourceGroupId != "" {
		m["resource_group_id"] = s.ResourceGroupId
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	return m
}

// AliCloudEcsDataDisk configures an additional data disk to be created
//
//	inline with the ECS instance.
type AliCloudEcsDataDiskInput struct {
	// Disk size in GB. Required for each data disk.
	Size int32 `json:"size" jsonschema:"required,Disk size in GB. Required for each data disk."`
	// Disk category.
	//  Default: "cloud_essd"
	Category string `json:"category,omitempty" jsonschema:"Disk category. Default: 'cloud_essd'"`
	// Disk display name.
	Name string `json:"name,omitempty" jsonschema:"Disk display name."`
	// ESSD performance level. Only applicable when category is "cloud_essd".
	PerformanceLevel string `json:"performance_level,omitempty" jsonschema:"ESSD performance level. Only applicable when category is 'cloud_essd'."`
	// Enable server-side encryption for this data disk.
	Encrypted bool `json:"encrypted,omitempty" jsonschema:"Enable server-side encryption for this data disk."`
	// KMS key ID for disk encryption.
	KmsKeyId string `json:"kms_key_id,omitempty" jsonschema:"KMS key ID for disk encryption."`
	// Snapshot ID to create this disk from.
	SnapshotId string `json:"snapshot_id,omitempty" jsonschema:"Snapshot ID to create this disk from."`
	// Whether this disk is deleted when the instance is released.
	//  Default: true
	DeleteWithInstance bool `json:"delete_with_instance,omitempty" jsonschema:"Whether this disk is deleted when the instance is released. Default: true"`
	// Disk description.
	Description string `json:"description,omitempty" jsonschema:"Disk description."`
}

func (s *AliCloudEcsDataDiskInput) validate() error {
	return nil
}

func (s *AliCloudEcsDataDiskInput) applyDefaults() {
	if s.Category == "" {
		s.Category = "cloud_essd"
	}
	// default: DeleteWithInstance = true (applied at zero-value)
}

func (s *AliCloudEcsDataDiskInput) toMap() map[string]any {
	m := make(map[string]any)
	m["size"] = s.Size
	if s.Category != "" {
		m["category"] = s.Category
	}
	if s.Name != "" {
		m["name"] = s.Name
	}
	if s.PerformanceLevel != "" {
		m["performance_level"] = s.PerformanceLevel
	}
	if s.Encrypted {
		m["encrypted"] = s.Encrypted
	}
	if s.KmsKeyId != "" {
		m["kms_key_id"] = s.KmsKeyId
	}
	if s.SnapshotId != "" {
		m["snapshot_id"] = s.SnapshotId
	}
	if s.DeleteWithInstance {
		m["delete_with_instance"] = s.DeleteWithInstance
	}
	if s.Description != "" {
		m["description"] = s.Description
	}
	return m
}

// AliCloudEcsSystemDisk configures the boot disk for the ECS instance.
type AliCloudEcsSystemDiskInput struct {
	// Disk category. Determines the underlying storage technology and
	//  performance characteristics.
	//  Default: "cloud_essd"
	Category string `json:"category,omitempty" jsonschema:"Disk category. Determines the underlying storage technology and performance characteristics. Default: 'cloud_essd'"`
	// Disk size in GB. The minimum depends on the image; typical minimum
	//  is 20 GB for Linux and 40 GB for Windows.
	//  Default: 40
	Size int32 `json:"size,omitempty" jsonschema:"Disk size in GB. The minimum depends on the image; typical minimum is 20 GB for Linux and 40 GB for Windows. Default: 40"`
	// ESSD performance level. Only applicable when category is "cloud_essd".
	//  Higher levels deliver more IOPS and throughput at higher cost.
	PerformanceLevel string `json:"performance_level,omitempty" jsonschema:"ESSD performance level. Only applicable when category is 'cloud_essd'. Higher levels deliver more IOPS and throughput at higher cost."`
	// Enable server-side encryption for the system disk.
	Encrypted bool `json:"encrypted,omitempty" jsonschema:"Enable server-side encryption for the system disk."`
	// KMS key ID for disk encryption. Only applicable when encrypted is true.
	KmsKeyId string `json:"kms_key_id,omitempty" jsonschema:"KMS key ID for disk encryption. Only applicable when encrypted is true."`
}

func (s *AliCloudEcsSystemDiskInput) validate() error {
	return nil
}

func (s *AliCloudEcsSystemDiskInput) applyDefaults() {
	if s.Category == "" {
		s.Category = "cloud_essd"
	}
	if s.Size == 0 {
		s.Size = 40
	}
}

func (s *AliCloudEcsSystemDiskInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Category != "" {
		m["category"] = s.Category
	}
	if s.Size != 0 {
		m["size"] = s.Size
	}
	if s.PerformanceLevel != "" {
		m["performance_level"] = s.PerformanceLevel
	}
	if s.Encrypted {
		m["encrypted"] = s.Encrypted
	}
	if s.KmsKeyId != "" {
		m["kms_key_id"] = s.KmsKeyId
	}
	return m
}

// ParseAliCloudEcsInstance validates and normalizes a AliCloudEcsInstance cloud_object.
func ParseAliCloudEcsInstance(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "ali-cloud.openmcf.org/v1", "AliCloudEcsInstance"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AliCloudEcsInstanceSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
