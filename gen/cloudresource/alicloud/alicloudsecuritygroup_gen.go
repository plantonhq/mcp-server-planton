// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package alicloud

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// alicloud-security-group
type AliCloudSecurityGroupSpecInput struct {
	// Alibaba Cloud region where the security group will be created.
	//  Must match the region of the VPC referenced by vpc_id.
	//  Examples: "cn-hangzhou", "cn-shanghai", "us-west-1", "ap-southeast-1".
	Region string `json:"region" jsonschema:"required,Alibaba Cloud region where the security group will be created. Must match the region of the VPC referenced by vpc_id. Examples: 'cn-hangzhou'; 'cn-shanghai'; 'us-west-1'; 'ap-southeast-1'."`
	// VPC ID that this security group belongs to.
	//  All security group rules automatically apply to VPC-internal traffic
	//  (nic_type "intranet" is implied and hardcoded in the IaC modules).
	VpcId string `json:"vpc_id" jsonschema:"required,VPC ID that this security group belongs to. All security group rules automatically apply to VPC-internal traffic (nic_type 'intranet' is implied and hardcoded in the IaC modules)."`
	// Security group name. 2-128 characters; must start with a letter; can
	//  contain Unicode characters, digits, colons, underscores, periods, hyphens.
	//  Maps to the provider field `security_group_name`.
	SecurityGroupName string `json:"security_group_name" jsonschema:"required,Security group name. 2-128 characters; must start with a letter; can contain Unicode characters; digits; colons; underscores; periods; hyphens. Maps to the provider field 'security_group_name'."`
	// Human-readable description of the security group's purpose.
	//  2-256 characters; cannot start with http:// or https://.
	Description string `json:"description,omitempty" jsonschema:"Human-readable description of the security group's purpose. 2-256 characters; cannot start with http:// or https://."`
	// Controls whether instances within the same security group can communicate
	//  with each other freely. When "Accept", all intra-group traffic is allowed.
	//  When "Drop", intra-group traffic follows normal rule evaluation.
	//
	//  Uses the provider's exact casing: "Accept" or "Drop".
	//  Default: "Accept"
	InnerAccessPolicy string `json:"inner_access_policy,omitempty" jsonschema:"Controls whether instances within the same security group can communicate with each other freely. When 'Accept'; all intra-group traffic is allowed. When 'Drop'; intra-group traffic follows normal rul..."`
	// Alibaba Cloud resource group ID for organizational grouping (per DD05).
	//  If omitted, the security group is placed in the account's default resource group.
	ResourceGroupId string `json:"resource_group_id,omitempty" jsonschema:"Alibaba Cloud resource group ID for organizational grouping (per DD05). If omitted; the security group is placed in the account's default resource group."`
	// Tags to apply to the security group.
	Tags map[string]string `json:"tags,omitempty" jsonschema:"Tags to apply to the security group."`
	// Security rules that define allowed or dropped traffic flows.
	//  Each rule specifies direction (ingress/egress), protocol, port range,
	//  source/destination, and an accept/drop decision.
	//
	//  Rules are evaluated by priority within their direction. Lower priority
	//  numbers are evaluated first (1 = highest pri...
	Rules []*AliCloudSecurityGroupRuleInput `json:"rules,omitempty" jsonschema:"Security rules that define allowed or dropped traffic flows. Each rule specifies direction (ingress/egress); protocol; port range; source/destination; and an accept/drop decision. Rules are evaluated ..."`
}

func (s *AliCloudSecurityGroupSpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	if s.VpcId == "" {
		return fmt.Errorf("vpc_id is required")
	}
	if s.SecurityGroupName == "" {
		return fmt.Errorf("security_group_name is required")
	}
	for i, v := range s.Rules {
		if v != nil {
			if err := v.validate(); err != nil {
				return fmt.Errorf("rules[%d]: %w", i, err)
			}
		}
	}
	return nil
}

func (s *AliCloudSecurityGroupSpecInput) applyDefaults() {
	if s.InnerAccessPolicy == "" {
		s.InnerAccessPolicy = "Accept"
	}
}

func (s *AliCloudSecurityGroupSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["region"] = s.Region
	m["vpc_id"] = s.VpcId
	m["security_group_name"] = s.SecurityGroupName
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.InnerAccessPolicy != "" {
		m["inner_access_policy"] = s.InnerAccessPolicy
	}
	if s.ResourceGroupId != "" {
		m["resource_group_id"] = s.ResourceGroupId
	}
	if len(s.Tags) > 0 {
		m["tags"] = s.Tags
	}
	if len(s.Rules) > 0 {
		items := make([]any, len(s.Rules))
		for i, v := range s.Rules {
			if v != nil {
				items[i] = v.toMap()
			}
		}
		m["rules"] = items
	}
	return m
}

// AliCloudSecurityGroupRule defines a single inbound or outbound traffic rule.
//
//	For ingress rules, cidr_ip and source_security_group_id specify the traffic
//	source. For egress rules, cidr_ip specifies the traffic destination. At least
//	one of cidr_ip or source_security_group_id must be provided.
//
//	All rule fields except description are immutable after creation (ForceNew in
//	the provider). Changing any field requires destroying and recreating the rule.
type AliCloudSecurityGroupRuleInput struct {
	// Traffic direction: "ingress" for inbound, "egress" for outbound.
	Type string `json:"type" jsonschema:"required,Traffic direction: 'ingress' for inbound; 'egress' for outbound."`
	// IP protocol for this rule.
	//  For "tcp" and "udp", port_range must specify explicit ports.
	//  For "icmp", "gre", and "all", port_range must be "-1/-1".
	IpProtocol string `json:"ip_protocol" jsonschema:"required,IP protocol for this rule. For 'tcp' and 'udp'; port_range must specify explicit ports. For 'icmp'; 'gre'; and 'all'; port_range must be '-1/-1'."`
	// Port range in "start/end" format.
	//  For tcp/udp: valid range 1-65535, e.g. "80/80" (single port), "8080/8090" (range).
	//  For icmp/gre/all: must be "-1/-1".
	//  Default: "-1/-1" (all ports)
	PortRange string `json:"port_range,omitempty" jsonschema:"Port range in 'start/end' format. For tcp/udp: valid range 1-65535; e.g. '80/80' (single port); '8080/8090' (range). For icmp/gre/all: must be '-1/-1'. Default: '-1/-1' (all ports)"`
	// IPv4 CIDR block for the traffic source (ingress) or destination (egress).
	//  Example: "0.0.0.0/0" (any), "10.0.0.0/8" (private range).
	//  At least one of cidr_ip or source_security_group_id must be specified.
	CidrIp string `json:"cidr_ip,omitempty" jsonschema:"IPv4 CIDR block for the traffic source (ingress) or destination (egress). Example: '0.0.0.0/0' (any); '10.0.0.0/8' (private range). At least one of cidr_ip or source_security_group_id must be specifie..."`
	// Source (for ingress) or destination (for egress) security group ID.
	//  Used for SG-to-SG rules within the same VPC.
	//  Mutually exclusive with cidr_ip in the provider -- when both are set,
	//  cidr_ip takes precedence.
	SourceSecurityGroupId string `json:"source_security_group_id,omitempty" jsonschema:"Source (for ingress) or destination (for egress) security group ID. Used for SG-to-SG rules within the same VPC. Mutually exclusive with cidr_ip in the provider -- when both are set; cidr_ip takes pre..."`
	// Rule evaluation priority. Lower number = higher priority.
	//  Range: 1 to 100.
	//  Default: 1 (highest priority)
	Priority int32 `json:"priority,omitempty" jsonschema:"Rule evaluation priority. Lower number = higher priority. Range: 1 to 100. Default: 1 (highest priority)"`
	// Action to take when this rule matches: "accept" to allow, "drop" to block.
	//  Default: "accept"
	Policy string `json:"policy,omitempty" jsonschema:"Action to take when this rule matches: 'accept' to allow; 'drop' to block. Default: 'accept'"`
	// Human-readable description of this rule's purpose.
	//  This is the only field that can be updated after creation without
	//  recreating the rule.
	Description string `json:"description,omitempty" jsonschema:"Human-readable description of this rule's purpose. This is the only field that can be updated after creation without recreating the rule."`
}

func (s *AliCloudSecurityGroupRuleInput) validate() error {
	if s.Type == "" {
		return fmt.Errorf("type is required")
	}
	if s.IpProtocol == "" {
		return fmt.Errorf("ip_protocol is required")
	}
	return nil
}

func (s *AliCloudSecurityGroupRuleInput) applyDefaults() {
	if s.PortRange == "" {
		s.PortRange = "-1/-1"
	}
	if s.Priority == 0 {
		s.Priority = 1
	}
	if s.Policy == "" {
		s.Policy = "accept"
	}
}

func (s *AliCloudSecurityGroupRuleInput) toMap() map[string]any {
	m := make(map[string]any)
	m["type"] = s.Type
	m["ip_protocol"] = s.IpProtocol
	if s.PortRange != "" {
		m["port_range"] = s.PortRange
	}
	if s.CidrIp != "" {
		m["cidr_ip"] = s.CidrIp
	}
	if s.SourceSecurityGroupId != "" {
		m["source_security_group_id"] = s.SourceSecurityGroupId
	}
	if s.Priority != 0 {
		m["priority"] = s.Priority
	}
	if s.Policy != "" {
		m["policy"] = s.Policy
	}
	if s.Description != "" {
		m["description"] = s.Description
	}
	return m
}

// ParseAliCloudSecurityGroup validates and normalizes a AliCloudSecurityGroup cloud_object.
func ParseAliCloudSecurityGroup(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "ali-cloud.openmcf.org/v1", "AliCloudSecurityGroup"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec AliCloudSecurityGroupSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
