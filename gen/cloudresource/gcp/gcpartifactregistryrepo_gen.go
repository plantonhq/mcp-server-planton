// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package gcp

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// gcp-artifact-registry-repo
type GcpArtifactRegistryRepoSpecInput struct {
	// The format of the repository in the Artifact Registry.
	RepoFormat string `json:"repo_format" jsonschema:"required,enum=DOCKER|GENERIC|GO|KUBEFLOW|MAVEN|NPM|PYTHON|YUM,The format of the repository in the Artifact Registry."`
	// The ID of the GCP project where the Artifact Registry resources will be created.
	//  Can be provided as a literal string value or as a reference to another resource's output.
	//  Example literal: {value: "my-gcp-project-123"}
	//  Example reference: {value_from: {kind: GcpProject, name: "main-project"}}
	ProjectId string `json:"project_id" jsonschema:"required,The ID of the GCP project where the Artifact Registry resources will be created. Can be provided as a literal string value or as a reference to another resource's output. Example literal: {value: 'my-..."`
	// The GCP region where the Artifact Registry will be created (e.g., "us-west2").
	//  Selecting a region close to your Kubernetes clusters can reduce service startup time
	//  by enabling faster downloads of container images.
	Region string `json:"region" jsonschema:"required,The GCP region where the Artifact Registry will be created (e.g.; 'us-west2'). Selecting a region close to your Kubernetes clusters can reduce service startup time by enabling faster downloads of cont..."`
	// A flag indicating whether to allow unauthenticated access to artifacts published in the repositories.
	//  Enable this for publishing artifacts for open-source projects that require public access.
	EnablePublicAccess bool `json:"enable_public_access,omitempty" jsonschema:"A flag indicating whether to allow unauthenticated access to artifacts published in the repositories. Enable this for publishing artifacts for open-source projects that require public access."`
}

func (s *GcpArtifactRegistryRepoSpecInput) validate() error {
	if s.RepoFormat == "" {
		return fmt.Errorf("repo_format is required")
	}
	switch s.RepoFormat {
	case "DOCKER", "GENERIC", "GO", "KUBEFLOW", "MAVEN", "NPM", "PYTHON", "YUM":
	default:
		return fmt.Errorf("invalid repo_format: %q", s.RepoFormat)
	}
	if s.ProjectId == "" {
		return fmt.Errorf("project_id is required")
	}
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	return nil
}

func (s *GcpArtifactRegistryRepoSpecInput) applyDefaults() {
}

func (s *GcpArtifactRegistryRepoSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["repo_format"] = s.RepoFormat
	m["project_id"] = s.ProjectId
	m["region"] = s.Region
	if s.EnablePublicAccess {
		m["enable_public_access"] = s.EnablePublicAccess
	}
	return m
}

// ParseGcpArtifactRegistryRepo validates and normalizes a GcpArtifactRegistryRepo cloud_object.
func ParseGcpArtifactRegistryRepo(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "gcp.openmcf.org/v1", "GcpArtifactRegistryRepo"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec GcpArtifactRegistryRepoSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
