// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T21:50:49+05:30

package gcp

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/gen/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// gcp-spanner-database
type GcpSpannerDatabaseSpecInput struct {
	// GCP project where the Spanner database will be created.
	//  Must match the project of the parent Spanner instance.
	ProjectId string `json:"project_id" jsonschema:"required,GCP project where the Spanner database will be created. Must match the project of the parent Spanner instance."`
	// Spanner instance to create the database on. This determines the
	//  compute capacity and regional configuration available to the database.
	//  Immutable after creation.
	Instance string `json:"instance" jsonschema:"required,Spanner instance to create the database on. This determines the compute capacity and regional configuration available to the database. Immutable after creation."`
	// Unique name for the Spanner database within the instance.
	//  Must start with a lowercase letter, can contain lowercase letters,
	//  digits, underscores, and hyphens, and must end with a lowercase
	//  letter or digit. 2-30 characters. Immutable after creation.
	DatabaseName string `json:"database_name" jsonschema:"required,Unique name for the Spanner database within the instance. Must start with a lowercase letter; can contain lowercase letters; digits; underscores; and hyphens; and must end with a lowercase letter or d..."`
	// SQL dialect for the database. Determines the SQL syntax and features
	//  available. This choice is permanent and cannot be changed after creation.
	//
	//  GOOGLE_STANDARD_SQL: Google's proprietary SQL dialect with full Spanner
	//  feature support including interleaved tables and STRUCT types.
	//
	//  POSTGRESQL: Post...
	DatabaseDialect string `json:"database_dialect,omitempty" jsonschema:"SQL dialect for the database. Determines the SQL syntax and features available. This choice is permanent and cannot be changed after creation. GOOGLE_STANDARD_SQL: Google's proprietary SQL dialect wit..."`
	// Retention period for database versions, enabling point-in-time recovery.
	//  The retention period must be between 1 hour and 7 days.
	//  Accepts duration formats: "1h", "24h", "1d", "1440m", "86400s".
	//  Defaults to "1h" if not set.
	//
	//  Increasing this value provides a longer window for point-in-time
	//  recover...
	VersionRetentionPeriod string `json:"version_retention_period,omitempty" jsonschema:"Retention period for database versions; enabling point-in-time recovery. The retention period must be between 1 hour and 7 days. Accepts duration formats: '1h'; '24h'; '1d'; '1440m'; '86400s'. Default..."`
	// Optional list of DDL statements to execute when creating the database.
	//  Statements can create tables, indexes, views, and other schema objects.
	//
	//  These statements execute atomically with the database creation. If any
	//  statement fails, the database is not created.
	//
	//  Important lifecycle behavior:
	//    -...
	Ddl []string `json:"ddl,omitempty" jsonschema:"Optional list of DDL statements to execute when creating the database. Statements can create tables; indexes; views; and other schema objects. These statements execute atomically with the database cre..."`
	// Whether to enable GCP API-level drop protection for this database.
	//  When true, the database cannot be deleted through any interface
	//  (Console, gcloud, API, Terraform, Pulumi) until this flag is set
	//  back to false.
	//
	//  Additionally, enabling drop protection on a database prevents deletion
	//  of the paren...
	EnableDropProtection bool `json:"enable_drop_protection,omitempty" jsonschema:"Whether to enable GCP API-level drop protection for this database. When true; the database cannot be deleted through any interface (Console; gcloud; API; Terraform; Pulumi) until this flag is set back..."`
	// Fully qualified name of the KMS key to use for customer-managed
	//  encryption (CMEK). The key must exist in the same location as the
	//  Spanner instance. Immutable after creation.
	//
	//  Format: projects/{project}/locations/{location}/keyRings/{ring}/cryptoKeys/{key}
	//
	//  If not set, Google-managed encryption i...
	KmsKeyName string `json:"kms_key_name,omitempty" jsonschema:"Fully qualified name of the KMS key to use for customer-managed encryption (CMEK). The key must exist in the same location as the Spanner instance. Immutable after creation. Format: projects/{project}..."`
	// Default time zone for the database. Affects SQL functions that depend
	//  on time zones, such as CURRENT_TIMESTAMP() and FORMAT_TIMESTAMP().
	//  Must be a valid name from the IANA Time Zone Database
	//  (e.g., "America/New_York", "Europe/London", "UTC").
	//
	//  If not set, GCP defaults to "America/Los_Angeles".
	DefaultTimeZone string `json:"default_time_zone,omitempty" jsonschema:"Default time zone for the database. Affects SQL functions that depend on time zones; such as CURRENT_TIMESTAMP() and FORMAT_TIMESTAMP(). Must be a valid name from the IANA Time Zone Database (e.g.; 'A..."`
}

func (s *GcpSpannerDatabaseSpecInput) validate() error {
	if s.ProjectId == "" {
		return fmt.Errorf("project_id is required")
	}
	if s.Instance == "" {
		return fmt.Errorf("instance is required")
	}
	if s.DatabaseName == "" {
		return fmt.Errorf("database_name is required")
	}
	return nil
}

func (s *GcpSpannerDatabaseSpecInput) applyDefaults() {
}

func (s *GcpSpannerDatabaseSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["project_id"] = s.ProjectId
	m["instance"] = s.Instance
	m["database_name"] = s.DatabaseName
	if s.DatabaseDialect != "" {
		m["database_dialect"] = s.DatabaseDialect
	}
	if s.VersionRetentionPeriod != "" {
		m["version_retention_period"] = s.VersionRetentionPeriod
	}
	if len(s.Ddl) > 0 {
		m["ddl"] = s.Ddl
	}
	if s.EnableDropProtection {
		m["enable_drop_protection"] = s.EnableDropProtection
	}
	if s.KmsKeyName != "" {
		m["kms_key_name"] = s.KmsKeyName
	}
	if s.DefaultTimeZone != "" {
		m["default_time_zone"] = s.DefaultTimeZone
	}
	return m
}

// ParseGcpSpannerDatabase validates and normalizes a GcpSpannerDatabase cloud_object.
func ParseGcpSpannerDatabase(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "gcp.openmcf.org/v1", "GcpSpannerDatabase"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec GcpSpannerDatabaseSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
