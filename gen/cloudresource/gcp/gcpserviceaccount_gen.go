// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package gcp

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// gcp-service-account
type GcpServiceAccountSpecInput struct {
	// service_account_id is the short unique ID for the service account (6-30 chars),
	//  used to form the email <service_account_id>@<project>.iam.gserviceaccount.com.
	//  Required: must comply with GCP naming rules (lowercase letters, digits, etc.).
	ServiceAccountId string `json:"service_account_id" jsonschema:"required,service_account_id is the short unique ID for the service account (6-30 chars); used to form the email <service_account_id>@<project>.iam.gserviceaccount.com. Required: must comply with GCP naming rul..."`
	// project_id specifies the GCP project in which the service account is created.
	//  Can be a literal value or a reference to a GcpProject resource.
	//  If omitted, the provider default project is used. Typically recommended to set explicitly.
	ProjectId string `json:"project_id,omitempty" jsonschema:"project_id specifies the GCP project in which the service account is created. Can be a literal value or a reference to a GcpProject resource. If omitted; the provider default project is used. Typicall..."`
	// org_id, if set, manages org-level IAM roles for the service account.
	//  If the user wants to assign an organization role, they must provide org_id
	//  (an integer string like "123456789012", or a numeric value stored as string).
	OrgId string `json:"org_id,omitempty" jsonschema:"org_id; if set; manages org-level IAM roles for the service account. If the user wants to assign an organization role; they must provide org_id (an integer string like '123456789012'; or a numeric val..."`
	// create_key indicates whether a key should be automatically generated
	//  for this service account. If true, a JSON private key is created;
	//  if false, no user-managed key is created.
	CreateKey bool `json:"create_key,omitempty" jsonschema:"create_key indicates whether a key should be automatically generated for this service account. If true; a JSON private key is created; if false; no user-managed key is created."`
	// project_iam_roles is a list of IAM roles to be granted at the project level
	//  to this service account. For example: ["roles/logging.logWriter", "roles/storage.admin"].
	//  Each role in this list will be bound to the service account in the specified project_id.
	ProjectIamRoles []string `json:"project_iam_roles,omitempty" jsonschema:"project_iam_roles is a list of IAM roles to be granted at the project level to this service account. For example: ['roles/logging.logWriter'; 'roles/storage.admin']. Each role in this list will be bou..."`
	// org_iam_roles is a list of IAM roles to be granted at the organization level
	//  to this service account. For example: ["roles/resourcemanager.organizationViewer"].
	//  Each role in this list will be bound to the service account in the specified org_id.
	OrgIamRoles []string `json:"org_iam_roles,omitempty" jsonschema:"org_iam_roles is a list of IAM roles to be granted at the organization level to this service account. For example: ['roles/resourcemanager.organizationViewer']. Each role in this list will be bound to..."`
}

func (s *GcpServiceAccountSpecInput) validate() error {
	if s.ServiceAccountId == "" {
		return fmt.Errorf("service_account_id is required")
	}
	return nil
}

func (s *GcpServiceAccountSpecInput) applyDefaults() {
}

func (s *GcpServiceAccountSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["service_account_id"] = s.ServiceAccountId
	if s.ProjectId != "" {
		m["project_id"] = s.ProjectId
	}
	if s.OrgId != "" {
		m["org_id"] = s.OrgId
	}
	if s.CreateKey {
		m["create_key"] = s.CreateKey
	}
	if len(s.ProjectIamRoles) > 0 {
		m["project_iam_roles"] = s.ProjectIamRoles
	}
	if len(s.OrgIamRoles) > 0 {
		m["org_iam_roles"] = s.OrgIamRoles
	}
	return m
}

// ParseGcpServiceAccount validates and normalizes a GcpServiceAccount cloud_object.
func ParseGcpServiceAccount(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "gcp.openmcf.org/v1", "GcpServiceAccount"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec GcpServiceAccountSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
