// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-27T00:55:48+05:30

package gcp

import (
	"encoding/json"
	"fmt"

	"github.com/plantonhq/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// gcp-kms-key
type GcpKmsKeySpecInput struct {
	// The key ring that this key belongs to.
	//  Accepts the fully qualified key ring path:
	//    projects/{project}/locations/{location}/keyRings/{name}
	//  Immutable after creation.
	KeyRingId string `json:"key_ring_id" jsonschema:"required,The key ring that this key belongs to. Accepts the fully qualified key ring path: projects/{project}/locations/{location}/keyRings/{name} Immutable after creation."`
	// Name of the key in GCP. Immutable after creation.
	//  Must be 1-63 characters: letters (upper or lower), digits, hyphens,
	//  or underscores. This is the GCP resource name, distinct from the
	//  OpenMCF metadata.name.
	//  Example: "cmek-encrypt-key", "artifact-signing-key"
	KeyName string `json:"key_name" jsonschema:"required,Name of the key in GCP. Immutable after creation. Must be 1-63 characters: letters (upper or lower); digits; hyphens; or underscores. This is the GCP resource name; distinct from the OpenMCF metadata...."`
	// The immutable purpose of this key. Determines what cryptographic
	//  operations the key supports. Cannot be changed after creation.
	//  If not set, GCP defaults to ENCRYPT_DECRYPT.
	//
	//  Valid values:
	//    "ENCRYPT_DECRYPT"      -- symmetric encryption for CMEK (default)
	//    "ASYMMETRIC_SIGN"      -- digital sig...
	Purpose string `json:"purpose,omitempty" jsonschema:"The immutable purpose of this key. Determines what cryptographic operations the key supports. Cannot be changed after creation. If not set; GCP defaults to ENCRYPT_DECRYPT. Valid values: 'ENCRYPT_DECR..."`
	// How often to auto-generate a new CryptoKeyVersion and set it as primary.
	//  Format: decimal seconds with suffix "s" (e.g., "7776000s" for 90 days).
	//  Must be greater than 86400s (24 hours). Only meaningful for
	//  ENCRYPT_DECRYPT keys; other purposes require manual key version management.
	RotationPeriod string `json:"rotation_period,omitempty" jsonschema:"How often to auto-generate a new CryptoKeyVersion and set it as primary. Format: decimal seconds with suffix 's' (e.g.; '7776000s' for 90 days). Must be greater than 86400s (24 hours). Only meaningful..."`
	// How long CryptoKeyVersions spend in DESTROY_SCHEDULED state before
	//  being permanently destroyed. Immutable after creation.
	//  Format: decimal seconds with suffix "s" (e.g., "2592000s" for 30 days).
	//  Minimum: 86400s (24 hours). Default: 2592000s (30 days) if not specified.
	DestroyScheduledDuration string `json:"destroy_scheduled_duration,omitempty" jsonschema:"How long CryptoKeyVersions spend in DESTROY_SCHEDULED state before being permanently destroyed. Immutable after creation. Format: decimal seconds with suffix 's' (e.g.; '2592000s' for 30 days). Minimu..."`
	// Template describing settings for new CryptoKeyVersions.
	//  Use this to specify the encryption algorithm and protection level.
	//  If omitted, GCP defaults to GOOGLE_SYMMETRIC_ENCRYPTION with SOFTWARE
	//  protection -- which is correct for standard CMEK use cases.
	VersionTemplate *GcpKmsKeyVersionTemplateInput `json:"version_template,omitempty" jsonschema:"Template describing settings for new CryptoKeyVersions. Use this to specify the encryption algorithm and protection level. If omitted; GCP defaults to GOOGLE_SYMMETRIC_ENCRYPTION with SOFTWARE protect..."`
	// If true, the key is created without an initial CryptoKeyVersion.
	//  You must create versions manually afterward using google_kms_crypto_key_version
	//  or a key ring import job. Only applicable during initial creation.
	SkipInitialVersionCreation bool `json:"skip_initial_version_creation,omitempty" jsonschema:"If true; the key is created without an initial CryptoKeyVersion. You must create versions manually afterward using google_kms_crypto_key_version or a key ring import job. Only applicable during initia..."`
}

func (s *GcpKmsKeySpecInput) validate() error {
	if s.KeyRingId == "" {
		return fmt.Errorf("key_ring_id is required")
	}
	if s.KeyName == "" {
		return fmt.Errorf("key_name is required")
	}
	if s.VersionTemplate != nil {
		if err := s.VersionTemplate.validate(); err != nil {
			return fmt.Errorf("version_template: %w", err)
		}
	}
	return nil
}

func (s *GcpKmsKeySpecInput) applyDefaults() {
	if s.VersionTemplate != nil {
		s.VersionTemplate.applyDefaults()
	}
}

func (s *GcpKmsKeySpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["key_ring_id"] = s.KeyRingId
	m["key_name"] = s.KeyName
	if s.Purpose != "" {
		m["purpose"] = s.Purpose
	}
	if s.RotationPeriod != "" {
		m["rotation_period"] = s.RotationPeriod
	}
	if s.DestroyScheduledDuration != "" {
		m["destroy_scheduled_duration"] = s.DestroyScheduledDuration
	}
	if s.VersionTemplate != nil {
		m["version_template"] = s.VersionTemplate.toMap()
	}
	if s.SkipInitialVersionCreation {
		m["skip_initial_version_creation"] = s.SkipInitialVersionCreation
	}
	return m
}

// GcpKmsKeyVersionTemplate describes settings for new CryptoKeyVersions.
//
//	Use this to control the encryption algorithm and protection level of
//	key versions created under a GcpKmsKey. If version_template is omitted
//	from the key spec, GCP defaults to GOOGLE_SYMMETRIC_ENCRYPTION with
//	SOFTWARE protection.
type GcpKmsKeyVersionTemplateInput struct {
	// The algorithm to use when creating a CryptoKeyVersion based on this
	//  template. Required when version_template is specified.
	//
	//  Common values by purpose:
	//    ENCRYPT_DECRYPT:    "GOOGLE_SYMMETRIC_ENCRYPTION" (default if omitted)
	//    ASYMMETRIC_SIGN:    "EC_SIGN_P256_SHA256", "RSA_SIGN_PSS_2048_SHA256", ...
	Algorithm string `json:"algorithm" jsonschema:"required,The algorithm to use when creating a CryptoKeyVersion based on this template. Required when version_template is specified. Common values by purpose: ENCRYPT_DECRYPT: 'GOOGLE_SYMMETRIC_ENCRYPTION' (def..."`
	// The protection level for CryptoKeyVersions created with this template.
	//  Immutable after creation.
	//
	//  Valid values:
	//    "SOFTWARE" (default) -- keys protected in software
	//    "HSM"               -- keys protected by Cloud HSM (FIPS 140-2 Level 3)
	ProtectionLevel string `json:"protection_level,omitempty" jsonschema:"The protection level for CryptoKeyVersions created with this template. Immutable after creation. Valid values: 'SOFTWARE' (default) -- keys protected in software 'HSM' -- keys protected by Cloud HSM (..."`
}

func (s *GcpKmsKeyVersionTemplateInput) validate() error {
	if s.Algorithm == "" {
		return fmt.Errorf("algorithm is required")
	}
	return nil
}

func (s *GcpKmsKeyVersionTemplateInput) applyDefaults() {
}

func (s *GcpKmsKeyVersionTemplateInput) toMap() map[string]any {
	m := make(map[string]any)
	m["algorithm"] = s.Algorithm
	if s.ProtectionLevel != "" {
		m["protection_level"] = s.ProtectionLevel
	}
	return m
}

// ParseGcpKmsKey validates and normalizes a GcpKmsKey cloud_object.
func ParseGcpKmsKey(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "gcp.openmcf.org/v1", "GcpKmsKey"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec GcpKmsKeySpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
