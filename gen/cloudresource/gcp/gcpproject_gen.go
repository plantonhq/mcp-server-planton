// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package gcp

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// gcp-project
type GcpProjectSpecInput struct {
	// Unique project ID for the GCP project. Must be 6-30 characters long,
	//  contain only lowercase letters, digits, and hyphens, must start with
	//  a letter, and cannot end with a hyphen. This ID is globally unique
	//  across all GCP projects.
	ProjectId string `json:"project_id" jsonschema:"required,Unique project ID for the GCP project. Must be 6-30 characters long; contain only lowercase letters; digits; and hyphens; must start with a letter; and cannot end with a hyphen. This ID is globally un..."`
	// If true, a random 3-character suffix will be appended to the project_id
	//  to ensure uniqueness across multiple deployments. This is useful when
	//  creating temporary or test projects. Defaults to false.
	AddSuffix bool `json:"add_suffix,omitempty" jsonschema:"If true; a random 3-character suffix will be appended to the project_id to ensure uniqueness across multiple deployments. This is useful when creating temporary or test projects. Defaults to false."`
	// The type of parent resource under which the project is created.
	ParentType string `json:"parent_type,omitempty" jsonschema:"enum=organization|folder,The type of parent resource under which the project is created."`
	// Organization ID/Folder ID (numeric string) under which the project is created.
	ParentId string `json:"parent_id,omitempty" jsonschema:"Organization ID/Folder ID (numeric string) under which the project is created."`
	// Billing account ID in the form "0123AB-4567CD-89EFGH".
	//  Strongly recommended for any project that will use billable services.
	BillingAccountId string `json:"billing_account_id,omitempty" jsonschema:"Billing account ID in the form '0123AB-4567CD-89EFGH'. Strongly recommended for any project that will use billable services."`
	// Key/value metadata labels for cost allocation and governance.
	//  GCP label keys must be <= 63 chars, lowercase letters, digits, or underscores.
	Labels map[string]string `json:"labels,omitempty" jsonschema:"Key/value metadata labels for cost allocation and governance. GCP label keys must be <= 63 chars; lowercase letters; digits; or underscores."`
	// If true, the auto-created "default" VPC network is deleted immediately
	//  after project creation. Disabling the default network is a common
	//  security hardening step.
	DisableDefaultNetwork bool `json:"disable_default_network,omitempty" jsonschema:"If true; the auto-created 'default' VPC network is deleted immediately after project creation. Disabling the default network is a common security hardening step."`
	// List of Cloud APIs to enable (e.g. "compute.googleapis.com").
	//  Each entry must end with ".googleapis.com".
	EnabledApis []string `json:"enabled_apis,omitempty" jsonschema:"List of Cloud APIs to enable (e.g. 'compute.googleapis.com'). Each entry must end with '.googleapis.com'."`
	// Optional IAM member (user / group / serviceAccount) to be granted
	//  the Owner role at project creation.
	//  Examples:
	//    "group:devops-admins@example.com"
	//    "user:alice@example.com"
	//    "serviceAccount:ci-automation@example.iam.gserviceaccount.com"
	OwnerMember string `json:"owner_member,omitempty" jsonschema:"Optional IAM member (user / group / serviceAccount) to be granted the Owner role at project creation. Examples: 'group:devops-admins@example.com' 'user:alice@example.com' 'serviceAccount:ci-automation..."`
	// If true, enables deletion protection on the GCP project.
	//  When enabled, the project cannot be deleted until this flag is set to false.
	//  This is a GCP-native feature (not a Pulumi/Terraform lifecycle option)
	//  that provides an additional layer of protection against accidental deletion.
	//  Defaults to fa...
	DeleteProtection bool `json:"delete_protection,omitempty" jsonschema:"If true; enables deletion protection on the GCP project. When enabled; the project cannot be deleted until this flag is set to false. This is a GCP-native feature (not a Pulumi/Terraform lifecycle opt..."`
}

func (s *GcpProjectSpecInput) validate() error {
	if s.ProjectId == "" {
		return fmt.Errorf("project_id is required")
	}
	switch s.ParentType {
	case "", "organization", "folder":
	default:
		return fmt.Errorf("invalid parent_type: %q", s.ParentType)
	}
	return nil
}

func (s *GcpProjectSpecInput) applyDefaults() {
	// default: DisableDefaultNetwork = true (applied at zero-value)
}

func (s *GcpProjectSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["project_id"] = s.ProjectId
	if s.AddSuffix {
		m["add_suffix"] = s.AddSuffix
	}
	if s.ParentType != "" {
		m["parent_type"] = s.ParentType
	}
	if s.ParentId != "" {
		m["parent_id"] = s.ParentId
	}
	if s.BillingAccountId != "" {
		m["billing_account_id"] = s.BillingAccountId
	}
	if len(s.Labels) > 0 {
		m["labels"] = s.Labels
	}
	if s.DisableDefaultNetwork {
		m["disable_default_network"] = s.DisableDefaultNetwork
	}
	if len(s.EnabledApis) > 0 {
		m["enabled_apis"] = s.EnabledApis
	}
	if s.OwnerMember != "" {
		m["owner_member"] = s.OwnerMember
	}
	if s.DeleteProtection {
		m["delete_protection"] = s.DeleteProtection
	}
	return m
}

// ParseGcpProject validates and normalizes a GcpProject cloud_object.
func ParseGcpProject(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "gcp.openmcf.org/v1", "GcpProject"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec GcpProjectSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
