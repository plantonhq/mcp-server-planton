// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T21:50:49+05:30

package gcp

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/gen/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// gcp-vpc
type GcpVpcSpecInput struct {
	// The GCP project ID in which to create this VPC network.
	//  Example: "my-prod-project-123"
	ProjectId string `json:"project_id" jsonschema:"required,The GCP project ID in which to create this VPC network. Example: 'my-prod-project-123'"`
	// Whether to use auto subnet mode (true) or custom subnet mode (false).
	//  **Default:** false (custom mode). Auto mode is not recommended for production:contentReference[oaicite:4]{index=4}.
	AutoCreateSubnetworks bool `json:"auto_create_subnetworks,omitempty" jsonschema:"Whether to use auto subnet mode (true) or custom subnet mode (false). **Default:** false (custom mode). Auto mode is not recommended for production:contentReference[oaicite:4]{index=4}."`
	// Dynamic routing mode for the VPC's Cloud Routers: REGIONAL or GLOBAL.
	//  **Default:** REGIONAL (Cloud Router adverts routes only in one region):contentReference[oaicite:5]{index=5}.
	//  Use GLOBAL only for multi-region routing needs.
	RoutingMode string `json:"routing_mode,omitempty" jsonschema:"enum=GLOBAL,Dynamic routing mode for the VPC's Cloud Routers: REGIONAL or GLOBAL. **Default:** REGIONAL (Cloud Router adverts routes only in one region):contentReference[oaicite:5]{index=5}. Use GLOBAL only for m..."`
	// Name of the VPC network to create in GCP.
	//  Must be 1-63 characters, lowercase letters, numbers, or hyphens.
	//  Must start with a lowercase letter and end with a lowercase letter or number.
	//  Example: "my-vpc-network", "prod-network"
	NetworkName string `json:"network_name" jsonschema:"required,Name of the VPC network to create in GCP. Must be 1-63 characters; lowercase letters; numbers; or hyphens. Must start with a lowercase letter and end with a lowercase letter or number. Example: 'my-vp..."`
	// Private Services Access configuration for connecting to Google managed services
	//  (Cloud SQL, Memorystore, Filestore, etc.) via private IP.
	//  PREREQUISITE: Enable servicenetworking.googleapis.com via GcpProject before using this.
	PrivateServicesAccess *GcpVpcPrivateServicesAccessInput `json:"private_services_access,omitempty" jsonschema:"Private Services Access configuration for connecting to Google managed services (Cloud SQL; Memorystore; Filestore; etc.) via private IP. PREREQUISITE: Enable servicenetworking.googleapis.com via GcpP..."`
}

func (s *GcpVpcSpecInput) validate() error {
	if s.ProjectId == "" {
		return fmt.Errorf("project_id is required")
	}
	switch s.RoutingMode {
	case "", "GLOBAL":
	default:
		return fmt.Errorf("invalid routing_mode: %q", s.RoutingMode)
	}
	if s.NetworkName == "" {
		return fmt.Errorf("network_name is required")
	}
	if s.PrivateServicesAccess != nil {
		if err := s.PrivateServicesAccess.validate(); err != nil {
			return fmt.Errorf("private_services_access: %w", err)
		}
	}
	return nil
}

func (s *GcpVpcSpecInput) applyDefaults() {
	if s.RoutingMode == "" {
		s.RoutingMode = "REGIONAL"
	}
	if s.PrivateServicesAccess != nil {
		s.PrivateServicesAccess.applyDefaults()
	}
}

func (s *GcpVpcSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["project_id"] = s.ProjectId
	if s.AutoCreateSubnetworks {
		m["auto_create_subnetworks"] = s.AutoCreateSubnetworks
	}
	if s.RoutingMode != "" {
		m["routing_mode"] = s.RoutingMode
	}
	m["network_name"] = s.NetworkName
	if s.PrivateServicesAccess != nil {
		m["private_services_access"] = s.PrivateServicesAccess.toMap()
	}
	return m
}

// Private Services Access configuration for Google managed services (Cloud SQL, Memorystore, etc.).
//
//	This creates VPC peering with Google's service network, enabling private IP connectivity.
//	PREREQUISITE: servicenetworking.googleapis.com must be enabled on the project via GcpProject.
type GcpVpcPrivateServicesAccessInput struct {
	// Enable Private Services Access (VPC peering with Google's service network).
	//  When enabled, Google managed services can be assigned private IPs from this VPC.
	Enabled bool `json:"enabled,omitempty" jsonschema:"Enable Private Services Access (VPC peering with Google's service network). When enabled; Google managed services can be assigned private IPs from this VPC."`
	// IP range prefix length for private services allocation.
	//  Determines how many IPs are reserved for Google managed services.
	//  Default: 16 (/16 = 65,536 IPs). Valid range: 8-24.
	//  Use smaller prefix (more IPs) if running many managed service instances.
	IpRangePrefixLength int32 `json:"ip_range_prefix_length,omitempty" jsonschema:"IP range prefix length for private services allocation. Determines how many IPs are reserved for Google managed services. Default: 16 (/16 = 65;536 IPs). Valid range: 8-24. Use smaller prefix (more IP..."`
}

func (s *GcpVpcPrivateServicesAccessInput) validate() error {
	return nil
}

func (s *GcpVpcPrivateServicesAccessInput) applyDefaults() {
	if s.IpRangePrefixLength == 0 {
		s.IpRangePrefixLength = 16
	}
}

func (s *GcpVpcPrivateServicesAccessInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Enabled {
		m["enabled"] = s.Enabled
	}
	if s.IpRangePrefixLength != 0 {
		m["ip_range_prefix_length"] = s.IpRangePrefixLength
	}
	return m
}

// ParseGcpVpc validates and normalizes a GcpVpc cloud_object.
func ParseGcpVpc(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "gcp.openmcf.org/v1", "GcpVpc"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec GcpVpcSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
