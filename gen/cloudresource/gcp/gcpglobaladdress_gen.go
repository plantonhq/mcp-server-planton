// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:01:03+05:30

package gcp

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// gcp-global-address
type GcpGlobalAddressSpecInput struct {
	// The GCP project in which to create this global address reservation.
	//  Example: "my-prod-project-123"
	ProjectId string `json:"project_id" jsonschema:"required,The GCP project in which to create this global address reservation. Example: 'my-prod-project-123'"`
	// Name of the global address resource in GCP.
	//  Must be 1-63 characters, lowercase letters, numbers, or hyphens.
	//  Must start with a lowercase letter and end with a letter or number.
	//  Example: "lb-external-ip", "vpc-peering-range"
	AddressName string `json:"address_name" jsonschema:"required,Name of the global address resource in GCP. Must be 1-63 characters; lowercase letters; numbers; or hyphens. Must start with a lowercase letter and end with a letter or number. Example: 'lb-external-i..."`
	// The static IP address to reserve. If omitted, GCP assigns an address automatically.
	//  For EXTERNAL addresses this is a single IP. For INTERNAL VPC_PEERING addresses
	//  this is the start of the reserved CIDR range.
	Address string `json:"address,omitempty" jsonschema:"The static IP address to reserve. If omitted; GCP assigns an address automatically. For EXTERNAL addresses this is a single IP. For INTERNAL VPC_PEERING addresses this is the start of the reserved CID..."`
	// The type of address to reserve.
	//  EXTERNAL reserves a public IP address (default). INTERNAL reserves a private IP range
	//  within a VPC network for purposes like VPC peering or Private Service Connect.
	AddressType string `json:"address_type,omitempty" jsonschema:"The type of address to reserve. EXTERNAL reserves a public IP address (default). INTERNAL reserves a private IP range within a VPC network for purposes like VPC peering or Private Service Connect."`
	// Human-readable description of this address reservation.
	//  Example: "Static IP for production HTTPS load balancer"
	Description string `json:"description,omitempty" jsonschema:"Human-readable description of this address reservation. Example: 'Static IP for production HTTPS load balancer'"`
	// The IP version for this address. Defaults to IPV4.
	IpVersion string `json:"ip_version,omitempty" jsonschema:"The IP version for this address. Defaults to IPV4."`
	// The VPC network for internal address reservations.
	//  Required when address_type is INTERNAL. Accepts a network name or full self-link URL.
	//  The reserved IP range must be in RFC1918 space and the network cannot be deleted
	//  while reserved IP ranges refer to it.
	Network string `json:"network,omitempty" jsonschema:"The VPC network for internal address reservations. Required when address_type is INTERNAL. Accepts a network name or full self-link URL. The reserved IP range must be in RFC1918 space and the network ..."`
	// The prefix length of the IP range to reserve.
	//  Required for VPC_PEERING purpose (e.g., 20 reserves a /20 range).
	//  Not applicable for single IP reservations or PRIVATE_SERVICE_CONNECT addresses.
	//  Valid range: 8 to 29.
	PrefixLength int32 `json:"prefix_length,omitempty" jsonschema:"The prefix length of the IP range to reserve. Required for VPC_PEERING purpose (e.g.; 20 reserves a /20 range). Not applicable for single IP reservations or PRIVATE_SERVICE_CONNECT addresses. Valid ra..."`
	// The purpose of this address reservation. Only applicable for INTERNAL addresses.
	//  VPC_PEERING — reserves a CIDR range for VPC network peering. Used by managed services
	//  like Cloud SQL, Redis, AlloyDB, and Filestore for private networking.
	//  PRIVATE_SERVICE_CONNECT — reserves an address for a Priv...
	Purpose string `json:"purpose,omitempty" jsonschema:"The purpose of this address reservation. Only applicable for INTERNAL addresses. VPC_PEERING — reserves a CIDR range for VPC network peering. Used by managed services like Cloud SQL; Redis; AlloyDB;..."`
}

func (s *GcpGlobalAddressSpecInput) validate() error {
	if s.ProjectId == "" {
		return fmt.Errorf("project_id is required")
	}
	if s.AddressName == "" {
		return fmt.Errorf("address_name is required")
	}
	return nil
}

func (s *GcpGlobalAddressSpecInput) applyDefaults() {
	if s.AddressType == "" {
		s.AddressType = "EXTERNAL"
	}
	if s.IpVersion == "" {
		s.IpVersion = "IPV4"
	}
}

func (s *GcpGlobalAddressSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["project_id"] = s.ProjectId
	m["address_name"] = s.AddressName
	if s.Address != "" {
		m["address"] = s.Address
	}
	if s.AddressType != "" {
		m["address_type"] = s.AddressType
	}
	if s.Description != "" {
		m["description"] = s.Description
	}
	if s.IpVersion != "" {
		m["ip_version"] = s.IpVersion
	}
	if s.Network != "" {
		m["network"] = s.Network
	}
	if s.PrefixLength != 0 {
		m["prefix_length"] = s.PrefixLength
	}
	if s.Purpose != "" {
		m["purpose"] = s.Purpose
	}
	return m
}

// ParseGcpGlobalAddress validates and normalizes a GcpGlobalAddress cloud_object.
func ParseGcpGlobalAddress(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "gcp.openmcf.org/v1", "GcpGlobalAddress"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec GcpGlobalAddressSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
