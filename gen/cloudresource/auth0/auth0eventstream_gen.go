// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package auth0

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// Auth0EventStream is a deployment component that configures an Event Stream in Auth0.
//
//	Event Streams enable real-time delivery of Auth0 events to external systems like
//	AWS EventBridge or custom webhook endpoints.
//
//	Use cases:
//	- Stream authentication events to a SIEM system for security monitoring
//	- Trigger workflows when users are created or updated
//	- Build real-time dashboards for login analytics
//	- Integrate Auth0 events with AWS Lambda for serverless processing
//
//	Example manifest for EventBridge:
//	```yaml
//	apiVersion: auth0.openmcf.org/v1
//	kind: Auth0EventStream
//	metadata:
//	  name: security-events
//	  org: my-organization
//	  env: production
//	spec:
//	  destination_type: eventbridge
//	  subscriptions:
//	    - user.created
//	    - user.updated
//	    - authentication.success
//	    - authentication.failure
//	  eventbridge_configuration:
//	    aws_account_id: "123456789012"
//	    aws_region: us-east-1
//	```
//
//	Example manifest for Webhook:
//	```yaml
//	apiVersion: auth0.openmcf.org/v1
//	kind: Auth0EventStream
//	metadata:
//	  name: user-events-webhook
//	  org: my-organization
//	  env: production
//	spec:
//	  destination_type: webhook
//	  subscriptions:
//	    - user.created
//	    - user.updated
//	    - user.deleted
//	  webhook_configuration:
//	    webhook_endpoint: "https://api.example.com/webhooks/auth0"
//	    webhook_authorization:
//	      method: bearer
//	      token: "your-secret-token"
//	```
type Auth0EventStreamSpecInput struct {
	// destination_type specifies where events should be delivered.
	//  This determines which configuration block is required.
	//
	//  - "eventbridge": Events are delivered to AWS EventBridge.
	//    Requires eventbridge_configuration to be set.
	//    EventBridge configurations cannot be updated after creation.
	//
	//  - "webho...
	DestinationType string `json:"destination_type" jsonschema:"required,destination_type specifies where events should be delivered. This determines which configuration block is required. - 'eventbridge': Events are delivered to AWS EventBridge. Requires eventbridge_confi..."`
	// subscriptions is a list of event types this stream is subscribed to.
	//  Only events matching these types will be delivered to the destination.
	//  At least one subscription is required.
	//
	//  Common event types:
	//  - User events: user.created, user.updated, user.deleted
	//  - Authentication: authentication.succes...
	Subscriptions []string `json:"subscriptions,omitempty" jsonschema:"subscriptions is a list of event types this stream is subscribed to. Only events matching these types will be delivered to the destination. At least one subscription is required. Common event types: -..."`
	// eventbridge_configuration contains settings for AWS EventBridge destination.
	//  Only applicable when destination_type is "eventbridge".
	//
	//  EventBridge configurations CANNOT be updated after creation.
	//  Any change will force the resource to be recreated.
	EventbridgeConfiguration *Auth0EventBridgeConfigurationInput `json:"eventbridge_configuration,omitempty" jsonschema:"eventbridge_configuration contains settings for AWS EventBridge destination. Only applicable when destination_type is 'eventbridge'. EventBridge configurations CANNOT be updated after creation. Any ch..."`
	// webhook_configuration contains settings for webhook destination.
	//  Only applicable when destination_type is "webhook".
	//
	//  Webhook configurations CAN be updated after creation,
	//  including the endpoint and authorization settings.
	WebhookConfiguration *Auth0WebhookConfigurationInput `json:"webhook_configuration,omitempty" jsonschema:"webhook_configuration contains settings for webhook destination. Only applicable when destination_type is 'webhook'. Webhook configurations CAN be updated after creation; including the endpoint and au..."`
}

func (s *Auth0EventStreamSpecInput) validate() error {
	if s.DestinationType == "" {
		return fmt.Errorf("destination_type is required")
	}
	if len(s.Subscriptions) < 1 {
		return fmt.Errorf("subscriptions requires at least 1 items, got %d", len(s.Subscriptions))
	}
	if s.EventbridgeConfiguration != nil {
		if err := s.EventbridgeConfiguration.validate(); err != nil {
			return fmt.Errorf("eventbridge_configuration: %w", err)
		}
	}
	if s.WebhookConfiguration != nil {
		if err := s.WebhookConfiguration.validate(); err != nil {
			return fmt.Errorf("webhook_configuration: %w", err)
		}
	}
	return nil
}

func (s *Auth0EventStreamSpecInput) applyDefaults() {
	if s.EventbridgeConfiguration != nil {
		s.EventbridgeConfiguration.applyDefaults()
	}
	if s.WebhookConfiguration != nil {
		s.WebhookConfiguration.applyDefaults()
	}
}

func (s *Auth0EventStreamSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	m["destination_type"] = s.DestinationType
	if len(s.Subscriptions) > 0 {
		m["subscriptions"] = s.Subscriptions
	}
	if s.EventbridgeConfiguration != nil {
		m["eventbridge_configuration"] = s.EventbridgeConfiguration.toMap()
	}
	if s.WebhookConfiguration != nil {
		m["webhook_configuration"] = s.WebhookConfiguration.toMap()
	}
	return m
}

// Auth0EventBridgeConfiguration configures AWS EventBridge as the event destination.
//
//	EventBridge enables serverless processing of Auth0 events in AWS.
//
//	IMPORTANT: EventBridge configurations cannot be updated after creation.
//	Any change to these settings will force the event stream to be recreated.
//
//	Setup flow:
//	1. Auth0 creates a partner event source in your AWS account
//	2. You must associate the event source with an EventBridge event bus
//	3. Create rules on the event bus to route events to targets
type Auth0EventBridgeConfigurationInput struct {
	// aws_account_id is the AWS account ID where events will be delivered.
	//  This is the 12-digit AWS account number.
	//  Example: "123456789012"
	//
	//  Auth0 will create a partner event source in this account.
	AwsAccountId string `json:"aws_account_id" jsonschema:"required,aws_account_id is the AWS account ID where events will be delivered. This is the 12-digit AWS account number. Example: '123456789012' Auth0 will create a partner event source in this account."`
	// aws_region is the AWS region for the EventBridge event bus.
	//  Events will be delivered to this region.
	//  Example: "us-east-1", "eu-west-1"
	//
	//  Common regions:
	//  - us-east-1 (N. Virginia)
	//  - us-west-2 (Oregon)
	//  - eu-west-1 (Ireland)
	//  - ap-southeast-1 (Singapore)
	AwsRegion string `json:"aws_region" jsonschema:"required,aws_region is the AWS region for the EventBridge event bus. Events will be delivered to this region. Example: 'us-east-1'; 'eu-west-1' Common regions: - us-east-1 (N. Virginia) - us-west-2 (Oregon) - ..."`
}

func (s *Auth0EventBridgeConfigurationInput) validate() error {
	if s.AwsAccountId == "" {
		return fmt.Errorf("aws_account_id is required")
	}
	if s.AwsRegion == "" {
		return fmt.Errorf("aws_region is required")
	}
	return nil
}

func (s *Auth0EventBridgeConfigurationInput) applyDefaults() {
}

func (s *Auth0EventBridgeConfigurationInput) toMap() map[string]any {
	m := make(map[string]any)
	m["aws_account_id"] = s.AwsAccountId
	m["aws_region"] = s.AwsRegion
	return m
}

// Auth0WebhookAuthorization configures authentication for webhook endpoints.
//
//	Supports both Basic and Bearer token authentication methods.
type Auth0WebhookAuthorizationInput struct {
	// method specifies the authorization method for the webhook.
	//
	//  - "basic": HTTP Basic Authentication using username and password.
	//    Auth0 sends: Authorization: Basic base64(username:password)
	//
	//  - "bearer": Bearer token authentication.
	//    Auth0 sends: Authorization: Bearer <token>
	Method string `json:"method" jsonschema:"required,method specifies the authorization method for the webhook. - 'basic': HTTP Basic Authentication using username and password. Auth0 sends: Authorization: Basic base64(username:password) - 'bearer': Bea..."`
	// username is the username for Basic authentication.
	//  Required when method is "basic".
	//  Ignored when method is "bearer".
	Username string `json:"username,omitempty" jsonschema:"username is the username for Basic authentication. Required when method is 'basic'. Ignored when method is 'bearer'."`
	// password is the password for Basic authentication.
	//  Required when method is "basic".
	//  This value is stored securely and never returned by the API.
	//  Ignored when method is "bearer".
	Password string `json:"password,omitempty" jsonschema:"password is the password for Basic authentication. Required when method is 'basic'. This value is stored securely and never returned by the API. Ignored when method is 'bearer'."`
	// token is the bearer token for token-based authentication.
	//  Required when method is "bearer".
	//  This value is stored securely and never returned by the API.
	//  Ignored when method is "basic".
	//
	//  Generate a secure token using OpenSSL:
	//    openssl rand -base64 32   # Base64 encoded (recommended)
	//    openssl ...
	Token string `json:"token,omitempty" jsonschema:"token is the bearer token for token-based authentication. Required when method is 'bearer'. This value is stored securely and never returned by the API. Ignored when method is 'basic'. Generate a secu..."`
}

func (s *Auth0WebhookAuthorizationInput) validate() error {
	if s.Method == "" {
		return fmt.Errorf("method is required")
	}
	return nil
}

func (s *Auth0WebhookAuthorizationInput) applyDefaults() {
}

func (s *Auth0WebhookAuthorizationInput) toMap() map[string]any {
	m := make(map[string]any)
	m["method"] = s.Method
	if s.Username != "" {
		m["username"] = s.Username
	}
	if s.Password != "" {
		m["password"] = s.Password
	}
	if s.Token != "" {
		m["token"] = s.Token
	}
	return m
}

// Auth0WebhookConfiguration configures an HTTPS endpoint as the event destination.
//
//	Webhooks allow custom event processing at any HTTP endpoint.
//
//	Webhook configurations can be updated after creation.
type Auth0WebhookConfigurationInput struct {
	// webhook_endpoint is the HTTPS URL that will receive webhook events.
	//  Must be a valid, publicly accessible HTTPS URL.
	//  Auth0 will POST event payloads to this endpoint.
	//
	//  Requirements:
	//  - Must use HTTPS (HTTP is not supported)
	//  - Must be publicly accessible
	//  - Should respond with 2xx status within 10 ...
	WebhookEndpoint string `json:"webhook_endpoint" jsonschema:"required,webhook_endpoint is the HTTPS URL that will receive webhook events. Must be a valid; publicly accessible HTTPS URL. Auth0 will POST event payloads to this endpoint. Requirements: - Must use HTTPS (HTT..."`
	// webhook_authorization contains authentication settings for the webhook endpoint.
	//  Auth0 will include these credentials when calling your endpoint.
	WebhookAuthorization *Auth0WebhookAuthorizationInput `json:"webhook_authorization" jsonschema:"required,webhook_authorization contains authentication settings for the webhook endpoint. Auth0 will include these credentials when calling your endpoint."`
}

func (s *Auth0WebhookConfigurationInput) validate() error {
	if s.WebhookEndpoint == "" {
		return fmt.Errorf("webhook_endpoint is required")
	}
	if s.WebhookAuthorization == nil {
		return fmt.Errorf("webhook_authorization is required")
	}
	if s.WebhookAuthorization != nil {
		if err := s.WebhookAuthorization.validate(); err != nil {
			return fmt.Errorf("webhook_authorization: %w", err)
		}
	}
	return nil
}

func (s *Auth0WebhookConfigurationInput) applyDefaults() {
	if s.WebhookAuthorization != nil {
		s.WebhookAuthorization.applyDefaults()
	}
}

func (s *Auth0WebhookConfigurationInput) toMap() map[string]any {
	m := make(map[string]any)
	m["webhook_endpoint"] = s.WebhookEndpoint
	if s.WebhookAuthorization != nil {
		m["webhook_authorization"] = s.WebhookAuthorization.toMap()
	}
	return m
}

// ParseAuth0EventStream validates and normalizes a Auth0EventStream cloud_object.
func ParseAuth0EventStream(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "auth0.openmcf.org/v1", "Auth0EventStream"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec Auth0EventStreamSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
