// Code generated by schema2go. DO NOT EDIT.
// Generated: 2026-02-26T22:50:56+05:30

package digitalocean

import (
	"encoding/json"
	"fmt"

	"github.com/plantoncloud/mcp-server-planton/internal/parse"
	"google.golang.org/protobuf/types/known/structpb"
)

var (
	_ = json.Marshal
	_ = fmt.Errorf
	_ = parse.ValidateHeader
	_ = (*structpb.Struct)(nil)
)

// digital-ocean-function
type DigitalOceanFunctionSpecInput struct {
	// function_name is the name of the function. Must be unique within the project.
	FunctionName string `json:"function_name,omitempty" jsonschema:"function_name is the name of the function. Must be unique within the project."`
	// region specifies the DigitalOcean region to deploy the function.
	Region string `json:"region" jsonschema:"required,enum=nyc3|sfo3|fra1|sgp1|lon1|tor1|blr1|ams3,region specifies the DigitalOcean region to deploy the function."`
	// runtime specifies the runtime environment for the function (e.g., nodejs, python, go).
	Runtime string `json:"runtime" jsonschema:"required,enum=nodejs_18|nodejs_20|python_39|python_310|python_311|go_120|go_121|php_82,runtime specifies the runtime environment for the function (e.g.; nodejs; python; go)."`
	// GitHub repository configuration for function source code
	GithubSource *DigitalOceanFunctionGithubSourceInput `json:"github_source,omitempty" jsonschema:"GitHub repository configuration for function source code"`
	// source_directory is the path within the repository containing the function code and project.yml
	//  Example: "/functions/api-handler"
	SourceDirectory string `json:"source_directory,omitempty" jsonschema:"source_directory is the path within the repository containing the function code and project.yml Example: '/functions/api-handler'"`
	// memory_mb is the memory allocated to the function (in megabytes). Defaults to 256 if not specified.
	//  Valid values: 128, 256, 512, 1024, 2048
	MemoryMb uint32 `json:"memory_mb,omitempty" jsonschema:"memory_mb is the memory allocated to the function (in megabytes). Defaults to 256 if not specified. Valid values: 128; 256; 512; 1024; 2048"`
	// timeout_ms is the maximum execution time for the function in milliseconds.
	//  Defaults to 3000ms (3 seconds) if not specified. Max: 300000ms (5 minutes)
	TimeoutMs uint32 `json:"timeout_ms,omitempty" jsonschema:"timeout_ms is the maximum execution time for the function in milliseconds. Defaults to 3000ms (3 seconds) if not specified. Max: 300000ms (5 minutes)"`
	// environment_variables are non-secret environment variables for the function
	EnvironmentVariables map[string]string `json:"environment_variables,omitempty" jsonschema:"environment_variables are non-secret environment variables for the function"`
	// secret_environment_variables are encrypted environment variables (e.g., database URLs, API keys)
	//  These are stored securely in App Platform's secret store
	SecretEnvironmentVariables map[string]string `json:"secret_environment_variables,omitempty" jsonschema:"secret_environment_variables are encrypted environment variables (e.g.; database URLs; API keys) These are stored securely in App Platform's secret store"`
	// entrypoint is an optional function or script entrypoint name within the code
	//  Example: "main" for Go, "handler" for Node.js
	Entrypoint string `json:"entrypoint,omitempty" jsonschema:"entrypoint is an optional function or script entrypoint name within the code Example: 'main' for Go; 'handler' for Node.js"`
	// cron_schedule is an optional cron expression for scheduled function execution
	//  Example: "0 * * * *" for hourly execution
	//  If set, the function will not be exposed as an HTTP endpoint
	CronSchedule string `json:"cron_schedule,omitempty" jsonschema:"cron_schedule is an optional cron expression for scheduled function execution Example: '0 * * * *' for hourly execution If set; the function will not be exposed as an HTTP endpoint"`
	// is_web indicates if the function should be exposed as an HTTP endpoint
	//  Defaults to true. Set to false for background/scheduled functions.
	IsWeb bool `json:"is_web,omitempty" jsonschema:"is_web indicates if the function should be exposed as an HTTP endpoint Defaults to true. Set to false for background/scheduled functions."`
}

func (s *DigitalOceanFunctionSpecInput) validate() error {
	if s.Region == "" {
		return fmt.Errorf("region is required")
	}
	switch s.Region {
	case "nyc3", "sfo3", "fra1", "sgp1", "lon1", "tor1", "blr1", "ams3":
	default:
		return fmt.Errorf("invalid region: %q", s.Region)
	}
	if s.Runtime == "" {
		return fmt.Errorf("runtime is required")
	}
	switch s.Runtime {
	case "nodejs_18", "nodejs_20", "python_39", "python_310", "python_311", "go_120", "go_121", "php_82":
	default:
		return fmt.Errorf("invalid runtime: %q", s.Runtime)
	}
	if s.GithubSource != nil {
		if err := s.GithubSource.validate(); err != nil {
			return fmt.Errorf("github_source: %w", err)
		}
	}
	return nil
}

func (s *DigitalOceanFunctionSpecInput) applyDefaults() {
	if s.GithubSource != nil {
		s.GithubSource.applyDefaults()
	}
}

func (s *DigitalOceanFunctionSpecInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.FunctionName != "" {
		m["function_name"] = s.FunctionName
	}
	m["region"] = s.Region
	m["runtime"] = s.Runtime
	if s.GithubSource != nil {
		m["github_source"] = s.GithubSource.toMap()
	}
	if s.SourceDirectory != "" {
		m["source_directory"] = s.SourceDirectory
	}
	if s.MemoryMb != 0 {
		m["memory_mb"] = s.MemoryMb
	}
	if s.TimeoutMs != 0 {
		m["timeout_ms"] = s.TimeoutMs
	}
	if len(s.EnvironmentVariables) > 0 {
		m["environment_variables"] = s.EnvironmentVariables
	}
	if len(s.SecretEnvironmentVariables) > 0 {
		m["secret_environment_variables"] = s.SecretEnvironmentVariables
	}
	if s.Entrypoint != "" {
		m["entrypoint"] = s.Entrypoint
	}
	if s.CronSchedule != "" {
		m["cron_schedule"] = s.CronSchedule
	}
	if s.IsWeb {
		m["is_web"] = s.IsWeb
	}
	return m
}

// DigitalOceanFunctionGithubSource defines the GitHub repository configuration for function source code
type DigitalOceanFunctionGithubSourceInput struct {
	// repo is the GitHub repository in the format "owner/repo"
	Repo string `json:"repo,omitempty" jsonschema:"repo is the GitHub repository in the format 'owner/repo'"`
	// branch is the Git branch to deploy from (e.g., "main", "production")
	Branch string `json:"branch,omitempty" jsonschema:"branch is the Git branch to deploy from (e.g.; 'main'; 'production')"`
	// deploy_on_push enables automatic redeployment when changes are pushed to the branch
	DeployOnPush bool `json:"deploy_on_push,omitempty" jsonschema:"deploy_on_push enables automatic redeployment when changes are pushed to the branch"`
}

func (s *DigitalOceanFunctionGithubSourceInput) validate() error {
	return nil
}

func (s *DigitalOceanFunctionGithubSourceInput) applyDefaults() {
}

func (s *DigitalOceanFunctionGithubSourceInput) toMap() map[string]any {
	m := make(map[string]any)
	if s.Repo != "" {
		m["repo"] = s.Repo
	}
	if s.Branch != "" {
		m["branch"] = s.Branch
	}
	if s.DeployOnPush {
		m["deploy_on_push"] = s.DeployOnPush
	}
	return m
}

// ParseDigitalOceanFunction validates and normalizes a DigitalOceanFunction cloud_object.
func ParseDigitalOceanFunction(cloudObject map[string]any) (*structpb.Struct, error) {
	if err := parse.ValidateHeader(cloudObject, "digital-ocean.openmcf.org/v1", "DigitalOceanFunction"); err != nil {
		return nil, err
	}

	specMap, err := parse.ExtractSpecMap(cloudObject)
	if err != nil {
		return nil, err
	}

	specBytes, err := json.Marshal(specMap)
	if err != nil {
		return nil, fmt.Errorf("marshal spec: %w", err)
	}

	var spec DigitalOceanFunctionSpecInput
	if err := json.Unmarshal(specBytes, &spec); err != nil {
		return nil, fmt.Errorf("invalid spec: %w", err)
	}

	if err := spec.validate(); err != nil {
		return nil, err
	}

	spec.applyDefaults()

	return parse.RebuildCloudObject(cloudObject, spec.toMap())
}
